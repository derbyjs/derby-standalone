!function(){var t=function(t){var e;return function(n){return e||t(e={exports:{},parent:n},e.exports),e.exports}},e=t(function(t,e){var i=r({}),o=n({}).DependencyOptions,s=ur.concat,a=ur.hasKeys,p=ur.traverseAndCreate;function u(t,e,n,r){for(var i=0;i<e.length;i++)t=c(t,e[i],n,r);return t}function c(t,e,n,r){var i=h(e,n,r);return s(t,i)}function h(t,e,n){return t.dependencies(e,n)}!function(){for(var t in cn)e[t]=cn[t]}(),e.Marker=f,e.View=y,e.ViewInstance=v,e.DynamicViewInstance=g,e.ViewParent=x,e.ContextClosure=b,e.Views=_,e.MarkupHook=E,e.ElementOn=C,e.ComponentOn=S,e.AsProperty=A,e.AsObject=k,e.AsObjectComponent=I,e.AsArray=T,e.AsArrayComponent=L,e.emptyTemplate=new cn.Template([]),cn.Template.prototype.isUnbound=function(t){return t.unbound},cn.Binding.prototype.isUnbound=function(){return this.template.expression.isUnbound(this.context)},cn.Template.prototype.resolve=function(){},cn.Template.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return u(null,this.content,t,e)},cn.Doctype.prototype.dependencies=function(){},cn.Text.prototype.dependencies=function(){},cn.DynamicText.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return h(this.expression,t,e)},cn.Comment.prototype.dependencies=function(){},cn.DynamicComment.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return h(this.expression,t,e)},cn.Html.prototype.dependencies=function(){},cn.DynamicHtml.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return h(this.expression,t,e)},cn.Element.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=function(t,e,n,r){for(var i in e)t=c(t,e[i],n,r);return t}(null,this.attributes,t,e);return this.content?u(n,this.content,t,e):n}},cn.DynamicElement.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return c(cn.Element.prototype.dependencies(t,e),this.tagName,t,e)},cn.Block.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this.expression.meta&&"on"===this.expression.meta.blockType?h(this.expression,t,e):null,r=t.child(this.expression);return u(n,this.content,r,e)}},cn.ConditionalBlock.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this.getCondition(t);if(null==n)return h(this.expressions[0],t,e);var r=function(t,e,n,r,i){for(var o=0;o<=i;o++)t=c(t,e[o],n,r);return t}(null,this.expressions,t,e,n),i=this.expressions[n];return u(r,this.contents[n],t.child(i),e)}},cn.EachBlock.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=h(this.expression,t,e),r=this.expression.get(t);if(r&&r.length)for(var i=0;i<r.length;i++){var s=t.eachChild(this.expression,i);n=u(n,this.content,s,e)}else this.elseContent&&(n=u(n,this.elseContent,t,e));return n}},cn.Attribute.prototype.dependencies=function(){},cn.DynamicAttribute.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return h(this.expression,t,e)};var l=[{emit:function(t,e){e.$component=t.controller,t.controller.markerNode=e}}];function f(t){cn.Comment.call(this,t,l)}function d(t){for(var e=t.split(/\s+/),n=0,r=e.length;n<r;n++)this[e[n]]=!0}function m(t){for(var e=t.split(/\s+/),n=0,r=e.length;n<r;n++){var i=e[n].split("/");this[i[0]]=i[1]||i[0]}}function y(t,e,n,r){this.views=t,this.name=e,this.source=n,this.options=r;var i=(this.name||"").split(":"),o=i.pop();this.namespace=i.join(":"),this.registeredName="index"===o?this.namespace:this.name,this.attributesMap=r&&r.attributes&&new d(r.attributes),this.arraysMap=r&&r.arrays&&new m(r.arrays),this.unminified=r&&(r.unminified||""===r.unminified),this.string=r&&(r.string||""===r.string),this.literal=r&&(r.literal||""===r.literal),this.template=null,this.componentFactory=null}function v(t,e,n,r){this.name=t,this.attributes=e,this.hooks=n,this.initHooks=r,this.view=null}function g(t,e,n,r){this.nameExpression=t,this.attributes=e,this.hooks=n,this.initHooks=r}function x(t){this.template=t}function b(t,e){this.template=t,this.context=e}function w(){}function _(){this.nameMap=new w,this.tagMap=new w,this.elementMap=this.tagMap}function E(){}function C(t,e){this.name=t,this.expression=e}function S(t,e){this.name=t,this.expression=e}function A(t){this.segments=t,this.lastSegment=t.pop()}function k(t,e){A.call(this,t),this.keyExpression=e}function I(t,e){k.call(this,t,e)}function T(t){A.call(this,t)}function L(t){T.call(this,t)}f.prototype=Object.create(cn.Comment.prototype),f.prototype.constructor=f,f.prototype.type="Marker",f.prototype.serialize=function(){return i.instance(this,this.data)},f.prototype.get=function(){return""},y.prototype=Object.create(cn.Template.prototype),y.prototype.constructor=y,y.prototype.type="View",y.prototype.serialize=function(){return null},y.prototype._isComponent=function(t){return!!this.componentFactory&&(!t.attributes||!t.attributes.extend)},y.prototype._initComponent=function(t){return this._isComponent(t)?this.componentFactory.init(t):t},y.prototype._queueCreate=function(t,e){if(this._isComponent(t)){var n=this.componentFactory;if(t.queue(function(){n.create(e)}),!t.hooks)return;t.queue(function(){for(var n=0,r=t.hooks.length;n<r;n++)t.hooks[n].emit(t,e.controller)})}},y.prototype.get=function(t,e){var n=this._initComponent(t);return(this.template||this.parse()).get(n,e)},y.prototype.getFragment=function(t,e){var n=this._initComponent(t),r=(this.template||this.parse()).getFragment(n,e);return this._queueCreate(t,n),r},y.prototype.appendTo=function(t,e){var n=this._initComponent(e);(this.template||this.parse()).appendTo(t,n),this._queueCreate(e,n)},y.prototype.attachTo=function(t,e,n){var r=this._initComponent(n);e=(this.template||this.parse()).attachTo(t,e,r);return this._queueCreate(n,r),e},y.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this.template||this.parse(),r=this._isComponent(t)?t.componentChild(null):t;return n.dependencies(r,e)}},y.prototype.parse=function(){if(this._parse(),this.componentFactory){var t=new f(this.name);this.template.content.unshift(t)}return this.template},y.prototype._parse=function(){throw new Error("View parsing not available")},v.prototype=Object.create(cn.Template.prototype),v.prototype.constructor=v,v.prototype.type="ViewInstance",v.prototype.serialize=function(){return i.instance(this,this.name,this.attributes,this.hooks,this.initHooks)},v.prototype.get=function(t,e){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.get(r,e)},v.prototype.getFragment=function(t,e){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.getFragment(r,e)},v.prototype.appendTo=function(t,e){var n=this._find(e),r=e.viewChild(n,this.attributes,this.hooks,this.initHooks);n.appendTo(t,r)},v.prototype.attachTo=function(t,e,n){var r=this._find(n),i=n.viewChild(r,this.attributes,this.hooks,this.initHooks);return r.attachTo(t,e,i)},v.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.dependencies(r,e)}},v.prototype._find=function(t){if(this.view)return this.view;var e=t.getView(),n=e&&e.namespace;if(this.view=t.meta.views.find(this.name,n),!this.view){var r=t.meta.views.findErrorMessage(this.name,e);throw new Error(r)}return this.view},g.prototype=Object.create(v.prototype),g.prototype.constructor=g,g.prototype.type="DynamicViewInstance",g.prototype.serialize=function(){return i.instance(this,this.nameExpression,this.attributes,this.hooks,this.initHooks)},g.prototype._find=function(t){var n=this.nameExpression.get(t),r=t.getView(),i=r&&r.namespace;return n&&t.meta.views.find(n,i)||e.emptyTemplate},g.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this.nameExpression.dependencies(t),r=v.prototype.dependencies.call(this,t,e);return s(n,r)}},x.prototype=Object.create(cn.Template.prototype),x.prototype.constructor=x,x.prototype.type="ViewParent",x.prototype.serialize=function(){return i.instance(this,this.template)},x.prototype.get=function(t,e){var n=t.forViewParent();return this.template.get(n,e)},x.prototype.getFragment=function(t,e){var n=t.forViewParent();return this.template.getFragment(n,e)},x.prototype.appendTo=function(t,e){var n=e.forViewParent();this.template.appendTo(t,n)},x.prototype.attachTo=function(t,e,n){var r=n.forViewParent();return this.template.attachTo(t,e,r)},x.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=t.forViewParent();return this.template.dependencies(n,e)}},b.prototype=Object.create(cn.Template.prototype),b.prototype.constructor=b,b.prototype.serialize=function(){throw new Error("ContextClosure cannot be serialized")},b.prototype.get=function(t,e){var n=t.closureChild(this.context);return this.template.get(n,e)},b.prototype.getFragment=function(t,e){var n=t.closureChild(this.context);return this.template.getFragment(n,e)},b.prototype.appendTo=function(t,e){var n=e.closureChild(this.context);this.template.appendTo(t,n)},b.prototype.attachTo=function(t,e,n){var r=n.closureChild(this.context);return this.template.attachTo(t,e,r)},b.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this.template,e)){var n=t.closureChild(this.context);return this.template.dependencies(n,e)}},b.prototype.equals=function(t){return t instanceof b&&this.context===t.context&&this.template.equals(t.template)},_.prototype.find=function(t,e){var n=this.nameMap;if(s=n[e?e+":"+t:t])return s;var r=t.split(":"),i=r.length;for(e&&(r=e.split(":").concat(r));i>0;){for(var o=r.slice();o.length>i;){var s;if(o.splice(-1-i,1),s=n[o.join(":")])return s}i--}},_.prototype.register=function(t,e,n){var r=t.replace(/:index$/,""),i=this.nameMap[r];if(i){var o=i.componentFactory;y.call(i,this,t,e,n),i.componentFactory=o}else i=new y(this,t,e,n);this.nameMap[r]=i;var s=n&&(n.tag||n.element);return s&&(this.tagMap[s]=i),i},_.prototype.serialize=function(t){var n="function(derbyTemplates, views) {var expressions = derbyTemplates.expressions;var templates = derbyTemplates.templates;",r=t&&t.server,o=t&&t.minify;for(var s in this.nameMap){var p=this.nameMap[s],u=p.template||p.parse();if(!r&&p.options){if(p.options.serverOnly)continue;p.options.server&&(u=e.emptyTemplate)}n+="views.register("+i.args([p.name,o?null:p.source,a(p.options)?p.options:null])+").parse = function() {return this.template = "+u.serialize()+"};"}return n+"}"},_.prototype.findErrorMessage=function(t,e){var n=Object.keys(this.nameMap),r='Cannot find view "'+t+'" in'+[""].concat(n).join("\n  ")+"\n";return e&&(r+='\nWithin template "'+e.name+'":\n'+e.source),r},E.prototype.module=cn.Template.prototype.module,C.prototype=Object.create(E.prototype),C.prototype.constructor=C,C.prototype.type="ElementOn",C.prototype.serialize=function(){return i.instance(this,this.name,this.expression)},C.prototype.emit=function(t,e){var n=this;if("create"===this.name)this.apply(t,e);else if("destroy"===this.name){(e.$destroyListeners||(e.$destroyListeners=[])).push(function(){n.apply(t,e)})}else e.addEventListener(this.name,function(r){return n.apply(t,e,r)},!1)},C.prototype.apply=function(t,e,n){var r=t.controller.model.data;r.$event=n,r.$element=e;var i=this.expression.apply(t);return delete r.$event,delete r.$element,i},S.prototype=Object.create(E.prototype),S.prototype.constructor=S,S.prototype.type="ComponentOn",S.prototype.serialize=function(){return i.instance(this,this.name,this.expression)},S.prototype.emit=function(t,e){var n=this.expression;e.on(this.name,function(){var e=arguments.length&&Array.prototype.slice.call(arguments);return n.apply(t,e)})},A.prototype=Object.create(E.prototype),A.prototype.constructor=A,A.prototype.type="AsProperty",A.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return i.instance(this,t)},A.prototype.emit=function(t,e){p(t.controller,this.segments)[this.lastSegment]=e},k.prototype=Object.create(A.prototype),k.prototype.constructor=k,k.prototype.type="AsObject",k.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return i.instance(this,t,this.keyExpression)},k.prototype.emit=function(t,e){var n=p(t.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]={}),i=this.keyExpression.get(t);r[i]=e,this.addListeners(e,r,i)},k.prototype.addListeners=function(t,e,n){this.addDestroyListener(t,function(){delete e[n]})},k.prototype.addDestroyListener=function(t,e){(t.$destroyListeners||(t.$destroyListeners=[])).push(e)},I.prototype=Object.create(k.prototype),I.prototype.constructor=I,I.prototype.type="AsObjectComponent",I.prototype.addDestroyListener=function(t,e){t.on("destroy",e)},T.prototype=Object.create(A.prototype),T.prototype.constructor=T,T.prototype.type="AsArray",T.prototype.emit=function(t,e){for(var n=p(t.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]=[]),i=r.length;i--;){var o=r[i];if(o===e)return;if(4&this.comparePosition(e,o))return r.splice(i+1,0,e),void this.addListeners(e,r)}r.unshift(e),this.addListeners(e,r)},T.prototype.addListeners=function(t,e){this.addDestroyListener(t,function(){var n=e.indexOf(t);-1!==n&&e.splice(n,1)})},T.prototype.comparePosition=function(t,e){return e.compareDocumentPosition(t)},T.prototype.addDestroyListener=k.prototype.addDestroyListener,L.prototype=Object.create(T.prototype),L.prototype.constructor=L,L.prototype.type="AsArrayComponent",L.prototype.comparePosition=function(t,e){return e.markerNode.compareDocumentPosition(t.markerNode)},L.prototype.addDestroyListener=I.prototype.addDestroyListener}),n=t(function(t,n){var r=e({});function i(t){this.setIgnoreTemplate(t&&t.ignoreTemplate)}n.DependencyOptions=i,i.shouldIgnoreTemplate=function(t,e){return!!e&&e.ignoreTemplate===t},i.prototype.setIgnoreTemplate=function(t){for(;t instanceof r.ContextClosure;)t=t.template;this.ignoreTemplate=t}}),r=t(function(t,e){function n(t){for(var e=[],n=t.length;n--;){var i=r(t[n]);e.unshift(i)}for(n=e.length;n--;){if("void 0"!==(i=e[n])&&"null"!==i)break;e.pop()}return e.join(", ")}function r(t){if(t&&t.serialize)return t.serialize();if(void 0===t)return"void 0";if(null===t)return"null";if("string"==typeof t)return i(t);if("number"==typeof t||"boolean"==typeof t)return t+"";if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++){var o=r(t[n]);e.push(o)}return"["+e.join(", ")+"]"}if("object"==typeof t){e=[];for(var s in t){o=r(t[s]);e.push(i(s)+": "+o)}return"{"+e.join(", ")+"}"}}function i(t){return"'"+t.replace(/['\r\n\\]/g,function(t){return"'"===t?"\\'":"\r"===t?"\\r":"\n"===t?"\\n":"\\"===t?"\\\\":""})+"'"}e.instance=function(t){var e=Array.prototype.slice.call(arguments,1);return"new "+t.module+"."+t.type+"("+n(e)+")"},e.args=n}),i=Object.create||function(t){var e=function(){};return e.prototype=t,new e},o=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return n},s=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function a(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=i(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}var p=a;a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0;var u,c=10;try{var h={};Object.defineProperty&&Object.defineProperty(h,"x",{value:0}),u=0===h.x}catch(t){u=!1}function l(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function f(t,e,n,r){var o,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=t._events)?(s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),a=s[e]):(s=t._events=i(null),t._eventsCount=0),a){if("function"==typeof a?a=s[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(o=l(t))&&o>0&&a.length>o){a.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');p.name="MaxListenersExceededWarning",p.emitter=t,p.type=e,p.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",p.name,p.message)}}else a=s[e]=n,++t._eventsCount;return t}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function m(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=s.call(d,r);return i.listener=n,r.wrapFn=i,i}function y(t,e,n){var r=t._events;if(!r)return[];var i=r[e];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):g(i,i.length):[]}function v(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function g(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}u?Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');c=t}}):a.defaultMaxListeners=c,a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(t){var e,n,r,i,o,s,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var p=new Error('Unhandled "error" event. ('+e+")");throw p.context=e,p}if(!(n=s[t]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:!function(t,e,n){if(e)t.call(n);else for(var r=t.length,i=g(t,r),o=0;o<r;++o)i[o].call(n)}(n,u,this);break;case 2:!function(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=g(t,i),s=0;s<i;++s)o[s].call(n,r)}(n,u,this,arguments[1]);break;case 3:!function(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=g(t,o),a=0;a<o;++a)s[a].call(n,r,i)}(n,u,this,arguments[1],arguments[2]);break;case 4:!function(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,a=g(t,s),p=0;p<s;++p)a[p].call(n,r,i,o)}(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=g(t,i),s=0;s<i;++s)o[s].apply(n,r)}(n,u,this,i)}return!0},a.prototype.addListener=function(t,e){return f(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return f(this,t,e,!0)},a.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,m(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,m(this,t,e)),this},a.prototype.removeListener=function(t,e){var n,r,o,s,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=i(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===e||n[s].listener===e){a=n[s].listener,o=s;break}if(o<0)return this;0===o?n.shift():function(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}(n,o),1===n.length&&(r[t]=n[0]),r.removeListener&&this.emit("removeListener",t,a||e)}return this},a.prototype.removeAllListeners=function(t){var e,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=i(null),this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=i(null):delete n[t]),this;if(0===arguments.length){var s,a=o(n);for(r=0;r<a.length;++r)"removeListener"!==(s=a[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=i(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},a.prototype.listeners=function(t){return y(this,t,!0)},a.prototype.rawListeners=function(t){return y(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):v.call(t,e)},a.prototype.listenerCount=v,a.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var x={};(function(t){var e,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var r=new Uint8Array(16);e=function(){return n.getRandomValues(r),r}}if(!e){var i=new Array(16);e=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}x=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});for(var b=[],w={},_=0;_<256;_++)b[_]=(_+256).toString(16).substr(1),w[b[_]]=_;function E(t,e){var n=e||0,r=b;return r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]}var C=x(),S=[1|C[0],C[1],C[2],C[3],C[4],C[5]],A=16383&(C[6]<<8|C[7]),k=0,I=0;function T(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var i=(t=t||{}).random||(t.rng||x)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e)for(var o=0;o<16;o++)e[r+o]=i[o];return e||E(i)}var L=T;L.v1=function(t,e,n){var r=e&&n||0,i=e||[],o=void 0!==(t=t||{}).clockseq?t.clockseq:A,s=void 0!==t.msecs?t.msecs:(new Date).getTime(),a=void 0!==t.nsecs?t.nsecs:I+1,p=s-k+(a-I)/1e4;if(p<0&&void 0===t.clockseq&&(o=o+1&16383),(p<0||s>k)&&void 0===t.nsecs&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");k=s,I=a,A=o;var u=(1e4*(268435455&(s+=122192928e5))+a)%4294967296;i[r++]=u>>>24&255,i[r++]=u>>>16&255,i[r++]=u>>>8&255,i[r++]=255&u;var c=s/4294967296*1e4&268435455;i[r++]=c>>>8&255,i[r++]=255&c,i[r++]=c>>>24&15|16,i[r++]=c>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var h=t.node||S,l=0;l<6;l++)i[r+l]=h[l];return e||E(i)},L.v4=T,L.parse=function(t,e,n){var r=e&&n||0,i=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){i<16&&(e[r+i++]=w[t])});i<16;)e[r+i++]=0;return e},L.unparse=E;var O=L;j.INITS=[];var P=j;function j(t){this.root=this;var e=j.INITS;t||(t={}),this.debug=t.debug||{};for(var n=0;n<e.length;n++)e[n](this,t)}function N(t){this.root=t.root,this._events=t._events,this._maxListeners=t._maxListeners,this._context=t._context,this._at=t._at,this._pass=t._pass,this._silent=t._silent,this._eventContext=t._eventContext,this._preventCompose=t._preventCompose}j.prototype.id=function(){return O.v4()},j.prototype._child=function(){return new N(this)},j.ChildModel=N,N.prototype=new j;var M,D,R,B=Array.isArray,F=Object.keys,U=Object.prototype.hasOwnProperty,$=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var r,i,o,s=B(e),a=B(n);if(s&&a){if((i=e.length)!=n.length)return!1;for(r=i;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(s!=a)return!1;var p=e instanceof Date,u=n instanceof Date;if(p!=u)return!1;if(p&&u)return e.getTime()==n.getTime();var c=e instanceof RegExp,h=n instanceof RegExp;if(c!=h)return!1;if(c&&h)return e.toString()==n.toString();var l=F(e);if((i=l.length)!==F(n).length)return!1;for(r=i;0!=r--;)if(!U.call(n,l[r]))return!1;for(r=i;0!=r--;)if(!t(e[o=l[r]],n[o]))return!1;return!0}return e!=e&&n!=n},q=M={};function V(){throw new Error("setTimeout has not been defined")}function H(){throw new Error("clearTimeout has not been defined")}function z(t){if(D===setTimeout)return setTimeout(t,0);if((D===V||!D)&&setTimeout)return D=setTimeout,setTimeout(t,0);try{return D(t,0)}catch(e){try{return D.call(null,t,0)}catch(e){return D.call(this,t,0)}}}!function(){try{D="function"==typeof setTimeout?setTimeout:V}catch(t){D=V}try{R="function"==typeof clearTimeout?clearTimeout:H}catch(t){R=H}}();var G,K=[],Q=!1,J=-1;function W(){Q&&G&&(Q=!1,G.length?K=G.concat(K):J=-1,K.length&&Y())}function Y(){if(!Q){var t=z(W);Q=!0;for(var e=K.length;e;){for(G=K,K=[];++J<e;)G&&G[J].run();J=-1,e=K.length}G=null,Q=!1,function(t){if(R===clearTimeout)return clearTimeout(t);if((R===H||!R)&&clearTimeout)return R=clearTimeout,clearTimeout(t);try{R(t)}catch(e){try{return R.call(null,t)}catch(e){return R.call(this,t)}}}(t)}}function X(t,e){this.fun=t,this.array=e}function Z(){}q.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];K.push(new X(t,e)),1!==K.length||Q||z(Y)},X.prototype.run=function(){this.fun.apply(null,this.array)},q.title="browser",q.browser=!0,q.env={},q.argv=[],q.version="",q.versions={},q.on=Z,q.addListener=Z,q.once=Z,q.off=Z,q.removeListener=Z,q.removeAllListeners=Z,q.emit=Z,q.prependListener=Z,q.prependOnceListener=Z,q.listeners=function(t){return[]},q.binding=function(t){throw new Error("process.binding is not supported")},q.cwd=function(){return"/"},q.chdir=function(t){throw new Error("process.chdir is not supported")},q.umask=function(){return 0};var tt={};(function(t){var e="browser"!==t.title;function n(t){this.cb=t,this.isDone=!1,this.count=0}function r(t){var e=new t.constructor;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function i(t){return t!=t}function o(t){return/^[0-9]+$/.test(t)}function s(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}tt.isServer=e,tt.asyncGroup=function(t){var e=new n(t);return function(){return e.add()}},tt.castSegments=function(t){for(var e=t.length;e--;){var n=t[e];"string"==typeof n&&o(n)&&(t[e]=+n)}return t},tt.contains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},tt.copy=function(t){if(t instanceof Date)return new Date(t);if("object"==typeof t)return null===t?null:Array.isArray(t)?t.slice():r(t);return t},tt.copyObject=r,tt.deepCopy=function t(e){if(e instanceof Date)return new Date(e);if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){for(var n=[],r=e.length;r--;)n[r]=t(e[r]);return n}var i=new e.constructor;for(var o in e)e.hasOwnProperty(o)&&(i[o]=t(e[o]));return i}return e},tt.deepEqual=$,tt.equal=function(t,e){return t===e||i(t)&&i(e)},tt.equalsNaN=i,tt.isArrayIndex=o,tt.lookup=function(t,e){if(!t)return e;for(var n=0,r=t.length;n<r;n++){if(null==e)return e;e=e[t[n]]}return e},tt.mergeInto=function(t,e){for(var n in e)t[n]=e[n];return t},tt.mayImpact=s,tt.mayImpactAny=function(t,e){for(var n=0,r=t.length;n<r;n++)if(s(t[n],e))return!0;return!1},tt.serverRequire=function(t,n){if(!e)return;return t.require(n)},tt.serverUse=function(t,n,r){if(!e)return this;var i=t.require(n);return this.use(i,r)},tt.use=function(t,e){var n=this._plugins||(this._plugins=[]);-1===n.indexOf(t)&&(n.push(t),t(this,e));return this},n.prototype.add=function(){this.count++;var t=this;return function(e){if(t.count--,!t.isDone)return e?(t.isDone=!0,void t.cb(e)):void(t.count>0||(t.isDone=!0,t.cb()))}}}).call(this,M);var et=p.EventEmitter;function nt(t,e,n){var r=n.patternSegments;if(!r)return!1;if(t===n.pattern||"**"===t)return!0;var i=e.length;if(i>r.length)return!1;for(var o=0;o<i;o++)if(e[o]!==r[o])return!1;return!0}function rt(t,e){for(var n in t)this[n]=t[n];for(var n in e)this[n]=e[n]}function it(t,e,n,r,i){var o,s,a;if(i?(o=n,s=r,a=i):r?(a=r,t.isPath(n)?o=n:s=n):a=n,s&&s.useEventObjects)var p=!0;if(o){var u=t.path(o);return p?st(e,u,a,t._eventContext):ot(u,a,t._eventContext)}var c=t.path();return c?p?st(e,c,a,t._eventContext):ot(c,a,t._eventContext):a}function ot(t,e,n){var r=tt.castSegments(t.split(".")),i=ft(t,r);function o(t,n){var r=i(t);if(r){var o=r.length?r.concat(n):n;return e.apply(null,o),!0}}return o.pattern=t,o.patternSegments=r,o.eventContext=n,o}function st(t,e,n,r){var i=tt.castSegments(e.split(".")),o=ft(e,i),s=function t(e){switch(e){case"change":return function(t){return new at(t)};case"insert":return function(t){return new pt(t)};case"remove":return function(t){return new ut(t)};case"move":return function(t){return new ct(t)};case"load":return function(t){return new ht(t)};case"unload":return function(t){return new lt(t)};case"all":return function(e){var n=e[0],r=t(n);return r(e.slice(1))};default:throw new Error("Unknown event: "+e)}}(t);function a(t,e){var r=o(t);if(r){var i=s(e);return n(i,r),!0}}return a.pattern=e,a.patternSegments=i,a.eventContext=r,a}function at(t){this.value=t[0],this.previous=t[1],this.passed=t[2]}function pt(t){this.index=t[0],this.values=t[1],this.passed=t[2]}function ut(t){this.index=t[0],this.removed=t[1],this.passed=t[2]}function ct(t){this.from=t[0],this.to=t[1],this.howMany=t[2],this.passed=t[3]}function ht(t){this.document=t[0],this.passed=t[1]}function lt(t){this.previousDocument=t[0],this.passed=t[1]}function ft(t,e){if("**"===t)return function(t){return[t.join(".")]};var n=function(t){var e=t.length-1,n=t[e];if("**"===n)return t.pop(),!0;if("string"!=typeof n)return!1;var r=/^([^\*]+)\*\*$/.exec(n);return!!r&&(t[e]=r[1],!0)}(e);return function(t){var r=e.length;if(!(r>t.length)&&(r===t.length||n)){for(var i=[],o=0;o<r;o++){var s=e[o],a=t[o];if("*"!==s&&"**"!==s){if(s!==a)return}else i.push(a)}if(n){var p=t.slice(o).join(".");i.push(p)}return i}}}P.MUTATOR_EVENTS={change:!0,insert:!0,remove:!0,move:!0,load:!0,unload:!0},P.INITS.push(function(t){et.call(this),t.setMaxListeners(0),t.root._defaultCallback=function(e){e&&t._emitError(e)},t.root._mutatorEventQueue=null,t.root._pass=new rt({},{}),t.root._silent=null,t.root._eventContext=null}),tt.mergeInto(P.prototype,et.prototype),P.prototype.wrapCallback=function(t){if(!t)return this.root._defaultCallback;var e=this;return function(){try{return t.apply(this,arguments)}catch(t){e._emitError(t)}}},P.prototype._emitError=function(t,e){var n=t.message?t.message:"string"==typeof t?t:"Unknown model error";if(e&&(n+=" "+e),t.data)try{n+=" "+JSON.stringify(t.data)}catch(t){}t instanceof Error?t.message=n:t=new Error(n),this.emit("error",t)},P.prototype._emit=et.prototype.emit,P.prototype.emit=function(t){if("error"===t)return this._emit.apply(this,arguments);if(P.MUTATOR_EVENTS[t]){if(this._silent)return this;var e=arguments[1],n=arguments[2];if(this._emit(t+"Immediate",e,n),this.root._mutatorEventQueue)return this.root._mutatorEventQueue.push([t,e,n]),this;for(this.root._mutatorEventQueue=[],this._emit(t,e,n),this._emit("all",e,[t].concat(n));this.root._mutatorEventQueue.length;){var r=this.root._mutatorEventQueue.shift();t=r[0],e=r[1],n=r[2],this._emit(t,e,n),this._emit("all",e,[t].concat(n))}return this.root._mutatorEventQueue=null,this}return this._emit.apply(this,arguments)},P.prototype._on=et.prototype.on,P.prototype.addListener=P.prototype.on=function(t,e,n,r){var i=it(this,t,e,n,r);return this._on(t,i),i},P.prototype.once=function(t,e,n,r){var i=it(this,t,e,n,r);function o(){i.apply(null,arguments)&&this.removeListener(t,o)}return this._on(t,o),o},P.prototype._removeAllListeners=et.prototype.removeAllListeners,P.prototype.removeAllListeners=function(t,e){if(!t){for(var n in this._events)this.removeAllListeners(n,e);return this}var r=this.path(e);if(!r)return 0===arguments.length?this._removeAllListeners():this._removeAllListeners(t);for(var i=this.listeners(t),o=r.split("."),s=i.length;s--;){var a=i[s];nt(r,o,a)&&this.removeListener(t,a)}return this},P.prototype.pass=function(t,e){var n=this._child();return n._pass=e?new rt(t,this._pass):new rt(this._pass,t),n},P.prototype.silent=function(t){var e=this._child();return e._silent=null==t||t,e},P.prototype.eventContext=function(t){var e=this._child();return e._eventContext=t,e},P.prototype.removeContextListeners=function(t){for(var e in 0===arguments.length&&(t=this._eventContext),this._events)for(var n=this.listeners(e),r=n.length;r--;){var i=n[r];i.eventContext===t&&this.removeListener(e,i)}return this},at.prototype.type="change",pt.prototype.type="insert",ut.prototype.type="remove",ct.prototype.type="move",ht.prototype.type="load",lt.prototype.type="unload";var dt={};function mt(t,e){var n=t._child();return n._at=e,n}dt.mixin={},P.prototype._splitPath=function(t){var e=this.path(t);return e&&e.split(".")||[]},P.prototype.path=function(t){return null==t||""===t?this._at?this._at:"":"string"==typeof t||"number"==typeof t?this._at?this._at+"."+t:""+t:"function"==typeof t.path?t.path():void 0},P.prototype.isPath=function(t){return null!=this.path(t)},P.prototype.scope=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return mt(this,t)},P.prototype.at=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return mt(this,this.path(t))},P.prototype.parent=function(t){null==t&&(t=1);var e=this._splitPath(),n=Math.max(0,e.length-t),r=e.slice(0,n).join(".");return this.scope(r)},P.prototype.leaf=function(t){t||(t=this.path());var e=t.lastIndexOf(".");return t.slice(e+1)};var yt=vt;function vt(t,e,n){this.collectionName=e,this.id=n,this.collectionData=t&&t.data[e]}vt.prototype.path=function(t){var e=this.collectionName+"."+this.id;return t&&t.length&&(e+="."+t.join(".")),e},vt.prototype._errorMessage=function(t,e,n){return t+" at "+this.path(e)+": "+JSON.stringify(n,null,2)};var gt=xt;function xt(t,e,n,r){yt.call(this,t,e,n),this.data=r,this._updateCollectionData()}function bt(t,e){return t=t[e]||(t[e]=[])}xt.prototype=new yt,xt.prototype._updateCollectionData=function(){this.collectionData[this.id]=this.data},xt.prototype.create=function(t,e){if(void 0!==this.data){var n=this._errorMessage("create on local document with data",null,this.data);return e(new Error(n))}this.data=t,this._updateCollectionData(),e()},xt.prototype.set=function(t,e,n){return this._apply(t,function(t,n){var r=t[n];return t[n]=e,r},n)},xt.prototype.del=function(t,e){var n=this.get(t);if(void 0!==n)return this._apply(t,function(t,e){return delete t[e],n},e);e()},xt.prototype.increment=function(t,e,n){var r=this;return this._validatedApply(t,function(e){if("number"!=typeof e&&null!=e)return new TypeError(r._errorMessage("increment on non-number",t,e))},function(t,n){var r=(t[n]||0)+e;return t[n]=r,r},n)},xt.prototype.push=function(t,e,n){return this._arrayApply(t,function(t){return t.push(e)},n)},xt.prototype.unshift=function(t,e,n){return this._arrayApply(t,function(t){return t.unshift(e)},n)},xt.prototype.insert=function(t,e,n,r){return this._arrayApply(t,function(t){return t.splice.apply(t,[e,0].concat(n)),t.length},r)},xt.prototype.pop=function(t,e){return this._arrayApply(t,function(t){return t.pop()},e)},xt.prototype.shift=function(t,e){return this._arrayApply(t,function(t){return t.shift()},e)},xt.prototype.remove=function(t,e,n,r){return this._arrayApply(t,function(t){return t.splice(e,n)},r)},xt.prototype.move=function(t,e,n,r,i){return this._arrayApply(t,function(t){var i=t.splice(e,r);return t.splice.apply(t,[n,0].concat(i)),i},i)},xt.prototype.stringInsert=function(t,e,n,r){var i=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(i._errorMessage("stringInsert on non-string",t,e))},function(t,r){var i=t[r];return null==i?(t[r]=n,i):(t[r]=i.slice(0,e)+n+i.slice(e),i)},r)},xt.prototype.stringRemove=function(t,e,n,r){var i=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(i._errorMessage("stringRemove on non-string",t,e))},function(t,r){var i=t[r];return null==i?i:(e<0&&(e+=i.length),t[r]=i.slice(0,e)+i.slice(e+n),i)},r)},xt.prototype.get=function(t){return tt.lookup(t,this.data)},xt.prototype._createImplied=function(t,e){for(var n=this,r="data",i=0,o=t[i++];null!=o;)n=n[r]||(n[r]=/^\d+$/.test(o)?[]:{}),r=o,o=t[i++];return e(n,r)},xt.prototype._apply=function(t,e,n){var r=this._createImplied(t,e);return this._updateCollectionData(),n(),r},xt.prototype._validatedApply=function(t,e,n,r){var i=this._createImplied(t,function(t,i){var o=e(t[i]);return o?r(o):n(t,i)});return this._updateCollectionData(),r(),i},xt.prototype._arrayApply=function(t,e,n){var r=this._createImplied(t,bt);if(!Array.isArray(r)){var i=this._errorMessage(e.name+" on non-array",t,r);return n(new TypeError(i))}var o=e(r);return this._updateCollectionData(),n(),o};function wt(){}function _t(){}function Et(){}function Ct(){}function St(t,e,n){this.model=t,this.name=e,this.Doc=n,this.docs=new Et,this.data=t.data[e]=new Ct}P.INITS.push(function(t){t.root.collections=new wt,t.root.data=new _t}),P.prototype.getCollection=function(t){return this.root.collections[t]},P.prototype.getDoc=function(t,e){var n=this.root.collections[t];return n&&n.docs[e]},P.prototype.get=function(t){var e=this._splitPath(t);return this._get(e)},P.prototype._get=function(t){return tt.lookup(t,this.root.data)},P.prototype.getCopy=function(t){var e=this._splitPath(t);return this._getCopy(e)},P.prototype._getCopy=function(t){var e=this._get(t);return tt.copy(e)},P.prototype.getDeepCopy=function(t){var e=this._splitPath(t);return this._getDeepCopy(e)},P.prototype._getDeepCopy=function(t){var e=this._get(t);return tt.deepCopy(e)},P.prototype.getOrCreateCollection=function(t){var e=this.root.collections[t];if(e)return e;var n=this._getDocConstructor(t);return e=new St(this.root,t,n),this.root.collections[t]=e,e},P.prototype._getDocConstructor=function(){return gt},P.prototype.getOrCreateDoc=function(t,e,n){var r=this.getOrCreateCollection(t);return r.docs[e]||r.add(e,n)},P.prototype.destroy=function(t){var e=this._splitPath(t),n=this.silent();if(n.removeAllListeners(null,t),n._removeAllRefs(e),n._stopAll(e),n._removeAllFilters(e),0===e.length){this.root.collections=new wt;var r=this.root.data;for(var i in r)delete r[i]}else if(1===e.length){var o=this.getCollection(e[0]);o&&o.destroy()}else n._del(e)},St.prototype.add=function(t,e){var n=new this.Doc(this.model,this.name,t,e,this);return this.docs[t]=n,n},St.prototype.destroy=function(){delete this.model.collections[this.name],delete this.model.data[this.name]},St.prototype.remove=function(t){delete this.docs[t],delete this.data[t],function(t){for(var e in t)return!1;return!0}(this.docs)&&this.destroy()},St.prototype.get=function(){return this.data};P.prototype._mutate=function(t,e,n){n=this.wrapCallback(n);var r=t[0],i=t[1];if(!r||!i){var o=e.name+" must be performed under a collection and document id. Invalid path: "+t.join(".");return n(new Error(o))}var s=this.getOrCreateDoc(r,i),a=t.slice(2);if(this._preventCompose&&s.shareDoc){var p=s.shareDoc.preventCompose;s.shareDoc.preventCompose=!0;var u=e(s,a,n);return s.shareDoc.preventCompose=p,u}return e(s,a,n)},P.prototype.set=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._set(r,e,n)},P.prototype._set=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.set(i,e,o);return 0===i.length&&(e=n.get(i)),r.emit("change",t,[e,s,r._pass]),s},n)},P.prototype.setNull=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setNull(r,e,n)},P.prototype._setNull=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.get(i);return null!=s?(o(),s):(n.set(i,e,o),r.emit("change",t,[e,s,r._pass]),e)},n)},P.prototype.setEach=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setEach(r,e,n)},P.prototype._setEach=function(t,e,n){t=this._dereference(t);var r=tt.asyncGroup(this.wrapCallback(n));for(var i in e){var o=e[i];this._set(t.concat(i),o,r())}},P.prototype.create=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._create(r,e,n)},P.prototype._create=function(t,e,n){if(2!==(t=this._dereference(t)).length){var r="create may only be used on a document path. Invalid path: "+t.join(".");return(n=this.wrapCallback(n))(new Error(r))}var i=this;this._mutate(t,function(n,r,o){n.create(e,o),e=n.get(),i.emit("change",t,[e,void 0,i._pass])},n)},P.prototype.createNull=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._createNull(r,e,n)},P.prototype._createNull=function(t,e,n){t=this._dereference(t);var r=this.getDoc(t[0],t[1]);r&&null!=r.get()||this._create(t,e,n)},P.prototype.add=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._add(r,e,n)},P.prototype._add=function(t,e,n){if("object"!=typeof e){var r="add requires an object value. Invalid value: "+e;return(n=this.wrapCallback(n))(new Error(r))}var i=e.id||this.id();e.id=i,t=this._dereference(t.concat(i));var o=this;return this._mutate(t,function(n,r,i){var s;r.length?s=n.set(r,e,i):(n.create(e,i),e=n.get()),o.emit("change",t,[e,s,o._pass])},n),i},P.prototype.del=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._del(n,e)},P.prototype._del=function(t,e){t=this._dereference(t);var n=this;return this._mutate(t,function(e,r,i){var o=e.del(r,i);if(2===t.length){var s=t[0],a=t[1];n.root.collections[s].remove(a)}return n.emit("change",t,[void 0,o,n._pass]),o},e)},P.prototype.increment=function(){var t,e,n;1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(n=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._increment(r,e,n)},P.prototype._increment=function(t,e,n){t=this._dereference(t),null==e&&(e=1);var r=this;return this._mutate(t,function(n,i,o){var s=n.increment(i,e,o),a=s-e;return r.emit("change",t,[s,a,r._pass]),s},n)},P.prototype.push=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._push(r,e,n)},P.prototype._push=function(t,e,n){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(n,i,o){var s=n.push(i,e,o);return r.emit("insert",t,[s-1,[e],r._pass]),s},n)},P.prototype.unshift=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._unshift(r,e,n)},P.prototype._unshift=function(t,e,n){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(n,i,o){var s=n.unshift(i,e,o);return r.emit("insert",t,[0,[e],r._pass]),s},n)},P.prototype.insert=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for insert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._insert(i,+e,n,r)},P.prototype._insert=function(t,e,n,r){t=this._dereference(t,!0);var i=this;return this._mutate(t,function(r,o,s){var a=Array.isArray(n)?n:[n],p=r.insert(o,e,a,s);return i.emit("insert",t,[e,a,i._pass]),p},r)},P.prototype.pop=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._pop(n,e)},P.prototype._pop=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,r,i){var o=e.get(r),s=o&&o.length;if(s){var a=e.pop(r,i);return n.emit("remove",t,[s-1,[a],n._pass]),a}i()},e)},P.prototype.shift=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._shift(n,e)},P.prototype._shift=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,r,i){var o=e.get(r);if(o&&o.length){var s=e.shift(r,i);return n.emit("remove",t,[0,[s],n._pass]),s}i()},e)},P.prototype.remove=function(){var t,e,n,r;arguments.length<2?e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(r=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(r=arguments[2],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1])):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return null==e&&(e=i.pop()),this._remove(i,+e,n,r)},P.prototype._remove=function(t,e,n,r){t=this._dereference(t,!0),null==n&&(n=1);var i=this;return this._mutate(t,function(r,o,s){var a=r.remove(o,e,n,s);return i.emit("remove",t,[e,a,i._pass]),a},r)},P.prototype.move=function(){var t,e,n,r,i;if(arguments.length<2)throw new Error("Not enough arguments for move");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],i=arguments[2]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):4===arguments.length?"function"==typeof arguments[3]?(i=arguments[3],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2])):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3],i=arguments[4]);var o=this._splitPath(t);return this._move(o,e,n,r,i)},P.prototype._move=function(t,e,n,r,i){t=this._dereference(t,!0),null==r&&(r=1);var o=this;return this._mutate(t,function(i,s,a){if(n=+n,(e=+e)<0||n<0){var p=i.get(s).length;e<0&&(e+=p),n<0&&(n+=p)}var u=i.move(s,e,n,r,a);return o.emit("move",t,[e,n,u.length,o._pass]),u},i)},P.prototype.stringInsert=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for stringInsert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._stringInsert(i,e,n,r)},P.prototype._stringInsert=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.stringInsert(o,e,n,s),p=r.get(o),u=i.pass({$stringInsert:{index:e,text:n}})._pass;i.emit("change",t,[p,a,u])},r)},P.prototype.stringRemove=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for stringRemove");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._stringRemove(i,e,n,r)},P.prototype._stringRemove=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.stringRemove(o,e,n,s),p=r.get(o),u=i.pass({$stringRemove:{index:e,howMany:n}})._pass;i.emit("change",t,[p,a,u])},r)},P.prototype.subtypeSubmit=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for subtypeSubmit");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._subtypeSubmit(i,e,n,r)},P.prototype._subtypeSubmit=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.subtypeSubmit(o,e,n,s),p=r.get(o),u=i.pass({$subtype:{type:e,op:n}})._pass;return i.emit("change",t,[p,void 0,u]),a},r)};var At=Ot;function kt(t,e){this.index=t,this.values=e}function It(t,e){this.index=t,this.howMany=e}function Tt(t,e,n){this.from=t,this.to=e,this.howMany=n}function Lt(t,e){return t===e}function Ot(t,e,n){n||(n=Lt);for(var r=t.length,i=e.length,o=[],s={},a={},p=0;p<r;p++)for(var u=t[p],c=0;c<i;c++)if(!a[c]&&n(u,e[c])){var h=p,l=c,f=0;do{s[p++]=a[c++]=!0,f++}while(p<r&&c<i&&n(t[p],e[c])&&!a[c]);o.push(new Tt(h,l,f)),p--;break}var d=[];for(p=0;p<r;)if(s[p])p++;else{var m=p;for(f=0;p<r&&!s[p++];)f++;d.push(new It(m,f))}var y=[];for(c=0;c<i;)if(a[c])c++;else{for(m=c,f=0;c<i&&!a[c++];)f++;var v=e.slice(m,m+f);y.push(new kt(m,v))}var g,x,b=y.length,w=d.length,_=o.length,E=0;for(g=0;g<w;g++){var C=d[g];for(C.index-=E,E+=C.howMany,x=0;x<_;x++){(I=o[x]).from>=C.index&&(I.from-=C.howMany)}}for(g=b;g--;){var S=y[g];f=S.values.length;for(x=_;x--;){(I=o[x]).to>=S.index&&(I.to-=f)}}for(g=_;g-- >1;){if((I=o[g]).to!==I.from)for(x=g;x--;){var A=o[x];A.to>=I.to&&(A.to-=I.howMany),A.to>=I.from&&(A.to+=I.howMany)}}var k=[];for(g=0;g<_;g++){var I;if((I=o[g]).to!==I.from)for(k.push(I),x=g+1;x<_;x++){var T=o[x];T.from>=I.from&&(T.from-=I.howMany),T.from>=I.to&&(T.from+=I.howMany)}}return d.concat(k,y)}Ot.InsertDiff=kt,Ot.RemoveDiff=It,Ot.MoveDiff=Tt,kt.prototype.type="insert",kt.prototype.toJSON=function(){return{type:this.type,index:this.index,values:this.values}},It.prototype.type="remove",It.prototype.toJSON=function(){return{type:this.type,index:this.index,howMany:this.howMany}},Tt.prototype.type="move",Tt.prototype.toJSON=function(){return{type:this.type,from:this.from,to:this.to,howMany:this.howMany}};P.prototype.setDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setDiff(r,e,n)},P.prototype._setDiff=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.get(i);return tt.equal(s,e)?(o(),s):(n.set(i,e,o),r.emit("change",t,[e,s,r._pass]),s)},n)},P.prototype.setDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setDiffDeep(r,e,n)},P.prototype._setDiffDeep=function(t,e,n){var r=this._get(t);n=this.wrapCallback(n);var i=tt.asyncGroup(n),o=i();!function t(e,n,r,i,o){if("object"!=typeof r||!r||"object"!=typeof i||!i)return void e._setDiff(n,i,o());if(Array.isArray(r)&&Array.isArray(i)){var s=At(r,i,tt.deepEqual);if(!s.length)return;if(2===s.length&&s[0].index===s[1].index&&s[0]instanceof At.RemoveDiff&&1===s[0].howMany&&s[1]instanceof At.InsertDiff&&1===s[1].values.length){var a=s[0].index,p=n.concat(a);return void t(e,p,r[a],i[a],o)}return void e._applyArrayDiff(n,s,o())}for(var u in r)if(!(u in i)){var p=n.concat(u);e._del(p,o())}for(var u in i)if(!tt.deepEqual(r[u],i[u])){var p=n.concat(u);t(e,p,r[u],i[u],o)}}(this,t,r,e,i),o()},P.prototype.setArrayDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setArrayDiff(r,e,n)},P.prototype.setArrayDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setArrayDiffDeep(r,e,n)},P.prototype._setArrayDiffDeep=function(t,e,n){return this._setArrayDiff(t,e,n,tt.deepEqual)},P.prototype._setArrayDiff=function(t,e,n,r){var i=this._get(t);if(i===e)return this.wrapCallback(n)();if(Array.isArray(i)&&Array.isArray(e)){var o=At(i,e,r);this._applyArrayDiff(t,o,n)}else this._set(t,e,n)},P.prototype._applyArrayDiff=function(t,e,n){if(!e.length)return this.wrapCallback(n)();t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){for(var s=tt.asyncGroup(o),a=0,p=e.length;a<p;a++){var u=e[a];if(u instanceof At.InsertDiff)n.insert(i,u.index,u.values,s()),r.emit("insert",t,[u.index,u.values,r._pass]);else if(u instanceof At.RemoveDiff){var c=n.remove(i,u.index,u.howMany,s());r.emit("remove",t,[u.index,c,r._pass])}else if(u instanceof At.MoveDiff){var h=n.move(i,u.from,u.to,u.howMany,s());r.emit("move",t,[u.from,u.to,h.length,r._pass])}}},n)};var Pt,jt=Pt=new function(){};function Nt(t){return t&&t.slice().reverse()}jt.reverse=new function(t,e){this.get=t,this.set=e}(Nt,function(t){return{0:Nt(t)}}),jt.asc=function(t,e){return t<e?-1:t>e?1:0},jt.desc=function(t,e){return t>e?-1:t<e?1:0};(function(t){function e(){}function n(t,e,n){var r,i,o,s,a,p=e.pop();"string"==typeof p?i=p:r=p,n&&(o=t.path(e.shift())),p=e[e.length-1],Array.isArray(p)||t.isPath(p)||(s=e.pop());for(var u=(a=1===e.length&&Array.isArray(e[0])?e[0]:e).length;u--;)a[u]=t.path(a[u]);return{name:i,path:o,inputPaths:a,fns:r,options:s}}function r(){}function i(t){this.model=t,this.nameMap=t.root._namedFns,this.fromMap=new r}function o(t,e,n,r,i,o){if(this.model=t.pass({$fn:this}),this.name=e,this.from=n,this.inputPaths=r,this.options=o,!i)throw new TypeError("Model function not found: "+e);this.getFn=i.get||i,this.setFn=i.set,this.fromSegments=n&&n.split("."),this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}var p=o&&o.copy||"output";this.copyInput="input"===p||"both"===p,this.copyOutput="output"===p||"both"===p,this.mode=o&&o.mode||"diffDeep",this.async=!(!o||!o.async),this.eventPending=!1}P.INITS.push(function(t){t.root._namedFns=new e,t.root._fns=new i(t),t.on("all",function(e,n){var r=n[n.length-1],i=t.root._fns.fromMap;for(var o in i){var s=i[o];r.$fn!==s&&(tt.mayImpactAny(s.inputsSegments,e)?s.onInput(r):tt.mayImpact(s.fromSegments,e)&&s.onOutput(r))}})}),P.prototype.fn=function(t,e){this.root._namedFns[t]=e},P.prototype.evaluate=function(){var t=n(this,Array.prototype.slice.call(arguments),!1);return this.root._fns.get(t.name,t.inputPaths,t.fns,t.options)},P.prototype.start=function(){var t=n(this,Array.prototype.slice.call(arguments),!0);return this.root._fns.start(t.name,t.path,t.inputPaths,t.fns,t.options)},P.prototype.stop=function(t){var e=this.path(t);this._stop(e)},P.prototype._stop=function(t){this.root._fns.stop(t)},P.prototype.stopAll=function(t){var e=this._splitPath(t);this._stopAll(e)},P.prototype._stopAll=function(t){var e=this.root._fns.fromMap;for(var n in e){var r=e[n].fromSegments;tt.contains(t,r)&&this._stop(n)}},i.prototype.get=function(t,e,n,r){return n||(n=this.nameMap[t]||Pt[t]),new o(this.model,t,null,e,n,r).get()},i.prototype.start=function(t,e,n,r,i){r||(r=this.nameMap[t]||Pt[t]);var s=new o(this.model,t,e,n,r,i);return this.fromMap[e]=s,s._onInput()},i.prototype.stop=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},i.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.name){var r=[n.from].concat(n.inputPaths);n.options&&r.push(n.options),r.push(n.name),t.push(r)}}return t},o.prototype.apply=function(t,e){for(var n=0,r=this.inputsSegments.length;n<r;n++){var i=this.model._get(this.inputsSegments[n]);e.push(this.copyInput?tt.deepCopy(i):i)}return t.apply(this.model,e)},o.prototype.get=function(){return this.apply(this.getFn,[])},o.prototype.set=function(t,e){if(this.setFn){var n=this.apply(this.setFn,[t]);if(n){var r=this.inputsSegments,i=this.model.pass(e,!0);for(var o in n){t=this.copyOutput?tt.deepCopy(n[o]):n[o];this._setValue(i,r[o],t)}}}},o.prototype.onInput=function(e){if(!this.async)return this._onInput(e);if(!this.eventPending){this.eventPending=!0;var n=this;t.nextTick(function(){n._onInput(e),n.eventPending=!1})}},o.prototype._onInput=function(t){var e=this.copyOutput?tt.deepCopy(this.get()):this.get();return this._setValue(this.model.pass(t,!0),this.fromSegments,e),e},o.prototype.onOutput=function(t){var e=this.model._get(this.fromSegments);return this.set(e,t)},o.prototype._setValue=function(t,e,n){"diffDeep"===this.mode?t._setDiffDeep(e,n):"arrayDeep"===this.mode?t._setArrayDiffDeep(e,n):"array"===this.mode?t._setArrayDiff(e,n):t._setDiff(e,n)}}).call(this,M);function Mt(t,e){var n,r=e.pop();t.isPath(e[e.length-1])||(n=e.pop());for(var i=t.path(e.shift()),o=e.length;o--;)e[o]=t.path(e[o]);return{path:i,inputPaths:e.length?e:null,options:n,fn:r}}function Dt(){}function Rt(t){this.model=t,this.fromMap=new Dt}function Bt(t,e,n,r,i,o){if(this.filters=t,this.model=t.model.pass({$filter:this}),this.path=e,this.segments=e.split("."),this.filterName=null,this.sortName=null,this.bundle=!0,this.filterFn=null,this.sortFn=null,this.inputPaths=i,this.inputsSegments=null,i){this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}}this.options=o,this.skip=o&&o.skip,this.limit=o&&o.limit,n&&this.filter(n),r&&this.sort(r),this.idsSegments=null,this.from=null,this.fromSegments=null}P.INITS.push(function(t){t.root._filters=new Rt(t),t.on("all",function(e,n){var r=n[n.length-1],i=t.root._filters.fromMap;for(var o in i){var s=i[o];r.$filter!==s&&((tt.mayImpact(s.segments,e)||s.inputsSegments&&tt.mayImpactAny(s.inputsSegments,e))&&s.update(r))}})}),P.prototype.filter=function(){var t=Mt(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,t.fn,null,t.inputPaths,t.options)},P.prototype.sort=function(){var t=Mt(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,null,t.fn||"asc",t.inputPaths,t.options)},P.prototype.removeAllFilters=function(t){var e=this._splitPath(t);this._removeAllFilters(e)},P.prototype._removeAllFilters=function(t){var e=this.root._filters.fromMap;for(var n in e)tt.contains(t,e[n].fromSegments)&&e[n].destroy()},Rt.prototype.add=function(t,e,n,r,i){return new Bt(this,t,e,n,r,i)},Rt.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.bundle){var r=[e,n.path,n.filterName,n.sortName,n.inputPaths];n.options&&r.push(n.options),t.push(r)}}return t},Bt.prototype.filter=function(t){if("function"==typeof t)return this.filterFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.filterName=t,this.filterFn=this.model.root._namedFns[t]||Pt[t],!this.filterFn))throw new TypeError("Filter function not found: "+t);return this},Bt.prototype.sort=function(t){if(t||(t="asc"),"function"==typeof t)return this.sortFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.sortName=t,this.sortFn=this.model.root._namedFns[t]||Pt[t],!this.sortFn))throw new TypeError("Sort function not found: "+t);return this},Bt.prototype._slice=function(t){if(null==this.skip&&null==this.limit)return t;var e,n=this.skip||0;return this.limit&&(e=n+this.limit),t.slice(n,e)},Bt.prototype.getInputs=function(){if(this.inputsSegments){for(var t=[],e=0,n=this.inputsSegments.length;e<n;e++){var r=this.model._get(this.inputsSegments[e]);t.push(r)}return t}},Bt.prototype.callFilter=function(t,e,n){var r=t[e];return n?this.filterFn.apply(this.model,[r,e,t].concat(n)):this.filterFn.call(this.model,r,e,t)},Bt.prototype.ids=function(){var t=this.model._get(this.segments),e=[];if(!t)return e;if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var r in t)t.hasOwnProperty(r)&&this.callFilter(t,r,n)&&e.push(r)}else e=Object.keys(t);var i=this.sortFn;return i&&e.sort(function(e,n){return i(t[e],t[n])}),this._slice(e)},Bt.prototype.get=function(){var t=this.model._get(this.segments),e=[];if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var r in t)t.hasOwnProperty(r)&&this.callFilter(t,r,n)&&e.push(t[r])}else for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return this.sortFn&&e.sort(this.sortFn),this._slice(e)},Bt.prototype.update=function(t){var e=this.ids();this.model.pass(t,!0)._setArrayDiff(this.idsSegments,e)},Bt.prototype.ref=function(t){return t=this.model.path(t),this.from=t,this.fromSegments=t.split("."),this.filters.fromMap[t]=this,this.idsSegments=["$filters",t.replace(/\./g,"|")],this.update(),this.model.refList(t,this.path,this.idsSegments.join("."))},Bt.prototype.destroy=function(){delete this.filters.fromMap[this.from],this.model._removeRef(this.idsSegments),this.model._del(this.idsSegments)};function Ft(t,e){t.on(e+"Immediate",function(n,r){var i=r[r.length-1],o=t._refLists.fromMap;for(var s in o){var a=o[s];i.$refList!==a&&a.onMutation(e,n,r)}})}function Ut(t,e,n){for(var r=[],i=0;i<n.length;i++){var o=n[i],s=e.idByItem(o);void 0===s&&"object"==typeof o&&(s=o.id=t.id());var a=e.toSegmentsByItem(o);if(void 0===s||void 0===a)throw new Error("Unable to add item to refList: "+o);t._get(a)!==o&&t._set(a,o),r.push(s)}return r}function $t(t,e,n,r,i){this.model=t&&t.pass({$refList:this}),this.from=e,this.to=n,this.ids=r,this.fromSegments=e&&e.split("."),this.toSegments=n&&n.split("."),this.idsSegments=r&&r.split("."),this.options=i,this.deleteRemoved=i&&i.deleteRemoved}function qt(){}function Vt(){this.fromMap=new qt}P.INITS.push(function(t){var e=t.root;for(var n in e._refLists=new Vt,P.MUTATOR_EVENTS)Ft(e,n)}),P.prototype.refList=function(){var t,e,n,r;2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?this.isPath(arguments[2])?(t=arguments[0],e=arguments[1],n=arguments[2]):(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i,o=this.path(t);if(Array.isArray(e)){i=[];for(var s=0;s<e.length;s++)i.push(this.path(e[s]))}else i=this.path(e);var a=this.path(n),p=new $t(this.root,o,i,a,r);return this.root._refLists.remove(o),p.model._setArrayDiff(p.fromSegments,p.get()),this.root._refLists.add(p),this.scope(o)},$t.prototype.get=function(){var t=this.model._get(this.idsSegments);if(!t)return[];for(var e=this.model._get(this.toSegments),n=[],r=0;r<t.length;r++){var i=t[r];n.push(e&&e[i])}return n},$t.prototype.dereference=function(t,e){var n=t.slice(e+1),r=this.idByIndex(n[0]);return null==r?[]:(n[0]=r,this.toSegments.concat(n))},$t.prototype.toSegmentsByItem=function(t){var e=this.idByItem(t);if(void 0!==e)return this.toSegments.concat(e)},$t.prototype.idByItem=function(t){if(t&&t.id)return t.id;var e=this.model._get(this.toSegments);for(var n in e)if(t===e[n])return n},$t.prototype.indicesByItem=function(t){var e=this.idByItem(t),n=this.model._get(this.idsSegments);if(n){for(var r,i=-1;-1!==(i=n.indexOf(e,i+1));)r?r.push(i):r=[i];return r}},$t.prototype.itemById=function(t){return this.model._get(this.toSegments.concat(t))},$t.prototype.idByIndex=function(t){return this.model._get(this.idsSegments.concat(t))},$t.prototype.onMutation=function(t,e,n){tt.mayImpact(this.toSegments,e)?function(t,e,n,r){var i=r.toSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o===i){if("insert"===t){for(var p=n[1],u=0;u<p.length;u++){var c=p[u];if(x=r.indicesByItem(c))for(var h=0;h<x.length;h++){var l=r.fromSegments.concat(x[h]);a._set(l,c)}}return}if("remove"===t){for(var f=n[0],d=(u=f,f+(p=n[1]).length);u<d;u++)if(x=r.indicesByItem(p[u])){h=0;for(var m=x.length;h<m;h++)l=r.fromSegments.concat(x[h]),a._set(l,void 0)}return}if("move"===t)return}if(o<=i)a._setArrayDiff(r.fromSegments,r.get());else if(o>i+1){if(c=a._get(e.slice(0,i+1)),!(x=r.indicesByItem(c)))return;var y=e.slice(i+1);for(u=0;u<x.length;u++){var v=x[u],g=r.fromSegments.concat(v,y);g=a._dereference(g,null,r),(n=n.slice())[n.length-1]=a._pass,a.emit(t,g,n)}}else if("change"!==t&&"load"!==t&&"unload"!==t){var x;if(c=a._get(e.slice(0,i+1)),(x=r.indicesByItem(c))&&("insert"===t||"remove"===t||"move"===t))for(u=0;u<x.length;u++)g=r.fromSegments.concat(x[u]),g=a._dereference(g,null,r),(n=n.slice())[n.length-1]=a._pass,a.emit(t,g,n)}else{var b;"change"===t?(c=n[0],b=n[1]):"load"===t?(c=n[0],b=void 0):"unload"===t&&(c=void 0,b=n[0]);var w=r.indicesByItem(c),_=r.indicesByItem(b);if(!w&&!_)return;if(_&&!function(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(_,w))for(var u=0;u<_.length;u++)l=r.fromSegments.concat(_[u]),a._set(l,void 0);if(w)for(u=0;u<w.length;u++)l=r.fromSegments.concat(w[u]),a._set(l,c)}}(t,e,n,this):tt.mayImpact(this.idsSegments,e)?function(t,e,n,r){var i=r.idsSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o===i){if("insert"===t){for(var p=n[0],u=n[1],c=[],h=0;h<u.length;h++){var l=r.itemById(u[h]);c.push(l)}return void a._insert(r.fromSegments,p,c)}if("remove"===t){p=n[0];var f=n[1].length;return void a._remove(r.fromSegments,p,f)}if("move"===t){var d=n[0],m=n[1];return f=n[2],void a._move(r.fromSegments,d,m,f)}}if(o<=i)a._setArrayDiff(r.fromSegments,r.get());else{p=e[i];var y=r.idByIndex(p),v=r.itemById(y),g=r.fromSegments.concat(p);a._get(g)!==v&&a._set(g,v)}}(t,e,n,this):tt.mayImpact(this.fromSegments,e)&&function(t,e,n,r){var i=r.fromSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o!==i)if(o<i)a._setArrayDiff(r.fromSegments,r.get());else{c=e[i];var p=a._get(r.fromSegments.concat(c)),u=r.toSegmentsByItem(p);if(o>i+1)throw new Error("Mutation on descendant of refList `from` should have been dereferenced: "+e.join("."));if("change"===t)return a._set(u,p),void function(t,e,n,r){var i=e.idByItem(r),o=e.idsSegments.concat(n);t._set(o,i)}(a,r,c,p);if("insert"===t||"remove"===t||"move"===t)throw new Error("Array mutation on child of refList `from`should have been dereferenced: "+e.join("."))}else{if("insert"===t){var c=n[0],h=Ut(a,r,v=n[1]);return void a._insert(r.idsSegments,c,h)}if("remove"===t){var c=n[0],l=n[1].length;if(h=a._remove(r.idsSegments,c,l),r.deleteRemoved)for(var f=0;f<h.length;f++){var d=r.itemById(h[f]);a._del(r.toSegmentsByItem(d))}return}if("move"===t){var m=n[0],y=n[1];return l=n[2],void a._move(r.idsSegments,m,y,l)}var v;if(!(v="change"===t?n[0]:a._get(r.fromSegments)))return void a._set(r.idsSegments,[]);h=Ut(a,r,v),a._set(r.idsSegments,h)}}(t,e,n,this)},Vt.prototype.add=function(t){this.fromMap[t.from]=t},Vt.prototype.remove=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},Vt.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to,n.ids,n.options])}return t};function Ht(t,e,n,r){var i=n[0];if(void 0===i){var o=r.slice(),s=o.pop(),a=t._get(o);if(!(a&&s in a))return void t._del(e)}t._set(e,i)}function zt(t,e,n){var r=n[0];t._set(e,r)}function Gt(t,e){t._del(e)}function Kt(t,e,n){var r=n[0],i=n[1];t._insert(e,r,i)}function Qt(t,e,n){var r=n[0],i=n[1].length;t._remove(e,r,i)}function Jt(t,e,n){var r=n[0],i=n[1],o=n[2];t._move(e,r,i,o)}function Wt(t,e,n){t.on(e+"Immediate",function(r,i){for(var o,s=i[i.length-1],a=t._refs.toMap,p=0,u=r.length;p<u;p++){o=o?o+"."+r[p]:r[p];var c=a[o];if(c){c=c.slice();for(var h=r.slice(p+1),l=0,f=c.length;l<f;l++){var d=c[l],m=d.fromSegments.concat(h);if(t._get(m)===t._get(r))t.emit(e,m,i);else{var y=d.model.pass(s,!0);y._dereference=Yt,n(y,m,i,r)}}}}var v=t._refs.parentToMap;if(!(c=v[o]))return;for(var l=0,f=c.length;l<f;l++){var d=c[l],g=t._get(d.toSegments),x=t._get(d.fromSegments);if(x!==g){var y=d.model.pass(s,!0);y._dereference=Yt,y._set(d.fromSegments,g)}}})}function Yt(t){return t}function Xt(t,e,n,r){this.model=t&&t.pass({$ref:this}),this.from=e,this.to=n,this.fromSegments=e.split("."),this.toSegments=n.split("."),this.parentTos=[];for(var i=1,o=this.toSegments.length;i<o;i++){var s=this.toSegments.slice(0,i).join(".");this.parentTos.push(s)}this.updateIndices=r&&r.updateIndices}function Zt(){}function te(){}function ee(){this.fromMap=new Zt,this.toMap=new te,this.parentToMap=new te}function ne(t,e,n){t[e]||(t[e]=[]),t[e].push(n)}function re(t,e,n){var r=t[e];if(r){var i=r.indexOf(n);-1!==i&&(r.splice(i,1),r.length||delete t[e])}}P.INITS.push(function(t){var e=t.root;e._refs=new ee,function(t){function e(e,n){var r=t._refs.fromMap;for(var i in r){var o=r[i];if(o.updateIndices&&tt.contains(e,o.toSegments)&&o.toSegments.length>e.length){var s=+o.toSegments[e.length],a=n(s);s!==a&&(t._refs.remove(i),o.toSegments[e.length]=""+a,o.to=o.toSegments.join("."),t._refs.add(o))}}}t.on("insertImmediate",function(t,n){var r=n[0],i=n[1].length;e(t,function(t){return r<=t?t+i:t})}),t.on("removeImmediate",function(t,n){var r=n[0],i=n[1].length;e(t,function(t){return r<=t?t-i:t})}),t.on("moveImmediate",function(t,n){var r=n[0],i=n[1],o=n[2];e(t,function(t){if(r<=t&&t<r+o)return t+i-r;r<=t&&(t-=o);i<=t&&(t+=o);return t})})}(e),Wt(e,"change",Ht),Wt(e,"load",zt),Wt(e,"unload",Gt),Wt(e,"insert",Kt),Wt(e,"remove",Qt),Wt(e,"move",Jt)}),P.prototype._canRefTo=function(t){return this.isPath(t)||t&&"function"==typeof t.ref},P.prototype.ref=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?this._canRefTo(arguments[1])?(t=arguments[0],e=arguments[1]):(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this.path(t),i=this.path(e);if(!i)return e.ref(r);var o=new Xt(this.root,r,i,n);if(o.fromSegments.length<2)throw new Error("ref must be performed under a collection and document id. Invalid path: "+r);this.root._refs.remove(r),this.root._refLists.remove(r);var s=this.get(e);return o.model._set(o.fromSegments,s),this.root._refs.add(o),this.scope(r)},P.prototype.removeRef=function(t){var e=this._splitPath(t),n=e.join(".");this._removeRef(e,n)},P.prototype._removeRef=function(t,e){this.root._refs.remove(e),this.root._refLists.remove(e),this._del(t)},P.prototype.removeAllRefs=function(t){var e=this._splitPath(t);this._removeAllRefs(e)},P.prototype._removeAllRefs=function(t){this._removeMapRefs(t,this.root._refs.fromMap),this._removeMapRefs(t,this.root._refLists.fromMap)},P.prototype._removeMapRefs=function(t,e){for(var n in e){var r=e[n].fromSegments;tt.contains(t,r)&&this._removeRef(r,n)}},P.prototype.dereference=function(t){var e=this._splitPath(t);return this._dereference(e).join(".")},P.prototype._dereference=function(t,e,n){if(0===t.length)return t;var r,i=this.root._refs.fromMap,o=this.root._refLists.fromMap;do{var s="";r=!1;for(var a=0,p=t.length;a<p;a++){var u=i[s=s?s+"."+t[a]:t[a]];if(u){var c=t.slice(a+1);t=u.toSegments.concat(c),r=!0;break}var h=o[s];if(h&&h!==n){if(!(a+2<p||e&&a+1<p))continue;t=h.dereference(t,a),r=!0;break}}}while(r);return 0===t.length?["$null"]:t},ee.prototype.add=function(t){this.fromMap[t.from]=t,ne(this.toMap,t.to,t);for(var e=0,n=t.parentTos.length;e<n;e++)ne(this.parentToMap,t.parentTos[e],t)},ee.prototype.remove=function(t){var e=this.fromMap[t];if(e){delete this.fromMap[t],re(this.toMap,e.to,e);for(var n=0,r=e.parentTos.length;n<r;n++)re(this.parentToMap,e.parentTos[n],e);return e}},ee.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to])}return t};var ie=P,oe={};(function(t){oe.basename=function(t,e){var n=function(t){"string"!=typeof t&&(t+="");var e,n=0,r=-1,i=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!i){n=e+1;break}}else-1===r&&(i=!1,r=e+1);return-1===r?"":t.slice(n,r)}(t);return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n};"ab".substr(-1)}).call(this,M);var se={},ae={}.toString;se.pathRegexp=function(t,e,n,r){return"[object RegExp]"==ae.call(t)?t:(Array.isArray(t)&&(t="("+t.join("|")+")"),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,n,r,i,o,s,a){return e.push({name:i,optional:!!s}),n=n||"",(s?"":n)+"(?:"+(s?n:"")+(r||"")+(o||(r?"([^/.]+?)":"([^/]+?)"))+")"+(s||"")+(a?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",n?"":"i"))};var pe=ue;function ue(t,e,n,r){r=r||{},this.path=e,this.method=t,this.callbacks=n,this.regexp=se.pathRegexp(e,this.keys=[],r.sensitive,r.strict)}ue.prototype.match=function(t){var e=this.keys,n=this.params=[],r=this.regexp.exec(t);if(!r)return!1;for(var i=1,o=r.length;i<o;++i){var s=e[i-1],a="string"==typeof r[i]?decodeURIComponent(r[i]):r[i];s?n[s.name]=a:n.push(a)}return!0};var ce=Object.prototype.hasOwnProperty,he=Array.isArray,le=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),fe={assign:function(t,e){return Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],r=0;r<e.length;++r)for(var i=e[r],o=i.obj[i.prop],s=Object.keys(o),a=0;a<s.length;++a){var p=s[a],u=o[p];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(e.push({obj:o,prop:p}),n.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(he(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,n){var r=t.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode:function(t,e,n){if(0===t.length)return t;var r=t;if("symbol"==typeof t?r=Symbol.prototype.toString.call(t):"string"!=typeof t&&(r=String(t)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var i="",o=0;o<r.length;++o){var s=r.charCodeAt(o);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?i+=r.charAt(o):s<128?i+=le[s]:s<2048?i+=le[192|s>>6]+le[128|63&s]:s<55296||s>=57344?i+=le[224|s>>12]+le[128|s>>6&63]+le[128|63&s]:(o+=1,s=65536+((1023&s)<<10|1023&r.charCodeAt(o)),i+=le[240|s>>18]+le[128|s>>12&63]+le[128|s>>6&63]+le[128|63&s])}return i},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},merge:function t(e,n,r){if(!n)return e;if("object"!=typeof n){if(he(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(r&&(r.plainObjects||r.allowPrototypes)||!ce.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var i=e;return he(e)&&!he(n)&&(i=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(n[r]=t[r]);return n}(e,r)),he(e)&&he(n)?(n.forEach(function(n,i){if(ce.call(e,i)){var o=e[i];o&&"object"==typeof o&&n&&"object"==typeof n?e[i]=t(o,n,r):e.push(n)}else e[i]=n}),e):Object.keys(n).reduce(function(e,i){var o=n[i];return ce.call(e,i)?e[i]=t(e[i],o,r):e[i]=o,e},i)}},de=String.prototype.replace,me=/%20/g,ye={RFC1738:"RFC1738",RFC3986:"RFC3986"},ve=fe.assign({default:ye.RFC3986,formatters:{RFC1738:function(t){return de.call(t,me,"+")},RFC3986:function(t){return String(t)}}},ye),ge=(Object.prototype.hasOwnProperty,Array.isArray,Array.prototype.push,Date.prototype.toISOString),xe=ve.default,be=(ve.formatters[xe],Object.prototype.hasOwnProperty),we={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:fe.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},_e=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},Ee=function(t,e,n){if(t){var r=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,o=n.depth>0&&/(\[[^[\]]*])/.exec(r),s=o?r.slice(0,o.index):r,a=[];if(s){if(!n.plainObjects&&be.call(Object.prototype,s)&&!n.allowPrototypes)return;a.push(s)}for(var p=0;n.depth>0&&null!==(o=i.exec(r))&&p<n.depth;){if(p+=1,!n.plainObjects&&be.call(Object.prototype,o[1].slice(1,-1))&&!n.allowPrototypes)return;a.push(o[1])}return o&&a.push("["+r.slice(o.index)+"]"),function(t,e,n){for(var r=e,i=t.length-1;i>=0;--i){var o,s=t[i];if("[]"===s&&n.parseArrays)o=[].concat(r);else{o=n.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,p=parseInt(a,10);n.parseArrays||""!==a?!isNaN(p)&&s!==a&&String(p)===a&&p>=0&&n.parseArrays&&p<=n.arrayLimit?(o=[])[p]=r:o[a]=r:o={0:r}}r=o}return r}(a,e,n)}},Ce={parse:function(t,e){var n=function(t){if(!t)return we;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?we.charset:t.charset;return{allowDots:void 0===t.allowDots?we.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:we.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:we.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:we.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:we.comma,decoder:"function"==typeof t.decoder?t.decoder:we.decoder,delimiter:"string"==typeof t.delimiter||fe.isRegExp(t.delimiter)?t.delimiter:we.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:we.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:we.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:we.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:we.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:we.strictNullHandling}}(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof t?function(t,e){var n,r={},i=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=e.parameterLimit===1/0?void 0:e.parameterLimit,s=i.split(e.delimiter,o),a=-1,p=e.charset;if(e.charsetSentinel)for(n=0;n<s.length;++n)0===s[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===s[n]?p="utf-8":"utf8=%26%2310003%3B"===s[n]&&(p="iso-8859-1"),a=n,n=s.length);for(n=0;n<s.length;++n)if(n!==a){var u,c,h=s[n],l=h.indexOf("]="),f=-1===l?h.indexOf("="):l+1;-1===f?(u=e.decoder(h,we.decoder,p,"key"),c=e.strictNullHandling?null:""):(u=e.decoder(h.slice(0,f),we.decoder,p,"key"),c=e.decoder(h.slice(f+1),we.decoder,p,"value")),c&&e.interpretNumericEntities&&"iso-8859-1"===p&&(c=_e(c)),c&&e.comma&&c.indexOf(",")>-1&&(c=c.split(",")),be.call(r,u)?r[u]=fe.combine(r[u],c):r[u]=c}return r}(t,n):t,i=n.plainObjects?Object.create(null):{},o=Object.keys(r),s=0;s<o.length;++s){var a=o[s],p=Ee(a,r[a],n);i=fe.merge(i,p,n)}return fe.compact(i)}},Se={exports:{}};(function(t){!function(e){var n="object"==typeof Se.exports&&Se.exports&&!Se.exports.nodeType&&Se.exports,r=Se&&!Se.nodeType&&Se,i="object"==typeof t&&t;i.global!==i&&i.window!==i&&i.self!==i||(e=i);var o,s,a=2147483647,p=36,u=1,c=26,h=38,l=700,f=72,d=128,m="-",y=/^xn--/,v=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=p-u,w=Math.floor,_=String.fromCharCode;function E(t){throw new RangeError(x[t])}function C(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function S(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+C((t=t.replace(g,".")).split("."),e).join(".")}function A(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function k(t){return C(t,function(t){var e="";return t>65535&&(e+=_((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=_(t)}).join("")}function I(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function T(t,e,n){var r=0;for(t=n?w(t/l):t>>1,t+=w(t/e);t>b*c>>1;r+=p)t=w(t/b);return w(r+(b+1)*t/(t+h))}function L(t){var e,n,r,i,o,s,h,l,y,v,g,x=[],b=t.length,_=0,C=d,S=f;for((n=t.lastIndexOf(m))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&E("not-basic"),x.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<b;){for(o=_,s=1,h=p;i>=b&&E("invalid-input"),((l=(g=t.charCodeAt(i++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:p)>=p||l>w((a-_)/s))&&E("overflow"),_+=l*s,!(l<(y=h<=S?u:h>=S+c?c:h-S));h+=p)s>w(a/(v=p-y))&&E("overflow"),s*=v;S=T(_-o,e=x.length+1,0==o),w(_/e)>a-C&&E("overflow"),C+=w(_/e),_%=e,x.splice(_++,0,C)}return k(x)}function O(t){var e,n,r,i,o,s,h,l,y,v,g,x,b,C,S,k=[];for(x=(t=A(t)).length,e=d,n=0,o=f,s=0;s<x;++s)(g=t[s])<128&&k.push(_(g));for(r=i=k.length,i&&k.push(m);r<x;){for(h=a,s=0;s<x;++s)(g=t[s])>=e&&g<h&&(h=g);for(h-e>w((a-n)/(b=r+1))&&E("overflow"),n+=(h-e)*b,e=h,s=0;s<x;++s)if((g=t[s])<e&&++n>a&&E("overflow"),g==e){for(l=n,y=p;!(l<(v=y<=o?u:y>=o+c?c:y-o));y+=p)S=l-v,C=p-v,k.push(_(I(v+S%C,0))),l=w(S/C);k.push(_(I(l,0))),o=T(n,b,r==i),n=0,++r}++n,++e}return k.join("")}if(o={version:"1.4.1",ucs2:{decode:A,encode:k},decode:L,encode:O,toASCII:function(t){return S(t,function(t){return v.test(t)?"xn--"+O(t):t})},toUnicode:function(t){return S(t,function(t){return y.test(t)?L(t.slice(4).toLowerCase()):t})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return o});else if(n&&r)if(Se.exports==n)r.exports=o;else for(s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);else e.punycode=o}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),Se=Se.exports;var Ae={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function ke(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Ie=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Te=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},Le=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function Oe(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var Pe=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},je={parse:function(t,e,n,r){e=e||"&",n=n||"=";var i={};if("string"!=typeof t||0===t.length)return i;var o=/\+/g;t=t.split(e);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var p=0;p<a;++p){var u,c,h,l,f=t[p].replace(o,"%20"),d=f.indexOf(n);d>=0?(u=f.substr(0,d),c=f.substr(d+1)):(u=f,c=""),h=decodeURIComponent(u),l=decodeURIComponent(c),ke(i,h)?Ie(i[h])?i[h].push(l):i[h]=[i[h],l]:i[h]=l}return i},stringify:function(t,e,n,r){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?Oe(Pe(t),function(r){var i=encodeURIComponent(Te(r))+n;return Le(t[r])?Oe(t[r],function(t){return i+encodeURIComponent(Te(t))}).join(e):i+encodeURIComponent(Te(t[r]))}).join(e):r?encodeURIComponent(Te(r))+n+encodeURIComponent(Te(t)):""}},Ne={};function Me(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}Ne.parse=Qe,Ne.resolve=function(t,e){return Qe(t,!1,!0).resolve(e)};var De=/^([a-z0-9.+-]+:)/i,Re=/:[0-9]*$/,Be=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Fe=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Ue=["'"].concat(Fe),$e=["%","/","?",";","#"].concat(Ue),qe=["/","?","#"],Ve=/^[+a-z0-9A-Z_-]{0,63}$/,He=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,ze={javascript:!0,"javascript:":!0},Ge={javascript:!0,"javascript:":!0},Ke={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Qe(t,e,n){if(t&&Ae.isObject(t)&&t instanceof Me)return t;var r=new Me;return r.parse(t,e,n),r}Me.prototype.parse=function(t,e,n){if(!Ae.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),i=-1!==r&&r<t.indexOf("#")?"?":"#",o=t.split(i);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(i);if(s=s.trim(),!n&&1===t.split("#").length){var a=Be.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?je.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var p=De.exec(s);if(p){var u=(p=p[0]).toLowerCase();this.protocol=u,s=s.substr(p.length)}if(n||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var c="//"===s.substr(0,2);!c||p&&Ge[p]||(s=s.substr(2),this.slashes=!0)}if(!Ge[p]&&(c||p&&!Ke[p])){for(var h,l,f=-1,d=0;d<qe.length;d++){-1!==(m=s.indexOf(qe[d]))&&(-1===f||m<f)&&(f=m)}-1!==(l=-1===f?s.lastIndexOf("@"):s.lastIndexOf("@",f))&&(h=s.slice(0,l),s=s.slice(l+1),this.auth=decodeURIComponent(h)),f=-1;for(d=0;d<$e.length;d++){var m;-1!==(m=s.indexOf($e[d]))&&(-1===f||m<f)&&(f=m)}-1===f&&(f=s.length),this.host=s.slice(0,f),s=s.slice(f),this.parseHost(),this.hostname=this.hostname||"";var y="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!y)for(var v=this.hostname.split(/\./),g=(d=0,v.length);d<g;d++){var x=v[d];if(x&&!x.match(Ve)){for(var b="",w=0,_=x.length;w<_;w++)x.charCodeAt(w)>127?b+="x":b+=x[w];if(!b.match(Ve)){var E=v.slice(0,d),C=v.slice(d+1),S=x.match(He);S&&(E.push(S[1]),C.unshift(S[2])),C.length&&(s="/"+C.join(".")+s),this.hostname=E.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=Se.toASCII(this.hostname));var A=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+A,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!ze[u])for(d=0,g=Ue.length;d<g;d++){var I=Ue[d];if(-1!==s.indexOf(I)){var T=encodeURIComponent(I);T===I&&(T=escape(I)),s=s.split(I).join(T)}}var L=s.indexOf("#");-1!==L&&(this.hash=s.substr(L),s=s.slice(0,L));var O=s.indexOf("?");if(-1!==O?(this.search=s.substr(O),this.query=s.substr(O+1),e&&(this.query=je.parse(this.query)),s=s.slice(0,O)):e&&(this.search="",this.query={}),s&&(this.pathname=s),Ke[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){A=this.pathname||"";var P=this.search||"";this.path=A+P}return this.href=this.format(),this},Me.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&Ae.isObject(this.query)&&Object.keys(this.query).length&&(o=je.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Ke[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+i+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+r},Me.prototype.resolve=function(t){return this.resolveObject(Qe(t,!1,!0)).format()},Me.prototype.resolveObject=function(t){if(Ae.isString(t)){var e=new Me;e.parse(t,!1,!0),t=e}for(var n=new Me,r=Object.keys(this),i=0;i<r.length;i++){var o=r[i];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var p=s[a];"protocol"!==p&&(n[p]=t[p])}return Ke[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!Ke[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var h=u[c];n[h]=t[h]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||Ge[t.protocol])n.pathname=t.pathname;else{for(var l=(t.pathname||"").split("/");l.length&&!(t.host=l.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==l[0]&&l.unshift(""),l.length<2&&l.unshift(""),n.pathname=l.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var f=n.pathname||"",d=n.search||"";n.path=f+d}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=y||m||n.host&&t.pathname,g=v,x=n.pathname&&n.pathname.split("/")||[],b=(l=t.pathname&&t.pathname.split("/")||[],n.protocol&&!Ke[n.protocol]);if(b&&(n.hostname="",n.port=null,n.host&&(""===x[0]?x[0]=n.host:x.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===l[0]?l[0]=t.host:l.unshift(t.host)),t.host=null),v=v&&(""===l[0]||""===x[0])),y)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,x=l;else if(l.length)x||(x=[]),x.pop(),x=x.concat(l),n.search=t.search,n.query=t.query;else if(!Ae.isNullOrUndefined(t.search)){if(b)n.hostname=n.host=x.shift(),(S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=S.shift(),n.host=n.hostname=S.shift());return n.search=t.search,n.query=t.query,Ae.isNull(n.pathname)&&Ae.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!x.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var w=x.slice(-1)[0],_=(n.host||t.host||x.length>1)&&("."===w||".."===w)||""===w,E=0,C=x.length;C>=0;C--)"."===(w=x[C])?x.splice(C,1):".."===w?(x.splice(C,1),E++):E&&(x.splice(C,1),E--);if(!v&&!g)for(;E--;E)x.unshift("..");!v||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),_&&"/"!==x.join("/").substr(-1)&&x.push("");var S,A=""===x[0]||x[0]&&"/"===x[0].charAt(0);b&&(n.hostname=n.host=A?"":x.length?x.shift():"",(S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=S.shift(),n.host=n.hostname=S.shift()));return(v=v||n.host&&x.length)&&!A&&x.unshift(""),x.length?n.pathname=x.join("/"):(n.pathname=null,n.path=null),Ae.isNull(n.pathname)&&Ae.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},Me.prototype.parseHost=function(){var t=this.host,e=Re.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var Je={render:function(t,e,n){var r=new We(t.app.page,t.routes,e,n);r.routeTransitional(0,function(){r.page=t.page(),r.routeQueue(0,function(){r.cancel()})})},isTransitional:function(t){return t.hasOwnProperty("from")&&t.hasOwnProperty("to")},mapRoute:function(t,e){var n=~(r=e.url.indexOf("?"))?e.url.slice(r):"",r=0;return t.replace(/\/(?:(?:\:([^?\/:*(]+)(?:\([^)]+\))?)|\*)(\?)?/g,function(t,n,i){var o=n?e[n]:e[r++];return i&&null==o?"":"/"+encodeURIComponent(o)})+n}};function We(t,e,n,r){this.page=t,this.options=n,this.e=r,this.setUrl(n.url.replace(/#.*/,""));var i=Ne.parse(this.url).query;this.query=i?Ce.parse(i):{},this.method=n.method,this.body=n.body||{},this.setPrevious(n.previous),this.transitional=e.transitional[this.method],this.queue=e.queue[this.method],this.app=e.app}We.prototype.cancel=function(){var t=this.options;this.e||t.noNavigate||(t.form?(t.form.setAttribute("data-router-ignore",""),t.form.submit()):window.location.assign(t.url))},We.prototype.setUrl=function(t){this.url=t,this.path=t.replace(/\?.*/,"")},We.prototype.setPrevious=function(t){this.previous=t,this.previousPath=t&&t.replace(/\?.*/,"")},We.prototype.routeTransitional=function(t,e){var n;for(t||(t=0);n=this.transitional[t++];){if(n.to.match(this.path)&&n.from.match(this.previousPath)){var r=this,i=this.routeParams(n.to);return void this.onMatch(n.to,i,function(n){if(n)return r.cancel();r.routeTransitional(t,e)},o)}function o(){}}e()},We.prototype.routeQueue=function(t,e){var n;for(t||(t=0);n=this.queue[t++];)if(n.match(this.path)){var r=this,i=this.routeParams(n);return void this.onMatch(n,i,function(n){if(n)return r.cancel();r.routeQueue(t,e)})}e()},We.prototype.onMatch=function(t,e,n,r){if(!this.page)return n();this.e&&(this.e.preventDefault(),this.e=null),this.page.params=e,t.isTransitional?this.app.onRoute(t.callbacks,this.page,n,r):this.app.onRoute(t.callbacks,this.page,n)},We.prototype.routeParams=function(t){var e=t.params,n=e.slice();for(var r in e)n[r]=e[r];return n.previous=this.previous,n.url=this.url,n.body=this.body,n.query=this.query,n.method=this.method,n};var Ye=Ne.parse,Xe=Ne.resolve,Ze=window.location.pathname+window.location.search;window.history.replaceState&&window.history.replaceState({$render:!0,$method:"get"},null,window.location.href);var tn=en;function en(t,e){this.app=t,this.routes=e,window.history.pushState?function(t){document.addEventListener("click",function(e){var n=e.target;if(e.metaKey||1!==e.which)return;if(e.defaultPrevented)return;for(;n;){var r=n.href;if(r){if(n.hasAttribute&&n.hasAttribute("data-router-ignore"))return;if(n.target&&"_self"!==n.target)return;var i=r.indexOf("#");if(~i&&r.slice(0,i)===window.location.href.replace(/#.*/,""))return;return e._tracksLink=n,void t.push(r,!0,null,e)}n=n.parentNode}},!0),document.addEventListener("submit",function(e){var n=e.target;if(e.defaultPrevented)return;if("form"!==n.tagName.toLowerCase())return;if("multipart/form-data"===n.enctype)return;if(n.hasAttribute&&n.hasAttribute("data-router-ignore"))return;var r=n.action||window.location.href;t.push(r,!0,null,e)},!1),window.addEventListener("popstate",function(e){if(!t.app.page)return;var n=Ze,r=e.state;Ze=window.location.pathname+window.location.search;var i={previous:n,url:Ze};if(r){if(!r.$render)return;return i.method=r.$method,Je.render(t,i)}var o,s,a=window.location.href,p=a.indexOf("#");~p&&Ze!==n&&(i.method="get",Je.render(t,i),s=a.slice(p+1),(o=document.getElementById(s)||document.getElementsByName(s)[0])&&o.scrollIntoView())},!0)}(this):(this.push=function(t){window.location.assign(t)},this.replace=function(t){window.location.replace(t)})}function nn(t){var e=Ye(t);return e&&e.protocol===window.location.protocol&&e.host===window.location.host&&e.pathname+(e.search||"")}en.prototype.push=function(t,e,n,r){this._update("pushState",t,e,n,r)},en.prototype.replace=function(t,e,n,r){this._update("replaceState",t,e,n,r)},en.prototype.refresh=function(){var t=nn(window.location.href);Je.render(this,{url:t,method:"get"})},en.prototype.back=function(){window.history.back()},en.prototype.forward=function(){window.history.forward()},en.prototype.go=function(t){window.history.go(t)},en.prototype._update=function(t,e,n,r,i){var o=nn(Xe(window.location.href,e));if(o){null==n&&(n=!0),null==r&&(r={});var s=function(t,e){if(t&&"submit"===t.type){for(var n,r=t.target,i=r.elements,o=[],s=0,a=i.length;s<a;s++){var p=(n=i[s]).name;if(p){var u=n.value;if(o.push(encodeURIComponent(p)+"="+encodeURIComponent(u)),"_method"===p){var c=u.toLowerCase();"delete"===c&&(c="del")}}}if(o=o.join("&"),"post"===r.method.toLowerCase())var h=c||"post",l=Ce.parse(o);else h="get",e+="?"+o}else h="get";return{method:h,url:e,previous:window.location.pathname+window.location.search,body:l,form:r,link:t&&t._tracksLink}}(i,o);r.$render=!0,r.$method=s.method,window.history[t](r,null,s.url),Ze=window.location.pathname+window.location.search,n&&Je.render(this,s,i)}},en.prototype.page=function(){var t=this.app.createPage(),e=this;return t.redirect=function(t){if("back"===t)return e.back();"home"===t&&(t="\\"),e.replace(t,!0)},t};var rn={},on=rn=Je;on.setup=function(t){var e={queue:{},transitional:{},app:t};t.history=new tn(t,e),["get","post","put","del","enter","exit"].forEach(function(n){var r=e.queue[n]=[],i=e.transitional[n]=[];t[n]=function(e,o){if(Array.isArray(e))return e.forEach(function(e){t[n](e,o)}),t;if(on.isTransitional(e)){var s=e.from,a=e.to,p=e.forward||o&&o.forward||o,u=e.back||o&&o.back,c=new pe(n,s,u),h=new pe(n,a,p);return c.isTransitional=!0,h.isTransitional=!0,i.push({from:c,to:h}),u&&i.push({from:h,to:c}),t}return r.push(new pe(n,e,o)),t}})};var sn={};function an(){}function pn(t,e,n,r,i){this.meta=t,this.controller=e,this.parent=n,this.unbound=r,this.expression=i,this.alias=i&&i.meta&&i.meta.as,this.keyAlias=i&&i.meta&&i.meta.keyAs,this.item=null,this.view=null,this.attributes=null,this.hooks=null,this.initHooks=null,this.closure=null,this._id=null}sn.ContextMeta=function(){this.addBinding=an,this.removeBinding=an,this.removeNode=an,this.addItemContext=an,this.removeItemContext=an,this.views=null,this.idNamespace="",this.idCount=0,this.pending=[],this.pauseCount=0},sn.Context=pn,pn.prototype.id=function(){var t=++this.meta.idCount;return this.meta.idNamespace+"_"+t.toString(36)},pn.prototype.addBinding=function(t){if(!t.itemFor){var e=t.template.expression;(e?e.isUnbound(this):this.unbound)||e&&e.meta&&"with"===e.meta.blockType||this.meta.addBinding(t)}},pn.prototype.removeBinding=function(t){this.meta.removeBinding(t)},pn.prototype.removeNode=function(t){this.meta.removeNode(t)},pn.prototype.child=function(t){var e=t.meta&&t.meta.blockType,n="unbound"===e||"bound"!==e&&this.unbound;return new pn(this.meta,this.controller,this,n,t)},pn.prototype.componentChild=function(t){return new pn(this.meta,t,this,this.unbound)},pn.prototype.eachChild=function(t,e){var n=new pn(this.meta,this.controller,this,this.unbound,t);return n.item=e,this.meta.addItemContext(n),n},pn.prototype.viewChild=function(t,e,n,r){var i=new pn(this.meta,this.controller,this,this.unbound);return i.view=t,i.attributes=e,i.hooks=n,i.initHooks=r,i},pn.prototype.closureChild=function(t){var e=new pn(this.meta,this.controller,this,this.unbound);return e.closure=t,e},pn.prototype.forRelative=function(t){for(var e=this;e&&e.expression===t||e.view;)e=e.parent;return e},pn.prototype.forAlias=function(t){for(var e=this;e;){if(e.alias===t||e.keyAlias===t)return e;e=e.parent}},pn.prototype.forAttribute=function(t){for(var e=this;e;){if(e.view){var n=e.attributes;if(!n)return;if(n.hasOwnProperty(t))return e;if(!n.inherit&&!n.extend)return}e=e.parent}},pn.prototype.forViewParent=function(){for(var t=this;t;){if(t.closure)return t.closure.parent;if(t.view)return t.parent;t=t.parent}},pn.prototype.getView=function(){for(var t=this;t;){if(t.view)return t.view;t=t.parent}},pn.prototype.get=function(){var t=this.expression?this.expression.get(this):this.controller.model.data;return null!=this.item?t&&t[this.item]:t},pn.prototype.pause=function(){this.meta.pauseCount++},pn.prototype.unpause=function(){--this.meta.pauseCount||this.flush()},pn.prototype.flush=function(){var t=this.meta.pending,e=t.length;if(e){this.meta.pending=[];for(var n=0;n<e;n++)t[n]()}},pn.prototype.queue=function(t){this.meta.pending.push(t)};var un={get:{"!U":function(t){return!t},"-U":function(t){return-t},"+U":function(t){return+t},"~U":function(t){return~t},typeofU:function(t){return typeof t},"||":function(t,e){return t||e},"&&":function(t,e){return t&&e},"|":function(t,e){return t|e},"^":function(t,e){return t^e},"&":function(t,e){return t&e},"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"<":function(t,e){return t<e},">":function(t,e){return t>e},"<=":function(t,e){return t<=e},">=":function(t,e){return t>=e},instanceof:function(t,e){return t instanceof e},in:function(t,e){return t in e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"?":function(t,e,n){return t?e:n},",":function(){return arguments[arguments.length-1]}},set:{"!U":function(t){return[!t]},"-U":function(t){return[-t]},"==":function(t,e,n){if(t)return[n]},"===":function(t,e,n){if(t)return[n]},in:function(t,e,n){return n[e]=!0,{1:n}},"+":function(t,e,n){return[t-n]},"-":function(t,e,n){return[t+n]},"*":function(t,e,n){return[t/n]},"/":function(t,e,n){return[t*n]}}},cn={},hn=r({}),ln={checked:"checked",disabled:"disabled",readonly:"readOnly",selected:"selected"},fn={colspan:"colSpan",maxlength:"maxLength",rowspan:"rowSpan",tabindex:"tabIndex"},dn={cellpadding:"cellPadding",cellspacing:"cellSpacing",class:"className",contenteditable:"contentEditable",enctype:"encoding",for:"htmlFor",frameborder:"frameBorder",id:"id",title:"title",type:"type",usemap:"useMap",value:"value"},mn={};rr(ln,mn),rr(fn,mn),rr(dn,mn);var yn={};rr(mn,yn),yn.checked="defaultChecked",yn.value="defaultValue";var vn={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function gn(t,e){this.content=t,this.source=e}function xn(t,e,n){this.name=t,this.publicId=e,this.systemId=n}function bn(t){this.data=t,this.escaped=ir(t)}function wn(t){this.expression=t,this.unbound=!1}function _n(t,e,n,r,i){if(!e){var o=document.createTextNode(n);return t.appendChild(o),void An(r,i,o)}if(3===e.nodeType){if(e.data===n)return An(r,i,e),e.nextSibling;var s=function(t,e){var n=t.cloneNode(!1);return n.deleteData(0,e),t.deleteData(e,t.length-e),t.parentNode.insertBefore(n,t.nextSibling||null),n}(e,(n=pr(n)).length);if(e.data!==n)throw Yn(t,e);return An(r,i,e),s}if(""===n){o=document.createTextNode("");return t.insertBefore(o,e||null),An(r,i,o),e}throw Yn(t,e)}function En(t,e){this.data=t,this.hooks=e}function Cn(t,e){this.expression=t,this.hooks=e}function Sn(t,e,n,r,i){if(!e||8!==e.nodeType){var o=document.createComment(n);return t.insertBefore(o,e||null),An(r,i,o),e}if(e.data===n)return An(r,i,e),e.nextSibling;throw Yn(t,e)}function An(t,e,n){t.expression&&!t.unbound&&e.addBinding(new Zn(t,e,n)),Bn(t.hooks,e,n)}function kn(t){this.data=t}function In(t){this.expression=t,this.ending="/"+t}function Tn(t,e){if(t&&1===t.nodeType)return(r=document.createRange()).selectNodeContents(t),r.createContextualFragment(e);var n=document.createElement("div"),r=document.createRange();return n.innerHTML=e,r.selectNodeContents(n),r.extractContents()}function Ln(t,e,n){for(var r=0,i=Tn(t,n).childNodes.length;r<i;r++){if(!e)throw Yn(t,e);e=e.nextSibling}return e}function On(t,e){this.data=t,this.ns=e}function Pn(t,e){this.expression=t,this.ns=e,this.elementNs=null}function jn(t,e){for(var n=t.get(e,!0);n instanceof gn;)n=n.get(e,!0);return n}function Nn(t,e,n,r,i,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=r,this.selfClosing=i,this.notClosed=o,this.ns=s,this.endTag=Rn(t,i,o),this.startClose=Dn(i);var a=t&&t.toLowerCase();this.unescapedContent="script"===a||"style"===a,this.bindContentToValue="textarea"===a}function Mn(t,e,n,r,i,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=r,this.selfClosing=i,this.notClosed=o,this.ns=s,this.startClose=Dn(i),this.unescapedContent=!1}function Dn(t){return t?" />":">"}function Rn(t,e,n){var r=t&&t.toLowerCase();return vn[r]||e||n?"":"</"+t+">"}function Bn(t,e,n){t&&e.queue(function(){for(var r=0,i=t.length;r<i;r++)t[r].emit(e,n)})}function Fn(t,e){this.expression=t,this.ending="/"+t,this.content=e}function Un(t,e){this.expressions=t,this.beginning=t.join("; "),this.ending="/"+this.beginning,this.contents=e}function $n(t,e,n){this.expression=t,this.ending="/"+t,this.content=e,this.elseContent=n}function qn(t,e){for(var n=t.start,r=0;n=n.nextSibling;){if(n===t.end)return n;if(n.$bindItemStart&&n.$bindItemStart.itemFor===t.start){if(e===r)return n;r++}}}function Vn(t,e,n,r,i,o,s){e?(e.start=r,e.end=i,e.condition=s,Hn(e,r,o)):t.addBinding(new nr(n,t,r,i,o,s))}function Hn(t,e,n){ar(e,n?"$bindItemStart":"$bindStart",t)}function zn(t,e,n){for(var r=0,i=e.length;r<i;r++)e[r].appendTo(t,n)}function Gn(t,e,n,r){for(var i=0,o=n.length;i<o;i++){for(;e&&e.hasAttribute&&e.hasAttribute("data-no-attach");)e=e.nextSibling;e=n[i].attachTo(t,e,r)}return e}function Kn(t,e,n){for(var r="",i=0,o=t.length;i<o;i++)r+=t[i].get(e,n);return r}function Qn(t,e,n,r,i,o){var s=e.parentNode;if(e.$bindItemStart&&r.firstChild&&(ar(r.firstChild,"$bindItemStart",e.$bindItemStart),e.$bindItemStart.start=r.firstChild),e===n)return s.replaceChild(r,e),void Jn(t,e,i);for(var a,p=o?e.nextSibling:e;p;){if(a=p.nextSibling,Jn(t,p,i),o&&p===n){a=n;break}if(s.removeChild(p),p===n)break;p=a}s.insertBefore(r,a||null)}function Jn(t,e,n){t.removeNode(e),Wn(t,n,e,"$bindNode"),Wn(t,n,e,"$bindStart"),Wn(t,n,e,"$bindItemStart");var r=e.$bindAttributes;if(r)for(var i in e.$bindAttributes=null,r)t.removeBinding(r[i]);for(e=e.firstChild;e;e=e.nextSibling)Jn(t,e,n)}function Wn(t,e,n,r){var i=n[r];i&&(n[r]=null,i!==e&&t.removeBinding(i))}function Yn(t,e){return"undefined"!=typeof console&&console.error("Attach failed for",e,"within",t),new Error("Attaching bindings failed, because HTML structure does not match client rendering.")}function Xn(){this.meta=null}function Zn(t,e,n){this.template=t,this.context=e,this.node=n,this.meta=null,ar(n,"$bindNode",this)}function tr(){}function er(t,e,n,r){this.template=t,this.context=e,this.element=n,this.name=r,this.meta=null,(n.$bindAttributes||(n.$bindAttributes=new tr))[r]=this}function nr(t,e,n,r,i,o){this.template=t,this.context=e,this.start=n,this.end=r,this.itemFor=i,this.condition=o,this.meta=null,Hn(this,n,i)}function rr(t,e){for(var n in t)e[n]=t[n]}function ir(t){return(t+="").replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"})}function or(t){return(t+="").replace(/[&"]/g,function(t){return"&"===t?"&amp;":"&quot;"})}function sr(t,e){return t===e||t instanceof gn&&t.equals(e)}function ar(t,e,n){return t[e]=n}function pr(t){return t}cn.CREATE_PROPERTIES=yn,cn.BOOLEAN_PROPERTIES=ln,cn.INTEGER_PROPERTIES=fn,cn.STRING_PROPERTIES=dn,cn.UPDATE_PROPERTIES=mn,cn.VOID_ELEMENTS=vn,cn.NAMESPACE_URIS={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"},cn.Template=gn,cn.Doctype=xn,cn.Text=bn,cn.DynamicText=wn,cn.Comment=En,cn.DynamicComment=Cn,cn.Html=kn,cn.DynamicHtml=In,cn.Element=Nn,cn.DynamicElement=Mn,cn.Block=Fn,cn.ConditionalBlock=Un,cn.EachBlock=$n,cn.Attribute=On,cn.DynamicAttribute=Pn,cn.Binding=Xn,cn.NodeBinding=Zn,cn.AttributeBinding=er,cn.RangeBinding=nr,gn.prototype.toString=function(){return this.source},gn.prototype.get=function(t,e){return Kn(this.content,t,e)},gn.prototype.getFragment=function(t,e){var n=document.createDocumentFragment();return this.appendTo(n,t,e),n},gn.prototype.appendTo=function(t,e){e.pause(),zn(t,this.content,e),e.unpause()},gn.prototype.attachTo=function(t,e,n){n.pause();e=Gn(t,e,this.content,n);return n.unpause(),e},gn.prototype.update=function(){},gn.prototype.stringify=function(t){return null==t?"":t+""},gn.prototype.equals=function(t){return this===t},gn.prototype.module="templates",gn.prototype.type="Template",gn.prototype.serialize=function(){return hn.instance(this,this.content,this.source)},xn.prototype=Object.create(gn.prototype),xn.prototype.constructor=xn,xn.prototype.get=function(){var t=this.publicId?' PUBLIC "'+this.publicId+'"':"",e=this.systemId?this.publicId?' "'+this.systemId+'"':' SYSTEM "'+this.systemId+'"':"";return"<!DOCTYPE "+this.name+t+e+">"},xn.prototype.appendTo=function(){},xn.prototype.attachTo=function(t,e){if(!e||10!==e.nodeType)throw Yn(t,e);return e.nextSibling},xn.prototype.type="Doctype",xn.prototype.serialize=function(){return hn.instance(this,this.name,this.publicId,this.systemId)},bn.prototype=Object.create(gn.prototype),bn.prototype.constructor=bn,bn.prototype.get=function(t,e){return e?this.data:this.escaped},bn.prototype.appendTo=function(t){var e=document.createTextNode(this.data);t.appendChild(e)},bn.prototype.attachTo=function(t,e){return _n(t,e,this.data,this)},bn.prototype.type="Text",bn.prototype.serialize=function(){return hn.instance(this,this.data)},wn.prototype=Object.create(gn.prototype),wn.prototype.constructor=wn,wn.prototype.get=function(t,e){var n=this.expression.get(t);if(n instanceof gn){do{n=n.get(t,e)}while(n instanceof gn);return n}var r=this.stringify(n);return e?r:ir(r)},wn.prototype.appendTo=function(t,e,n){var r=this.expression.get(e);if(r instanceof gn){var i=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(e);return t.appendChild(i),r.appendTo(t,e),t.appendChild(o),void Vn(e,n,this,i,o,null,s)}var a=this.stringify(r),p=document.createTextNode(a);t.appendChild(p),An(this,e,p)},wn.prototype.attachTo=function(t,e,n){var r=this.expression.get(n);if(r instanceof gn){var i=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(n);return t.insertBefore(i,e||null),e=r.attachTo(t,e,n),t.insertBefore(o,e||null),Vn(n,null,this,i,o,null,s),e}return _n(t,e,this.stringify(r),this,n)},wn.prototype.update=function(t,e){if(e instanceof nr)this._blockUpdate(t,e);else{var n=this.expression.get(t);if(n instanceof gn){var r=e.node;if(!r.parentNode)return;Qn(t,r,r,this.getFragment(t),e)}else e.node.data=this.stringify(n)}},wn.prototype.getCondition=function(t){return this.expression.get(t)},wn.prototype.type="DynamicText",wn.prototype.serialize=function(){return hn.instance(this,this.expression)},En.prototype=Object.create(gn.prototype),En.prototype.constructor=En,En.prototype.get=function(){return"\x3c!--"+this.data+"--\x3e"},En.prototype.appendTo=function(t,e){var n=document.createComment(this.data);t.appendChild(n),Bn(this.hooks,e,n)},En.prototype.attachTo=function(t,e,n){return Sn(t,e,this.data,this,n)},En.prototype.type="Comment",En.prototype.serialize=function(){return hn.instance(this,this.data,this.hooks)},Cn.prototype=Object.create(gn.prototype),Cn.prototype.constructor=Cn,Cn.prototype.get=function(t){var e=jn(this.expression,t);return"\x3c!--"+this.stringify(e)+"--\x3e"},Cn.prototype.appendTo=function(t,e){var n=jn(this.expression,e),r=this.stringify(n),i=document.createComment(r);t.appendChild(i),An(this,e,i)},Cn.prototype.attachTo=function(t,e,n){var r=jn(this.expression,n);return Sn(t,e,this.stringify(r),this,n)},Cn.prototype.update=function(t,e){var n=jn(this.expression,t);e.node.data=this.stringify(n)},Cn.prototype.type="DynamicComment",Cn.prototype.serialize=function(){return hn.instance(this,this.expression,this.hooks)},kn.prototype=Object.create(gn.prototype),kn.prototype.constructor=kn,kn.prototype.get=function(){return this.data},kn.prototype.appendTo=function(t){var e=Tn(t,this.data);t.appendChild(e)},kn.prototype.attachTo=function(t,e){return Ln(t,e,this.data)},kn.prototype.type="Html",kn.prototype.serialize=function(){return hn.instance(this,this.data)},In.prototype=Object.create(gn.prototype),In.prototype.constructor=In,In.prototype.get=function(t){var e=jn(this.expression,t);return this.stringify(e)},In.prototype.appendTo=function(t,e,n){var r=document.createComment(this.expression),i=document.createComment(this.ending),o=jn(this.expression,e),s=Tn(t,this.stringify(o));t.appendChild(r),t.appendChild(s),t.appendChild(i),Vn(e,n,this,r,i)},In.prototype.attachTo=function(t,e,n){var r=document.createComment(this.expression),i=document.createComment(this.ending),o=jn(this.expression,n),s=this.stringify(o);return t.insertBefore(r,e||null),e=Ln(t,e,s),t.insertBefore(i,e||null),Vn(n,null,this,r,i),e},In.prototype.update=function(t,e){var n=e.start.parentNode;if(n){var r=e.start,i=e.end,o=jn(this.expression,t);Qn(t,r,i,Tn(n,this.stringify(o)),e,!0)}},In.prototype.type="DynamicHtml",In.prototype.serialize=function(){return hn.instance(this,this.expression)},On.prototype=Object.create(gn.prototype),On.prototype.constructor=On,On.prototype.get=On.prototype.getBound=function(t){return this.data},On.prototype.type="Attribute",On.prototype.serialize=function(){return hn.instance(this,this.data,this.ns)},Pn.prototype=Object.create(On.prototype),Pn.prototype.constructor=Pn,Pn.prototype.get=function(t){return jn(this.expression,t)},Pn.prototype.getBound=function(t,e,n,r){return this.elementNs=r,t.addBinding(new er(this,t,e,n)),jn(this.expression,t)},Pn.prototype.update=function(t,e){var n=jn(this.expression,t),r=e.element,i=!this.elementNs&&mn[e.name];if(i){var o=dn[e.name]?this.stringify(n):n;if(r[i]===o)return;r[i]=o}else!1!==n&&null!=n?(!0===n&&(n=e.name),this.ns?r.setAttributeNS(this.ns,e.name,n):r.setAttribute(e.name,n)):this.ns?r.removeAttributeNS(this.ns,e.name):r.removeAttribute(e.name)},Pn.prototype.type="DynamicAttribute",Pn.prototype.serialize=function(){return hn.instance(this,this.expression,this.ns)},Nn.prototype=Object.create(gn.prototype),Nn.prototype.constructor=Nn,Nn.prototype.getTagName=function(){return this.tagName},Nn.prototype.getEndTag=function(){return this.endTag},Nn.prototype.get=function(t){var e=this.getTagName(t),n=this.getEndTag(e),r=[e];for(var i in this.attributes){var o=this.attributes[i].get(t);!0===o?r.push(i):!1!==o&&null!=o&&r.push(i+'="'+or(o)+'"')}var s="<"+r.join(" ")+this.startClose;return this.content?s+Kn(this.content,t,this.unescapedContent)+n:s+n},Nn.prototype.appendTo=function(t,e){var n=this.getTagName(e),r=this.ns?document.createElementNS(this.ns,n):document.createElement(n);for(var i in this.attributes){var o=this.attributes[i],s=o.getBound(e,r,i,this.ns);if(!1!==s&&null!=s){var a=!this.ns&&yn[i];a?r[a]=s:(!0===s&&(s=i),o.ns?r.setAttributeNS(o.ns,i,s):r.setAttribute(i,s))}}this.content&&(this._bindContent(e,r),zn(r,this.content,e)),t.appendChild(r),Bn(this.hooks,e,r)},Nn.prototype.attachTo=function(t,e,n){var r=this.getTagName(n);if(!e||1!==e.nodeType||e.tagName.toLowerCase()!==r.toLowerCase())throw Yn(t,e);for(var i in this.attributes)this.attributes[i].getBound(n,e,i,this.ns);return this.content&&(this._bindContent(n,e),Gn(e,e.firstChild,this.content,n)),Bn(this.hooks,n,e),e.nextSibling},Nn.prototype._bindContent=function(t,e){var n=this.bindContentToValue&&1===this.content.length&&this.content[0];if(n instanceof wn){n.unbound=!0;var r=new Pn(n.expression);t.addBinding(new er(r,t,e,"value"))}},Nn.prototype.type="Element",Nn.prototype.serialize=function(){return hn.instance(this,this.tagName,this.attributes,this.content,this.hooks,this.selfClosing,this.notClosed,this.ns)},Mn.prototype=Object.create(Nn.prototype),Mn.prototype.constructor=Mn,Mn.prototype.getTagName=function(t){return jn(this.tagName,t)},Mn.prototype.getEndTag=function(t){return Rn(t,this.selfClosing,this.notClosed)},Mn.prototype.type="DynamicElement",Fn.prototype=Object.create(gn.prototype),Fn.prototype.constructor=Fn,Fn.prototype.get=function(t,e){var n=t.child(this.expression);return Kn(this.content,n,e)},Fn.prototype.appendTo=function(t,e,n){var r=e.child(this.expression),i=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(e);t.appendChild(i),zn(t,this.content,r),t.appendChild(o),Vn(e,n,this,i,o,null,s)},Fn.prototype.attachTo=function(t,e,n){var r=n.child(this.expression),i=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(n);return t.insertBefore(i,e||null),e=Gn(t,e,this.content,r),t.insertBefore(o,e||null),Vn(n,null,this,i,o,null,s),e},Fn.prototype.type="Block",Fn.prototype.serialize=function(){return hn.instance(this,this.expression,this.content)},Fn.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!sr(n,e.condition))e.condition=n,Qn(t,e.start,e.end,this.getFragment(t,e),e)}},Fn.prototype.getCondition=function(t){var e=this.expression.get(t);return"object"==typeof e?NaN:e},wn.prototype._blockUpdate=Fn.prototype.update,Un.prototype=Object.create(Fn.prototype),Un.prototype.constructor=Un,Un.prototype.get=function(t,e){var n=this.getCondition(t);if(null==n)return"";var r=this.expressions[n],i=t.child(r);return Kn(this.contents[n],i,e)},Un.prototype.appendTo=function(t,e,n){var r=document.createComment(this.beginning),i=document.createComment(this.ending);t.appendChild(r);var o=this.getCondition(e);if(null!=o){var s=this.expressions[o],a=e.child(s);zn(t,this.contents[o],a)}t.appendChild(i),Vn(e,n,this,r,i,null,o)},Un.prototype.attachTo=function(t,e,n){var r=document.createComment(this.beginning),i=document.createComment(this.ending);t.insertBefore(r,e||null);var o=this.getCondition(n);if(null!=o){var s=this.expressions[o],a=n.child(s);e=Gn(t,e,this.contents[o],a)}return t.insertBefore(i,e||null),Vn(n,null,this,r,i,null,o),e},Un.prototype.type="ConditionalBlock",Un.prototype.serialize=function(){return hn.instance(this,this.expressions,this.contents)},Un.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!sr(n,e.condition))e.condition=n,Qn(t,e.start,e.end,this.getFragment(t,e),e)}},Un.prototype.getCondition=function(t){for(var e=0,n=this.expressions.length;e<n;e++)if(this.expressions[e].truthy(t))return e},$n.prototype=Object.create(Fn.prototype),$n.prototype.constructor=$n,$n.prototype.get=function(t,e){var n=this.expression.get(t);if(n&&n.length){for(var r="",i=0,o=n.length;i<o;i++){var s=t.eachChild(this.expression,i);r+=Kn(this.content,s,e)}return r}return this.elseContent?Kn(this.elseContent,t,e):""},$n.prototype.appendTo=function(t,e,n){var r=this.expression.get(e),i=document.createComment(this.expression),o=document.createComment(this.ending);if(t.appendChild(i),r&&r.length)for(var s=0,a=r.length;s<a;s++){var p=e.eachChild(this.expression,s);this.appendItemTo(t,p,i)}else this.elseContent&&zn(t,this.elseContent,e);t.appendChild(o),Vn(e,n,this,i,o)},$n.prototype.appendItemTo=function(t,e,n,r){var i,o,s=t.lastChild;zn(t,this.content,e),s===t.lastChild?(i=o=document.createComment("empty"),t.appendChild(i)):(i=s&&s.nextSibling||t.firstChild,o=t.lastChild),Vn(e,r,this,i,o,n)},$n.prototype.attachTo=function(t,e,n){var r=this.expression.get(n),i=document.createComment(this.expression),o=document.createComment(this.ending);if(t.insertBefore(i,e||null),r&&r.length)for(var s=0,a=r.length;s<a;s++){var p=n.eachChild(this.expression,s);e=this.attachItemTo(t,e,p,i)}else this.elseContent&&(e=Gn(t,e,this.elseContent,n));return t.insertBefore(o,e||null),Vn(n,null,this,i,o),e},$n.prototype.attachItemTo=function(t,e,n,r){var i,o,s=e&&e.previousSibling,a=Gn(t,e,this.content,n);return a===e?(i=o=document.createComment("empty"),t.insertBefore(i,e||null)):(i=s&&s.nextSibling||t.firstChild,o=a&&a.previousSibling||t.lastChild),Vn(n,null,this,i,o,r),a},$n.prototype.update=function(t,e){if(e.start.parentNode){var n=e.start,r=e.end;if(e.itemFor){var i=document.createDocumentFragment();this.appendItemTo(i,t,e.itemFor,e)}else i=this.getFragment(t,e);Qn(t,n,r,i,e)}},$n.prototype.insert=function(t,e,n,r){var i=e.start.parentNode;if(i){if(0===n&&this.expression.get(t).length===r)return this.update(t,e);for(var o=qn(e,n),s=document.createDocumentFragment(),a=n,p=n+r;a<p;a++){var u=t.eachChild(this.expression,a);this.appendItemTo(s,u,e.start)}i.insertBefore(s,o||null)}},$n.prototype.remove=function(t,e,n,r){var i=e.start.parentNode;if(i){if(0===n&&0===this.expression.get(t).length)return this.update(t,e);for(var o=qn(e,n),s=0;o;){if(o===e.end)return;if(o.$bindItemStart&&o.$bindItemStart.itemFor===e.start&&r===s++)return;var a=o.nextSibling;i.removeChild(o),Jn(t,o,e),o=a}}},$n.prototype.move=function(t,e,n,r,i){var o=e.start.parentNode;if(o){for(var s=qn(e,n),a=document.createDocumentFragment(),p=0;s&&s!==e.end&&(!s.$bindItemStart||s.$bindItemStart.itemFor!==e.start||i!==p++);){var u=s.nextSibling;a.appendChild(s),s=u}s=qn(e,r),o.insertBefore(a,s||null)}},$n.prototype.type="EachBlock",$n.prototype.serialize=function(){return hn.instance(this,this.expression,this.content,this.elseContent)},Xn.prototype.type="Binding",Xn.prototype.update=function(){this.context.pause(),this.template.update(this.context,this),this.context.unpause()},Xn.prototype.insert=function(){this.update()},Xn.prototype.remove=function(){this.update()},Xn.prototype.move=function(){this.update()},Zn.prototype=Object.create(Xn.prototype),Zn.prototype.constructor=Zn,Zn.prototype.type="NodeBinding",er.prototype=Object.create(Xn.prototype),er.prototype.constructor=er,er.prototype.type="AttributeBinding",nr.prototype=Object.create(Xn.prototype),nr.prototype.constructor=nr,nr.prototype.type="RangeBinding",nr.prototype.insert=function(t,e){this.context.pause(),this.template.insert?this.template.insert(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},nr.prototype.remove=function(t,e){this.context.pause(),this.template.remove?this.template.remove(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},nr.prototype.move=function(t,e,n){this.context.pause(),this.template.move?this.template.move(this.context,this,t,e,n):this.template.update(this.context,this),this.context.unpause()},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),function(){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML="\r\n<br>\n";var e=t.firstChild.data.length,n=t.lastChild.data.length;1===e&&1===n?pr=function(t){return t.replace(/\r\n/g,"\n")}:2===e&&2===n&&(pr=function(t){return t.replace(/(^|[^\r])(\n+)/g,function(t,e,n){for(var r=n.length;r--;)e+="\r\n";return e})});var r=document.createElement("input");r.defaultValue="x","x"!==r.value&&(yn.value="value");try{document.createTextNode("").$try=0}catch(t){ar=function(t,e,n){if(3===t.nodeType){var r=t.previousSibling;return r&&r.$bindProxy===t||((r=document.createComment("proxy")).$bindProxy=t,t.parentNode.insertBefore(r,t||null)),r[e]=n}return t[e]=n}}}}();var ur={concat:function(t,e){return t?e?t.concat(e):t:e},hasKeys:function(t){if(!t)return!1;for(var e in t)return!0;return!1},traverseAndCreate:function(t,e){var n=e.length;if(!n)return t;for(var r=0;r<n;r++){var i=e[r];t=t[i]||(t[i]={})}return t}},cr={};(function(t){var n=r({}),i=e({}),o=i.Template,s=ur.concat;function a(t,e){if(!t)return e;for(var n=0,r=t.length;n<r;n++){if(null==e)return e;e=e[t[n]]}return e}function p(t){return Array.isArray(t)?t.length>0:!!t}function u(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e[n]="object"==typeof r?r.item:r}return e}function c(t,e){return"object"!=typeof t?t:t instanceof o?h(t,e):Array.isArray(t)?function(t,e){for(var n=0;n<t.length;n++)if(l(t[n]))return f(t,e);return t}(t,e):function(t,e){return l(t)?function(t,e){var n={};for(var r in t)n[r]=c(t[r],e);return n}(t,e):t}(t,e)}function h(t,e){for(var n=1e3;t instanceof o;){if(--n<0)throw new Error("Maximum template render passes exceeded");t=t.get(e,!0)}return t}function l(t){if(!t)return!1;if(t.constructor!==Object)return!1;for(var e in t)if(t[e]instanceof o)return!0;return!1}function f(t,e){for(var n=new Array(t.length),r=0;r<t.length;r++)n[r]=c(t[r],e);return n}function d(t,e,n,r,i,o,s,a){this.source=t,this.blockType=e,this.isEnd=n,this.as=r,this.keyAs=i,this.unescaped=o,this.bindType=s,this.valueType=a}function m(t){this.meta=t}function y(t,e){this.value=t,this.meta=e}function v(t,e){this.segments=t,this.meta=e}function g(t,e){this.segments=t,this.meta=e}function x(t,e,n){this.alias=t,this.segments=e,this.meta=n}function b(t,e,n){this.attribute=t,this.segments=e,this.meta=n}function w(t,e,n,r){this.before=t,this.inside=e,this.afterSegments=n,this.meta=r}function _(t,e){if(!(t instanceof o))throw new Error("DeferRenderExpression requires a Template argument");this.template=t,this.meta=e}function E(t,e,n){this.items=t,this.afterSegments=e,this.meta=n}function C(t,e,n){this.properties=t,this.afterSegments=e,this.meta=n}function S(t,e,n,r){this.segments=t,this.args=e,this.afterSegments=n,this.meta=r;var i=t&&t.slice();this.lastSegment=i&&i.pop(),this.parentSegments=i&&i.length?i:null}function A(t,e,n,r){S.call(this,t,e,n,r)}function k(t,e,n,r){this.name=t,this.args=e,this.afterSegments=n,this.meta=r,this.getFn=un.get[t],this.setFn=un.set[t]}function I(t,e,n){this.args=t,this.afterSegments=e,this.meta=n}function T(t,e){this.expression=t,this.meta=e}function L(t,e){this.expression=t,this.meta=e}function O(t,e,n){if(t instanceof m||t instanceof o)return t.dependencies(e,n)}function P(t,e,n){var r=e.resolve(n);return r?t?(t.push(r),t):[r]:t}function j(t,e,n){if(!e.segments.length)return t;var r=e.resolve(n);return r?t?(t.pop(),t.push(r),t):[r]:t}cr.lookup=a,cr.templateTruthy=p,cr.pathSegments=u,cr.renderValue=c,cr.renderTemplate=h,cr.ExpressionMeta=d,cr.Expression=m,cr.LiteralExpression=y,cr.PathExpression=v,cr.RelativePathExpression=g,cr.AliasPathExpression=x,cr.AttributePathExpression=b,cr.BracketsExpression=w,cr.DeferRenderExpression=_,cr.ArrayExpression=E,cr.ObjectExpression=C,cr.FnExpression=S,cr.OperatorExpression=k,cr.NewExpression=A,cr.SequenceExpression=I,cr.ViewParentExpression=T,cr.ScopedModelExpression=L,d.prototype.module="expressions",d.prototype.type="ExpressionMeta",d.prototype.serialize=function(){return n.instance(this,this.source,this.blockType,this.isEnd,this.as,this.keyAs,this.unescaped,this.bindType,this.valueType)},m.prototype.module="expressions",m.prototype.type="Expression",m.prototype.serialize=function(){return n.instance(this,this.meta)},m.prototype.toString=function(){return this.meta&&this.meta.source},m.prototype.truthy=function(t){var e=this.meta.blockType;if("else"===e)return!0;var n=p(this.get(t,!0));return"unless"===e?!n:n},m.prototype.get=function(){},m.prototype.resolve=function(){},m.prototype.dependencies=function(){},m.prototype.pathSegments=function(t){var e=this.resolve(t);return e&&u(e)},m.prototype.set=function(t,e){var n=this.pathSegments(t);if(!n)throw new Error("Expression does not support setting");t.controller.model._set(n,e)},m.prototype._resolvePatch=function(t,e){return t&&t.expression===this&&null!=t.item?e.concat(t):e},m.prototype.isUnbound=function(t){var e=this.meta&&this.meta.bindType;return"unbound"===e||"bound"!==e&&t.unbound},m.prototype._lookupAndContextifyValue=function(t,e){return this.segments&&this.segments.length&&(t=h(t,e),t=a(this.segments,t)),t instanceof o&&!(t instanceof i.ContextClosure)&&(t=new i.ContextClosure(t,e)),t},y.prototype=Object.create(m.prototype),y.prototype.constructor=y,y.prototype.type="LiteralExpression",y.prototype.serialize=function(){return n.instance(this,this.value,this.meta)},y.prototype.get=function(){return this.value},v.prototype=Object.create(m.prototype),v.prototype.constructor=v,v.prototype.type="PathExpression",v.prototype.serialize=function(){return n.instance(this,this.segments,this.meta)},v.prototype.get=function(t){if(t.controller)return a(this.segments,t.controller.model.data)},v.prototype.resolve=function(t){if(t.controller){var e=s(t.controller._scope,this.segments);return this._resolvePatch(t,e)}},v.prototype.dependencies=function(t,e){if(t.controller)return P(O(a(this.segments,t.controller.model.data),t,e),this,t)},g.prototype=Object.create(m.prototype),g.prototype.constructor=g,g.prototype.type="RelativePathExpression",g.prototype.serialize=function(){return n.instance(this,this.segments,this.meta)},g.prototype.get=function(t){var e=t.forRelative(this),n=e.get();return this._lookupAndContextifyValue(n,e)},g.prototype.resolve=function(t){var e=t.forRelative(this),n=e.expression?e.expression.resolve(e):[];if(n){var r=n.concat(this.segments);return this._resolvePatch(t,r)}},g.prototype.dependencies=function(t,e){var n=t.forRelative(this);return j(n.expression&&n.expression.dependencies(n,e),this,t)},x.prototype=Object.create(m.prototype),x.prototype.constructor=x,x.prototype.type="AliasPathExpression",x.prototype.serialize=function(){return n.instance(this,this.alias,this.segments,this.meta)},x.prototype.get=function(t){var e=t.forAlias(this.alias);if(e){if(e.keyAlias===this.alias)return e.item;var n=e.get();return this._lookupAndContextifyValue(n,e)}},x.prototype.resolve=function(t){var e=t.forAlias(this.alias);if(e&&e.keyAlias!==this.alias){var n=e.expression.resolve(e);if(n){var r=n.concat(this.segments);return this._resolvePatch(t,r)}}},x.prototype.dependencies=function(t,e){var n=t.forAlias(this.alias);if(n){if(n.keyAlias===this.alias){var r=n.expression.resolve(n.parent);if(!r)return;return[r]}return j(n.expression.dependencies(n,e),this,t)}},b.prototype=Object.create(m.prototype),b.prototype.constructor=b,b.prototype.type="AttributePathExpression",b.prototype.serialize=function(){return n.instance(this,this.attribute,this.segments,this.meta)},b.prototype.get=function(t){var e=t.forAttribute(this.attribute);if(e){var n=e.attributes[this.attribute];return n instanceof m&&(n=n.get(e)),this._lookupAndContextifyValue(n,e)}},b.prototype.resolve=function(t){var e=t.forAttribute(this.attribute);if(e){var n,r=e.attributes[this.attribute];if((r instanceof m||r instanceof o)&&(n=r.resolve(e)),n){var i=n.concat(this.segments);return this._resolvePatch(t,i)}}},b.prototype.dependencies=function(t,e){var n=t.forAttribute(this.attribute);if(n)return j(O(n.attributes[this.attribute],n,e),this,t)},w.prototype=Object.create(m.prototype),w.prototype.constructor=w,w.prototype.type="BracketsExpression",w.prototype.serialize=function(){return n.instance(this,this.before,this.inside,this.afterSegments,this.meta)},w.prototype.get=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.get(t);if(n){var r=n[e];return this.afterSegments?a(this.afterSegments,r):r}}},w.prototype.resolve=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.resolve(t);if(n){var r=this.afterSegments?n.concat(e,this.afterSegments):n.concat(e);return this._resolvePatch(t,r)}}},w.prototype.dependencies=function(t,e){var n=this.before.dependencies(t,e);n&&n.pop();var r=this.inside.dependencies(t,e);return P(s(n,r),this,t)},_.prototype=Object.create(m.prototype),_.prototype.constructor=_,_.prototype.type="DeferRenderExpression",_.prototype.serialize=function(){return n.instance(this,this.template,this.meta)},_.prototype.get=function(t){return new i.ContextClosure(this.template,t)},E.prototype=Object.create(m.prototype),E.prototype.constructor=E,E.prototype.type="ArrayExpression",E.prototype.serialize=function(){return n.instance(this,this.items,this.afterSegments,this.meta)},E.prototype.get=function(t){for(var e=new Array(this.items.length),n=0;n<this.items.length;n++){var r=this.items[n].get(t);e[n]=r}return this.afterSegments?a(this.afterSegments,e):e},E.prototype.dependencies=function(t,e){if(this.items){for(var n,r=0;r<this.items.length;r++){var i=this.items[r].dependencies(t,e);n=s(n,i)}return n}},C.prototype=Object.create(m.prototype),C.prototype.constructor=C,C.prototype.type="ObjectExpression",C.prototype.serialize=function(){return n.instance(this,this.properties,this.afterSegments,this.meta)},C.prototype.get=function(t){var e={};for(var n in this.properties){var r=this.properties[n].get(t);e[n]=r}return this.afterSegments?a(this.afterSegments,e):e},C.prototype.dependencies=function(t,e){if(this.properties){var n;for(var r in this.properties){var i=this.properties[r].dependencies(t,e);n=s(n,i)}return n}},S.prototype=Object.create(m.prototype),S.prototype.constructor=S,S.prototype.type="FnExpression",S.prototype.serialize=function(){return n.instance(this,this.segments,this.args,this.afterSegments,this.meta)},S.prototype.get=function(t){var e=this.apply(t);return this.afterSegments?a(this.afterSegments,e):e},S.prototype.apply=function(t,e){if(t.controller){var n=this._lookupParent(t),r=n[this.lastSegment],i=r.get||r;return this._applyFn(i,t,e,n)}},S.prototype._lookupParent=function(e){var n=e.controller,r=this.parentSegments,i=r?a(r,n):n;if(i&&i[this.lastSegment])return i;var o=n.page;if(n!==o&&(i=r?a(r,o):o)&&i[this.lastSegment])return i;if((i=r?a(r,t):t)&&i[this.lastSegment])return i;throw new Error("Function not found for: "+this.segments.join("."))},S.prototype._getInputs=function(t){for(var e=[],n=0,r=this.args.length;n<r;n++){var i=this.args[n].get(t);e.push(c(i,t))}return e},S.prototype._applyFn=function(t,e,n,r){if(!this.args)return n?t.apply(r,n):t.call(r);var i=this._getInputs(e);if(n)for(var o=0,s=n.length;o<s;o++)i.push(n[o]);return t.apply(r,i)},S.prototype.dependencies=function(t,e){var n=[];if(!this.args)return n;for(var r=0,i=this.args.length;r<i;r++){var o=this.args[r].dependencies(t,e);if(o&&!(o.length<1)){for(var s=o.length-1,a=0;a<s;a++)n.push(o[a]);var p=o[s];"*"!==p[p.length-1]&&(p=p.concat("*")),n.push(p)}}return n},S.prototype.set=function(t,e){for(var n,r,i=t.controller;i&&!(n=(r=this.parentSegments?a(this.parentSegments,i):i)&&r[this.lastSegment]);)i=i.parent;var o=n&&n.set;if(!o)throw new Error("No setter function for: "+this.segments.join("."));var s=this._getInputs(t);s.unshift(e);var p=o.apply(r,s);for(var u in p)this.args[u].set(t,p[u])},A.prototype=Object.create(S.prototype),A.prototype.constructor=A,A.prototype.type="NewExpression",A.prototype._applyFn=function(t,e){if(!this.args)return new t;var n=this._getInputs(e);return n.unshift(null),new(t.bind.apply(t,n))},k.prototype=Object.create(S.prototype),k.prototype.constructor=k,k.prototype.type="OperatorExpression",k.prototype.serialize=function(){return n.instance(this,this.name,this.args,this.afterSegments,this.meta)},k.prototype.apply=function(t){var e=this._getInputs(t);return this.getFn.apply(null,e)},k.prototype.set=function(t,e){var n=this._getInputs(t);n.unshift(e);var r=this.setFn.apply(null,n);for(var i in r)this.args[i].set(t,r[i])},I.prototype=Object.create(k.prototype),I.prototype.constructor=I,I.prototype.type="SequenceExpression",I.prototype.serialize=function(){return n.instance(this,this.args,this.afterSegments,this.meta)},I.prototype.name=",",I.prototype.getFn=un.get[","],I.prototype.resolve=function(t){return this.args[this.args.length-1].resolve(t)},I.prototype.dependencies=function(t,e){for(var n=[],r=0,i=this.args.length;r<i;r++)for(var o=this.args[r].dependencies(t,e),s=0,a=o.length;s<a;s++)n.push(o[s]);return n},T.prototype=Object.create(m.prototype),T.prototype.constructor=T,T.prototype.type="ViewParentExpression",T.prototype.serialize=function(){return n.instance(this,this.expression,this.meta)},T.prototype.get=function(t){var e=t.forViewParent();return this.expression.get(e)},T.prototype.resolve=function(t){var e=t.forViewParent();return this.expression.resolve(e)},T.prototype.dependencies=function(t,e){var n=t.forViewParent();return this.expression.dependencies(n,e)},T.prototype.pathSegments=function(t){var e=t.forViewParent();return this.expression.pathSegments(e)},T.prototype.set=function(t,e){var n=t.forViewParent();return this.expression.set(n,e)},L.prototype=Object.create(m.prototype),L.prototype.constructor=L,L.prototype.type="ScopedModelExpression",L.prototype.serialize=function(){return n.instance(this,this.expression,this.meta)},L.prototype.get=function(t){var e=this.pathSegments(t);if(e)return t.controller.model.scope(e.join("."))},L.prototype.resolve=function(t){return this.expression.resolve(t)},L.prototype.dependencies=function(t,e){return this.expression.dependencies(t,e)},L.prototype.pathSegments=function(t){return this.expression.pathSegments(t)},L.prototype.set=function(t,e){return this.expression.set(t,e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var hr={};hr.contexts=sn,hr.expressions=cr,hr.operatorFns=un,hr.options=n({}),hr.templates=e({});var lr={};function fr(t,e,n){var r=n(t.selectionStart),i=n(t.selectionEnd),o=t.scrollTop;t.value=e,t.scrollTop!==o&&(t.scrollTop=o),document.activeElement===t&&(t.selectionStart=r,t.selectionEnd=i)}lr.onStringInsert=function(t,e,n,r){e||(e="");var i=e.slice(0,n)+r+e.slice(n);fr(t,i,function(t){return n<t?t+r.length:t})},lr.onStringRemove=function(t,e,n,r){e||(e="");var i=e.slice(0,n)+e.slice(n+r);fr(t,i,function(t){return n<t?t-Math.min(r,t-n):t})},lr.onTextInput=function(t,e,n){var r=t._get(e)||"";if(r===n)return;var i=0;for(;r.charAt(i)===n.charAt(i);)i++;var o=0;for(;r.charAt(r.length-1-o)===n.charAt(n.length-1-o)&&o+i<r.length&&o+i<n.length;)o++;if(r.length!==i+o){var s=r.length-i-o;t._stringRemove(e,i,s)}if(n.length!==i+o){var a=n.slice(i,n.length-o);t._stringInsert(e,i,a)}};var dr={};function mr(t){var e=t.type;return"text"===e||"textarea"===e||"search"===e||"url"===e||"tel"===e||"password"===e}function yr(t){var e=t.type;return"number"===e||"range"===e&&!t.multiple}dr.add=function(t){t.addEventListener("input",gr,!0),t.addEventListener("change",xr,!0),parseFloat(window.navigator.appVersion.split("MSIE ")[1])<=9&&t.addEventListener("selectionchange",function(t){document.activeElement&&gr({target:document.activeElement})},!0);var e=document.createElement("input");if(e.type="number",e.value="7",e.valueAsNumber!=e.valueAsNumber){var n=vr;vr=function(t){return"number"===t.type?yr(t)?parseFloat(t.value):t.value:n.apply(this,arguments)}}},dr.inputSupportsSelection=mr;var vr=function(t){return yr(t)?t.valueAsNumber:t.value};function gr(t){var e=t.target;"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName||wr(t,e)}function xr(t){var e=t.target;"INPUT"===e.tagName?(br(e,"checked"),wr(t,e)):"SELECT"===e.tagName?function t(e){for(var n=e.firstChild;n;n=n.nextSibling)"OPTION"===n.tagName?br(n,"selected"):n.hasChildNodes()&&t(n)}(e):"TEXTAREA"===e.tagName&&wr(t,e)}function br(t,e){var n=t.$bindAttributes&&t.$bindAttributes[e];if(n&&!n.isUnbound()){var r=t[e];n.template.expression.set(n.context,r)}}function wr(t,e){var n=e.$bindAttributes&&e.$bindAttributes.value;if(n&&!n.isUnbound())if(mr(e)){var r={$event:t};!function(t,e,n){var r=t.template.expression,i=r.pathSegments(t.context);if(i){var o=t.context.controller.model.pass(n);lr.onTextInput(o,i,e)}else r.set&&r.set(t.context,e)}(n,e.value,r)}else{var i=vr(e);n.template.expression.set(n.context,i)}}var _r=Er;function Er(t){this.controller=t,this._listeners=null}function Cr(t,e,n,r){this.type=t,this.target=e,this.listener=n,this.useCapture=!!r}function Sr(t,e){Cr.call(this,"destroy",t,e)}Er.prototype._initListeners=function(){var t=this;return this.controller.on("destroy",function(){var e=t._listeners;if(e){for(var n=e.length;n--;)e[n].remove();t._listeners=null}}),this._listeners=[]},Er.prototype._listenerIndex=function(t){var e=this._listeners;if(!e)return-1;for(var n=e.length;n--;)if(e[n].equals(t))return n;return-1},Er.prototype.addListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i="destroy"===t?new Sr(e,n):new Cr(t,e,n,r);-1===this._listenerIndex(i)&&(this._listeners||this._initListeners()).push(i);i.add()},Er.prototype.on=Er.prototype.addListener,Er.prototype.once=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document),this.addListener(t,e,function o(){i.removeListener(t,e,o,r);return n.apply(this,arguments)},r);var i=this},Er.prototype.removeListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i=new Cr(t,e,n,r);i.remove();var o=this._listenerIndex(i);o>-1&&this._listeners.splice(o,1)},Cr.prototype.equals=function(t){return this.listener===t.listener&&this.target===t.target&&this.type===t.type&&this.useCapture===t.useCapture},Cr.prototype.add=function(){this.target.addEventListener(this.type,this.listener,this.useCapture)},Cr.prototype.remove=function(){this.target.removeEventListener(this.type,this.listener,this.useCapture)},Sr.prototype=new Cr,Sr.prototype.add=function(){var t=this.target.$destroyListeners||(this.target.$destroyListeners=[]);-1===t.indexOf(this.listener)&&t.push(this.listener)},Sr.prototype.remove=function(){var t=this.target.$destroyListeners;if(t){var e=t.indexOf(this.listener);-1!==e&&t.splice(e,1)}};var Ar=p.EventEmitter,kr=Ir;function Ir(t,e,n){Ar.call(this),this.dom=new _r(this),this.app=t,this.page=e,this.model=n,n.data.$controller=this}tt.mergeInto(Ir.prototype,Ar.prototype),Ir.prototype.emitCancellable=function(){var t=!1;var e=Array.prototype.slice.call(arguments);return e.push(function(){t=!0}),this.emit.apply(this,e),t},Ir.prototype.emitDelayable=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n=!1;return t.push(function(){return n=!0,e}),this.emit.apply(this,t),n||e(),n};var Tr={},Lr=hr.templates,Or=hr.expressions,Pr=[].slice;function jr(t,e){var n=t.controller,r=t.id(),i=["$components",r],o=n.model.root.eventContext(r);o._at=i.join("."),e.id=r,o._set(i,e),o.data=e,kr.call(this,n.app,n.page,o),this.parent=n,this.context=t.componentChild(this),this.id=r,this._scope=i,this.page._components[r]=this,this.isDestroyed=!1}function Nr(t,e,n){this.expression=t,this.model=e,this.key=n}function Mr(t,e,n,r){this.template=new Nr(t,e,n),this.context=r,this.condition=t.get(r)}function Dr(t,e,n,r){if(r instanceof Or.Expression){var i=r.pathSegments(t);if(i)e.root.ref(e._at+"."+n,i.join("."),{updateIndices:!0});else{var o=new Mr(r,e,n,t);t.addBinding(o),e.set(n,o.condition)}}else if(r instanceof Lr.Template){var s=new Lr.ContextClosure(r,t);e.set(n,s)}else e.set(n,r)}function Rr(){this.id=null,this.$controller=null}function Br(t){this.constructor=t}function Fr(t){this.constructor=t,this.component=null}function Ur(t){return t===Object.prototype||t===Function.prototype||null===t}Tr.Component=jr,Tr.ComponentAttributeBinding=Mr,Tr.createFactory=function(t){return t.prototype.singleton?new Fr(t):new Br(t)},Tr.extendComponent=function(t){if(t.prototype instanceof jr)return;$r(t)},tt.mergeInto(jr.prototype,kr.prototype),jr.prototype.destroy=function(){this.emit("destroy"),this.model.removeContextListeners(),this.model.destroy(),delete this.page._components[this.id];var t=this.page._eventModel.object.$components;t&&delete t.object[this.id],this.isDestroyed=!0},jr.prototype.bind=function(t){var e=this;return this.on("destroy",function(){e=null,t=null}),function(){if(t)return t.apply(e,arguments)}},jr.prototype.throttle=function(t,e){var n=this;if(this.on("destroy",function(){n=null,t=null}),null==e||"number"==typeof e){var r,i=e||0,o=function(){var e=s;s=null,r=+new Date,t&&e&&t.apply(n,e)};return function(){var t=!s;if(s=Pr.call(arguments),t){var e=+new Date,n=Math.max(r+i-e,0);setTimeout(o,n)}}}if("function"==typeof e){var s;o=function(){var e=s;s=null,t&&e&&t.apply(n,e)};return function(){var t=!s;s=Pr.call(arguments),t&&e(o)}}throw new Error("Second argument must be a delay function or number")},jr.prototype.debounce=function(t,e){if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var n,r,i=this;this.on("destroy",function(){i=null,t=null});var o=function(){var e=n;n=null,r=null,t&&e&&t.apply(i,e)};return function(){n=Pr.call(arguments),r&&clearTimeout(r),r=setTimeout(o,e)}},jr.prototype.debounceAsync=function(t,e){var n=1!==t.length;if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var r=this;this.on("destroy",function(){r=null,t=null});var i,o,s=!1;function a(){var e=i;i=null,o=null,t&&e?(s=!0,e.push(a),t.apply(r,e)):s=!1}return function(){i=n?Pr.call(arguments):[],o&&clearTimeout(o),s||(o=setTimeout(a,e))}},jr.prototype.get=function(t,e){return this.getView(t).get(this.context,e)},jr.prototype.getFragment=function(t){return this.getView(t).getFragment(this.context)},jr.prototype.getView=function(t){var e=this.context.getView();return t?this.app.views.find(t,e.namespace):e},jr.prototype.getAttribute=function(t){var e=this.context.forAttribute(t);if(e){var n=e.attributes[t];return n instanceof Or.Expression&&(n=n.get(e)),Or.renderValue(n,this.context)}},jr.prototype.setAttribute=function(t,e){this.context.parent.attributes[t]=e},jr.prototype.setNullAttribute=function(t,e){var n=this.context.parent.attributes;null==n[t]&&(n[t]=e)},Nr.prototype.update=function(t,e){var n=this.expression.get(t);e.condition=n,this.model.setDiff(this.key,n)},Mr.prototype=Object.create(Lr.Binding.prototype),Mr.prototype.constructor=Mr,Br.prototype.init=function(t){var e=new(this.constructor.DataConstructor||Rr),n=new this.constructor(t,e);return n.context||jr.call(n,t,e),function(t,e){var n=t.parent.attributes;if(n)for(var r in n)Dr(t,e,r,n[r])}(n.context,n.model),function(t,e){if(t.initHooks)for(var n=0,r=t.initHooks.length;n<r;n++)t.initHooks[n].emit(t,e)}(t,n),n.emit("init",n),n.init&&n.init(n.model),n.context},Br.prototype.create=function(t){var e=t.controller;e.emit("create",e),e.create&&e.create(e.model,e.dom)},Fr.prototype.init=function(t){return this.component||(this.component=new this.constructor),t.componentChild(this.component)},Fr.prototype.create=function(){};var $r=Object.setPrototypeOf&&Object.getPrototypeOf?function(t){var e=function(t){for(;;){var e=Object.getPrototypeOf(t);if(Ur(e))return t;t=e}}(t.prototype);Object.setPrototypeOf(e,jr.prototype)}:function(t){var e=t.prototype;t.prototype=Object.create(jr.prototype),t.prototype.constructor=t,tt.mergeInto(t.prototype,e)};var qr=hr.expressions,Vr=Yr,Hr=1;function zr(t,e,n,r){this.id=Hr++,this.model=t,this.segments=n,this.item=e,this.outside=r,this.result=r.child(e).refChild(this)}function Gr(){}function Kr(){}function Qr(){}function Jr(){}function Wr(){}function Yr(){this.id=Hr++,this.object=null,this.array=null,this.arrayByReference=null,this.refOut=null,this.refChildren=null,this.bindings=null,this.itemContexts=null}function Xr(t){for(var e in t)return!0;return!1}function Zr(t){t._set()}zr.prototype.update=function(){var t=qr.pathSegments(this.segments),e=qr.lookup(t,this.model.data);if(this.item!==e){delete this.outside.child(this.item).refChildren[this.id],this.item=e;var n=this.outside.child(this.item);n.refChildren||(n.refChildren=new Kr),n.refChildren[this.id]=this.result,this.result.update()}},Yr.prototype.refChild=function(t){this.refChildren||(this.refChildren=new Kr);var e=t.id;return this.refChildren[e]||(this.refChildren[e]=new Yr),this.refChildren[e]},Yr.prototype.arrayLookup=function(t,e,n){var r=qr.pathSegments(n),i=qr.lookup(r,t.data),o=this.at(n),s=this.at(e);o.refOut||(o.refOut=new Gr);var a=o.refOut[s.id];return null==a&&(a=new zr(t,i,n,s),o.refOut[s.id]=a),a},Yr.prototype.child=function(t){var e;if("string"==typeof t)this.object||(this.object={}),e=this.object;else if("number"==typeof t)this.array||(this.array=[]),e=this.array;else{if(t instanceof zr)return t.result;this.arrayByReference||(this.arrayByReference=[]),e=this.arrayByReference,t=t.item}return e[t]||(e[t]=new Yr)},Yr.prototype.at=function(t){if(null==t)return this;for(var e=this,n=0;n<t.length;n++)e=e.child(t[n]);return e},Yr.prototype.isEmpty=function(){if(Xr(this.dependancies))return!1;if(Xr(this.itemContexts))return!1;if(this.object){if(Xr(this.object))return!1;this.object=null}if(this.arrayByReference){for(var t=0;t<this.arrayByReference.length;t++)if(null!=this.arrayByReference[t])return!1;this.arrayByReference=null}if(this.array){for(t=0;t<this.array.length;t++)if(null!=this.array[t])return!1;this.array=null}return!0},Yr.prototype._addItemContext=function(t){t._id||(t._id=Hr++),this.itemContexts||(this.itemContexts=new Jr),this.itemContexts[t._id]=t},Yr.prototype._removeItemContext=function(t){this.itemContexts&&delete this.itemContexts[t._id]},Yr.prototype._addBinding=function(t){var e=this.bindings||(this.bindings=new Qr);t.eventModels||(t.eventModels=new Wr),e[t.id]=t,t.eventModels[this.id]=this},Yr.prototype.addBinding=function(t,e){this.at(t)._addBinding(e)},Yr.prototype.addItemContext=function(t,e){this.at(t)._addItemContext(e)},Yr.prototype.removeBinding=function(t){if(t.eventModels){for(var e in t.eventModels){var n=t.eventModels[e];n.bindings&&delete n.bindings[t.id]}t.eventModels=null}},Yr.prototype._each=function(t,e,n){if(this.refChildren)for(var r in this.refChildren){var i=this.refChildren[r];i&&i._each(t,e,n)}if(t.length!==e){var o,s=t[e];"string"==typeof s?(o=this.object&&this.object[s])&&o._each(t,e+1,n):((o=this.array&&this.array[s])&&o._each(t,e+1,n),(o=this.arrayByReference&&this.arrayByReference[s])&&o._each(t,e+1,n))}else n(this)},Yr.prototype.localUpdate=function(t,e){if(this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.update(t,e)}if(this.refOut)for(var n in this.refOut){var i=this.refOut[n];i&&i.update()}},Yr.prototype.update=function(t,e){if(this.localUpdate(t,e),this.object)for(var n in this.object){(i=this.object[n])&&i.update()}if(this.array)for(var r=0;r<this.array.length;r++){(i=this.array[r])&&i.update()}if(this.arrayByReference)for(r=0;r<this.arrayByReference.length;r++){var i;(i=this.arrayByReference[r])&&i.update()}},Yr.prototype._updateChildItemContexts=function(t,e){if(this.arrayByReference){null==t&&(t=0),null==e&&(e=this.arrayByReference.length);for(var n=t;n<e;n++){var r=this.arrayByReference[n]&&this.arrayByReference[n].itemContexts;if(r)for(var i in r)r[i].item=n}}},Yr.prototype._updateArray=function(t,e){if(this.array){null==t&&(t=0),null==e&&(e=this.array.length);for(var n=t;n<e;n++){var r=this.array[n];r&&r.update()}}},Yr.prototype._updateObject=function(){if(this.object)for(var t in this.object){var e=this.object[t];e&&e.update()}},Yr.prototype._set=function(t,e){this.update(t,e)},Yr.prototype._insert=function(t,e){if(this._updateArray(t),this.arrayByReference&&this.arrayByReference.length>t){for(var n=0;n<e;n++)this.arrayByReference.splice(t,0,null);this._updateChildItemContexts(t+e)}if(this.bindings)for(var r in this.bindings){var i=this.bindings[r];i&&i.insert(t,e)}this._updateObject()},Yr.prototype._remove=function(t,e){if(this._updateArray(t),this.arrayByReference&&(this.arrayByReference.splice(t,e),this._updateChildItemContexts(t)),this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.remove(t,e)}this._updateObject()},Yr.prototype._move=function(t,e,n){var r,i;t<e?(r=t,i=e+n):(r=e,i=t+n),this._updateArray(r,i);var o=this.arrayByReference;if(o&&o.length>r){var s=o.splice(t,n);o.splice.apply(o,[e,0].concat(s)),this._updateChildItemContexts(r,i)}if(this.bindings)for(var a in this.bindings){var p=this.bindings[a];p&&p.move(t,e,n)}this._updateObject()},Yr.prototype.mutate=function(t,e){this._each(t,0,e);for(var n=0,r=t.length;n++<r;){var i=t.slice(0,n);i.push("*"),this._each(i,0,Zr)}},Yr.prototype.set=function(t,e,n){this.mutate(t,function(t){t._set(e,n)})},Yr.prototype.insert=function(t,e,n){this.mutate(t,function(t){t._insert(e,n)})},Yr.prototype.remove=function(t,e,n){this.mutate(t,function(t){t._remove(e,n)})},Yr.prototype.move=function(t,e,n,r){this.mutate(t,function(t){t._move(e,n,r)})};var ti={exports:{}},ei=hr.contexts,ni=hr.expressions,ri=hr.templates,ii=hr.options.DependencyOptions;function oi(t,e,n,r){kr.call(this,t,this,e),this.req=n,this.res=r,this.params=null,this.init&&this.init(e),this.context=this._createContext(),this._eventModel=null,this._removeModelListeners=null,this._components={},this._addListeners()}function si(t,e,n){new pi(t,e,n).updateDependencies()}ti.exports=oi,tt.mergeInto(oi.prototype,kr.prototype),oi.prototype.$bodyClass=function(t){if(t){for(var e=[],n=t.split(":"),r=0,i=n.length;r<i;r++){var o=n.slice(0,r+1).join("-");e.push(o)}return e.join(" ")}},oi.prototype.$preventDefault=function(t){t.preventDefault()},oi.prototype.$stopPropagation=function(t){t.stopPropagation()},oi.prototype._setRenderParams=function(t){this.model.set("$render.ns",t),this.model.set("$render.params",this.params),this.model.set("$render.url",this.params&&this.params.url),this.model.set("$render.query",this.params&&this.params.query)},oi.prototype._setRenderPrefix=function(t){var e=t?t+":":"";this.model.set("$render.prefix",e)},oi.prototype.get=function(t,e,n){return this._setRenderPrefix(e),this.getView(t,e).get(this.context,n)},oi.prototype.getFragment=function(t,e){return this._setRenderPrefix(e),this.getView(t,e).getFragment(this.context)},oi.prototype.getView=function(t,e){return this.app.views.find(t,e)},oi.prototype.render=function(t){this.app.emit("render",this),this.context.pause(),this._setRenderParams(t);var e=this.getFragment("TitleElement",t),n=this.getFragment("BodyElement",t),r=document.getElementsByTagName("title")[0];r.parentNode.replaceChild(e,r),document.body.parentNode.replaceChild(n,document.body),this.context.unpause(),this.create&&this.create(this.model,this.dom),this.app.emit("routeDone",this,"render")},oi.prototype.attach=function(){this.context.pause();var t=this.model.get("$render.ns"),e=this.getView("TitleElement",t),n=this.getView("BodyElement",t),r=document.getElementsByTagName("title")[0];e.attachTo(r.parentNode,r,this.context),n.attachTo(document.body.parentNode,document.body,this.context),this.context.unpause(),this.create&&this.create(this.model,this.dom)},oi.prototype._createContext=function(){var t=new ei.ContextMeta;t.views=this.app&&this.app.views;var e=new ei.Context(t,this);return e.expression=new ni.PathExpression([]),e.alias="#root",e},oi.prototype._addListeners=function(){var t=this._eventModel=new Vr;this._addModelListeners(t),this._addContextListeners(t)},oi.prototype.destroy=function(){for(var t in this.emit("destroy"),this._removeModelListeners(),this._components){this._components[t].destroy()}var e=this.model.silent();e.destroy("_page"),e.destroy("$components"),e.unloadAll&&e.unloadAll()},oi.prototype._addModelListeners=function(t){var e=this.model;if(e){if(e.get("$derbyFlags.immediateModelListeners"))return this._addModelListenersImmediate(t);this.context;var n=e.on("change","**",function(e,n,r,i){var o=tt.castSegments(e.split("."));t.set(o,r,i)}),r=e.on("load","**",function(e){var n=tt.castSegments(e.split("."));t.set(n)}),i=e.on("unload","**",function(e){var n=tt.castSegments(e.split("."));t.set(n)}),o=e.on("insert","**",function(e,n,r){var i=tt.castSegments(e.split("."));t.insert(i,n,r.length)}),s=e.on("remove","**",function(e,n,r){var i=tt.castSegments(e.split("."));t.remove(i,n,r.length)}),a=e.on("move","**",function(e,n,r,i){var o=tt.castSegments(e.split("."));t.move(o,n,r,i)});this._removeModelListeners=function(){e.removeListener("change",n),e.removeListener("load",r),e.removeListener("unload",i),e.removeListener("insert",o),e.removeListener("remove",s),e.removeListener("move",a)}}},oi.prototype._addModelListenersImmediate=function(t){var e=this.model;if(e){var n=e.on("changeImmediate",function(e,n){var r=n[1],i=n[2];e=tt.castSegments(e.slice()),t.set(e,r,i)}),r=e.on("loadImmediate",function(e){e=tt.castSegments(e.slice()),t.set(e)}),i=e.on("unloadImmediate",function(e){e=tt.castSegments(e.slice()),t.set(e)}),o=e.on("insertImmediate",function(e,n){var r=n[0],i=n[1];e=tt.castSegments(e.slice()),t.insert(e,r,i.length)}),s=e.on("removeImmediate",function(e,n){var r=n[0],i=n[1];e=tt.castSegments(e.slice()),t.remove(e,r,i.length)}),a=e.on("moveImmediate",function(e,n){var r=n[0],i=n[1],o=n[2];e=tt.castSegments(e.slice()),t.move(e,r,i,o)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",r),e.removeListener("unloadImmediate",i),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},oi.prototype._addContextListeners=function(t){this.context.meta.addBinding=function(e){!function(t){t instanceof ri.AttributeBinding&&"value"===t.name&&("INPUT"===t.element.tagName||"TEXTAREA"===t.element.tagName)&&dr.inputSupportsSelection(t.element)&&t.template.expression.resolve(t.context)&&(t.update=ui)}(e);var n=e.template.expressions;if(n)for(var r=0,i=n.length;r<i;r++)si(t,n[r],e);else{var o=e.template.expression;si(t,o,e)}},this.context.meta.removeBinding=function(e){var n=e.meta;if(!n)return;for(var r=n.length;r--;)t.removeBinding(n[r])},this.context.meta.removeNode=function(t){var e=t.$component;e&&!e.singleton&&e.destroy();var n=t.$destroyListeners;if(n)for(var r=0;r<n.length;r++)n[r]()},this.context.meta.addItemContext=function(e){var n=e.expression.resolve(e);t.addItemContext(n,e)},this.context.meta.removeItemContext=function(t){}};var ai=1;function pi(t,e,n){this.eventModel=t,this.expression=e,this.binding=n,this.id=ai++,this.eventModels=null,this.dependencies=null,this.ignoreTemplateDependency=n instanceof Tr.ComponentAttributeBinding||n.template instanceof ri.DynamicText&&n instanceof ri.RangeBinding,n.meta?n.meta.push(this):n.meta=[this]}function ui(t,e){!function(t,e,n,r){if(r){if(r.$event&&r.$event.target===e)return;if(r.$stringInsert)return lr.onStringInsert(e,n,r.$stringInsert.index,r.$stringInsert.text);if(r.$stringRemove)return lr.onStringRemove(e,n,r.$stringRemove.index,r.$stringRemove.howMany)}t.template.update(t.context,t)}(this,this.element,t,e)}pi.prototype.updateDependencies=function(){var t;this.ignoreTemplateDependency&&this.binding.condition instanceof ri.Template&&(t=new ii).setIgnoreTemplate(this.binding.condition);var e=this.expression.dependencies(this.binding.context,t);if(this.dependencies){if(function(t,e){var n=t?t.length:-1,r=e?e.length:-1;if(n!==r)return!1;for(var i=0;i<n;i++){var o=t[i],s=e[i],a=o?o.length:-1,p=s?s.length:-1;if(a!==p)return!1;for(var u=0;u<p;u++)if(o[u]!==s[u])return!1}return!0}(this.dependencies,e))return;this.eventModel.removeBinding(this)}if(e){this.dependencies=e;for(var n=0,r=e.length;n<r;n++){var i=e[n];i&&this.eventModel.addBinding(i,this)}}},pi.prototype.update=function(t,e){this.binding.update(t,e),this.updateDependencies()},pi.prototype.insert=function(t,e){this.binding.insert(t,e),this.updateDependencies()},pi.prototype.remove=function(t,e){this.binding.remove(t,e),this.updateDependencies()},pi.prototype.move=function(t,e,n){this.binding.move(t,e,n),this.updateDependencies()},tt.serverRequire(ti,"./Page.server"),ti=ti.exports;var ci={},hi={exports:{}},li=p.EventEmitter,fi=hr.templates;function di(t,e,n,r){li.call(this),this.derby=t,this.name=e,this.filename=n,this.scriptHash="{{DERBY_SCRIPT_HASH}}",this.bundledAt="{{DERBY_BUNDLED_AT}}",this.Page=function(){function t(){ti.apply(this,arguments)}return t.prototype=Object.create(ti.prototype),t}(),this.proto=this.Page.prototype,this.views=new fi.Views,this.tracksRoutes=rn.setup(this),this.model=null,this.page=null,this._init(r)}hi.exports=di,tt.mergeInto(di.prototype,li.prototype),di.prototype._init=function(){this._waitForAttach=!0,this._cancelAttach=!1,this.model=new this.derby.Model,ci(hr,this.views),this._contentReady()},di.prototype._finishInit=function(){var t=this._getScript(),e=JSON.parse(t.nextSibling.innerHTML);this.model.createConnection(e),this.emit("model",this.model),tt.isProduction="production"===e.nodeEnv,tt.isProduction||this._autoRefresh(),this.model.unbundle(e);var n=this.createPage();if(n.params=this.model.get("$render.params"),this.emit("ready",n),this._waitForAttach=!1,this._cancelAttach)this.history.refresh();else{if(tt.isProduction)try{n.attach()}catch(t){this.history.refresh(),console.warn("attachment error",t.stack)}else n.attach();this.emit("load",n)}},di.prototype._contentReady=function(){var t=!1,e=this;function n(){document.addEventListener?document.removeEventListener("DOMContentLoaded",n,!1):document.detachEvent("onreadystatechange",n),r()}function r(){if(!t){if(!document.body)return setTimeout(r,0);t=!0,setTimeout(function(){e._finishInit()},0)}}if("loading"!==document.readyState)return r();if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(document.attachEvent){var i;document.attachEvent("onreadystatechange",n),window.attachEvent("onload",n);try{i=null==window.frameElement}catch(t){}document.documentElement.doScroll&&i&&function e(){if(!t){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}r()}}()}},di.prototype._getScript=function(){return document.querySelector("script[data-derby-app]")},di.prototype.use=tt.use,di.prototype.serverUse=tt.serverUse,di.prototype.loadViews=function(){},di.prototype.loadStyles=function(){},di.prototype.component=function(t,e){"function"==typeof t&&(e=t,t=null);var n=e.view||e.prototype.view,r=e.is||e.prototype.name;if(Tr.extendComponent(e),n)t=t||r||oe.basename(n,".html"),this.loadViews(n,t);else if(!t){if(!r)throw new Error("No view name specified for component");var i;t=r,(i=this.views.register(t)).template=fi.emptyTemplate}if(!(i=this.views.find(t))){var o=this.views.findErrorMessage(t);throw new Error(o)}return i.componentFactory=Tr.createFactory(e),this},di.prototype.createPage=function(){this.page&&(this.emit("destroyPage",this.page),this.page.destroy());var t=new this.Page(this,this.model);return this.page=t,t},di.prototype.onRoute=function(t,e,n,r){if(this._waitForAttach)this._cancelAttach=!0;else if(this.emit("route",e),e.model.set("$render.params",e.params),e.model.set("$render.url",e.params.url),e.model.set("$render.query",e.params.query),r){var i=this;t.call(e,e,e.model,e.params,n,function(){i.emit("routeDone",e,"transition"),r()})}else t.call(e,e,e.model,e.params,n)},di.prototype._autoRefresh=function(){var t=this,e=this.model.connection;e.on("connected",function(){e.send({derby:"app",name:t.name,hash:t.scriptHash})}),e.on("receive",function(e){if(e.data.derby){var n=e.data;e.data=null,t._handleMessage(n.derby,n)}})},di.prototype._handleMessage=function(t,e){if("refreshViews"===t){new Function("return "+e.views)()(hr,this.views);var n=this.model.get("$render.ns");this.page.render(n)}else if("refreshStyles"===t){var r=document.querySelector('style[data-filename="'+e.filename+'"]');r&&(r.innerHTML=e.css)}else"reload"===t&&this.model.whenNothingPending(function(){window.location=window.location})},tt.serverRequire(hi,"./App.server"),hi=hi.exports;var mi=p.EventEmitter,yi=vi;function vi(){mi.call(this)}dr.add(document),tt.mergeInto(vi.prototype,mi.prototype),vi.prototype.Model=ie,vi.prototype.util=tt,vi.prototype.App=hi,vi.prototype.Page=ti,vi.prototype.Component=Tr.Component,vi.prototype.createApp=function(){return new hi(this)},hi.prototype._init=function(){this.model=new this.derby.Model,this.createPage()};var gi=/^<([^\s=\/!>]+)((?:\s+[^\s=\/>]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+)?)?)*)\s*(\/?)\s*>/,xi=/^<\/([^\s=\/!>]+)[^>]*>/,bi=/^<!--([\s\S]*?)-->/,wi=/<!--[\s\S]*?-->/,_i=/^<([\s\S]*?)>/,Ei=/([^\s=]+)(?:\s*(=)\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+))?)?/g,Ci=/^(style|script)$/i;function Si(){}function Ai(t){return new RegExp("</"+t,"i")}function ki(t,e,n){var r={},i=e[0],o=e[1],s=e[2],a=!!e[3];return t=t.slice(i.length),s.replace(Ei,function(t,e,n,i,o,s){r[e]=i||o||s||!n||""}),n(i,o,r,a,t),t}function Ii(t,e,n){var r=e[0];return n(r,e[1],t=t.slice(r.length)),t}function Ti(t,e,n,r){var i;return~e?(i=t.slice(0,e),t=t.slice(e)):(i=t,t=""),i&&r(i,n,t),t}function Li(t,e,n){n||(n=0);var r,i=t.search(e),o=t.match(wi);return o&&o.index<i?(n+=r=o.index+o[0].length,Li(t=t.slice(r),e,n)):i+n}var Oi,Pi=function(t,e){if(null==e&&(e={}),t)for(var n,r,i,o,s,a=e.start||Si,p=e.end||Si,u=e.text||Si,c=e.comment||Si,h=e.other||Si,l=e.matchEnd||Ai,f=e.error,d=e.rawTags||Ci;t;){if(t===r){if(s=new Error("HTML parse error: "+t),!f)throw s;f(s)}if(r=t,"<"===t[0]){if(i=t.match(gi)){t=ki(t,i,a),o=i[1],d.test(o)&&(t=Ti(t,n=Li(t,l(o)),!0,u));continue}if(i=t.match(xi)){i[1]=i[1],t=Ii(t,i,p);continue}if(i=t.match(bi)){t=Ii(t,i,c);continue}if(i=t.match(_i)){t=Ii(t,i,h);continue}}n=t.indexOf("<"),t=Ti(t,n,!1,u)}},ji={exports:{}};if(ji.exports={parse:Pi,unescapeEntities:function(t){return t.replace(/&#?[A-Za-z0-9]+;/g,Oi)},isConditionalComment:Di,minify:function(t){var e="",n=!0;return Pi(t,{start:function(t,r,i){n=!("x-no-minify"in i),e+=Ri(t)},end:function(t){e+=Ri(t)},text:function(t){e+=n?function(t){return t?t.replace(/\s*\r?\n\s*/g,""):""}(t):t},comment:function(t){Di(t)&&(e+=t)},other:function(t){e+=t}}),e}},"undefined"!=typeof document){var Ni=document.createElement("div");Oi=function(t){return Ni.innerHTML=t,Ni.textContent||Ni.innerText}}else{var Mi=ji.require("./entities.json");Oi=function(t){var e=Mi[t];if(e)return e.characters;if("#"!==t.charAt(1))throw new Error("Unrecognized character reference: "+t);var n="x"===t.charAt(2)||"X"===t.charAt(2)?parseInt(t.slice(3,-1),16):parseInt(t.slice(2,-1),10);return String.fromCharCode(n)}}function Di(t){return/(?:^<!--\[)|(?:\]-->$)/.test(t)}function Ri(t){return t.replace(/(?:\s*\r?\n\s*)+/g,"\n")}ji=ji.exports;var Bi={};!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["exports"],e):e(void 0!==Bi?Bi:t.esprima={})}(this,function(t){"use strict";var e,n,r,i,o,s,a,p,u,c,h,l,f,d,m,y,v,g;function x(t,e){if(!t)throw new Error("ASSERT: "+e)}function b(t){return t>=48&&t<=57}function w(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function _(t){return"01234567".indexOf(t)>=0}function E(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function C(t){return 10===t||13===t||8232===t||8233===t}function S(t){return 36===t||95===t||64===t||35===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&a.NonAsciiIdentifierStart.test(String.fromCharCode(t))}function A(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&a.NonAsciiIdentifierPart.test(String.fromCharCode(t))}function k(t,e,n,r,i){var o,s;x("number"==typeof n,"Comment must have valid position"),v.lastCommentStart>=n||(v.lastCommentStart=n,o={type:t,value:e},g.range&&(o.range=[n,r]),g.loc&&(o.loc=i),g.comments.push(o),g.attachComment&&(s={comment:o,leading:null,trailing:null,range:[n,r]},g.pendingComments.push(s)))}function I(){var t,e,n,r;for(t=h-2,e={start:{line:l,column:h-f-2}};h<d;)if(n=u.charCodeAt(h),++h,C(n))return g.comments&&(r=u.slice(t+2,h-1),e.end={line:l,column:h-f-1},k("Line",r,t,h-1,e)),13===n&&10===u.charCodeAt(h)&&++h,++l,void(f=h);g.comments&&(r=u.slice(t+2,h),e.end={line:l,column:h-f},k("Line",r,t,h,e))}function T(){var t,e,n,r;for(g.comments&&(t=h-2,e={start:{line:l,column:h-f-2}});h<d;)if(C(n=u.charCodeAt(h)))13===n&&10===u.charCodeAt(h+1)&&++h,++l,f=++h,h>=d&&q({},s.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===u.charCodeAt(h+1))return++h,++h,void(g.comments&&(r=u.slice(t+2,h-2),e.end={line:l,column:h-f},k("Block",r,t,h,e)));++h}else++h;q({},s.UnexpectedToken,"ILLEGAL")}function L(){var t,e;for(e=0===h;h<d;)if(E(t=u.charCodeAt(h)))++h;else if(C(t))++h,13===t&&10===u.charCodeAt(h)&&++h,++l,f=h,e=!0;else if(47===t)if(47===(t=u.charCodeAt(h+1)))++h,++h,I(),e=!0;else{if(42!==t)break;++h,++h,T()}else if(e&&45===t){if(45!==u.charCodeAt(h+1)||62!==u.charCodeAt(h+2))break;h+=3,I()}else{if(60!==t)break;if("!--"!==u.slice(h+1,h+4))break;++h,++h,++h,++h,I()}}function O(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e){if(!(h<d&&w(u[h])))return"";r=u[h++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(i)}function P(){var t,e;for(t=u.charCodeAt(h++),e=String.fromCharCode(t),92===t&&(117!==u.charCodeAt(h)&&q({},s.UnexpectedToken,"ILLEGAL"),++h,(t=O("u"))&&"\\"!==t&&S(t.charCodeAt(0))||q({},s.UnexpectedToken,"ILLEGAL"),e=t);h<d&&A(t=u.charCodeAt(h));)++h,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==u.charCodeAt(h)&&q({},s.UnexpectedToken,"ILLEGAL"),++h,(t=O("u"))&&"\\"!==t&&A(t.charCodeAt(0))||q({},s.UnexpectedToken,"ILLEGAL"),e+=t);return e}function j(){var t,n;return t=h,{type:1===(n=92===u.charCodeAt(h)?P():function(){var t,e;for(t=h++;h<d;){if(92===(e=u.charCodeAt(h)))return h=t,P();if(!A(e))break;++h}return u.slice(t,h)}()).length?e.Identifier:function(t){return"this"===t||"typeof"===t||"instanceof"===t||"in"===t||"new"===t}(n)?e.Keyword:"undefined"===n?e.Undefined:"null"===n?e.NullLiteral:"true"===n||"false"===n?e.BooleanLiteral:e.Identifier,value:n,lineNumber:l,lineStart:f,range:[t,h]}}function N(){var t,n,r,i,o=h,a=u.charCodeAt(h),p=u[h];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++h,g.tokenize&&(40===a?g.openParenToken=g.tokens.length:123===a&&(g.openCurlyToken=g.tokens.length)),{type:e.Punctuator,value:String.fromCharCode(a),lineNumber:l,lineStart:f,range:[o,h]};default:if(61===(t=u.charCodeAt(h+1)))switch(a){case 37:case 38:case 42:case 43:case 45:case 47:case 60:case 62:case 94:case 124:return h+=2,{type:e.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(t),lineNumber:l,lineStart:f,range:[o,h]};case 33:case 61:return h+=2,61===u.charCodeAt(h)&&++h,{type:e.Punctuator,value:u.slice(o,h),lineNumber:l,lineStart:f,range:[o,h]}}}return n=u[h+1],r=u[h+2],i=u[h+3],">"===p&&">"===n&&">"===r&&"="===i?(h+=4,{type:e.Punctuator,value:">>>=",lineNumber:l,lineStart:f,range:[o,h]}):">"===p&&">"===n&&">"===r?(h+=3,{type:e.Punctuator,value:">>>",lineNumber:l,lineStart:f,range:[o,h]}):"<"===p&&"<"===n&&"="===r?(h+=3,{type:e.Punctuator,value:"<<=",lineNumber:l,lineStart:f,range:[o,h]}):">"===p&&">"===n&&"="===r?(h+=3,{type:e.Punctuator,value:">>=",lineNumber:l,lineStart:f,range:[o,h]}):p===n&&"+-<>&|".indexOf(p)>=0?(h+=2,{type:e.Punctuator,value:p+n,lineNumber:l,lineStart:f,range:[o,h]}):"<>=!+-*%&|^/".indexOf(p)>=0?(++h,{type:e.Punctuator,value:p,lineNumber:l,lineStart:f,range:[o,h]}):void q({},s.UnexpectedToken,"ILLEGAL")}function M(){var t,n,r;if(x(b((r=u[h]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=h,t="","."!==r){if(t=u[h++],r=u[h],"0"===t){if("x"===r||"X"===r)return++h,function(t){for(var n="";h<d&&w(u[h]);)n+=u[h++];return 0===n.length&&q({},s.UnexpectedToken,"ILLEGAL"),S(u.charCodeAt(h))&&q({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:l,lineStart:f,range:[t,h]}}(n);if(_(r))return function(t){for(var n="0"+u[h++];h<d&&_(u[h]);)n+=u[h++];return(S(u.charCodeAt(h))||b(u.charCodeAt(h)))&&q({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:l,lineStart:f,range:[t,h]}}(n);r&&b(r.charCodeAt(0))&&q({},s.UnexpectedToken,"ILLEGAL")}for(;b(u.charCodeAt(h));)t+=u[h++];r=u[h]}if("."===r){for(t+=u[h++];b(u.charCodeAt(h));)t+=u[h++];r=u[h]}if("e"===r||"E"===r)if(t+=u[h++],"+"!==(r=u[h])&&"-"!==r||(t+=u[h++]),b(u.charCodeAt(h)))for(;b(u.charCodeAt(h));)t+=u[h++];else q({},s.UnexpectedToken,"ILLEGAL");return S(u.charCodeAt(h))&&q({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseFloat(t),lineNumber:l,lineStart:f,range:[n,h]}}function D(){var t,n,r,i,o,a,p,c=!1,m=!1;for(y=null,L(),r=h,x("/"===(n=u[h]),"Regular expression literal must start with a slash"),t=u[h++];h<d;)if(t+=n=u[h++],"\\"===n)C((n=u[h++]).charCodeAt(0))&&q({},s.UnterminatedRegExp),t+=n;else if(C(n.charCodeAt(0)))q({},s.UnterminatedRegExp);else if(c)"]"===n&&(c=!1);else{if("/"===n){m=!0;break}"["===n&&(c=!0)}for(m||q({},s.UnterminatedRegExp),i=t.substr(1,t.length-2),o="";h<d&&A((n=u[h]).charCodeAt(0));)if(++h,"\\"===n&&h<d)if("u"===(n=u[h]))if(p=++h,n=O("u"))for(o+=n,t+="\\u";p<h;++p)t+=u[p];else h=p,o+="u",t+="\\u";else t+="\\";else o+=n,t+=n;try{a=new RegExp(i,o)}catch(t){q({},s.InvalidRegExp)}return g.tokenize?{type:e.RegularExpression,value:a,lineNumber:l,lineStart:f,range:[r,h]}:{literal:t,value:a,range:[r,h]}}function R(){var t,e,n,r;return L(),t=h,e={start:{line:l,column:h-f}},n=D(),e.end={line:l,column:h-f},g.tokenize||(g.tokens.length>0&&(r=g.tokens[g.tokens.length-1]).range[0]===t&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||g.tokens.pop()),g.tokens.push({type:"RegularExpression",value:n.literal,range:[t,h],loc:e})),n}function B(){var t;return L(),h>=d?{type:e.EOF,lineNumber:l,lineStart:f,range:[h,h]}:40===(t=u.charCodeAt(h))||41===t||58===t?N():39===t||34===t?function(){var t,n,r,i,o,a,p="",c=!1;for(x("'"===(t=u[h])||'"'===t,"String literal must starts with a quote"),n=h,++h;h<d;){if((r=u[h++])===t){t="";break}if("\\"===r)if((r=u[h++])&&C(r.charCodeAt(0)))++l,"\r"===r&&"\n"===u[h]&&++h;else switch(r){case"n":p+="\n";break;case"r":p+="\r";break;case"t":p+="\t";break;case"u":case"x":a=h,(o=O(r))?p+=o:(h=a,p+=r);break;case"b":p+="\b";break;case"f":p+="\f";break;case"v":p+="\v";break;default:_(r)?(0!==(i="01234567".indexOf(r))&&(c=!0),h<d&&_(u[h])&&(c=!0,i=8*i+"01234567".indexOf(u[h++]),"0123".indexOf(r)>=0&&h<d&&_(u[h])&&(i=8*i+"01234567".indexOf(u[h++]))),p+=String.fromCharCode(i)):p+=r}else{if(C(r.charCodeAt(0)))break;p+=r}}return""!==t&&q({},s.UnexpectedToken,"ILLEGAL"),{type:e.StringLiteral,value:p,octal:c,lineNumber:l,lineStart:f,range:[n,h]}}():S(t)?j():46===t?b(u.charCodeAt(h+1))?M():N():b(t)?M():g.tokenize&&47===t?function(){var t,e;if(!(t=g.tokens[g.tokens.length-1]))return R();if("Punctuator"===t.type){if(")"===t.value)return!(e=g.tokens[g.openParenToken-1])||"Keyword"!==e.type||"if"!==e.value&&"while"!==e.value&&"for"!==e.value&&"with"!==e.value?N():R();if("}"===t.value){if(g.tokens[g.openCurlyToken-3]&&"Keyword"===g.tokens[g.openCurlyToken-3].type){if(!(e=g.tokens[g.openCurlyToken-4]))return N()}else{if(!g.tokens[g.openCurlyToken-4]||"Keyword"!==g.tokens[g.openCurlyToken-4].type)return N();if(!(e=g.tokens[g.openCurlyToken-5]))return R()}return r.indexOf(e.value)>=0?N():R()}return R()}return"Keyword"===t.type?R():N()}():N()}function F(){var t,r,i,o;return L(),h,t={start:{line:l,column:h-f}},r=B(),t.end={line:l,column:h-f},r.type!==e.EOF&&(i=[r.range[0],r.range[1]],o=u.slice(r.range[0],r.range[1]),g.tokens.push({type:n[r.type],value:o,range:i,loc:t})),r}function U(){var t;return h=(t=y).range[1],l=t.lineNumber,f=t.lineStart,y=void 0!==g.tokens?F():B(),h=t.range[1],l=t.lineNumber,f=t.lineStart,t}function $(){var t,e,n;t=h,e=l,n=f,y=void 0!==g.tokens?F():B(),h=t,l=e,f=n}function q(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,function(t,e){return x(e<r.length,"Message reference must be in range"),r[e]});throw"number"==typeof t.lineNumber?((n=new Error("Line "+t.lineNumber+": "+i)).index=t.range[0],n.lineNumber=t.lineNumber,n.column=t.range[0]-f+1):((n=new Error("Line "+l+": "+i)).index=h,n.lineNumber=l,n.column=h-f+1),n.description=i,n}function V(){try{q.apply(null,arguments)}catch(t){if(!g.errors)throw t;g.errors.push(t)}}function H(t){if(t.type===e.EOF&&q(t,s.UnexpectedEOS),t.type===e.NumericLiteral&&q(t,s.UnexpectedNumber),t.type===e.StringLiteral&&q(t,s.UnexpectedString),t.type===e.Identifier&&q(t,s.UnexpectedIdentifier),t.type===e.Keyword){if(t.value,c&&(t.value,0))return void V(t,s.StrictReservedWord);q(t,s.UnexpectedToken,t.value)}q(t,s.UnexpectedToken,t.value)}function z(t){var n=U();n.type===e.Punctuator&&n.value===t||H(n)}function G(t){return y.type===e.Punctuator&&y.value===t}function K(t){return y.type===e.Keyword&&y.value===t}function Q(t){return t.type===i.Identifier||t.type===i.MemberExpression}function J(t,e){var n,r;return n=c,L(),m.markStart(),r=parseFunctionSourceElements(),e&&c&&(t[0].name,0)&&V(e,s.StrictParamName),c=n,m.markEnd(m.createFunctionExpression(null,t,[],r))}function W(){var t;return L(),m.markStart(),(t=U()).type===e.StringLiteral||t.type===e.NumericLiteral?(c&&t.octal&&V(t,s.StrictOctalLiteral),m.markEnd(m.createLiteral(t))):m.markEnd(m.createIdentifier(t.value))}function Y(){var t,n,r,i,o;return t=y,L(),m.markStart(),t.type===e.Identifier?(r=W(),"get"!==t.value||G(":")?"set"!==t.value||G(":")?(z(":"),i=pt(),m.markEnd(m.createProperty("init",r,i))):(n=W(),z("("),(t=y).type!==e.Identifier?(z(")"),V(t,s.UnexpectedToken,t.value),i=J([])):(o=[parseVariableIdentifier()],z(")"),i=J(o,t)),m.markEnd(m.createProperty("set",n,i))):(n=W(),z("("),z(")"),i=J([]),m.markEnd(m.createProperty("get",n,i)))):t.type!==e.EOF&&t.type!==e.Punctuator?(n=W(),z(":"),i=pt(),m.markEnd(m.createProperty("init",n,i))):void H(t)}function X(){var t,n,r;return G("(")?function(){var t;return z("("),t=ut(),z(")"),t}():(t=y.type,m.markStart(),t===e.Identifier?r=m.createIdentifier(U().value):t===e.StringLiteral||t===e.NumericLiteral?(c&&y.octal&&V(y,s.StrictOctalLiteral),r=m.createLiteral(U())):t===e.Keyword?K("this")?(U(),r=m.createThisExpression()):K("function")&&(r=parseFunctionExpression()):t===e.BooleanLiteral?((n=U()).value="true"===n.value,r=m.createLiteral(n)):t===e.Undefined?((n=U()).value=void 0,r=m.createLiteral(n)):t===e.NullLiteral?((n=U()).value=null,r=m.createLiteral(n)):G("[")?r=function(){var t=[];for(z("[");!G("]");)G(",")?(U(),t.push(null)):(t.push(pt()),G("]")||z(","));return z("]"),m.createArrayExpression(t)}():G("{")?r=function(){var t,e,n,r,a=[],p={},u=String;for(z("{");!G("}");)e=(t=Y()).key.type===i.Identifier?t.key.name:u(t.key.value),r="init"===t.kind?o.Data:"get"===t.kind?o.Get:o.Set,n="$"+e,Object.prototype.hasOwnProperty.call(p,n)?(p[n]===o.Data?c&&r===o.Data?V({},s.StrictDuplicateProperty):r!==o.Data&&V({},s.AccessorDataProperty):r===o.Data?V({},s.AccessorDataProperty):p[n]&r&&V({},s.AccessorGetSet),p[n]|=r):p[n]=r,a.push(t),G("}")||z(",");return z("}"),m.createObjectExpression(a)}():(G("/")||G("/="))&&(r=void 0!==g.tokens?m.createLiteral(R()):m.createLiteral(D()),$()),r?m.markEnd(r):void H(U()))}function Z(){var t=[];if(z("("),!G(")"))for(;h<d&&(t.push(pt()),!G(")"));)z(",");return z(")"),t}function tt(){var t;return m.markStart(),function(t){return t.type===e.Identifier||t.type===e.Keyword||t.type===e.BooleanLiteral||t.type===e.Undefined||t.type===e.NullLiteral}(t=U())||H(t),m.markEnd(m.createIdentifier(t.value))}function et(){return z("."),tt()}function nt(){var t;return z("["),t=ut(),z("]"),t}function rt(){var t,n,r,i;return m.markStart(),r="new",(i=U()).type===e.Keyword&&i.value===r||H(i),t=function(){var t,e,n,r;t=ft(),e=v.allowIn,n=K("new")?rt():X(),v.allowIn=e;for(;G(".")||G("[");)G("[")?(r=nt(),n=m.createMemberExpression("[",n,r)):(r=et(),n=m.createMemberExpression(".",n,r)),t&&(t.end(),t.apply(n));return n}(),n=G("(")?Z():[],m.markEnd(m.createNewExpression(t,n))}function it(){var t,n,r,o,a,p;return m.markStart(),t=function(){var t,e,n,r,i;for(t=ft(),e=v.allowIn,v.allowIn=!0,n=K("new")?rt():X(),v.allowIn=e;G(".")||G("[")||G("(");)G("(")?(r=Z(),n=m.createCallExpression(n,r)):G("[")?(i=nt(),n=m.createMemberExpression("[",n,i)):(i=et(),n=m.createMemberExpression(".",n,i)),t&&(t.end(),t.apply(n));return n}(),y.type===e.Punctuator&&(!G("++")&&!G("--")||(r=h,o=l,a=f,L(),p=l!==o,h=r,l=o,f=a,p)||(c&&t.type===i.Identifier&&(t.name,0)&&V({},s.StrictLHSPostfix),Q(t)||V({},s.InvalidLHSInAssignment),n=U(),t=m.createPostfixExpression(n.value,t))),m.markEndIf(t)}function ot(){var t,n;return m.markStart(),y.type!==e.Punctuator&&y.type!==e.Keyword?n=it():G("++")||G("--")?(t=U(),n=ot(),c&&n.type===i.Identifier&&(n.name,0)&&V({},s.StrictLHSPrefix),Q(n)||V({},s.InvalidLHSInAssignment),n=m.createUnaryExpression(t.value,n)):G("+")||G("-")||G("~")||G("!")?(t=U(),n=ot(),n=m.createUnaryExpression(t.value,n)):K("delete")||K("void")||K("typeof")?(t=U(),n=ot(),n=m.createUnaryExpression(t.value,n),c&&"delete"===n.operator&&n.argument.type===i.Identifier&&V({},s.StrictDelete)):n=it(),m.markEndIf(n)}function st(t,n){var r=0;if(t.type!==e.Punctuator&&t.type!==e.Keyword)return 0;switch(t.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function at(){var t,e,n,r;return m.markStart(),t=function(){var t,e,n,r,i,o,s,a,p,u;if(t=ft(),p=ot(),0===(i=st(r=y,v.allowIn)))return p;for(r.prec=i,U(),e=[t,ft()],o=[p,r,s=ot()];(i=st(y,v.allowIn))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)s=o.pop(),a=o.pop().value,p=o.pop(),n=m.createBinaryExpression(a,p,s),e.pop(),(t=e.pop())&&(t.end(),t.apply(n)),o.push(n),e.push(t);(r=U()).prec=i,o.push(r),e.push(ft()),n=ot(),o.push(n)}for(n=o[u=o.length-1],e.pop();u>1;)n=m.createBinaryExpression(o[u-1].value,o[u-2],n),u-=2,(t=e.pop())&&(t.end(),t.apply(n));return n}(),G("?")?(U(),e=v.allowIn,v.allowIn=!0,n=pt(),v.allowIn=e,z(":"),r=pt(),t=m.markEnd(m.createConditionalExpression(t,n,r))):m.markEnd({}),t}function pt(){var t,n,r,o,a;return t=y,m.markStart(),o=n=at(),y.type!==e.Punctuator||"="!==(a=y.value)&&"*="!==a&&"/="!==a&&"%="!==a&&"+="!==a&&"-="!==a&&"<<="!==a&&">>="!==a&&">>>="!==a&&"&="!==a&&"^="!==a&&"|="!==a||(Q(n)||V({},s.InvalidLHSInAssignment),c&&n.type===i.Identifier&&(n.name,0)&&V(t,s.StrictLHSAssignment),t=U(),r=pt(),o=m.createAssignmentExpression(t.value,n,r)),m.markEndIf(o)}function ut(){var t;if(m.markStart(),t=pt(),G(","))for(t=m.createSequenceExpression([t]);h<d&&G(",");)U(),t.expressions.push(pt());return m.markEndIf(t)}function ct(){var t,n=ut();return 59!==u.charCodeAt(h)?(t=l,L(),l===t&&(G(";")?U():y.type===e.EOF||G("}")||H(y))):U(),m.createExpressionStatement(n)}function ht(){var t,e,n,r=[];for(t=0;t<g.tokens.length;++t)n={type:(e=g.tokens[t]).type,value:e.value},g.range&&(n.range=e.range),g.loc&&(n.loc=e.loc),r.push(n);g.tokens=r}function lt(){this.marker=[h,l,h-f,0,0,0]}function ft(){return g.loc||g.range?(L(),new lt):null}(n={})[(e={UndefinedLiteral:-1,BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).UndefinedLiteral]="Undefined",n[e.BooleanLiteral]="Boolean",n[e.EOF]="<end>",n[e.Identifier]="Identifier",n[e.Keyword]="Keyword",n[e.NullLiteral]="Null",n[e.NumericLiteral]="Numeric",n[e.Punctuator]="Punctuator",n[e.StringLiteral]="String",n[e.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],i={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",FunctionExpression:"FunctionExpression",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Property:"Property",SequenceExpression:"SequenceExpression",ThisExpression:"ThisExpression",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},o={Data:1,Get:2,Set:4},s={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},a={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},p={name:"SyntaxTree",markStart:function(){g.loc&&(v.markerStack.push(h-f),v.markerStack.push(l)),g.range&&v.markerStack.push(h)},processComment:function(t){var e,n,r,o,s;if(void 0!==t.type&&t.type!==i.Program)for($(),e=0;e<g.pendingComments.length;++e)n=g.pendingComments[e],t.range[0]>=n.comment.range[1]&&((s=n.leading)?(r=s.range[0],o=s.range[1]-r,t.range[0]<=r&&t.range[1]-t.range[0]>=o&&(n.leading=t)):n.leading=t),t.range[1]<=n.comment.range[0]&&((s=n.trailing)?(r=s.range[0],o=s.range[1]-r,t.range[0]<=r&&t.range[1]-t.range[0]>=o&&(n.trailing=t)):n.trailing=t)},markEnd:function(t){return g.range&&(t.range=[v.markerStack.pop(),h]),g.loc&&(t.loc={start:{line:v.markerStack.pop(),column:v.markerStack.pop()},end:{line:l,column:h-f}},this.postProcess(t)),g.attachComment&&this.processComment(t),t},markEndIf:function(t){return t.range||t.loc?(g.loc&&(v.markerStack.pop(),v.markerStack.pop()),g.range&&v.markerStack.pop()):this.markEnd(t),t},postProcess:function(t){return g.source&&(t.loc.source=g.source),t},createArrayExpression:function(t){return{type:i.ArrayExpression,elements:t}},createAssignmentExpression:function(t,e,n){return{type:i.AssignmentExpression,operator:t,left:e,right:n}},createBinaryExpression:function(t,e,n){return{type:"||"===t||"&&"===t?i.LogicalExpression:i.BinaryExpression,operator:t,left:e,right:n}},createCallExpression:function(t,e){return{type:i.CallExpression,callee:t,arguments:e}},createConditionalExpression:function(t,e,n){return{type:i.ConditionalExpression,test:t,consequent:e,alternate:n}},createExpressionStatement:function(t){return{type:i.ExpressionStatement,expression:t}},createFunctionExpression:function(t,e,n,r){return{type:i.FunctionExpression,id:t,params:e,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(t){return{type:i.Identifier,name:t}},createLiteral:function(t){return{type:i.Literal,value:t.value,raw:u.slice(t.range[0],t.range[1])}},createMemberExpression:function(t,e,n){return{type:i.MemberExpression,computed:"["===t,object:e,property:n}},createNewExpression:function(t,e){return{type:i.NewExpression,callee:t,arguments:e}},createObjectExpression:function(t){return{type:i.ObjectExpression,properties:t}},createPostfixExpression:function(t,e){return{type:i.UpdateExpression,operator:t,argument:e,prefix:!1}},createProperty:function(t,e,n){return{type:i.Property,key:e,value:n,kind:t}},createSequenceExpression:function(t){return{type:i.SequenceExpression,expressions:t}},createThisExpression:function(){return{type:i.ThisExpression}},createUnaryExpression:function(t,e){return"++"===t||"--"===t?{type:i.UpdateExpression,operator:t,argument:e,prefix:!0}:{type:i.UnaryExpression,operator:t,argument:e,prefix:!0}}},lt.prototype={constructor:lt,end:function(){this.marker[3]=h,this.marker[4]=l,this.marker[5]=h-f},apply:function(t){g.range&&(t.range=[this.marker[0],this.marker[3]]),g.loc&&(t.loc={start:{line:this.marker[1],column:this.marker[2]},end:{line:this.marker[4],column:this.marker[5]}},t=m.postProcess(t)),g.attachComment&&m.processComment(t)}},t.parse=function(t,e){var n,r;r=String,"string"==typeof t||t instanceof String||(t=r(t)),m=p,h=0,l=(u=t).length>0?1:0,f=0,d=u.length,y=null,v={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,markerStack:[]},g={},void 0!==e&&(g.range="boolean"==typeof e.range&&e.range,g.loc="boolean"==typeof e.loc&&e.loc,g.attachComment="boolean"==typeof e.attachComment&&e.attachComment,g.loc&&null!==e.source&&void 0!==e.source&&(g.source=r(e.source)),"boolean"==typeof e.tokens&&e.tokens&&(g.tokens=[]),"boolean"==typeof e.comment&&e.comment&&(g.comments=[]),"boolean"==typeof e.tolerant&&e.tolerant&&(g.errors=[]),g.attachComment&&(g.range=!0,g.pendingComments=[],g.comments=[])),d>0&&void 0===u[0]&&t instanceof String&&(u=t.valueOf());try{L(),m.markStart(),c=!1,$(),n=m.markEnd(ct()),void 0!==g.comments&&(n.comments=g.comments),void 0!==g.tokens&&(ht(),n.tokens=g.tokens),void 0!==g.errors&&(n.errors=g.errors),g.attachComment&&function(){var t,e,n,r;for(t=0;t<g.pendingComments.length;++t)(e=g.pendingComments[t]).comment,(n=e.leading)&&(void 0===n.leadingComments&&(n.leadingComments=[]),n.leadingComments.push(e.comment)),(r=e.trailing)&&(void 0===r.trailingComments&&(r.trailingComments=[]),r.trailingComments.push(e.comment));g.pendingComments=[]}()}catch(t){throw t}finally{g={}}return n},t.Syntax=function(){var t,e={};for(t in"function"==typeof Object.create&&(e=Object.create(null)),i)i.hasOwnProperty(t)&&(e[t]=i[t]);return"function"==typeof Object.freeze&&Object.freeze(e),e}()});var Fi=hr.expressions,Ui=hr.operatorFns,$i=Bi.Syntax,qi=function(t){return Vi(Bi.parse(t).expression)};function Vi(t){var e=t.type;return e===$i.MemberExpression?Hi(t):e===$i.Identifier?function(t){return Gi([t.name])}(t):e===$i.ThisExpression?new Fi.RelativePathExpression([]):e===$i.CallExpression?Ki(t):e===$i.Literal?function(t){return new Fi.LiteralExpression(t.value)}(t):e===$i.UnaryExpression?function(t){var e=t.operator+"U",n=Vi(t.argument);if(n instanceof Fi.LiteralExpression){var r=Ui.get[e];return n.value=r(n.value),n}return new Fi.OperatorExpression(e,[n])}(t):e===$i.BinaryExpression||e===$i.LogicalExpression?function(t){var e=t.operator,n=Vi(t.left),r=Vi(t.right);if(n instanceof Fi.LiteralExpression&&r instanceof Fi.LiteralExpression){var i=Ui.get[e],o=i(n.value,r.value);return new Fi.LiteralExpression(o)}return new Fi.OperatorExpression(e,[n,r])}(t):e===$i.ConditionalExpression?function(t){var e=Vi(t.test),n=Vi(t.consequent),r=Vi(t.alternate);if(e instanceof Fi.LiteralExpression&&n instanceof Fi.LiteralExpression&&r instanceof Fi.LiteralExpression){var i=e.value?n.value:r.value;return new Fi.LiteralExpression(i)}return new Fi.OperatorExpression("?",[e,n,r])}(t):e===$i.ArrayExpression?function(t){for(var e=[],n=[],r=!0,i=0;i<t.elements.length;i++){var o=Vi(t.elements[i]);n.push(o),r&&o instanceof Fi.LiteralExpression?e.push(o.value):r=!1}return r?new Fi.LiteralExpression(e):new Fi.ArrayExpression(n)}(t):e===$i.ObjectExpression?function(t){for(var e={},n={},r=!0,i=0;i<t.properties.length;i++){var o=t.properties[i],s=Wi(o.key),a=Vi(o.value);n[s]=a,r&&a instanceof Fi.LiteralExpression?e[s]=a.value:r=!1}return r?new Fi.LiteralExpression(e):new Fi.ObjectExpression(n)}(t):e===$i.SequenceExpression?Yi(t):e===$i.NewExpression?Qi(t):void Xi(t)}function Hi(t,e){if(t.computed){if(t.property.type===$i.Literal)return zi(t,t.property.value,e);var n=Vi(t.object),r=Vi(t.property);return new Fi.BracketsExpression(n,r,e)}if(t.property.type===$i.Identifier)return zi(t,t.property.name);Xi(t)}function zi(t,e,n){var r=[e];n&&(r=r.concat(n));for(var i=!1;t=t.object;)if(t.type===$i.MemberExpression){if(t.computed)return Hi(t,r);t.property.type===$i.Identifier?r.unshift(t.property.name):Xi(t)}else if(t.type===$i.Identifier)r.unshift(t.name);else if(t.type===$i.ThisExpression)i=!0;else{if(t.type===$i.CallExpression)return Ki(t,r);if(t.type===$i.SequenceExpression)return Yi(t,r);if(t.type===$i.NewExpression)return Qi(t,r);Xi(t)}return i?new Fi.RelativePathExpression(r):Gi(r)}function Gi(t){var e=t[0],n=e.charAt&&e.charAt(0);if("#"===n){var r=e;return t.shift(),new Fi.AliasPathExpression(r,t)}if("@"===n){var i=e.slice(1);return t.shift(),new Fi.AttributePathExpression(i,t)}return new Fi.PathExpression(t)}function Ki(t,e){return Ji(t,e,Fi.FnExpression)}function Qi(t,e){return Ji(t,e,Fi.NewExpression)}function Ji(t,e,n){var r=t.arguments.map(Vi),i=t.callee;return i.type===$i.Identifier?"$at"===i.name?new Fi.ScopedModelExpression(r[0]):new n([i.name],r,e):i.type===$i.MemberExpression?new n(Hi(i).segments,r,e):void Xi(t)}function Wi(t){return t.type===$i.Identifier?t.name:t.type===$i.Literal?t.value:Xi(t)}function Yi(t,e){var n=t.expressions.map(Vi);return new Fi.SequenceExpression(n,e)}function Xi(t){throw new Error("Unexpected Esprima node: "+JSON.stringify(t,null,2))}var Zi={},to=p.EventEmitter,eo=hr.templates,no=Zi=new ro;function ro(){to.call(this)}function io(t,e){var n=t.hooks;if(!n)return!1;for(var r=0,i=n.length;r<i;r++){var o=n[r];if(o instanceof eo.ElementOn&&o.name===e)return!0}return!1}function oo(t,e,n){var r=t.hooks||(t.hooks=[]),i=qi(n);r.push(new eo.ElementOn(e,i))}!function(t,e){for(var n in e)t[n]=e[n]}(ro.prototype,to.prototype),no.on("element:a",function(t){if(io(t,"click")){var e=t.attributes||(t.attributes={});e.href||(e.href=new eo.Attribute("#"),oo(t,"click","$preventDefault($event)"))}}),no.on("element:form",function(t){io(t,"submit")&&oo(t,"submit","$preventDefault($event)")});var so,ao={},po=hr.templates,uo=hr.expressions;function co(t,e){for(t=Fo(t),so=new Bo(e),ji.parse(t,{start:lo,end:fo,text:vo,comment:go,other:bo});so.parent;){var n=(so=so.parent).last();if(n instanceof po.Element){if("body"===n.tagName||"html"===n.tagName){n.notClosed=!0,n.endTag="";continue}throw new Error("Missing closing HTML tag: "+n.endTag)}Go()}return new po.Template(so.content)}function ho(t,e){return t=Fo(t),so=new Bo(e),$o(t,wo,_o,"string"),new po.Template(so.content)}function lo(t,e,n,r){var i,o=e.toLowerCase();"view"===o||yo(o)||(i=function(t,e){if(!t)return;var n=[];for(var r in t){var i=t[r];if("as"!==r)if("as-array"!==r)if("as-object"!==r){var o=/^on-(.+)/.exec(r),s=o&&o[1];if(s){var a=Po(r,i);n.push(new po.ElementOn(s,a)),delete t[r]}}else{var p=Oo(r,i);n.push(new po.AsObject(p.segments,p.expression)),delete t[r]}else{var u=Lo(r,i);n.push(new po.AsArray(u)),delete t[r]}else{var u=Lo(r,i);n.push(new po.AsProperty(u)),delete t[r]}}if(n.length)return n}(n));var s=function(t){var e;for(var n in t){e||(e={});var r=t[n],i=/([^:]+):[^:]/.exec(n),o=i&&po.NAMESPACE_URIS[i[1]];if(""!==r&&"string"==typeof r){if(so=so.child(),$o(r,wo,_o,"attribute"),1===so.content.length){var s=so.content[0];e[n]=s instanceof po.Text?new po.Attribute(s.data,o):s instanceof po.DynamicText?s.expression instanceof uo.LiteralExpression?new po.Attribute(s.expression.value,o):new po.DynamicAttribute(s.expression,o):new po.DynamicAttribute(s,o)}else{if(!(so.content.length>1))throw new Error("Error parsing "+n+" attribute: "+r);var a=new po.Template(so.content,r);e[n]=new po.DynamicAttribute(a,o)}so=so.parent}else e[n]=new po.Attribute(r,o)}return e}(n),a="svg"===o?po.NAMESPACE_URIS.svg:so.namespaceUri,p=po.Element;if("tag"===o&&(p=po.DynamicElement,e=s.is,delete s.is),r||po.VOID_ELEMENTS[o]){var u=new p(e,s,null,i,r,null,a);so.content.push(u),mo(o)}else{(so=so.child()).namespaceUri=a;u=new p(e,s,so.content,i,r,null,a);so.parent.content.push(u)}}function fo(t,e){var n=(so=so.parent).last();if(!(n instanceof po.DynamicElement&&"tag"===e.toLowerCase()||n instanceof po.Element&&n.tagName===e))throw new Error("Mismatched closing HTML tag: "+t);mo(e)}function mo(t){if("view"!==t){var e=yo(t);if(e){Co(n=so.content.pop(),e,e.name)}else{n=so.last();Zi.emit("element",n),Zi.emit("element:"+t,n)}}else{var n;!function(t){var e=t.attributes.is||t.attributes.name;if(!e)throw new Error('The <view> element requires an "is" attribute');if(delete t.attributes.is,delete t.attributes.name,e.expression){var n=To(t),r=jo(n),i=t.content||[],o=So(e.expression,n,r.hooks,r.initHooks);Ao(n,i,o)}else{var s=e.data,a=Eo(s);Co(t,a,s)}}(n=so.content.pop())}}function yo(t){return so.view&&so.view.views.tagMap[t]}function vo(t,e){$o(t,wo,_o,e?"string":"html")}function go(t,e){if(ji.isConditionalComment(t)){var n=new po.Comment(e);so.content.push(n)}}ao.createTemplate=co,ao.createStringTemplate=ho,ao.createExpression=zo,ao.createPathExpression=qi,ao.markup=Zi,po.View.prototype._parse=function(){var t;try{if(this.literal){var e=this.unminified?this.source:this.source.replace(/^\s*\n/,"").replace(/\s*$/,"");t=new po.Text(e)}else if(this.string)t=ho(this.source,this);else{t=co(e=this.unminified?this.source:ji.minify(this.source).replace(/&sp;/g," "),this)}}catch(t){throw Ko(t,'\n\nWithin template "'+this.name+'":\n'+this.source)}return this.template=t,t};var xo=/^<!DOCTYPE\s+([^\s]+)(?:\s+(PUBLIC|SYSTEM)\s+"([^"]+)"(?:\s+"([^"]+)")?)?\s*>/i;function bo(t){var e=xo.exec(t);if(e){var n,r,i=e[1],o=e[2]&&e[2].toLowerCase();"public"===o?(n=e[3],r=e[4]):"system"===o&&(r=e[3]);var s=new po.Doctype(i,n,r);so.content.push(s)}else Go(t)}function wo(t){var e=new po.Text(t);so.content.push(e)}function _o(t,e){var n=zo(t);if(n.meta.blockType)!function(t){var e=t.meta.blockType;if(t.meta.isEnd){var n=(so=so.parent).last(),r=n&&(n.expression||n.expressions&&n.expressions[0]);if(!(r&&"end"===e&&r.meta.blockType||e===r.meta.blockType))throw new Error("Mismatched closing template tag: "+t.meta.source)}else if("else"===e||"else if"===e){var n=(so=so.parent).last();so=so.child(),n instanceof po.ConditionalBlock?(n.expressions.push(t),n.contents.push(so.content)):n instanceof po.EachBlock?("else"!==e&&Go(t.meta.source),n.elseContent=so.content):Go(t.meta.source)}else{var i,o=so.child();i="if"===e||"unless"===e?new po.ConditionalBlock([t],[o.content]):"each"===e?new po.EachBlock(t,o.content):new po.Block(t,o.content),so.content.push(i),so=o}}(n);else if("view"===n.meta.valueType)!function(t){var e,n;t instanceof uo.SequenceExpression?(e=t.args[0],n=t.args[1]):e=t;var r,i=function(t){if(!t)return;var e=t instanceof uo.ObjectExpression?t.properties:t instanceof uo.LiteralExpression?t.value:null;"object"!=typeof e&&Go();var n={};for(var r in e){var i=e[r];n[r]=i instanceof uo.LiteralExpression?i.value:i instanceof uo.Expression?new uo.ViewParentExpression(i):i}return n}(n),o=jo(i);if(e instanceof uo.LiteralExpression){var s=e.get();Eo(s),r=new po.ViewInstance(s,i,o.hooks,o.initHooks)}else r=So(e,i,o.hooks,o.initHooks);so.content.push(r)}(n);else if(n.meta.unescaped&&"html"===e){var r=new po.DynamicHtml(n);so.content.push(r)}else{var i=new po.DynamicText(n);so.content.push(i)}}function Eo(t){var e=so.view.views.find(t,so.view.namespace);if(!e){var n=so.view.views.findErrorMessage(t);throw new Error(n)}return e}function Co(t,e,n){var r=To(t),i=jo(r);Ao(r,function(t,e,n){var r=[];if(!t)return r;for(var i=0,o=t.length;i<o;i++){var s=t[i],a=s instanceof po.Element&&s.tagName;if("attribute"===a){var a=Mo(s);Do(s,a,n)}else if(e.attributesMap&&e.attributesMap[a])Do(s,a,n);else if("array"===a){var a=Mo(s);Ro(s,a,n)}else e.arraysMap&&e.arraysMap[a]?Ro(s,e.arraysMap[a],n):r.push(s)}return r}(t.content,e,r),new po.ViewInstance(e.registeredName,r,i.hooks,i.initHooks))}function So(t,e,n,r){var i=new po.DynamicViewInstance(t,e,n,r);return new po.Block(t,[i])}function Ao(t,e,n){ko(t,e),delete t.within,so.content.push(n)}function ko(t,e){t.hasOwnProperty("content")||e.length&&(t.content=Io(e,t.within))}function Io(t,e){if(1===t.length){var n=t[0];if(n instanceof po.Text)return n.data;if(n instanceof po.DynamicText){var r=n.expression;return r instanceof uo.LiteralExpression?r.value:e?n:new uo.ViewParentExpression(r)}}var i=new po.Template(t);return e?i:new po.ViewParent(i)}function To(t){var e={};for(var n in t.attributes){var r=t.attributes[n];e[No(n)]=r.expression instanceof po.Template?new po.ViewParent(r.expression):r.expression instanceof uo.Expression?new uo.ViewParentExpression(r.expression):r.data}return e}function Lo(t,e){var n=qi(e);if(!(n instanceof uo.PathExpression))throw new Error(t+" attribute must be a path: "+t+'="'+e+'"');return n.segments}function Oo(t,e){var n;if(!((n=qi(e))instanceof uo.SequenceExpression&&2===n.args.length&&n.args[0]instanceof uo.PathExpression))throw new Error(t+" attribute requires a path and a key argument: "+t+'="'+e+'"');return{segments:n.args[0].segments,expression:n=n.args[1]}}function Po(t,e){return qi(e)}function jo(t){if(!t)return{};var e=[],n=[];for(var r in t){var i=t[r];if("as"!==r)if("asArray"!==r)if("asObject"!==r){var o=/^on([A-Z_].*)/.exec(r),s=o&&o[1].charAt(0).toLowerCase()+o[1].slice(1);if(s){var a=Po(0,i);n.push(new po.ComponentOn(s,a)),delete t[r]}}else{var p=Oo("as-object",i);e.push(new po.AsObjectComponent(p.segments,p.expression)),delete t[r]}else{u=Lo("as-array",i);e.push(new po.AsArrayComponent(u)),delete t[r]}else{var u=Lo(r,i);e.push(new po.AsProperty(u)),delete t[r]}}return{hooks:e.length?e:null,initHooks:n.length?n:null}}function No(t){return t.replace(/-./g,function(t){return t.charAt(1).toUpperCase()})}function Mo(t){var e=(t.attributes.is||t.attributes.name).data;if(!e)throw new Error("The <"+t.tagName+'> element requires a literal "is" attribute');return delete t.attributes.is,delete t.attributes.name,e}function Do(t,e,n){var r=No(e),i=t.attributes&&t.attributes.within;n[r]=Io(t.content,i)}function Ro(t,e,n){var r=To(t);ko(r,t.content),delete r.within;var i=function(t){var e={},n={},r=!0;for(var i in t){var o=t[i];o instanceof uo.Expression?(e[i]=o,r=!1):o instanceof po.Template?(e[i]=new uo.DeferRenderExpression(o),r=!1):(e[i]=new uo.LiteralExpression(o),n[i]=o)}return r?new uo.LiteralExpression(n):new uo.ObjectExpression(e)}(r),o=No(e),s=n[o];if(s instanceof uo.ArrayExpression)s.items.push(i);else if(Array.isArray(s))if(i instanceof uo.LiteralExpression)s.push(i.value);else{for(var a=[],p=0;p<s.length;p++)a[p]=new uo.LiteralExpression(s[p]);a.push(i),n[o]=new uo.ArrayExpression(a)}else null==s?n[o]=i instanceof uo.LiteralExpression?[i.value]:new uo.ArrayExpression([i]):Go()}function Bo(t,e){this.view=t,this.parent=e,this.content=[],this.namespaceUri=e&&e.namespaceUri}function Fo(t){var e="";return $o(t,function(t){e+=t},function(t){var n=t.replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"});e+="{{"+n+"}}"},"string"),e}function Uo(t,e){return"html"===e||"attribute"===e?ji.unescapeEntities(t):t}function $o(t,e,n,r){for(var i,o=t;o;){if(o===i)throw new Error("Error parsing template text: "+t);i=o;var s=o.indexOf("{{");if(-1===s)return void e(Uo(o,r));var a=qo(o,2,s,"{","}");if(-1===a)throw new Error("Mismatched braces in: "+t);if(s>0)e(Uo(o.slice(0,s),r));var p=o.slice(s+2,a-2);if(p){var u=p.replace(/(?:&amp;|&lt;)/g,function(t){return"&amp;"===t?"&":"<"});n(u=Uo(u,r),r)}o=o.slice(a)}}function qo(t,e,n,r,i){for(n+=e;e;){var o=t.indexOf(i,n),s=t.indexOf(r,n),a=-1!==s;if(-1!==o&&(!a||o<s))n=o+1,e--;else{if(!a)return-1;n=s+1,e++}}return n}Bo.prototype.child=function(){return new Bo(this.view,this)},Bo.prototype.last=function(){return this.content[this.content.length-1]};var Vo=/^(if|unless|else if|each|with|on)\s+([\s\S]+?)(?:\s+as\s+([^,\s]+)\s*(?:,\s*(\S+))?)?$/,Ho=/^(?:(view|unbound|bound|unescaped)\s+)?([\s\S]*)/;function zo(t){t=t.trim();var e,n,r,i,o=new uo.ExpressionMeta(t),s=Vo.exec(t);if(s)o.blockType=s[1],e=s[2],n=s[3],r=s[4];else if("else"===t||"unbound"===t||"bound"===t)o.blockType=t;else if("/"===t.charAt(0))o.isEnd=!0,o.blockType=t.slice(1).trim()||"end";else{var a;e=t;do{a=(s=Ho.exec(e))[1],e=s[2],"unescaped"===a?o.unescaped=!0:"unbound"===a||"bound"===a?o.bindType=a:a&&(o.valueType=a)}while(a)}try{i=e?qi(e):new uo.Expression,n&&(o.as=Qo(n)),r&&(o.keyAs=Qo(r))}catch(e){throw Ko(e,"\n\nWithin expression: "+t)}return i.meta=o,i}function Go(t){throw new Error("Error parsing template: "+t)}function Ko(t,e){return t instanceof Error?(t.message+=e,t):new Error(t+e)}function Qo(t){var e=qi(t);if(e instanceof uo.AliasPathExpression){if(0===e.segments.length)return e.alias;throw new Error("Alias must not have dots or brackets: "+t)}throw new Error('Alias must be an identifier starting with "#": '+t)}var Jo={};(function(t){t.derby=Jo=new yi,Jo.App.prototype.registerViews=function(t){t||(t='script[type="text/template"]');for(var e=document.querySelectorAll(t),n=0;n<e.length;n++){var r=e[n];this.views.register(r.id,r.innerHTML,r.dataset)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}();
//# sourceMappingURL=derby-standalone.min.map.json