!function(){var t=function(t){var e;return function(n){return e||t(e={exports:{},parent:n},e.exports),e.exports}},e=t(function(t,e){var i=r({}),o=n({}).DependencyOptions,s=kt.concat,a=kt.hasKeys,p=kt.traverseAndCreate;function u(t,e,n,r){for(var i=0;i<e.length;i++)t=c(t,e[i],n,r);return t}function c(t,e,n,r){var i=h(e,n,r);return s(t,i)}function h(t,e,n){return t.dependencies(e,n)}!function(){for(var t in I)e[t]=I[t]}(),e.Marker=f,e.View=y,e.ViewInstance=v,e.DynamicViewInstance=g,e.ViewParent=w,e.ContextClosure=x,e.Views=_,e.MarkupHook=E,e.ElementOn=C,e.ComponentOn=S,e.AsProperty=A,e.AsObject=k,e.AsObjectComponent=T,e.AsArray=L,e.AsArrayComponent=O,e.emptyTemplate=new I.Template([]),I.Template.prototype.isUnbound=function(t){return t.unbound},I.Binding.prototype.isUnbound=function(){return this.template.expression.isUnbound(this.context)},I.Template.prototype.resolve=function(){},I.Template.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return u(null,this.content,t,e)},I.Doctype.prototype.dependencies=function(){},I.Text.prototype.dependencies=function(){},I.DynamicText.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return h(this.expression,t,e)},I.Comment.prototype.dependencies=function(){},I.DynamicComment.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return h(this.expression,t,e)},I.Html.prototype.dependencies=function(){},I.DynamicHtml.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return h(this.expression,t,e)},I.Element.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=function(t,e,n,r){for(var i in e)t=c(t,e[i],n,r);return t}(null,this.attributes,t,e);return this.content?u(n,this.content,t,e):n}},I.DynamicElement.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return c(I.Element.prototype.dependencies(t,e),this.tagName,t,e)},I.Block.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this.expression.meta&&"on"===this.expression.meta.blockType?h(this.expression,t,e):null,r=t.child(this.expression);return u(n,this.content,r,e)}},I.ConditionalBlock.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this.getCondition(t);if(null==n)return h(this.expressions[0],t,e);var r=function(t,e,n,r,i){for(var o=0;o<=i;o++)t=c(t,e[o],n,r);return t}(null,this.expressions,t,e,n),i=this.expressions[n];return u(r,this.contents[n],t.child(i),e)}},I.EachBlock.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=h(this.expression,t,e),r=this.expression.get(t);if(r&&r.length)for(var i=0;i<r.length;i++){var s=t.eachChild(this.expression,i);n=u(n,this.content,s,e)}else this.elseContent&&(n=u(n,this.elseContent,t,e));return n}},I.Attribute.prototype.dependencies=function(){},I.DynamicAttribute.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e))return h(this.expression,t,e)};var l=[{emit:function(t,e){e.$component=t.controller,t.controller.markerNode=e}}];function f(t){I.Comment.call(this,t,l)}function m(t){for(var e=t.split(/\s+/),n=0,r=e.length;n<r;n++)this[e[n]]=!0}function d(t){for(var e=t.split(/\s+/),n=0,r=e.length;n<r;n++){var i=e[n].split("/");this[i[0]]=i[1]||i[0]}}function y(t,e,n,r){this.views=t,this.name=e,this.source=n,this.options=r;var i=(this.name||"").split(":"),o=i.pop();this.namespace=i.join(":"),this.registeredName="index"===o?this.namespace:this.name,this.attributesMap=r&&r.attributes&&new m(r.attributes),this.arraysMap=r&&r.arrays&&new d(r.arrays),this.unminified=r&&(r.unminified||""===r.unminified),this.string=r&&(r.string||""===r.string),this.literal=r&&(r.literal||""===r.literal),this.template=null,this.componentFactory=null,this.fromSerialized=!1}function v(t,e,n,r){this.name=t,this.attributes=e,this.hooks=n,this.initHooks=r,this.view=null}function g(t,e,n,r){this.nameExpression=t,this.attributes=e,this.hooks=n,this.initHooks=r}function w(t){this.template=t}function x(t,e){this.template=t,this.context=e}function b(){}function _(){this.nameMap=new b,this.tagMap=new b,this.elementMap=this.tagMap}function E(){}function C(t,e){this.name=t,this.expression=e}function S(t,e){this.name=t,this.expression=e}function A(t){this.segments=t,this.lastSegment=t.pop()}function k(t,e){A.call(this,t),this.keyExpression=e}function T(t,e){k.call(this,t,e)}function L(t){A.call(this,t)}function O(t){L.call(this,t)}f.prototype=Object.create(I.Comment.prototype),f.prototype.constructor=f,f.prototype.type="Marker",f.prototype.serialize=function(){return i.instance(this,this.data)},f.prototype.get=function(){return""},y.prototype=Object.create(I.Template.prototype),y.prototype.constructor=y,y.prototype.type="View",y.prototype.serialize=function(){return null},y.prototype._isComponent=function(t){return!!this.componentFactory&&(!t.attributes||!t.attributes.extend)},y.prototype._initComponent=function(t){return this._isComponent(t)?this.componentFactory.init(t):t},y.prototype._queueCreate=function(t,e){if(this._isComponent(t)){var n=this.componentFactory;if(t.queue(function(){n.create(e)}),!t.hooks)return;t.queue(function(){for(var n=0,r=t.hooks.length;n<r;n++)t.hooks[n].emit(t,e.controller)})}},y.prototype.get=function(t,e){var n=this._initComponent(t);return(this.template||this.parse()).get(n,e)},y.prototype.getFragment=function(t,e){var n=this._initComponent(t),r=(this.template||this.parse()).getFragment(n,e);return this._queueCreate(t,n),r},y.prototype.appendTo=function(t,e){var n=this._initComponent(e);(this.template||this.parse()).appendTo(t,n),this._queueCreate(e,n)},y.prototype.attachTo=function(t,e,n){var r=this._initComponent(n);e=(this.template||this.parse()).attachTo(t,e,r);return this._queueCreate(n,r),e},y.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this.template||this.parse(),r=this._isComponent(t)?t.componentChild(null):t;return n.dependencies(r,e)}},y.prototype.parse=function(){if(this._parse(),this.componentFactory){var t=new f(this.name);this.template.content.unshift(t)}return this.template},y.prototype._parse=function(){throw new Error("View parsing not available")},v.prototype=Object.create(I.Template.prototype),v.prototype.constructor=v,v.prototype.type="ViewInstance",v.prototype.serialize=function(){return i.instance(this,this.name,this.attributes,this.hooks,this.initHooks)},v.prototype.get=function(t,e){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.get(r,e)},v.prototype.getFragment=function(t,e){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.getFragment(r,e)},v.prototype.appendTo=function(t,e){var n=this._find(e),r=e.viewChild(n,this.attributes,this.hooks,this.initHooks);n.appendTo(t,r)},v.prototype.attachTo=function(t,e,n){var r=this._find(n),i=n.viewChild(r,this.attributes,this.hooks,this.initHooks);return r.attachTo(t,e,i)},v.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this._find(t),r=t.viewChild(n,this.attributes,this.hooks,this.initHooks);return n.dependencies(r,e)}},v.prototype._find=function(t){if(this.view)return this.view;var e=t.getView(),n=e&&e.namespace;if(this.view=t.meta.views.find(this.name,n),!this.view){var r=t.meta.views.findErrorMessage(this.name,e);throw new Error(r)}return this.view},g.prototype=Object.create(v.prototype),g.prototype.constructor=g,g.prototype.type="DynamicViewInstance",g.prototype.serialize=function(){return i.instance(this,this.nameExpression,this.attributes,this.hooks,this.initHooks)},g.prototype._find=function(t){var n=this.nameExpression.get(t),r=t.getView(),i=r&&r.namespace;return n&&t.meta.views.find(n,i)||e.emptyTemplate},g.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=this.nameExpression.dependencies(t),r=v.prototype.dependencies.call(this,t,e);return s(n,r)}},w.prototype=Object.create(I.Template.prototype),w.prototype.constructor=w,w.prototype.type="ViewParent",w.prototype.serialize=function(){return i.instance(this,this.template)},w.prototype.get=function(t,e){var n=t.forViewParent();return this.template.get(n,e)},w.prototype.getFragment=function(t,e){var n=t.forViewParent();return this.template.getFragment(n,e)},w.prototype.appendTo=function(t,e){var n=e.forViewParent();this.template.appendTo(t,n)},w.prototype.attachTo=function(t,e,n){var r=n.forViewParent();return this.template.attachTo(t,e,r)},w.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this,e)){var n=t.forViewParent();return this.template.dependencies(n,e)}},x.prototype=Object.create(I.Template.prototype),x.prototype.constructor=x,x.prototype.serialize=function(){throw new Error("ContextClosure cannot be serialized")},x.prototype.get=function(t,e){var n=t.closureChild(this.context);return this.template.get(n,e)},x.prototype.getFragment=function(t,e){var n=t.closureChild(this.context);return this.template.getFragment(n,e)},x.prototype.appendTo=function(t,e){var n=e.closureChild(this.context);this.template.appendTo(t,n)},x.prototype.attachTo=function(t,e,n){var r=n.closureChild(this.context);return this.template.attachTo(t,e,r)},x.prototype.dependencies=function(t,e){if(!o.shouldIgnoreTemplate(this.template,e)){var n=t.closureChild(this.context);return this.template.dependencies(n,e)}},x.prototype.equals=function(t){return t instanceof x&&this.context===t.context&&this.template.equals(t.template)},_.prototype.find=function(t,e){var n=this.nameMap;if(s=n[e?e+":"+t:t])return s;var r=t.split(":"),i=r.length;for(e&&(r=e.split(":").concat(r));i>0;){for(var o=r.slice();o.length>i;){var s;if(o.splice(-1-i,1),s=n[o.join(":")])return s}i--}},_.prototype.register=function(t,e,n){var r=t.replace(/:index$/,""),i=this.nameMap[r];if(i){var o=i.componentFactory;y.call(i,this,t,e,n),i.componentFactory=o}else i=new y(this,t,e,n);this.nameMap[r]=i;var s=n&&(n.tag||n.element);return s&&(this.tagMap[s]=i),i},_.prototype.deserialize=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=n[0],i=n[1],o=n[2],s=n[3],a=this.register(i,o,s);a.parse=r,a.fromSerialized=!0}},_.prototype.serialize=function(t){var n=t&&t.server,r=t&&t.minify,o=[];for(var s in this.nameMap){var p=this.nameMap[s],u=p.template||p.parse();if(!n&&p.options){if(p.options.serverOnly)continue;p.options.server&&(u=e.emptyTemplate)}o.push("[function(){return this.template="+u.serialize()+"},"+i.args([p.name,r?null:p.source,a(p.options)?p.options:null])+"]")}return"function(derbyTemplates, views){var expressions = derbyTemplates.expressions,templates = derbyTemplates.templates;views.deserialize(["+o.join(",")+"])}"},_.prototype.findErrorMessage=function(t,e){var n=Object.keys(this.nameMap),r='Cannot find view "'+t+'" in'+[""].concat(n).join("\n  ")+"\n";return e&&(r+='\nWithin template "'+e.name+'":\n'+e.source),r},E.prototype.module=I.Template.prototype.module,C.prototype=Object.create(E.prototype),C.prototype.constructor=C,C.prototype.type="ElementOn",C.prototype.serialize=function(){return i.instance(this,this.name,this.expression)},C.prototype.emit=function(t,e){var n=this;if("create"===this.name)this.apply(t,e);else if("destroy"===this.name){(e.$destroyListeners||(e.$destroyListeners=[])).push(function(){n.apply(t,e)})}else e.addEventListener(this.name,function(r){return n.apply(t,e,r)},!1)},C.prototype.apply=function(t,e,n){var r=t.controller.model.data;r.$event=n,r.$element=e;var i=this.expression.apply(t);return delete r.$event,delete r.$element,i},S.prototype=Object.create(E.prototype),S.prototype.constructor=S,S.prototype.type="ComponentOn",S.prototype.serialize=function(){return i.instance(this,this.name,this.expression)},S.prototype.emit=function(t,e){var n=this.expression;e.on(this.name,function(){var e=arguments.length&&Array.prototype.slice.call(arguments);return n.apply(t,e)})},A.prototype=Object.create(E.prototype),A.prototype.constructor=A,A.prototype.type="AsProperty",A.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return i.instance(this,t)},A.prototype.emit=function(t,e){p(t.controller,this.segments)[this.lastSegment]=e},k.prototype=Object.create(A.prototype),k.prototype.constructor=k,k.prototype.type="AsObject",k.prototype.serialize=function(){var t=this.segments.concat(this.lastSegment);return i.instance(this,t,this.keyExpression)},k.prototype.emit=function(t,e){var n=p(t.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]={}),i=this.keyExpression.get(t);r[i]=e,this.addListeners(e,r,i)},k.prototype.addListeners=function(t,e,n){this.addDestroyListener(t,function(){delete e[n]})},k.prototype.addDestroyListener=function(t,e){(t.$destroyListeners||(t.$destroyListeners=[])).push(e)},T.prototype=Object.create(k.prototype),T.prototype.constructor=T,T.prototype.type="AsObjectComponent",T.prototype.addDestroyListener=function(t,e){t.on("destroy",e)},L.prototype=Object.create(A.prototype),L.prototype.constructor=L,L.prototype.type="AsArray",L.prototype.emit=function(t,e){for(var n=p(t.controller,this.segments),r=n[this.lastSegment]||(n[this.lastSegment]=[]),i=r.length;i--;){var o=r[i];if(o===e)return;if(4&this.comparePosition(e,o))return r.splice(i+1,0,e),void this.addListeners(e,r)}r.unshift(e),this.addListeners(e,r)},L.prototype.addListeners=function(t,e){this.addDestroyListener(t,function(){var n=e.indexOf(t);-1!==n&&e.splice(n,1)})},L.prototype.comparePosition=function(t,e){return e.compareDocumentPosition(t)},L.prototype.addDestroyListener=k.prototype.addDestroyListener,O.prototype=Object.create(L.prototype),O.prototype.constructor=O,O.prototype.type="AsArrayComponent",O.prototype.comparePosition=function(t,e){return e.markerNode.compareDocumentPosition(t.markerNode)},O.prototype.addDestroyListener=T.prototype.addDestroyListener}),n=t(function(t,n){var r=e({});function i(t){this.setIgnoreTemplate(t&&t.ignoreTemplate)}n.DependencyOptions=i,i.shouldIgnoreTemplate=function(t,e){return!!e&&e.ignoreTemplate===t},i.prototype.setIgnoreTemplate=function(t){for(;t instanceof r.ContextClosure;)t=t.template;this.ignoreTemplate=t}}),r=t(function(t,e){function n(t){for(var e=[],n=t.length;n--;){var i=r(t[n]);e.unshift(i)}for(n=e.length;n--;){if("void 0"!==(i=e[n])&&"null"!==i)break;e.pop()}return e.join(", ")}function r(t){if(t&&t.serialize)return t.serialize();if(void 0===t)return"void 0";if(null===t)return"null";if("string"==typeof t)return i(t);if("number"==typeof t||"boolean"==typeof t)return t+"";if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++){var o=r(t[n]);e.push(o)}return"["+e.join(", ")+"]"}if("object"==typeof t){e=[];for(var s in t){o=r(t[s]);e.push(i(s)+": "+o)}return"{"+e.join(", ")+"}"}}function i(t){return"'"+t.replace(/['\r\n\\]/g,function(t){return"'"===t?"\\'":"\r"===t?"\\r":"\n"===t?"\\n":"\\"===t?"\\\\":""})+"'"}e.instance=function(t){var e=Array.prototype.slice.call(arguments,1);return"new "+t.module+"."+t.type+"("+n(e)+")"},e.args=n}),i=/^<([^\s=\/!>]+)((?:\s+[^\s=\/>]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+)?)?)*)\s*(\/?)\s*>/,o=/^<\/([^\s=\/!>]+)[^>]*>/,s=/^<!--([\s\S]*?)-->/,a=/<!--[\s\S]*?-->/,p=/^<([\s\S]*?)>/,u=/([^\s=]+)(?:\s*(=)\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+))?)?/g,c=/^(style|script)$/i;function h(){}function l(t){return new RegExp("</"+t,"i")}function f(t,e,n){var r={},i=e[0],o=e[1],s=e[2],a=!!e[3];return t=t.slice(i.length),s.replace(u,function(t,e,n,i,o,s){r[e]=i||o||s||!n||""}),n(i,o,r,a,t),t}function m(t,e,n){var r=e[0];return n(r,e[1],t=t.slice(r.length)),t}function d(t,e,n,r){var i;return~e?(i=t.slice(0,e),t=t.slice(e)):(i=t,t=""),i&&r(i,n,t),t}function y(t,e,n){n||(n=0);var r,i=t.search(e),o=t.match(a);return o&&o.index<i?(n+=r=o.index+o[0].length,y(t=t.slice(r),e,n)):i+n}var v,g=function(t,e){if(null==e&&(e={}),t)for(var n,r,a,u,v,g=e.start||h,w=e.end||h,x=e.text||h,b=e.comment||h,_=e.other||h,E=e.matchEnd||l,C=e.error,S=e.rawTags||c;t;){if(t===r){if(v=new Error("HTML parse error: "+t),!C)throw v;C(v)}if(r=t,"<"===t[0]){if(a=t.match(i)){t=f(t,a,g),u=a[1],S.test(u)&&(t=d(t,n=y(t,E(u)),!0,x));continue}if(a=t.match(o)){a[1]=a[1],t=m(t,a,w);continue}if(a=t.match(s)){t=m(t,a,b);continue}if(a=t.match(p)){t=m(t,a,_);continue}}n=t.indexOf("<"),t=d(t,n,!1,x)}},w={exports:{}};if(w.exports={parse:g,unescapeEntities:function(t){return t.replace(/&#?[A-Za-z0-9]+;/g,v)},isConditionalComment:_,minify:function(t){var e="",n=!0;return g(t,{start:function(t,r,i){n=!("x-no-minify"in i),e+=E(t)},end:function(t){e+=E(t)},text:function(t){e+=n?function(t){return t?t.replace(/\s*\r?\n\s*/g,""):""}(t):t},comment:function(t){_(t)&&(e+=t)},other:function(t){e+=t}}),e}},"undefined"!=typeof document){var x=document.createElement("div");v=function(t){return x.innerHTML=t,x.textContent||x.innerText}}else{var b=w.require("./entities.json");v=function(t){var e=b[t];if(e)return e.characters;if("#"!==t.charAt(1))throw new Error("Unrecognized character reference: "+t);var n="x"===t.charAt(2)||"X"===t.charAt(2)?parseInt(t.slice(3,-1),16):parseInt(t.slice(2,-1),10);return String.fromCharCode(n)}}function _(t){return/(?:^<!--\[)|(?:\]-->$)/.test(t)}function E(t){return t.replace(/(?:\s*\r?\n\s*)+/g,"\n")}w=w.exports;var C={};function S(){}function A(t,e,n,r,i){this.meta=t,this.controller=e,this.parent=n,this.unbound=r,this.expression=i,this.alias=i&&i.meta&&i.meta.as,this.keyAlias=i&&i.meta&&i.meta.keyAs,this.item=null,this.view=null,this.attributes=null,this.hooks=null,this.initHooks=null,this.closure=null,this._id=null}C.ContextMeta=function(){this.addBinding=S,this.removeBinding=S,this.removeNode=S,this.addItemContext=S,this.removeItemContext=S,this.views=null,this.idNamespace="",this.idCount=0,this.pending=[],this.pauseCount=0},C.Context=A,A.prototype.id=function(){var t=++this.meta.idCount;return this.meta.idNamespace+"_"+t.toString(36)},A.prototype.addBinding=function(t){if(!t.itemFor){var e=t.template.expression;(e?e.isUnbound(this):this.unbound)||e&&e.meta&&"with"===e.meta.blockType||this.meta.addBinding(t)}},A.prototype.removeBinding=function(t){this.meta.removeBinding(t)},A.prototype.removeNode=function(t){this.meta.removeNode(t)},A.prototype.child=function(t){var e=t.meta&&t.meta.blockType,n="unbound"===e||"bound"!==e&&this.unbound;return new A(this.meta,this.controller,this,n,t)},A.prototype.componentChild=function(t){return new A(this.meta,t,this,this.unbound)},A.prototype.eachChild=function(t,e){var n=new A(this.meta,this.controller,this,this.unbound,t);return n.item=e,this.meta.addItemContext(n),n},A.prototype.viewChild=function(t,e,n,r){var i=new A(this.meta,this.controller,this,this.unbound);return i.view=t,i.attributes=e,i.hooks=n,i.initHooks=r,i},A.prototype.closureChild=function(t){var e=new A(this.meta,this.controller,this,this.unbound);return e.closure=t,e},A.prototype.forRelative=function(t){for(var e=this;e&&e.expression===t||e.view;)e=e.parent;return e},A.prototype.forAlias=function(t){for(var e=this;e;){if(e.alias===t||e.keyAlias===t)return e;e=e.parent}},A.prototype.forAttribute=function(t){for(var e=this;e;){if(e.view){var n=e.attributes;if(!n)return;if(n.hasOwnProperty(t))return e;if(!n.inherit&&!n.extend)return}e=e.parent}},A.prototype.forViewParent=function(){for(var t=this;t;){if(t.closure)return t.closure.parent;if(t.view)return t.parent;t=t.parent}},A.prototype.getView=function(){for(var t=this;t;){if(t.view)return t.view;t=t.parent}},A.prototype.get=function(){var t=this.expression?this.expression.get(this):this.controller.model.data;return null!=this.item?t&&t[this.item]:t},A.prototype.pause=function(){this.meta.pauseCount++},A.prototype.unpause=function(){--this.meta.pauseCount||this.flush()},A.prototype.flush=function(){var t=this.meta.pending,e=t.length;if(e){this.meta.pending=[];for(var n=0;n<e;n++)t[n]()}},A.prototype.queue=function(t){this.meta.pending.push(t)};var k={get:{"!U":function(t){return!t},"-U":function(t){return-t},"+U":function(t){return+t},"~U":function(t){return~t},typeofU:function(t){return typeof t},"||":function(t,e){return t||e},"&&":function(t,e){return t&&e},"|":function(t,e){return t|e},"^":function(t,e){return t^e},"&":function(t,e){return t&e},"==":function(t,e){return t==e},"!=":function(t,e){return t!=e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"<":function(t,e){return t<e},">":function(t,e){return t>e},"<=":function(t,e){return t<=e},">=":function(t,e){return t>=e},instanceof:function(t,e){return t instanceof e},in:function(t,e){return t in e},"<<":function(t,e){return t<<e},">>":function(t,e){return t>>e},">>>":function(t,e){return t>>>e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"?":function(t,e,n){return t?e:n},",":function(){return arguments[arguments.length-1]}},set:{"!U":function(t){return[!t]},"-U":function(t){return[-t]},"==":function(t,e,n){if(t)return[n]},"===":function(t,e,n){if(t)return[n]},in:function(t,e,n){return n[e]=!0,{1:n}},"+":function(t,e,n){return[t-n]},"-":function(t,e,n){return[t+n]},"*":function(t,e,n){return[t/n]},"/":function(t,e,n){return[t*n]}}},I={},T=r({}),L={checked:"checked",disabled:"disabled",readonly:"readOnly",selected:"selected"},O={colspan:"colSpan",maxlength:"maxLength",rowspan:"rowSpan",tabindex:"tabIndex"},P={cellpadding:"cellPadding",cellspacing:"cellSpacing",class:"className",contenteditable:"contentEditable",enctype:"encoding",for:"htmlFor",frameborder:"frameBorder",id:"id",title:"title",type:"type",usemap:"useMap",value:"value"},j={};bt(L,j),bt(O,j),bt(P,j);var N={};bt(j,N),N.checked="defaultChecked",N.value="defaultValue";var M={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function D(t,e){this.content=t,this.source=e}function R(t,e,n){this.name=t,this.publicId=e,this.systemId=n}function B(t){this.data=t,this.escaped=_t(t)}function F(t){this.expression=t,this.unbound=!1}function U(t,e,n,r,i){if(!e){var o=document.createTextNode(n);return t.appendChild(o),void z(r,i,o)}if(3===e.nodeType){if(e.data===n)return z(r,i,e),e.nextSibling;var s=function(t,e){var n=t.cloneNode(!1);return n.deleteData(0,e),t.deleteData(e,t.length-e),t.parentNode.insertBefore(n,t.nextSibling||null),n}(e,(n=At(n)).length);if(e.data!==n)throw dt(t,e);return z(r,i,e),s}if(""===n){o=document.createTextNode("");return t.insertBefore(o,e||null),z(r,i,o),e}throw dt(t,e)}function $(t,e){this.data=t,this.hooks=e}function q(t,e){this.expression=t,this.hooks=e}function V(t,e,n,r,i){if(!e||8!==e.nodeType){var o=document.createComment(n);return t.insertBefore(o,e||null),z(r,i,o),e}if(e.data===n)return z(r,i,e),e.nextSibling;throw dt(t,e)}function z(t,e,n){t.expression&&!t.unbound&&e.addBinding(new vt(t,e,n)),nt(t.hooks,e,n)}function H(t){this.data=t}function G(t){this.expression=t,this.ending="/"+t}function K(t,e){if(t&&1===t.nodeType)return(r=document.createRange()).selectNodeContents(t),r.createContextualFragment(e);var n=document.createElement("div"),r=document.createRange();return n.innerHTML=e,r.selectNodeContents(n),r.extractContents()}function Q(t,e,n){for(var r=0,i=K(t,n).childNodes.length;r<i;r++){if(!e)throw dt(t,e);e=e.nextSibling}return e}function J(t,e){this.data=t,this.ns=e}function W(t,e){this.expression=t,this.ns=e,this.elementNs=null}function Y(t,e){for(var n=t.get(e,!0);n instanceof D;)n=n.get(e,!0);return n}function X(t,e,n,r,i,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=r,this.selfClosing=i,this.notClosed=o,this.ns=s,this.endTag=et(t,i,o),this.startClose=tt(i);var a=t&&t.toLowerCase();this.unescapedContent="script"===a||"style"===a,this.bindContentToValue="textarea"===a}function Z(t,e,n,r,i,o,s){this.tagName=t,this.attributes=e,this.content=n,this.hooks=r,this.selfClosing=i,this.notClosed=o,this.ns=s,this.startClose=tt(i),this.unescapedContent=!1}function tt(t){return t?" />":">"}function et(t,e,n){var r=t&&t.toLowerCase();return M[r]||e||n?"":"</"+t+">"}function nt(t,e,n){t&&e.queue(function(){for(var r=0,i=t.length;r<i;r++)t[r].emit(e,n)})}function rt(t,e){this.expression=t,this.ending="/"+t,this.content=e}function it(t,e){this.expressions=t,this.beginning=t.join("; "),this.ending="/"+this.beginning,this.contents=e}function ot(t,e,n){this.expression=t,this.ending="/"+t,this.content=e,this.elseContent=n}function st(t,e){for(var n=t.start,r=0;n=n.nextSibling;){if(n===t.end)return n;if(n.$bindItemStart&&n.$bindItemStart.itemFor===t.start){if(e===r)return n;r++}}}function at(t,e,n,r,i,o,s){e?(e.start=r,e.end=i,e.condition=s,pt(e,r,o)):t.addBinding(new xt(n,t,r,i,o,s))}function pt(t,e,n){St(e,n?"$bindItemStart":"$bindStart",t)}function ut(t,e,n){for(var r=0,i=e.length;r<i;r++)e[r].appendTo(t,n)}function ct(t,e,n,r){for(var i=0,o=n.length;i<o;i++){for(;e&&e.hasAttribute&&e.hasAttribute("data-no-attach");)e=e.nextSibling;e=n[i].attachTo(t,e,r)}return e}function ht(t,e,n){for(var r="",i=0,o=t.length;i<o;i++)r+=t[i].get(e,n);return r}function lt(t,e,n,r,i,o){var s=e.parentNode;if(e.$bindItemStart&&r.firstChild&&(St(r.firstChild,"$bindItemStart",e.$bindItemStart),e.$bindItemStart.start=r.firstChild),e===n)return s.replaceChild(r,e),void ft(t,e,i);for(var a,p=o?e.nextSibling:e;p;){if(a=p.nextSibling,ft(t,p,i),o&&p===n){a=n;break}if(s.removeChild(p),p===n)break;p=a}s.insertBefore(r,a||null)}function ft(t,e,n){t.removeNode(e),mt(t,n,e,"$bindNode"),mt(t,n,e,"$bindStart"),mt(t,n,e,"$bindItemStart");var r=e.$bindAttributes;if(r)for(var i in e.$bindAttributes=null,r)t.removeBinding(r[i]);for(e=e.firstChild;e;e=e.nextSibling)ft(t,e,n)}function mt(t,e,n,r){var i=n[r];i&&(n[r]=null,i!==e&&t.removeBinding(i))}function dt(t,e){return"undefined"!=typeof console&&console.error("Attach failed for",e,"within",t),new Error("Attaching bindings failed, because HTML structure does not match client rendering.")}function yt(){this.meta=null}function vt(t,e,n){this.template=t,this.context=e,this.node=n,this.meta=null,St(n,"$bindNode",this)}function gt(){}function wt(t,e,n,r){this.template=t,this.context=e,this.element=n,this.name=r,this.meta=null,(n.$bindAttributes||(n.$bindAttributes=new gt))[r]=this}function xt(t,e,n,r,i,o){this.template=t,this.context=e,this.start=n,this.end=r,this.itemFor=i,this.condition=o,this.meta=null,pt(this,n,i)}function bt(t,e){for(var n in t)e[n]=t[n]}function _t(t){return(t+="").replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"})}function Et(t){return(t+="").replace(/[&"]/g,function(t){return"&"===t?"&amp;":"&quot;"})}function Ct(t,e){return t===e||t instanceof D&&t.equals(e)}function St(t,e,n){return t[e]=n}function At(t){return t}I.CREATE_PROPERTIES=N,I.BOOLEAN_PROPERTIES=L,I.INTEGER_PROPERTIES=O,I.STRING_PROPERTIES=P,I.UPDATE_PROPERTIES=j,I.VOID_ELEMENTS=M,I.NAMESPACE_URIS={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"},I.Template=D,I.Doctype=R,I.Text=B,I.DynamicText=F,I.Comment=$,I.DynamicComment=q,I.Html=H,I.DynamicHtml=G,I.Element=X,I.DynamicElement=Z,I.Block=rt,I.ConditionalBlock=it,I.EachBlock=ot,I.Attribute=J,I.DynamicAttribute=W,I.Binding=yt,I.NodeBinding=vt,I.AttributeBinding=wt,I.RangeBinding=xt,D.prototype.toString=function(){return this.source},D.prototype.get=function(t,e){return ht(this.content,t,e)},D.prototype.getFragment=function(t,e){var n=document.createDocumentFragment();return this.appendTo(n,t,e),n},D.prototype.appendTo=function(t,e){e.pause(),ut(t,this.content,e),e.unpause()},D.prototype.attachTo=function(t,e,n){n.pause();e=ct(t,e,this.content,n);return n.unpause(),e},D.prototype.update=function(){},D.prototype.stringify=function(t){return null==t?"":t+""},D.prototype.equals=function(t){return this===t},D.prototype.module="templates",D.prototype.type="Template",D.prototype.serialize=function(){return T.instance(this,this.content,this.source)},R.prototype=Object.create(D.prototype),R.prototype.constructor=R,R.prototype.get=function(){var t=this.publicId?' PUBLIC "'+this.publicId+'"':"",e=this.systemId?this.publicId?' "'+this.systemId+'"':' SYSTEM "'+this.systemId+'"':"";return"<!DOCTYPE "+this.name+t+e+">"},R.prototype.appendTo=function(){},R.prototype.attachTo=function(t,e){if(!e||10!==e.nodeType)throw dt(t,e);return e.nextSibling},R.prototype.type="Doctype",R.prototype.serialize=function(){return T.instance(this,this.name,this.publicId,this.systemId)},B.prototype=Object.create(D.prototype),B.prototype.constructor=B,B.prototype.get=function(t,e){return e?this.data:this.escaped},B.prototype.appendTo=function(t){var e=document.createTextNode(this.data);t.appendChild(e)},B.prototype.attachTo=function(t,e){return U(t,e,this.data,this)},B.prototype.type="Text",B.prototype.serialize=function(){return T.instance(this,this.data)},F.prototype=Object.create(D.prototype),F.prototype.constructor=F,F.prototype.get=function(t,e){var n=this.expression.get(t);if(n instanceof D){do{n=n.get(t,e)}while(n instanceof D);return n}var r=this.stringify(n);return e?r:_t(r)},F.prototype.appendTo=function(t,e,n){var r=this.expression.get(e);if(r instanceof D){var i=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(e);return t.appendChild(i),r.appendTo(t,e),t.appendChild(o),void at(e,n,this,i,o,null,s)}var a=this.stringify(r),p=document.createTextNode(a);t.appendChild(p),z(this,e,p)},F.prototype.attachTo=function(t,e,n){var r=this.expression.get(n);if(r instanceof D){var i=document.createComment(this.expression),o=document.createComment("/"+this.expression),s=this.getCondition(n);return t.insertBefore(i,e||null),e=r.attachTo(t,e,n),t.insertBefore(o,e||null),at(n,null,this,i,o,null,s),e}return U(t,e,this.stringify(r),this,n)},F.prototype.update=function(t,e){if(e instanceof xt)this._blockUpdate(t,e);else{var n=this.expression.get(t);if(n instanceof D){var r=e.node;if(!r.parentNode)return;lt(t,r,r,this.getFragment(t),e)}else e.node.data=this.stringify(n)}},F.prototype.getCondition=function(t){return this.expression.get(t)},F.prototype.type="DynamicText",F.prototype.serialize=function(){return T.instance(this,this.expression)},$.prototype=Object.create(D.prototype),$.prototype.constructor=$,$.prototype.get=function(){return"\x3c!--"+this.data+"--\x3e"},$.prototype.appendTo=function(t,e){var n=document.createComment(this.data);t.appendChild(n),nt(this.hooks,e,n)},$.prototype.attachTo=function(t,e,n){return V(t,e,this.data,this,n)},$.prototype.type="Comment",$.prototype.serialize=function(){return T.instance(this,this.data,this.hooks)},q.prototype=Object.create(D.prototype),q.prototype.constructor=q,q.prototype.get=function(t){var e=Y(this.expression,t);return"\x3c!--"+this.stringify(e)+"--\x3e"},q.prototype.appendTo=function(t,e){var n=Y(this.expression,e),r=this.stringify(n),i=document.createComment(r);t.appendChild(i),z(this,e,i)},q.prototype.attachTo=function(t,e,n){var r=Y(this.expression,n);return V(t,e,this.stringify(r),this,n)},q.prototype.update=function(t,e){var n=Y(this.expression,t);e.node.data=this.stringify(n)},q.prototype.type="DynamicComment",q.prototype.serialize=function(){return T.instance(this,this.expression,this.hooks)},H.prototype=Object.create(D.prototype),H.prototype.constructor=H,H.prototype.get=function(){return this.data},H.prototype.appendTo=function(t){var e=K(t,this.data);t.appendChild(e)},H.prototype.attachTo=function(t,e){return Q(t,e,this.data)},H.prototype.type="Html",H.prototype.serialize=function(){return T.instance(this,this.data)},G.prototype=Object.create(D.prototype),G.prototype.constructor=G,G.prototype.get=function(t){var e=Y(this.expression,t);return this.stringify(e)},G.prototype.appendTo=function(t,e,n){var r=document.createComment(this.expression),i=document.createComment(this.ending),o=Y(this.expression,e),s=K(t,this.stringify(o));t.appendChild(r),t.appendChild(s),t.appendChild(i),at(e,n,this,r,i)},G.prototype.attachTo=function(t,e,n){var r=document.createComment(this.expression),i=document.createComment(this.ending),o=Y(this.expression,n),s=this.stringify(o);return t.insertBefore(r,e||null),e=Q(t,e,s),t.insertBefore(i,e||null),at(n,null,this,r,i),e},G.prototype.update=function(t,e){var n=e.start.parentNode;if(n){var r=e.start,i=e.end,o=Y(this.expression,t);lt(t,r,i,K(n,this.stringify(o)),e,!0)}},G.prototype.type="DynamicHtml",G.prototype.serialize=function(){return T.instance(this,this.expression)},J.prototype=Object.create(D.prototype),J.prototype.constructor=J,J.prototype.get=J.prototype.getBound=function(t){return this.data},J.prototype.type="Attribute",J.prototype.serialize=function(){return T.instance(this,this.data,this.ns)},W.prototype=Object.create(J.prototype),W.prototype.constructor=W,W.prototype.get=function(t){return Y(this.expression,t)},W.prototype.getBound=function(t,e,n,r){return this.elementNs=r,t.addBinding(new wt(this,t,e,n)),Y(this.expression,t)},W.prototype.update=function(t,e){var n=Y(this.expression,t),r=e.element,i=!this.elementNs&&j[e.name];if(i){var o=P[e.name]?this.stringify(n):n;if(r[i]===o)return;r[i]=o}else!1!==n&&null!=n?(!0===n&&(n=e.name),this.ns?r.setAttributeNS(this.ns,e.name,n):r.setAttribute(e.name,n)):this.ns?r.removeAttributeNS(this.ns,e.name):r.removeAttribute(e.name)},W.prototype.type="DynamicAttribute",W.prototype.serialize=function(){return T.instance(this,this.expression,this.ns)},X.prototype=Object.create(D.prototype),X.prototype.constructor=X,X.prototype.getTagName=function(){return this.tagName},X.prototype.getEndTag=function(){return this.endTag},X.prototype.get=function(t){var e=this.getTagName(t),n=this.getEndTag(e),r=[e];for(var i in this.attributes){var o=this.attributes[i].get(t);!0===o?r.push(i):!1!==o&&null!=o&&r.push(i+'="'+Et(o)+'"')}var s="<"+r.join(" ")+this.startClose;return this.content?s+ht(this.content,t,this.unescapedContent)+n:s+n},X.prototype.appendTo=function(t,e){var n=this.getTagName(e),r=this.ns?document.createElementNS(this.ns,n):document.createElement(n);for(var i in this.attributes){var o=this.attributes[i],s=o.getBound(e,r,i,this.ns);if(!1!==s&&null!=s){var a=!this.ns&&N[i];a?r[a]=s:(!0===s&&(s=i),o.ns?r.setAttributeNS(o.ns,i,s):r.setAttribute(i,s))}}this.content&&(this._bindContent(e,r),ut(r,this.content,e)),t.appendChild(r),nt(this.hooks,e,r)},X.prototype.attachTo=function(t,e,n){var r=this.getTagName(n);if(!e||1!==e.nodeType||e.tagName.toLowerCase()!==r.toLowerCase())throw dt(t,e);for(var i in this.attributes)this.attributes[i].getBound(n,e,i,this.ns);return this.content&&(this._bindContent(n,e),ct(e,e.firstChild,this.content,n)),nt(this.hooks,n,e),e.nextSibling},X.prototype._bindContent=function(t,e){var n=this.bindContentToValue&&1===this.content.length&&this.content[0];if(n instanceof F){n.unbound=!0;var r=new W(n.expression);t.addBinding(new wt(r,t,e,"value"))}},X.prototype.type="Element",X.prototype.serialize=function(){return T.instance(this,this.tagName,this.attributes,this.content,this.hooks,this.selfClosing,this.notClosed,this.ns)},Z.prototype=Object.create(X.prototype),Z.prototype.constructor=Z,Z.prototype.getTagName=function(t){return Y(this.tagName,t)},Z.prototype.getEndTag=function(t){return et(t,this.selfClosing,this.notClosed)},Z.prototype.type="DynamicElement",rt.prototype=Object.create(D.prototype),rt.prototype.constructor=rt,rt.prototype.get=function(t,e){var n=t.child(this.expression);return ht(this.content,n,e)},rt.prototype.appendTo=function(t,e,n){var r=e.child(this.expression),i=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(e);t.appendChild(i),ut(t,this.content,r),t.appendChild(o),at(e,n,this,i,o,null,s)},rt.prototype.attachTo=function(t,e,n){var r=n.child(this.expression),i=document.createComment(this.expression),o=document.createComment(this.ending),s=this.getCondition(n);return t.insertBefore(i,e||null),e=ct(t,e,this.content,r),t.insertBefore(o,e||null),at(n,null,this,i,o,null,s),e},rt.prototype.type="Block",rt.prototype.serialize=function(){return T.instance(this,this.expression,this.content)},rt.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!Ct(n,e.condition))e.condition=n,lt(t,e.start,e.end,this.getFragment(t,e),e)}},rt.prototype.getCondition=function(t){var e=this.expression.get(t);return"object"==typeof e?NaN:e},F.prototype._blockUpdate=rt.prototype.update,it.prototype=Object.create(rt.prototype),it.prototype.constructor=it,it.prototype.get=function(t,e){var n=this.getCondition(t);if(null==n)return"";var r=this.expressions[n],i=t.child(r);return ht(this.contents[n],i,e)},it.prototype.appendTo=function(t,e,n){var r=document.createComment(this.beginning),i=document.createComment(this.ending);t.appendChild(r);var o=this.getCondition(e);if(null!=o){var s=this.expressions[o],a=e.child(s);ut(t,this.contents[o],a)}t.appendChild(i),at(e,n,this,r,i,null,o)},it.prototype.attachTo=function(t,e,n){var r=document.createComment(this.beginning),i=document.createComment(this.ending);t.insertBefore(r,e||null);var o=this.getCondition(n);if(null!=o){var s=this.expressions[o],a=n.child(s);e=ct(t,e,this.contents[o],a)}return t.insertBefore(i,e||null),at(n,null,this,r,i,null,o),e},it.prototype.type="ConditionalBlock",it.prototype.serialize=function(){return T.instance(this,this.expressions,this.contents)},it.prototype.update=function(t,e){if(e.start.parentNode){var n=this.getCondition(t);if(!Ct(n,e.condition))e.condition=n,lt(t,e.start,e.end,this.getFragment(t,e),e)}},it.prototype.getCondition=function(t){for(var e=0,n=this.expressions.length;e<n;e++)if(this.expressions[e].truthy(t))return e},ot.prototype=Object.create(rt.prototype),ot.prototype.constructor=ot,ot.prototype.get=function(t,e){var n=this.expression.get(t);if(n&&n.length){for(var r="",i=0,o=n.length;i<o;i++){var s=t.eachChild(this.expression,i);r+=ht(this.content,s,e)}return r}return this.elseContent?ht(this.elseContent,t,e):""},ot.prototype.appendTo=function(t,e,n){var r=this.expression.get(e),i=document.createComment(this.expression),o=document.createComment(this.ending);if(t.appendChild(i),r&&r.length)for(var s=0,a=r.length;s<a;s++){var p=e.eachChild(this.expression,s);this.appendItemTo(t,p,i)}else this.elseContent&&ut(t,this.elseContent,e);t.appendChild(o),at(e,n,this,i,o)},ot.prototype.appendItemTo=function(t,e,n,r){var i,o,s=t.lastChild;ut(t,this.content,e),s===t.lastChild?(i=o=document.createComment("empty"),t.appendChild(i)):(i=s&&s.nextSibling||t.firstChild,o=t.lastChild),at(e,r,this,i,o,n)},ot.prototype.attachTo=function(t,e,n){var r=this.expression.get(n),i=document.createComment(this.expression),o=document.createComment(this.ending);if(t.insertBefore(i,e||null),r&&r.length)for(var s=0,a=r.length;s<a;s++){var p=n.eachChild(this.expression,s);e=this.attachItemTo(t,e,p,i)}else this.elseContent&&(e=ct(t,e,this.elseContent,n));return t.insertBefore(o,e||null),at(n,null,this,i,o),e},ot.prototype.attachItemTo=function(t,e,n,r){var i,o,s=e&&e.previousSibling,a=ct(t,e,this.content,n);return a===e?(i=o=document.createComment("empty"),t.insertBefore(i,e||null)):(i=s&&s.nextSibling||t.firstChild,o=a&&a.previousSibling||t.lastChild),at(n,null,this,i,o,r),a},ot.prototype.update=function(t,e){if(e.start.parentNode){var n=e.start,r=e.end;if(e.itemFor){var i=document.createDocumentFragment();this.appendItemTo(i,t,e.itemFor,e)}else i=this.getFragment(t,e);lt(t,n,r,i,e)}},ot.prototype.insert=function(t,e,n,r){var i=e.start.parentNode;if(i){if(0===n&&this.expression.get(t).length===r)return this.update(t,e);for(var o=st(e,n),s=document.createDocumentFragment(),a=n,p=n+r;a<p;a++){var u=t.eachChild(this.expression,a);this.appendItemTo(s,u,e.start)}i.insertBefore(s,o||null)}},ot.prototype.remove=function(t,e,n,r){var i=e.start.parentNode;if(i){if(0===n&&0===this.expression.get(t).length)return this.update(t,e);for(var o=st(e,n),s=0;o;){if(o===e.end)return;if(o.$bindItemStart&&o.$bindItemStart.itemFor===e.start&&r===s++)return;var a=o.nextSibling;i.removeChild(o),ft(t,o,e),o=a}}},ot.prototype.move=function(t,e,n,r,i){var o=e.start.parentNode;if(o){for(var s=st(e,n),a=document.createDocumentFragment(),p=0;s&&s!==e.end&&(!s.$bindItemStart||s.$bindItemStart.itemFor!==e.start||i!==p++);){var u=s.nextSibling;a.appendChild(s),s=u}s=st(e,r),o.insertBefore(a,s||null)}},ot.prototype.type="EachBlock",ot.prototype.serialize=function(){return T.instance(this,this.expression,this.content,this.elseContent)},yt.prototype.type="Binding",yt.prototype.update=function(){this.context.pause(),this.template.update(this.context,this),this.context.unpause()},yt.prototype.insert=function(){this.update()},yt.prototype.remove=function(){this.update()},yt.prototype.move=function(){this.update()},vt.prototype=Object.create(yt.prototype),vt.prototype.constructor=vt,vt.prototype.type="NodeBinding",wt.prototype=Object.create(yt.prototype),wt.prototype.constructor=wt,wt.prototype.type="AttributeBinding",xt.prototype=Object.create(yt.prototype),xt.prototype.constructor=xt,xt.prototype.type="RangeBinding",xt.prototype.insert=function(t,e){this.context.pause(),this.template.insert?this.template.insert(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},xt.prototype.remove=function(t,e){this.context.pause(),this.template.remove?this.template.remove(this.context,this,t,e):this.template.update(this.context,this),this.context.unpause()},xt.prototype.move=function(t,e,n){this.context.pause(),this.template.move?this.template.move(this.context,this,t,e,n):this.template.update(this.context,this),this.context.unpause()},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),function(){if("undefined"!=typeof document){var t=document.createElement("div");t.innerHTML="\r\n<br>\n";var e=t.firstChild.data.length,n=t.lastChild.data.length;1===e&&1===n?At=function(t){return t.replace(/\r\n/g,"\n")}:2===e&&2===n&&(At=function(t){return t.replace(/(^|[^\r])(\n+)/g,function(t,e,n){for(var r=n.length;r--;)e+="\r\n";return e})});var r=document.createElement("input");r.defaultValue="x","x"!==r.value&&(N.value="value");try{document.createTextNode("").$try=0}catch(t){St=function(t,e,n){if(3===t.nodeType){var r=t.previousSibling;return r&&r.$bindProxy===t||((r=document.createComment("proxy")).$bindProxy=t,t.parentNode.insertBefore(r,t||null)),r[e]=n}return t[e]=n}}}}();var kt={concat:function(t,e){return t?e?t.concat(e):t:e},hasKeys:function(t){if(!t)return!1;for(var e in t)return!0;return!1},traverseAndCreate:function(t,e){var n=e.length;if(!n)return t;for(var r=0;r<n;r++){var i=e[r];t=t[i]||(t[i]={})}return t}},It={};(function(t){var n=r({}),i=e({}),o=i.Template,s=kt.concat;function a(t,e){if(!t)return e;for(var n=0,r=t.length;n<r;n++){if(null==e)return e;e=e[t[n]]}return e}function p(t){return Array.isArray(t)?t.length>0:!!t}function u(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e[n]="object"==typeof r?r.item:r}return e}function c(t,e){return"object"!=typeof t?t:t instanceof o?h(t,e):Array.isArray(t)?function(t,e){for(var n=0;n<t.length;n++)if(l(t[n]))return f(t,e);return t}(t,e):function(t,e){return l(t)?function(t,e){var n={};for(var r in t)n[r]=c(t[r],e);return n}(t,e):t}(t,e)}function h(t,e){for(var n=1e3;t instanceof o;){if(--n<0)throw new Error("Maximum template render passes exceeded");t=t.get(e,!0)}return t}function l(t){if(!t)return!1;if(t.constructor!==Object)return!1;for(var e in t)if(t[e]instanceof o)return!0;return!1}function f(t,e){for(var n=new Array(t.length),r=0;r<t.length;r++)n[r]=c(t[r],e);return n}function m(t,e,n,r,i,o,s,a){this.source=t,this.blockType=e,this.isEnd=n,this.as=r,this.keyAs=i,this.unescaped=o,this.bindType=s,this.valueType=a}function d(t){this.meta=t}function y(t,e){this.value=t,this.meta=e}function v(t,e){this.segments=t,this.meta=e}function g(t,e){this.segments=t,this.meta=e}function w(t,e,n){this.alias=t,this.segments=e,this.meta=n}function x(t,e,n){this.attribute=t,this.segments=e,this.meta=n}function b(t,e,n,r){this.before=t,this.inside=e,this.afterSegments=n,this.meta=r}function _(t,e){if(!(t instanceof o))throw new Error("DeferRenderExpression requires a Template argument");this.template=t,this.meta=e}function E(t,e,n){this.items=t,this.afterSegments=e,this.meta=n}function C(t,e,n){this.properties=t,this.afterSegments=e,this.meta=n}function S(t,e,n,r){this.segments=t,this.args=e,this.afterSegments=n,this.meta=r;var i=t&&t.slice();this.lastSegment=i&&i.pop(),this.parentSegments=i&&i.length?i:null}function A(t,e,n,r){S.call(this,t,e,n,r)}function I(t,e,n,r){this.name=t,this.args=e,this.afterSegments=n,this.meta=r,this.getFn=k.get[t],this.setFn=k.set[t]}function T(t,e,n){this.args=t,this.afterSegments=e,this.meta=n}function L(t,e){this.expression=t,this.meta=e}function O(t,e){this.expression=t,this.meta=e}function P(t,e,n){if(t instanceof d||t instanceof o)return t.dependencies(e,n)}function j(t,e,n){var r=e.resolve(n);return r?t?(t.push(r),t):[r]:t}function N(t,e,n){if(!e.segments.length)return t;var r=e.resolve(n);return r?t?(t.pop(),t.push(r),t):[r]:t}It.lookup=a,It.templateTruthy=p,It.pathSegments=u,It.renderValue=c,It.renderTemplate=h,It.ExpressionMeta=m,It.Expression=d,It.LiteralExpression=y,It.PathExpression=v,It.RelativePathExpression=g,It.AliasPathExpression=w,It.AttributePathExpression=x,It.BracketsExpression=b,It.DeferRenderExpression=_,It.ArrayExpression=E,It.ObjectExpression=C,It.FnExpression=S,It.OperatorExpression=I,It.NewExpression=A,It.SequenceExpression=T,It.ViewParentExpression=L,It.ScopedModelExpression=O,m.prototype.module="expressions",m.prototype.type="ExpressionMeta",m.prototype.serialize=function(){return n.instance(this,this.source,this.blockType,this.isEnd,this.as,this.keyAs,this.unescaped,this.bindType,this.valueType)},d.prototype.module="expressions",d.prototype.type="Expression",d.prototype.serialize=function(){return n.instance(this,this.meta)},d.prototype.toString=function(){return this.meta&&this.meta.source},d.prototype.truthy=function(t){var e=this.meta.blockType;if("else"===e)return!0;var n=p(this.get(t,!0));return"unless"===e?!n:n},d.prototype.get=function(){},d.prototype.resolve=function(){},d.prototype.dependencies=function(){},d.prototype.pathSegments=function(t){var e=this.resolve(t);return e&&u(e)},d.prototype.set=function(t,e){var n=this.pathSegments(t);if(!n)throw new Error("Expression does not support setting");t.controller.model._set(n,e)},d.prototype._resolvePatch=function(t,e){return t&&t.expression===this&&null!=t.item?e.concat(t):e},d.prototype.isUnbound=function(t){var e=this.meta&&this.meta.bindType;return"unbound"===e||"bound"!==e&&t.unbound},d.prototype._lookupAndContextifyValue=function(t,e){return this.segments&&this.segments.length&&(t=h(t,e),t=a(this.segments,t)),t instanceof o&&!(t instanceof i.ContextClosure)&&(t=new i.ContextClosure(t,e)),t},y.prototype=Object.create(d.prototype),y.prototype.constructor=y,y.prototype.type="LiteralExpression",y.prototype.serialize=function(){return n.instance(this,this.value,this.meta)},y.prototype.get=function(){return this.value},v.prototype=Object.create(d.prototype),v.prototype.constructor=v,v.prototype.type="PathExpression",v.prototype.serialize=function(){return n.instance(this,this.segments,this.meta)},v.prototype.get=function(t){if(t.controller)return a(this.segments,t.controller.model.data)},v.prototype.resolve=function(t){if(t.controller){var e=s(t.controller._scope,this.segments);return this._resolvePatch(t,e)}},v.prototype.dependencies=function(t,e){if(t.controller)return j(P(a(this.segments,t.controller.model.data),t,e),this,t)},g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.type="RelativePathExpression",g.prototype.serialize=function(){return n.instance(this,this.segments,this.meta)},g.prototype.get=function(t){var e=t.forRelative(this),n=e.get();return this._lookupAndContextifyValue(n,e)},g.prototype.resolve=function(t){var e=t.forRelative(this),n=e.expression?e.expression.resolve(e):[];if(n){var r=n.concat(this.segments);return this._resolvePatch(t,r)}},g.prototype.dependencies=function(t,e){var n=t.forRelative(this);return N(n.expression&&n.expression.dependencies(n,e),this,t)},w.prototype=Object.create(d.prototype),w.prototype.constructor=w,w.prototype.type="AliasPathExpression",w.prototype.serialize=function(){return n.instance(this,this.alias,this.segments,this.meta)},w.prototype.get=function(t){var e=t.forAlias(this.alias);if(e){if(e.keyAlias===this.alias)return e.item;var n=e.get();return this._lookupAndContextifyValue(n,e)}},w.prototype.resolve=function(t){var e=t.forAlias(this.alias);if(e&&e.keyAlias!==this.alias){var n=e.expression.resolve(e);if(n){var r=n.concat(this.segments);return this._resolvePatch(t,r)}}},w.prototype.dependencies=function(t,e){var n=t.forAlias(this.alias);if(n){if(n.keyAlias===this.alias){var r=n.expression.resolve(n.parent);if(!r)return;return[r]}return N(n.expression.dependencies(n,e),this,t)}},x.prototype=Object.create(d.prototype),x.prototype.constructor=x,x.prototype.type="AttributePathExpression",x.prototype.serialize=function(){return n.instance(this,this.attribute,this.segments,this.meta)},x.prototype.get=function(t){var e=t.forAttribute(this.attribute);if(e){var n=e.attributes[this.attribute];return n instanceof d&&(n=n.get(e)),this._lookupAndContextifyValue(n,e)}},x.prototype.resolve=function(t){var e=t.forAttribute(this.attribute);if(e){var n,r=e.attributes[this.attribute];if((r instanceof d||r instanceof o)&&(n=r.resolve(e)),n){var i=n.concat(this.segments);return this._resolvePatch(t,i)}}},x.prototype.dependencies=function(t,e){var n=t.forAttribute(this.attribute);if(n)return N(P(n.attributes[this.attribute],n,e),this,t)},b.prototype=Object.create(d.prototype),b.prototype.constructor=b,b.prototype.type="BracketsExpression",b.prototype.serialize=function(){return n.instance(this,this.before,this.inside,this.afterSegments,this.meta)},b.prototype.get=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.get(t);if(n){var r=n[e];return this.afterSegments?a(this.afterSegments,r):r}}},b.prototype.resolve=function(t){var e=this.inside.get(t);if(null!=e){var n=this.before.resolve(t);if(n){var r=this.afterSegments?n.concat(e,this.afterSegments):n.concat(e);return this._resolvePatch(t,r)}}},b.prototype.dependencies=function(t,e){var n=this.before.dependencies(t,e);n&&n.pop();var r=this.inside.dependencies(t,e);return j(s(n,r),this,t)},_.prototype=Object.create(d.prototype),_.prototype.constructor=_,_.prototype.type="DeferRenderExpression",_.prototype.serialize=function(){return n.instance(this,this.template,this.meta)},_.prototype.get=function(t){return new i.ContextClosure(this.template,t)},E.prototype=Object.create(d.prototype),E.prototype.constructor=E,E.prototype.type="ArrayExpression",E.prototype.serialize=function(){return n.instance(this,this.items,this.afterSegments,this.meta)},E.prototype.get=function(t){for(var e=new Array(this.items.length),n=0;n<this.items.length;n++){var r=this.items[n].get(t);e[n]=r}return this.afterSegments?a(this.afterSegments,e):e},E.prototype.dependencies=function(t,e){if(this.items){for(var n,r=0;r<this.items.length;r++){var i=this.items[r].dependencies(t,e);n=s(n,i)}return n}},C.prototype=Object.create(d.prototype),C.prototype.constructor=C,C.prototype.type="ObjectExpression",C.prototype.serialize=function(){return n.instance(this,this.properties,this.afterSegments,this.meta)},C.prototype.get=function(t){var e={};for(var n in this.properties){var r=this.properties[n].get(t);e[n]=r}return this.afterSegments?a(this.afterSegments,e):e},C.prototype.dependencies=function(t,e){if(this.properties){var n;for(var r in this.properties){var i=this.properties[r].dependencies(t,e);n=s(n,i)}return n}},S.prototype=Object.create(d.prototype),S.prototype.constructor=S,S.prototype.type="FnExpression",S.prototype.serialize=function(){return n.instance(this,this.segments,this.args,this.afterSegments,this.meta)},S.prototype.get=function(t){var e=this.apply(t);return this.afterSegments?a(this.afterSegments,e):e},S.prototype.apply=function(t,e){if(t.controller){var n=this._lookupParent(t),r=n[this.lastSegment],i=r.get||r;return this._applyFn(i,t,e,n)}},S.prototype._lookupParent=function(e){var n=e.controller,r=this.parentSegments,i=r?a(r,n):n;if(i&&i[this.lastSegment])return i;var o=n.page;if(n!==o&&(i=r?a(r,o):o)&&i[this.lastSegment])return i;if((i=r?a(r,t):t)&&i[this.lastSegment])return i;throw new Error("Function not found for: "+this.segments.join("."))},S.prototype._getInputs=function(t){for(var e=[],n=0,r=this.args.length;n<r;n++){var i=this.args[n].get(t);e.push(c(i,t))}return e},S.prototype._applyFn=function(t,e,n,r){if(!this.args)return n?t.apply(r,n):t.call(r);var i=this._getInputs(e);if(n)for(var o=0,s=n.length;o<s;o++)i.push(n[o]);return t.apply(r,i)},S.prototype.dependencies=function(t,e){var n=[];if(!this.args)return n;for(var r=0,i=this.args.length;r<i;r++){var o=this.args[r].dependencies(t,e);if(o&&!(o.length<1)){for(var s=o.length-1,a=0;a<s;a++)n.push(o[a]);var p=o[s];"*"!==p[p.length-1]&&(p=p.concat("*")),n.push(p)}}return n},S.prototype.set=function(t,e){for(var n,r,i=t.controller;i&&!(n=(r=this.parentSegments?a(this.parentSegments,i):i)&&r[this.lastSegment]);)i=i.parent;var o=n&&n.set;if(!o)throw new Error("No setter function for: "+this.segments.join("."));var s=this._getInputs(t);s.unshift(e);var p=o.apply(r,s);for(var u in p)this.args[u].set(t,p[u])},A.prototype=Object.create(S.prototype),A.prototype.constructor=A,A.prototype.type="NewExpression",A.prototype._applyFn=function(t,e){if(!this.args)return new t;var n=this._getInputs(e);return n.unshift(null),new(t.bind.apply(t,n))},I.prototype=Object.create(S.prototype),I.prototype.constructor=I,I.prototype.type="OperatorExpression",I.prototype.serialize=function(){return n.instance(this,this.name,this.args,this.afterSegments,this.meta)},I.prototype.apply=function(t){var e=this._getInputs(t);return this.getFn.apply(null,e)},I.prototype.set=function(t,e){var n=this._getInputs(t);n.unshift(e);var r=this.setFn.apply(null,n);for(var i in r)this.args[i].set(t,r[i])},T.prototype=Object.create(I.prototype),T.prototype.constructor=T,T.prototype.type="SequenceExpression",T.prototype.serialize=function(){return n.instance(this,this.args,this.afterSegments,this.meta)},T.prototype.name=",",T.prototype.getFn=k.get[","],T.prototype.resolve=function(t){return this.args[this.args.length-1].resolve(t)},T.prototype.dependencies=function(t,e){for(var n=[],r=0,i=this.args.length;r<i;r++)for(var o=this.args[r].dependencies(t,e),s=0,a=o.length;s<a;s++)n.push(o[s]);return n},L.prototype=Object.create(d.prototype),L.prototype.constructor=L,L.prototype.type="ViewParentExpression",L.prototype.serialize=function(){return n.instance(this,this.expression,this.meta)},L.prototype.get=function(t){var e=t.forViewParent();return this.expression.get(e)},L.prototype.resolve=function(t){var e=t.forViewParent();return this.expression.resolve(e)},L.prototype.dependencies=function(t,e){var n=t.forViewParent();return this.expression.dependencies(n,e)},L.prototype.pathSegments=function(t){var e=t.forViewParent();return this.expression.pathSegments(e)},L.prototype.set=function(t,e){var n=t.forViewParent();return this.expression.set(n,e)},O.prototype=Object.create(d.prototype),O.prototype.constructor=O,O.prototype.type="ScopedModelExpression",O.prototype.serialize=function(){return n.instance(this,this.expression,this.meta)},O.prototype.get=function(t){var e=this.pathSegments(t);if(e)return t.controller.model.scope(e.join("."))},O.prototype.resolve=function(t){return this.expression.resolve(t)},O.prototype.dependencies=function(t,e){return this.expression.dependencies(t,e)},O.prototype.pathSegments=function(t){return this.expression.pathSegments(t)},O.prototype.set=function(t,e){return this.expression.set(t,e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Tt={};Tt.contexts=C,Tt.expressions=It,Tt.operatorFns=k,Tt.options=n({}),Tt.templates=e({});var Lt={};!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["exports"],e):e(void 0!==Lt?Lt:t.esprima={})}(this,function(t){"use strict";var e,n,r,i,o,s,a,p,u,c,h,l,f,m,d,y,v,g;function w(t,e){if(!t)throw new Error("ASSERT: "+e)}function x(t){return t>=48&&t<=57}function b(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function _(t){return"01234567".indexOf(t)>=0}function E(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function C(t){return 10===t||13===t||8232===t||8233===t}function S(t){return 36===t||95===t||64===t||35===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&a.NonAsciiIdentifierStart.test(String.fromCharCode(t))}function A(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&a.NonAsciiIdentifierPart.test(String.fromCharCode(t))}function k(t,e,n,r,i){var o,s;w("number"==typeof n,"Comment must have valid position"),v.lastCommentStart>=n||(v.lastCommentStart=n,o={type:t,value:e},g.range&&(o.range=[n,r]),g.loc&&(o.loc=i),g.comments.push(o),g.attachComment&&(s={comment:o,leading:null,trailing:null,range:[n,r]},g.pendingComments.push(s)))}function I(){var t,e,n,r;for(t=h-2,e={start:{line:l,column:h-f-2}};h<m;)if(n=u.charCodeAt(h),++h,C(n))return g.comments&&(r=u.slice(t+2,h-1),e.end={line:l,column:h-f-1},k("Line",r,t,h-1,e)),13===n&&10===u.charCodeAt(h)&&++h,++l,void(f=h);g.comments&&(r=u.slice(t+2,h),e.end={line:l,column:h-f},k("Line",r,t,h,e))}function T(){var t,e,n,r;for(g.comments&&(t=h-2,e={start:{line:l,column:h-f-2}});h<m;)if(C(n=u.charCodeAt(h)))13===n&&10===u.charCodeAt(h+1)&&++h,++l,f=++h,h>=m&&q({},s.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===u.charCodeAt(h+1))return++h,++h,void(g.comments&&(r=u.slice(t+2,h-2),e.end={line:l,column:h-f},k("Block",r,t,h,e)));++h}else++h;q({},s.UnexpectedToken,"ILLEGAL")}function L(){var t,e;for(e=0===h;h<m;)if(E(t=u.charCodeAt(h)))++h;else if(C(t))++h,13===t&&10===u.charCodeAt(h)&&++h,++l,f=h,e=!0;else if(47===t)if(47===(t=u.charCodeAt(h+1)))++h,++h,I(),e=!0;else{if(42!==t)break;++h,++h,T()}else if(e&&45===t){if(45!==u.charCodeAt(h+1)||62!==u.charCodeAt(h+2))break;h+=3,I()}else{if(60!==t)break;if("!--"!==u.slice(h+1,h+4))break;++h,++h,++h,++h,I()}}function O(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e){if(!(h<m&&b(u[h])))return"";r=u[h++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(i)}function P(){var t,e;for(t=u.charCodeAt(h++),e=String.fromCharCode(t),92===t&&(117!==u.charCodeAt(h)&&q({},s.UnexpectedToken,"ILLEGAL"),++h,(t=O("u"))&&"\\"!==t&&S(t.charCodeAt(0))||q({},s.UnexpectedToken,"ILLEGAL"),e=t);h<m&&A(t=u.charCodeAt(h));)++h,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==u.charCodeAt(h)&&q({},s.UnexpectedToken,"ILLEGAL"),++h,(t=O("u"))&&"\\"!==t&&A(t.charCodeAt(0))||q({},s.UnexpectedToken,"ILLEGAL"),e+=t);return e}function j(){var t,n;return t=h,{type:1===(n=92===u.charCodeAt(h)?P():function(){var t,e;for(t=h++;h<m;){if(92===(e=u.charCodeAt(h)))return h=t,P();if(!A(e))break;++h}return u.slice(t,h)}()).length?e.Identifier:function(t){return"this"===t||"typeof"===t||"instanceof"===t||"in"===t||"new"===t}(n)?e.Keyword:"undefined"===n?e.Undefined:"null"===n?e.NullLiteral:"true"===n||"false"===n?e.BooleanLiteral:e.Identifier,value:n,lineNumber:l,lineStart:f,range:[t,h]}}function N(){var t,n,r,i,o=h,a=u.charCodeAt(h),p=u[h];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++h,g.tokenize&&(40===a?g.openParenToken=g.tokens.length:123===a&&(g.openCurlyToken=g.tokens.length)),{type:e.Punctuator,value:String.fromCharCode(a),lineNumber:l,lineStart:f,range:[o,h]};default:if(61===(t=u.charCodeAt(h+1)))switch(a){case 37:case 38:case 42:case 43:case 45:case 47:case 60:case 62:case 94:case 124:return h+=2,{type:e.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(t),lineNumber:l,lineStart:f,range:[o,h]};case 33:case 61:return h+=2,61===u.charCodeAt(h)&&++h,{type:e.Punctuator,value:u.slice(o,h),lineNumber:l,lineStart:f,range:[o,h]}}}return n=u[h+1],r=u[h+2],i=u[h+3],">"===p&&">"===n&&">"===r&&"="===i?(h+=4,{type:e.Punctuator,value:">>>=",lineNumber:l,lineStart:f,range:[o,h]}):">"===p&&">"===n&&">"===r?(h+=3,{type:e.Punctuator,value:">>>",lineNumber:l,lineStart:f,range:[o,h]}):"<"===p&&"<"===n&&"="===r?(h+=3,{type:e.Punctuator,value:"<<=",lineNumber:l,lineStart:f,range:[o,h]}):">"===p&&">"===n&&"="===r?(h+=3,{type:e.Punctuator,value:">>=",lineNumber:l,lineStart:f,range:[o,h]}):p===n&&"+-<>&|".indexOf(p)>=0?(h+=2,{type:e.Punctuator,value:p+n,lineNumber:l,lineStart:f,range:[o,h]}):"<>=!+-*%&|^/".indexOf(p)>=0?(++h,{type:e.Punctuator,value:p,lineNumber:l,lineStart:f,range:[o,h]}):void q({},s.UnexpectedToken,"ILLEGAL")}function M(){var t,n,r;if(w(x((r=u[h]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=h,t="","."!==r){if(t=u[h++],r=u[h],"0"===t){if("x"===r||"X"===r)return++h,function(t){for(var n="";h<m&&b(u[h]);)n+=u[h++];return 0===n.length&&q({},s.UnexpectedToken,"ILLEGAL"),S(u.charCodeAt(h))&&q({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:l,lineStart:f,range:[t,h]}}(n);if(_(r))return function(t){for(var n="0"+u[h++];h<m&&_(u[h]);)n+=u[h++];return(S(u.charCodeAt(h))||x(u.charCodeAt(h)))&&q({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:l,lineStart:f,range:[t,h]}}(n);r&&x(r.charCodeAt(0))&&q({},s.UnexpectedToken,"ILLEGAL")}for(;x(u.charCodeAt(h));)t+=u[h++];r=u[h]}if("."===r){for(t+=u[h++];x(u.charCodeAt(h));)t+=u[h++];r=u[h]}if("e"===r||"E"===r)if(t+=u[h++],"+"!==(r=u[h])&&"-"!==r||(t+=u[h++]),x(u.charCodeAt(h)))for(;x(u.charCodeAt(h));)t+=u[h++];else q({},s.UnexpectedToken,"ILLEGAL");return S(u.charCodeAt(h))&&q({},s.UnexpectedToken,"ILLEGAL"),{type:e.NumericLiteral,value:parseFloat(t),lineNumber:l,lineStart:f,range:[n,h]}}function D(){var t,n,r,i,o,a,p,c=!1,d=!1;for(y=null,L(),r=h,w("/"===(n=u[h]),"Regular expression literal must start with a slash"),t=u[h++];h<m;)if(t+=n=u[h++],"\\"===n)C((n=u[h++]).charCodeAt(0))&&q({},s.UnterminatedRegExp),t+=n;else if(C(n.charCodeAt(0)))q({},s.UnterminatedRegExp);else if(c)"]"===n&&(c=!1);else{if("/"===n){d=!0;break}"["===n&&(c=!0)}for(d||q({},s.UnterminatedRegExp),i=t.substr(1,t.length-2),o="";h<m&&A((n=u[h]).charCodeAt(0));)if(++h,"\\"===n&&h<m)if("u"===(n=u[h]))if(p=++h,n=O("u"))for(o+=n,t+="\\u";p<h;++p)t+=u[p];else h=p,o+="u",t+="\\u";else t+="\\";else o+=n,t+=n;try{a=new RegExp(i,o)}catch(t){q({},s.InvalidRegExp)}return g.tokenize?{type:e.RegularExpression,value:a,lineNumber:l,lineStart:f,range:[r,h]}:{literal:t,value:a,range:[r,h]}}function R(){var t,e,n,r;return L(),t=h,e={start:{line:l,column:h-f}},n=D(),e.end={line:l,column:h-f},g.tokenize||(g.tokens.length>0&&(r=g.tokens[g.tokens.length-1]).range[0]===t&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||g.tokens.pop()),g.tokens.push({type:"RegularExpression",value:n.literal,range:[t,h],loc:e})),n}function B(){var t;return L(),h>=m?{type:e.EOF,lineNumber:l,lineStart:f,range:[h,h]}:40===(t=u.charCodeAt(h))||41===t||58===t?N():39===t||34===t?function(){var t,n,r,i,o,a,p="",c=!1;for(w("'"===(t=u[h])||'"'===t,"String literal must starts with a quote"),n=h,++h;h<m;){if((r=u[h++])===t){t="";break}if("\\"===r)if((r=u[h++])&&C(r.charCodeAt(0)))++l,"\r"===r&&"\n"===u[h]&&++h;else switch(r){case"n":p+="\n";break;case"r":p+="\r";break;case"t":p+="\t";break;case"u":case"x":a=h,(o=O(r))?p+=o:(h=a,p+=r);break;case"b":p+="\b";break;case"f":p+="\f";break;case"v":p+="\v";break;default:_(r)?(0!==(i="01234567".indexOf(r))&&(c=!0),h<m&&_(u[h])&&(c=!0,i=8*i+"01234567".indexOf(u[h++]),"0123".indexOf(r)>=0&&h<m&&_(u[h])&&(i=8*i+"01234567".indexOf(u[h++]))),p+=String.fromCharCode(i)):p+=r}else{if(C(r.charCodeAt(0)))break;p+=r}}return""!==t&&q({},s.UnexpectedToken,"ILLEGAL"),{type:e.StringLiteral,value:p,octal:c,lineNumber:l,lineStart:f,range:[n,h]}}():S(t)?j():46===t?x(u.charCodeAt(h+1))?M():N():x(t)?M():g.tokenize&&47===t?function(){var t,e;if(!(t=g.tokens[g.tokens.length-1]))return R();if("Punctuator"===t.type){if(")"===t.value)return!(e=g.tokens[g.openParenToken-1])||"Keyword"!==e.type||"if"!==e.value&&"while"!==e.value&&"for"!==e.value&&"with"!==e.value?N():R();if("}"===t.value){if(g.tokens[g.openCurlyToken-3]&&"Keyword"===g.tokens[g.openCurlyToken-3].type){if(!(e=g.tokens[g.openCurlyToken-4]))return N()}else{if(!g.tokens[g.openCurlyToken-4]||"Keyword"!==g.tokens[g.openCurlyToken-4].type)return N();if(!(e=g.tokens[g.openCurlyToken-5]))return R()}return r.indexOf(e.value)>=0?N():R()}return R()}return"Keyword"===t.type?R():N()}():N()}function F(){var t,r,i,o;return L(),h,t={start:{line:l,column:h-f}},r=B(),t.end={line:l,column:h-f},r.type!==e.EOF&&(i=[r.range[0],r.range[1]],o=u.slice(r.range[0],r.range[1]),g.tokens.push({type:n[r.type],value:o,range:i,loc:t})),r}function U(){var t;return h=(t=y).range[1],l=t.lineNumber,f=t.lineStart,y=void 0!==g.tokens?F():B(),h=t.range[1],l=t.lineNumber,f=t.lineStart,t}function $(){var t,e,n;t=h,e=l,n=f,y=void 0!==g.tokens?F():B(),h=t,l=e,f=n}function q(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,function(t,e){return w(e<r.length,"Message reference must be in range"),r[e]});throw"number"==typeof t.lineNumber?((n=new Error("Line "+t.lineNumber+": "+i)).index=t.range[0],n.lineNumber=t.lineNumber,n.column=t.range[0]-f+1):((n=new Error("Line "+l+": "+i)).index=h,n.lineNumber=l,n.column=h-f+1),n.description=i,n}function V(){try{q.apply(null,arguments)}catch(t){if(!g.errors)throw t;g.errors.push(t)}}function z(t){if(t.type===e.EOF&&q(t,s.UnexpectedEOS),t.type===e.NumericLiteral&&q(t,s.UnexpectedNumber),t.type===e.StringLiteral&&q(t,s.UnexpectedString),t.type===e.Identifier&&q(t,s.UnexpectedIdentifier),t.type===e.Keyword){if(t.value,c&&(t.value,0))return void V(t,s.StrictReservedWord);q(t,s.UnexpectedToken,t.value)}q(t,s.UnexpectedToken,t.value)}function H(t){var n=U();n.type===e.Punctuator&&n.value===t||z(n)}function G(t){return y.type===e.Punctuator&&y.value===t}function K(t){return y.type===e.Keyword&&y.value===t}function Q(t){return t.type===i.Identifier||t.type===i.MemberExpression}function J(t,e){var n,r;return n=c,L(),d.markStart(),r=parseFunctionSourceElements(),e&&c&&(t[0].name,0)&&V(e,s.StrictParamName),c=n,d.markEnd(d.createFunctionExpression(null,t,[],r))}function W(){var t;return L(),d.markStart(),(t=U()).type===e.StringLiteral||t.type===e.NumericLiteral?(c&&t.octal&&V(t,s.StrictOctalLiteral),d.markEnd(d.createLiteral(t))):d.markEnd(d.createIdentifier(t.value))}function Y(){var t,n,r,i,o;return t=y,L(),d.markStart(),t.type===e.Identifier?(r=W(),"get"!==t.value||G(":")?"set"!==t.value||G(":")?(H(":"),i=pt(),d.markEnd(d.createProperty("init",r,i))):(n=W(),H("("),(t=y).type!==e.Identifier?(H(")"),V(t,s.UnexpectedToken,t.value),i=J([])):(o=[parseVariableIdentifier()],H(")"),i=J(o,t)),d.markEnd(d.createProperty("set",n,i))):(n=W(),H("("),H(")"),i=J([]),d.markEnd(d.createProperty("get",n,i)))):t.type!==e.EOF&&t.type!==e.Punctuator?(n=W(),H(":"),i=pt(),d.markEnd(d.createProperty("init",n,i))):void z(t)}function X(){var t,n,r;return G("(")?function(){var t;return H("("),t=ut(),H(")"),t}():(t=y.type,d.markStart(),t===e.Identifier?r=d.createIdentifier(U().value):t===e.StringLiteral||t===e.NumericLiteral?(c&&y.octal&&V(y,s.StrictOctalLiteral),r=d.createLiteral(U())):t===e.Keyword?K("this")?(U(),r=d.createThisExpression()):K("function")&&(r=parseFunctionExpression()):t===e.BooleanLiteral?((n=U()).value="true"===n.value,r=d.createLiteral(n)):t===e.Undefined?((n=U()).value=void 0,r=d.createLiteral(n)):t===e.NullLiteral?((n=U()).value=null,r=d.createLiteral(n)):G("[")?r=function(){var t=[];for(H("[");!G("]");)G(",")?(U(),t.push(null)):(t.push(pt()),G("]")||H(","));return H("]"),d.createArrayExpression(t)}():G("{")?r=function(){var t,e,n,r,a=[],p={},u=String;for(H("{");!G("}");)e=(t=Y()).key.type===i.Identifier?t.key.name:u(t.key.value),r="init"===t.kind?o.Data:"get"===t.kind?o.Get:o.Set,n="$"+e,Object.prototype.hasOwnProperty.call(p,n)?(p[n]===o.Data?c&&r===o.Data?V({},s.StrictDuplicateProperty):r!==o.Data&&V({},s.AccessorDataProperty):r===o.Data?V({},s.AccessorDataProperty):p[n]&r&&V({},s.AccessorGetSet),p[n]|=r):p[n]=r,a.push(t),G("}")||H(",");return H("}"),d.createObjectExpression(a)}():(G("/")||G("/="))&&(r=void 0!==g.tokens?d.createLiteral(R()):d.createLiteral(D()),$()),r?d.markEnd(r):void z(U()))}function Z(){var t=[];if(H("("),!G(")"))for(;h<m&&(t.push(pt()),!G(")"));)H(",");return H(")"),t}function tt(){var t;return d.markStart(),function(t){return t.type===e.Identifier||t.type===e.Keyword||t.type===e.BooleanLiteral||t.type===e.Undefined||t.type===e.NullLiteral}(t=U())||z(t),d.markEnd(d.createIdentifier(t.value))}function et(){return H("."),tt()}function nt(){var t;return H("["),t=ut(),H("]"),t}function rt(){var t,n,r,i;return d.markStart(),r="new",(i=U()).type===e.Keyword&&i.value===r||z(i),t=function(){var t,e,n,r;t=ft(),e=v.allowIn,n=K("new")?rt():X(),v.allowIn=e;for(;G(".")||G("[");)G("[")?(r=nt(),n=d.createMemberExpression("[",n,r)):(r=et(),n=d.createMemberExpression(".",n,r)),t&&(t.end(),t.apply(n));return n}(),n=G("(")?Z():[],d.markEnd(d.createNewExpression(t,n))}function it(){var t,n,r,o,a,p;return d.markStart(),t=function(){var t,e,n,r,i;for(t=ft(),e=v.allowIn,v.allowIn=!0,n=K("new")?rt():X(),v.allowIn=e;G(".")||G("[")||G("(");)G("(")?(r=Z(),n=d.createCallExpression(n,r)):G("[")?(i=nt(),n=d.createMemberExpression("[",n,i)):(i=et(),n=d.createMemberExpression(".",n,i)),t&&(t.end(),t.apply(n));return n}(),y.type===e.Punctuator&&(!G("++")&&!G("--")||(r=h,o=l,a=f,L(),p=l!==o,h=r,l=o,f=a,p)||(c&&t.type===i.Identifier&&(t.name,0)&&V({},s.StrictLHSPostfix),Q(t)||V({},s.InvalidLHSInAssignment),n=U(),t=d.createPostfixExpression(n.value,t))),d.markEndIf(t)}function ot(){var t,n;return d.markStart(),y.type!==e.Punctuator&&y.type!==e.Keyword?n=it():G("++")||G("--")?(t=U(),n=ot(),c&&n.type===i.Identifier&&(n.name,0)&&V({},s.StrictLHSPrefix),Q(n)||V({},s.InvalidLHSInAssignment),n=d.createUnaryExpression(t.value,n)):G("+")||G("-")||G("~")||G("!")?(t=U(),n=ot(),n=d.createUnaryExpression(t.value,n)):K("delete")||K("void")||K("typeof")?(t=U(),n=ot(),n=d.createUnaryExpression(t.value,n),c&&"delete"===n.operator&&n.argument.type===i.Identifier&&V({},s.StrictDelete)):n=it(),d.markEndIf(n)}function st(t,n){var r=0;if(t.type!==e.Punctuator&&t.type!==e.Keyword)return 0;switch(t.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function at(){var t,e,n,r;return d.markStart(),t=function(){var t,e,n,r,i,o,s,a,p,u;if(t=ft(),p=ot(),0===(i=st(r=y,v.allowIn)))return p;for(r.prec=i,U(),e=[t,ft()],o=[p,r,s=ot()];(i=st(y,v.allowIn))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)s=o.pop(),a=o.pop().value,p=o.pop(),n=d.createBinaryExpression(a,p,s),e.pop(),(t=e.pop())&&(t.end(),t.apply(n)),o.push(n),e.push(t);(r=U()).prec=i,o.push(r),e.push(ft()),n=ot(),o.push(n)}for(n=o[u=o.length-1],e.pop();u>1;)n=d.createBinaryExpression(o[u-1].value,o[u-2],n),u-=2,(t=e.pop())&&(t.end(),t.apply(n));return n}(),G("?")?(U(),e=v.allowIn,v.allowIn=!0,n=pt(),v.allowIn=e,H(":"),r=pt(),t=d.markEnd(d.createConditionalExpression(t,n,r))):d.markEnd({}),t}function pt(){var t,n,r,o,a;return t=y,d.markStart(),o=n=at(),y.type!==e.Punctuator||"="!==(a=y.value)&&"*="!==a&&"/="!==a&&"%="!==a&&"+="!==a&&"-="!==a&&"<<="!==a&&">>="!==a&&">>>="!==a&&"&="!==a&&"^="!==a&&"|="!==a||(Q(n)||V({},s.InvalidLHSInAssignment),c&&n.type===i.Identifier&&(n.name,0)&&V(t,s.StrictLHSAssignment),t=U(),r=pt(),o=d.createAssignmentExpression(t.value,n,r)),d.markEndIf(o)}function ut(){var t;if(d.markStart(),t=pt(),G(","))for(t=d.createSequenceExpression([t]);h<m&&G(",");)U(),t.expressions.push(pt());return d.markEndIf(t)}function ct(){var t,n=ut();return 59!==u.charCodeAt(h)?(t=l,L(),l===t&&(G(";")?U():y.type===e.EOF||G("}")||z(y))):U(),d.createExpressionStatement(n)}function ht(){var t,e,n,r=[];for(t=0;t<g.tokens.length;++t)n={type:(e=g.tokens[t]).type,value:e.value},g.range&&(n.range=e.range),g.loc&&(n.loc=e.loc),r.push(n);g.tokens=r}function lt(){this.marker=[h,l,h-f,0,0,0]}function ft(){return g.loc||g.range?(L(),new lt):null}(n={})[(e={UndefinedLiteral:-1,BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).UndefinedLiteral]="Undefined",n[e.BooleanLiteral]="Boolean",n[e.EOF]="<end>",n[e.Identifier]="Identifier",n[e.Keyword]="Keyword",n[e.NullLiteral]="Null",n[e.NumericLiteral]="Numeric",n[e.Punctuator]="Punctuator",n[e.StringLiteral]="String",n[e.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],i={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",FunctionExpression:"FunctionExpression",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Property:"Property",SequenceExpression:"SequenceExpression",ThisExpression:"ThisExpression",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},o={Data:1,Get:2,Set:4},s={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},a={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},p={name:"SyntaxTree",markStart:function(){g.loc&&(v.markerStack.push(h-f),v.markerStack.push(l)),g.range&&v.markerStack.push(h)},processComment:function(t){var e,n,r,o,s;if(void 0!==t.type&&t.type!==i.Program)for($(),e=0;e<g.pendingComments.length;++e)n=g.pendingComments[e],t.range[0]>=n.comment.range[1]&&((s=n.leading)?(r=s.range[0],o=s.range[1]-r,t.range[0]<=r&&t.range[1]-t.range[0]>=o&&(n.leading=t)):n.leading=t),t.range[1]<=n.comment.range[0]&&((s=n.trailing)?(r=s.range[0],o=s.range[1]-r,t.range[0]<=r&&t.range[1]-t.range[0]>=o&&(n.trailing=t)):n.trailing=t)},markEnd:function(t){return g.range&&(t.range=[v.markerStack.pop(),h]),g.loc&&(t.loc={start:{line:v.markerStack.pop(),column:v.markerStack.pop()},end:{line:l,column:h-f}},this.postProcess(t)),g.attachComment&&this.processComment(t),t},markEndIf:function(t){return t.range||t.loc?(g.loc&&(v.markerStack.pop(),v.markerStack.pop()),g.range&&v.markerStack.pop()):this.markEnd(t),t},postProcess:function(t){return g.source&&(t.loc.source=g.source),t},createArrayExpression:function(t){return{type:i.ArrayExpression,elements:t}},createAssignmentExpression:function(t,e,n){return{type:i.AssignmentExpression,operator:t,left:e,right:n}},createBinaryExpression:function(t,e,n){return{type:"||"===t||"&&"===t?i.LogicalExpression:i.BinaryExpression,operator:t,left:e,right:n}},createCallExpression:function(t,e){return{type:i.CallExpression,callee:t,arguments:e}},createConditionalExpression:function(t,e,n){return{type:i.ConditionalExpression,test:t,consequent:e,alternate:n}},createExpressionStatement:function(t){return{type:i.ExpressionStatement,expression:t}},createFunctionExpression:function(t,e,n,r){return{type:i.FunctionExpression,id:t,params:e,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(t){return{type:i.Identifier,name:t}},createLiteral:function(t){return{type:i.Literal,value:t.value,raw:u.slice(t.range[0],t.range[1])}},createMemberExpression:function(t,e,n){return{type:i.MemberExpression,computed:"["===t,object:e,property:n}},createNewExpression:function(t,e){return{type:i.NewExpression,callee:t,arguments:e}},createObjectExpression:function(t){return{type:i.ObjectExpression,properties:t}},createPostfixExpression:function(t,e){return{type:i.UpdateExpression,operator:t,argument:e,prefix:!1}},createProperty:function(t,e,n){return{type:i.Property,key:e,value:n,kind:t}},createSequenceExpression:function(t){return{type:i.SequenceExpression,expressions:t}},createThisExpression:function(){return{type:i.ThisExpression}},createUnaryExpression:function(t,e){return"++"===t||"--"===t?{type:i.UpdateExpression,operator:t,argument:e,prefix:!0}:{type:i.UnaryExpression,operator:t,argument:e,prefix:!0}}},lt.prototype={constructor:lt,end:function(){this.marker[3]=h,this.marker[4]=l,this.marker[5]=h-f},apply:function(t){g.range&&(t.range=[this.marker[0],this.marker[3]]),g.loc&&(t.loc={start:{line:this.marker[1],column:this.marker[2]},end:{line:this.marker[4],column:this.marker[5]}},t=d.postProcess(t)),g.attachComment&&d.processComment(t)}},t.parse=function(t,e){var n,r;r=String,"string"==typeof t||t instanceof String||(t=r(t)),d=p,h=0,l=(u=t).length>0?1:0,f=0,m=u.length,y=null,v={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1,markerStack:[]},g={},void 0!==e&&(g.range="boolean"==typeof e.range&&e.range,g.loc="boolean"==typeof e.loc&&e.loc,g.attachComment="boolean"==typeof e.attachComment&&e.attachComment,g.loc&&null!==e.source&&void 0!==e.source&&(g.source=r(e.source)),"boolean"==typeof e.tokens&&e.tokens&&(g.tokens=[]),"boolean"==typeof e.comment&&e.comment&&(g.comments=[]),"boolean"==typeof e.tolerant&&e.tolerant&&(g.errors=[]),g.attachComment&&(g.range=!0,g.pendingComments=[],g.comments=[])),m>0&&void 0===u[0]&&t instanceof String&&(u=t.valueOf());try{L(),d.markStart(),c=!1,$(),n=d.markEnd(ct()),void 0!==g.comments&&(n.comments=g.comments),void 0!==g.tokens&&(ht(),n.tokens=g.tokens),void 0!==g.errors&&(n.errors=g.errors),g.attachComment&&function(){var t,e,n,r;for(t=0;t<g.pendingComments.length;++t)(e=g.pendingComments[t]).comment,(n=e.leading)&&(void 0===n.leadingComments&&(n.leadingComments=[]),n.leadingComments.push(e.comment)),(r=e.trailing)&&(void 0===r.trailingComments&&(r.trailingComments=[]),r.trailingComments.push(e.comment));g.pendingComments=[]}()}catch(t){throw t}finally{g={}}return n},t.Syntax=function(){var t,e={};for(t in"function"==typeof Object.create&&(e=Object.create(null)),i)i.hasOwnProperty(t)&&(e[t]=i[t]);return"function"==typeof Object.freeze&&Object.freeze(e),e}()});var Ot=Tt.expressions,Pt=Tt.operatorFns,jt=Lt.Syntax,Nt=function(t){return Mt(Lt.parse(t).expression)};function Mt(t){var e=t.type;return e===jt.MemberExpression?Dt(t):e===jt.Identifier?function(t){return Bt([t.name])}(t):e===jt.ThisExpression?new Ot.RelativePathExpression([]):e===jt.CallExpression?Ft(t):e===jt.Literal?function(t){return new Ot.LiteralExpression(t.value)}(t):e===jt.UnaryExpression?function(t){var e=t.operator+"U",n=Mt(t.argument);if(n instanceof Ot.LiteralExpression){var r=Pt.get[e];return n.value=r(n.value),n}return new Ot.OperatorExpression(e,[n])}(t):e===jt.BinaryExpression||e===jt.LogicalExpression?function(t){var e=t.operator,n=Mt(t.left),r=Mt(t.right);if(n instanceof Ot.LiteralExpression&&r instanceof Ot.LiteralExpression){var i=Pt.get[e],o=i(n.value,r.value);return new Ot.LiteralExpression(o)}return new Ot.OperatorExpression(e,[n,r])}(t):e===jt.ConditionalExpression?function(t){var e=Mt(t.test),n=Mt(t.consequent),r=Mt(t.alternate);if(e instanceof Ot.LiteralExpression&&n instanceof Ot.LiteralExpression&&r instanceof Ot.LiteralExpression){var i=e.value?n.value:r.value;return new Ot.LiteralExpression(i)}return new Ot.OperatorExpression("?",[e,n,r])}(t):e===jt.ArrayExpression?function(t){for(var e=[],n=[],r=!0,i=0;i<t.elements.length;i++){var o=Mt(t.elements[i]);n.push(o),r&&o instanceof Ot.LiteralExpression?e.push(o.value):r=!1}return r?new Ot.LiteralExpression(e):new Ot.ArrayExpression(n)}(t):e===jt.ObjectExpression?function(t){for(var e={},n={},r=!0,i=0;i<t.properties.length;i++){var o=t.properties[i],s=qt(o.key),a=Mt(o.value);n[s]=a,r&&a instanceof Ot.LiteralExpression?e[s]=a.value:r=!1}return r?new Ot.LiteralExpression(e):new Ot.ObjectExpression(n)}(t):e===jt.SequenceExpression?Vt(t):e===jt.NewExpression?Ut(t):void zt(t)}function Dt(t,e){if(t.computed){if(t.property.type===jt.Literal)return Rt(t,t.property.value,e);var n=Mt(t.object),r=Mt(t.property);return new Ot.BracketsExpression(n,r,e)}if(t.property.type===jt.Identifier)return Rt(t,t.property.name);zt(t)}function Rt(t,e,n){var r=[e];n&&(r=r.concat(n));for(var i=!1;t=t.object;)if(t.type===jt.MemberExpression){if(t.computed)return Dt(t,r);t.property.type===jt.Identifier?r.unshift(t.property.name):zt(t)}else if(t.type===jt.Identifier)r.unshift(t.name);else if(t.type===jt.ThisExpression)i=!0;else{if(t.type===jt.CallExpression)return Ft(t,r);if(t.type===jt.SequenceExpression)return Vt(t,r);if(t.type===jt.NewExpression)return Ut(t,r);zt(t)}return i?new Ot.RelativePathExpression(r):Bt(r)}function Bt(t){var e=t[0],n=e.charAt&&e.charAt(0);if("#"===n){var r=e;return t.shift(),new Ot.AliasPathExpression(r,t)}if("@"===n){var i=e.slice(1);return t.shift(),new Ot.AttributePathExpression(i,t)}return new Ot.PathExpression(t)}function Ft(t,e){return $t(t,e,Ot.FnExpression)}function Ut(t,e){return $t(t,e,Ot.NewExpression)}function $t(t,e,n){var r=t.arguments.map(Mt),i=t.callee;return i.type===jt.Identifier?"$at"===i.name?new Ot.ScopedModelExpression(r[0]):new n([i.name],r,e):i.type===jt.MemberExpression?new n(Dt(i).segments,r,e):void zt(t)}function qt(t){return t.type===jt.Identifier?t.name:t.type===jt.Literal?t.value:zt(t)}function Vt(t,e){var n=t.expressions.map(Mt);return new Ot.SequenceExpression(n,e)}function zt(t){throw new Error("Unexpected Esprima node: "+JSON.stringify(t,null,2))}var Ht=Object.create||function(t){var e=function(){};return e.prototype=t,new e},Gt=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return n},Kt=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function Qt(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=Ht(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}var Jt=Qt;Qt.EventEmitter=Qt,Qt.prototype._events=void 0,Qt.prototype._maxListeners=void 0;var Wt,Yt=10;try{var Xt={};Object.defineProperty&&Object.defineProperty(Xt,"x",{value:0}),Wt=0===Xt.x}catch(t){Wt=!1}function Zt(t){return void 0===t._maxListeners?Qt.defaultMaxListeners:t._maxListeners}function te(t,e,n,r){var i,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]):(o=t._events=Ht(null),t._eventsCount=0),s){if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=Zt(t))&&i>0&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else s=o[e]=n,++t._eventsCount;return t}function ee(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function ne(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=Kt.call(ee,r);return i.listener=n,r.wrapFn=i,i}function re(t,e,n){var r=t._events;if(!r)return[];var i=r[e];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):oe(i,i.length):[]}function ie(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function oe(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Wt?Object.defineProperty(Qt,"defaultMaxListeners",{enumerable:!0,get:function(){return Yt},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');Yt=t}}):Qt.defaultMaxListeners=Yt,Qt.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},Qt.prototype.getMaxListeners=function(){return Zt(this)},Qt.prototype.emit=function(t){var e,n,r,i,o,s,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var p=new Error('Unhandled "error" event. ('+e+")");throw p.context=e,p}if(!(n=s[t]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:!function(t,e,n){if(e)t.call(n);else for(var r=t.length,i=oe(t,r),o=0;o<r;++o)i[o].call(n)}(n,u,this);break;case 2:!function(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=oe(t,i),s=0;s<i;++s)o[s].call(n,r)}(n,u,this,arguments[1]);break;case 3:!function(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=oe(t,o),a=0;a<o;++a)s[a].call(n,r,i)}(n,u,this,arguments[1],arguments[2]);break;case 4:!function(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,a=oe(t,s),p=0;p<s;++p)a[p].call(n,r,i,o)}(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=oe(t,i),s=0;s<i;++s)o[s].apply(n,r)}(n,u,this,i)}return!0},Qt.prototype.addListener=function(t,e){return te(this,t,e,!1)},Qt.prototype.on=Qt.prototype.addListener,Qt.prototype.prependListener=function(t,e){return te(this,t,e,!0)},Qt.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,ne(this,t,e)),this},Qt.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,ne(this,t,e)),this},Qt.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Ht(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),r.removeListener&&this.emit("removeListener",t,s||e)}return this},Qt.prototype.removeAllListeners=function(t){var e,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=Ht(null),this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=Ht(null):delete n[t]),this;if(0===arguments.length){var i,o=Gt(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Ht(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},Qt.prototype.listeners=function(t){return re(this,t,!0)},Qt.prototype.rawListeners=function(t){return re(this,t,!1)},Qt.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):ie.call(t,e)},Qt.prototype.listenerCount=ie,Qt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var se={},ae=Jt.EventEmitter,pe=Tt.templates,ue=se=new ce;function ce(){ae.call(this)}function he(t,e){var n=t.hooks;if(!n)return!1;for(var r=0,i=n.length;r<i;r++){var o=n[r];if(o instanceof pe.ElementOn&&o.name===e)return!0}return!1}function le(t,e,n){var r=t.hooks||(t.hooks=[]),i=Nt(n);r.push(new pe.ElementOn(e,i))}!function(t,e){for(var n in e)t[n]=e[n]}(ce.prototype,ae.prototype),ue.on("element:a",function(t){if(he(t,"click")){var e=t.attributes||(t.attributes={});e.href||(e.href=new pe.Attribute("#"),le(t,"click","$preventDefault($event)"))}}),ue.on("element:form",function(t){he(t,"submit")&&le(t,"submit","$preventDefault($event)")});var fe,me={},de=Tt.templates,ye=Tt.expressions;function ve(t,e){for(t=He(t),fe=new ze(e),w.parse(t,{start:we,end:xe,text:Ee,comment:Ce,other:Ae});fe.parent;){var n=(fe=fe.parent).last();if(n instanceof de.Element){if("body"===n.tagName||"html"===n.tagName){n.notClosed=!0,n.endTag="";continue}throw new Error("Missing closing HTML tag: "+n.endTag)}Xe()}return new de.Template(fe.content)}function ge(t,e){return t=He(t),fe=new ze(e),Ke(t,ke,Ie,"string"),new de.Template(fe.content)}function we(t,e,n,r){var i,o=e.toLowerCase();"view"===o||_e(o)||(i=function(t,e){if(!t)return;var n=[];for(var r in t){var i=t[r];if("as"!==r)if("as-array"!==r)if("as-object"!==r){var o=/^on-(.+)/.exec(r),s=o&&o[1];if(s){var a=Be(r,i);n.push(new de.ElementOn(s,a)),delete t[r]}}else{var p=Re(r,i);n.push(new de.AsObject(p.segments,p.expression)),delete t[r]}else{var u=De(r,i);n.push(new de.AsArray(u)),delete t[r]}else{var u=De(r,i);n.push(new de.AsProperty(u)),delete t[r]}}if(n.length)return n}(n));var s=function(t){var e;for(var n in t){e||(e={});var r=t[n],i=/([^:]+):[^:]/.exec(n),o=i&&de.NAMESPACE_URIS[i[1]];if(""!==r&&"string"==typeof r){if(fe=fe.child(),Ke(r,ke,Ie,"attribute"),1===fe.content.length){var s=fe.content[0];e[n]=s instanceof de.Text?new de.Attribute(s.data,o):s instanceof de.DynamicText?s.expression instanceof ye.LiteralExpression?new de.Attribute(s.expression.value,o):new de.DynamicAttribute(s.expression,o):new de.DynamicAttribute(s,o)}else{if(!(fe.content.length>1))throw new Error("Error parsing "+n+" attribute: "+r);var a=new de.Template(fe.content,r);e[n]=new de.DynamicAttribute(a,o)}fe=fe.parent}else e[n]=new de.Attribute(r,o)}return e}(n),a="svg"===o?de.NAMESPACE_URIS.svg:fe.namespaceUri,p=de.Element;if("tag"===o&&(p=de.DynamicElement,e=s.is,delete s.is),r||de.VOID_ELEMENTS[o]){var u=new p(e,s,null,i,r,null,a);fe.content.push(u),be(o)}else{(fe=fe.child()).namespaceUri=a;u=new p(e,s,fe.content,i,r,null,a);fe.parent.content.push(u)}}function xe(t,e){var n=(fe=fe.parent).last();if(!(n instanceof de.DynamicElement&&"tag"===e.toLowerCase()||n instanceof de.Element&&n.tagName===e))throw new Error("Mismatched closing HTML tag: "+t);be(e)}function be(t){if("view"!==t){var e=_e(t);if(e){Le(n=fe.content.pop(),e,e.name)}else{n=fe.last();se.emit("element",n),se.emit("element:"+t,n)}}else{var n;!function(t){var e=t.attributes.is||t.attributes.name;if(!e)throw new Error('The <view> element requires an "is" attribute');if(delete t.attributes.is,delete t.attributes.name,e.expression){var n=Me(t),r=Fe(n),i=t.content||[],o=Oe(e.expression,n,r.hooks,r.initHooks);Pe(n,i,o)}else{var s=e.data,a=Te(s);Le(t,a,s)}}(n=fe.content.pop())}}function _e(t){return fe.view&&fe.view.views.tagMap[t]}function Ee(t,e){Ke(t,ke,Ie,e?"string":"html")}function Ce(t,e){if(w.isConditionalComment(t)){var n=new de.Comment(e);fe.content.push(n)}}me.createTemplate=ve,me.createStringTemplate=ge,me.createExpression=Ye,me.createPathExpression=Nt,me.markup=se,de.View.prototype._parse=function(){var t;try{if(this.literal){var e=this.unminified?this.source:this.source.replace(/^\s*\n/,"").replace(/\s*$/,"");t=new de.Text(e)}else if(this.string)t=ge(this.source,this);else{t=ve(e=this.unminified?this.source:w.minify(this.source).replace(/&sp;/g," "),this)}}catch(t){throw Ze(t,'\n\nWithin template "'+this.name+'":\n'+this.source)}return this.template=t,t};var Se=/^<!DOCTYPE\s+([^\s]+)(?:\s+(PUBLIC|SYSTEM)\s+"([^"]+)"(?:\s+"([^"]+)")?)?\s*>/i;function Ae(t){var e=Se.exec(t);if(e){var n,r,i=e[1],o=e[2]&&e[2].toLowerCase();"public"===o?(n=e[3],r=e[4]):"system"===o&&(r=e[3]);var s=new de.Doctype(i,n,r);fe.content.push(s)}else Xe(t)}function ke(t){var e=new de.Text(t);fe.content.push(e)}function Ie(t,e){var n=Ye(t);if(n.meta.blockType)!function(t){var e=t.meta.blockType;if(t.meta.isEnd){var n=(fe=fe.parent).last(),r=n&&(n.expression||n.expressions&&n.expressions[0]);if(!(r&&"end"===e&&r.meta.blockType||e===r.meta.blockType))throw new Error("Mismatched closing template tag: "+t.meta.source)}else if("else"===e||"else if"===e){var n=(fe=fe.parent).last();fe=fe.child(),n instanceof de.ConditionalBlock?(n.expressions.push(t),n.contents.push(fe.content)):n instanceof de.EachBlock?("else"!==e&&Xe(t.meta.source),n.elseContent=fe.content):Xe(t.meta.source)}else{var i,o=fe.child();i="if"===e||"unless"===e?new de.ConditionalBlock([t],[o.content]):"each"===e?new de.EachBlock(t,o.content):new de.Block(t,o.content),fe.content.push(i),fe=o}}(n);else if("view"===n.meta.valueType)!function(t){var e,n;t instanceof ye.SequenceExpression?(e=t.args[0],n=t.args[1]):e=t;var r,i=function(t){if(!t)return;var e=t instanceof ye.ObjectExpression?t.properties:t instanceof ye.LiteralExpression?t.value:null;"object"!=typeof e&&Xe();var n={};for(var r in e){var i=e[r];n[r]=i instanceof ye.LiteralExpression?i.value:i instanceof ye.Expression?new ye.ViewParentExpression(i):i}return n}(n),o=Fe(i);if(e instanceof ye.LiteralExpression){var s=e.get();Te(s),r=new de.ViewInstance(s,i,o.hooks,o.initHooks)}else r=Oe(e,i,o.hooks,o.initHooks);fe.content.push(r)}(n);else if(n.meta.unescaped&&"html"===e){var r=new de.DynamicHtml(n);fe.content.push(r)}else{var i=new de.DynamicText(n);fe.content.push(i)}}function Te(t){var e=fe.view.views.find(t,fe.view.namespace);if(!e){var n=fe.view.views.findErrorMessage(t);throw new Error(n)}return e}function Le(t,e,n){var r=Me(t),i=Fe(r);Pe(r,function(t,e,n){var r=[];if(!t)return r;for(var i=0,o=t.length;i<o;i++){var s=t[i],a=s instanceof de.Element&&s.tagName;if("attribute"===a){var a=$e(s);qe(s,a,n)}else if(e.attributesMap&&e.attributesMap[a])qe(s,a,n);else if("array"===a){var a=$e(s);Ve(s,a,n)}else e.arraysMap&&e.arraysMap[a]?Ve(s,e.arraysMap[a],n):r.push(s)}return r}(t.content,e,r),new de.ViewInstance(e.registeredName,r,i.hooks,i.initHooks))}function Oe(t,e,n,r){var i=new de.DynamicViewInstance(t,e,n,r);return new de.Block(t,[i])}function Pe(t,e,n){je(t,e),delete t.within,fe.content.push(n)}function je(t,e){t.hasOwnProperty("content")||e.length&&(t.content=Ne(e,t.within))}function Ne(t,e){if(1===t.length){var n=t[0];if(n instanceof de.Text)return n.data;if(n instanceof de.DynamicText){var r=n.expression;return r instanceof ye.LiteralExpression?r.value:e?n:new ye.ViewParentExpression(r)}}var i=new de.Template(t);return e?i:new de.ViewParent(i)}function Me(t){var e={};for(var n in t.attributes){var r=t.attributes[n];e[Ue(n)]=r.expression instanceof de.Template?new de.ViewParent(r.expression):r.expression instanceof ye.Expression?new ye.ViewParentExpression(r.expression):r.data}return e}function De(t,e){var n=Nt(e);if(!(n instanceof ye.PathExpression))throw new Error(t+" attribute must be a path: "+t+'="'+e+'"');return n.segments}function Re(t,e){var n;if(!((n=Nt(e))instanceof ye.SequenceExpression&&2===n.args.length&&n.args[0]instanceof ye.PathExpression))throw new Error(t+" attribute requires a path and a key argument: "+t+'="'+e+'"');return{segments:n.args[0].segments,expression:n=n.args[1]}}function Be(t,e){return Nt(e)}function Fe(t){if(!t)return{};var e=[],n=[];for(var r in t){var i=t[r];if("as"!==r)if("asArray"!==r)if("asObject"!==r){var o=/^on([A-Z_].*)/.exec(r),s=o&&o[1].charAt(0).toLowerCase()+o[1].slice(1);if(s){var a=Be(0,i);n.push(new de.ComponentOn(s,a)),delete t[r]}}else{var p=Re("as-object",i);e.push(new de.AsObjectComponent(p.segments,p.expression)),delete t[r]}else{u=De("as-array",i);e.push(new de.AsArrayComponent(u)),delete t[r]}else{var u=De(r,i);e.push(new de.AsProperty(u)),delete t[r]}}return{hooks:e.length?e:null,initHooks:n.length?n:null}}function Ue(t){return t.replace(/-./g,function(t){return t.charAt(1).toUpperCase()})}function $e(t){var e=(t.attributes.is||t.attributes.name).data;if(!e)throw new Error("The <"+t.tagName+'> element requires a literal "is" attribute');return delete t.attributes.is,delete t.attributes.name,e}function qe(t,e,n){var r=Ue(e),i=t.attributes&&t.attributes.within;n[r]=Ne(t.content,i)}function Ve(t,e,n){var r=Me(t);je(r,t.content),delete r.within;var i=function(t){var e={},n={},r=!0;for(var i in t){var o=t[i];o instanceof ye.Expression?(e[i]=o,r=!1):o instanceof de.Template?(e[i]=new ye.DeferRenderExpression(o),r=!1):(e[i]=new ye.LiteralExpression(o),n[i]=o)}return r?new ye.LiteralExpression(n):new ye.ObjectExpression(e)}(r),o=Ue(e),s=n[o];if(s instanceof ye.ArrayExpression)s.items.push(i);else if(Array.isArray(s))if(i instanceof ye.LiteralExpression)s.push(i.value);else{for(var a=[],p=0;p<s.length;p++)a[p]=new ye.LiteralExpression(s[p]);a.push(i),n[o]=new ye.ArrayExpression(a)}else null==s?n[o]=i instanceof ye.LiteralExpression?[i.value]:new ye.ArrayExpression([i]):Xe()}function ze(t,e){this.view=t,this.parent=e,this.content=[],this.namespaceUri=e&&e.namespaceUri}function He(t){var e="";return Ke(t,function(t){e+=t},function(t){var n=t.replace(/[&<]/g,function(t){return"&"===t?"&amp;":"&lt;"});e+="{{"+n+"}}"},"string"),e}function Ge(t,e){return"html"===e||"attribute"===e?w.unescapeEntities(t):t}function Ke(t,e,n,r){for(var i,o=t;o;){if(o===i)throw new Error("Error parsing template text: "+t);i=o;var s=o.indexOf("{{");if(-1===s)return void e(Ge(o,r));var a=Qe(o,2,s,"{","}");if(-1===a)throw new Error("Mismatched braces in: "+t);if(s>0)e(Ge(o.slice(0,s),r));var p=o.slice(s+2,a-2);if(p){var u=p.replace(/(?:&amp;|&lt;)/g,function(t){return"&amp;"===t?"&":"<"});n(u=Ge(u,r),r)}o=o.slice(a)}}function Qe(t,e,n,r,i){for(n+=e;e;){var o=t.indexOf(i,n),s=t.indexOf(r,n),a=-1!==s;if(-1!==o&&(!a||o<s))n=o+1,e--;else{if(!a)return-1;n=s+1,e++}}return n}ze.prototype.child=function(){return new ze(this.view,this)},ze.prototype.last=function(){return this.content[this.content.length-1]};var Je=/^(if|unless|else if|each|with|on)\s+([\s\S]+?)(?:\s+as\s+([^,\s]+)\s*(?:,\s*(\S+))?)?$/,We=/^(?:(view|unbound|bound|unescaped)\s+)?([\s\S]*)/;function Ye(t){t=t.trim();var e,n,r,i,o=new ye.ExpressionMeta(t),s=Je.exec(t);if(s)o.blockType=s[1],e=s[2],n=s[3],r=s[4];else if("else"===t||"unbound"===t||"bound"===t)o.blockType=t;else if("/"===t.charAt(0))o.isEnd=!0,o.blockType=t.slice(1).trim()||"end";else{var a;e=t;do{a=(s=We.exec(e))[1],e=s[2],"unescaped"===a?o.unescaped=!0:"unbound"===a||"bound"===a?o.bindType=a:a&&(o.valueType=a)}while(a)}try{i=e?Nt(e):new ye.Expression,n&&(o.as=tn(n)),r&&(o.keyAs=tn(r))}catch(e){throw Ze(e,"\n\nWithin expression: "+t)}return i.meta=o,i}function Xe(t){throw new Error("Error parsing template: "+t)}function Ze(t,e){return t instanceof Error?(t.message+=e,t):new Error(t+e)}function tn(t){var e=Nt(t);if(e instanceof ye.AliasPathExpression){if(0===e.segments.length)return e.alias;throw new Error("Alias must not have dots or brackets: "+t)}throw new Error('Alias must be an identifier starting with "#": '+t)}var en,nn,rn,on=en={};function sn(){throw new Error("setTimeout has not been defined")}function an(){throw new Error("clearTimeout has not been defined")}function pn(t){if(nn===setTimeout)return setTimeout(t,0);if((nn===sn||!nn)&&setTimeout)return nn=setTimeout,setTimeout(t,0);try{return nn(t,0)}catch(e){try{return nn.call(null,t,0)}catch(e){return nn.call(this,t,0)}}}!function(){try{nn="function"==typeof setTimeout?setTimeout:sn}catch(t){nn=sn}try{rn="function"==typeof clearTimeout?clearTimeout:an}catch(t){rn=an}}();var un,cn=[],hn=!1,ln=-1;function fn(){hn&&un&&(hn=!1,un.length?cn=un.concat(cn):ln=-1,cn.length&&mn())}function mn(){if(!hn){var t=pn(fn);hn=!0;for(var e=cn.length;e;){for(un=cn,cn=[];++ln<e;)un&&un[ln].run();ln=-1,e=cn.length}un=null,hn=!1,function(t){if(rn===clearTimeout)return clearTimeout(t);if((rn===an||!rn)&&clearTimeout)return rn=clearTimeout,clearTimeout(t);try{rn(t)}catch(e){try{return rn.call(null,t)}catch(e){return rn.call(this,t)}}}(t)}}function dn(t,e){this.fun=t,this.array=e}function yn(){}on.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];cn.push(new dn(t,e)),1!==cn.length||hn||pn(mn)},dn.prototype.run=function(){this.fun.apply(null,this.array)},on.title="browser",on.browser=!0,on.env={},on.argv=[],on.version="",on.versions={},on.on=yn,on.addListener=yn,on.once=yn,on.off=yn,on.removeListener=yn,on.removeAllListeners=yn,on.emit=yn,on.prependListener=yn,on.prependOnceListener=yn,on.listeners=function(t){return[]},on.binding=function(t){throw new Error("process.binding is not supported")},on.cwd=function(){return"/"},on.chdir=function(t){throw new Error("process.chdir is not supported")},on.umask=function(){return 0};var vn={};(function(t){function e(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}vn.resolve=function(){for(var r="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(r=s+"/"+r,i="/"===s.charAt(0))}return(i?"/":"")+(r=e(n(r.split("/"),function(t){return!!t}),!i).join("/"))||"."},vn.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),n=47===e,r=-1,i=!0,o=t.length-1;o>=1;--o)if(47===(e=t.charCodeAt(o))){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":t.slice(0,r)},vn.basename=function(t,e){var n=function(t){"string"!=typeof t&&(t+="");var e,n=0,r=-1,i=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!i){n=e+1;break}}else-1===r&&(i=!1,r=e+1);return-1===r?"":t.slice(n,r)}(t);return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},vn.extname=function(t){"string"!=typeof t&&(t+="");for(var e=-1,n=0,r=-1,i=!0,o=0,s=t.length-1;s>=0;--s){var a=t.charCodeAt(s);if(47!==a)-1===r&&(i=!1,r=s+1),46===a?-1===e?e=s:1!==o&&(o=1):-1!==e&&(o=-1);else if(!i){n=s+1;break}}return-1===e||-1===r||0===o||1===o&&e===r-1&&e===n+1?"":t.slice(e,r)};"ab".substr(-1)}).call(this,en);var gn={},wn={}.toString;gn.pathRegexp=function(t,e,n,r){return"[object RegExp]"==wn.call(t)?t:(Array.isArray(t)&&(t="("+t.join("|")+")"),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(t,n,r,i,o,s,a){return e.push({name:i,optional:!!s}),n=n||"",(s?"":n)+"(?:"+(s?n:"")+(r||"")+(o||(r?"([^/.]+?)":"([^/]+?)"))+")"+(s||"")+(a?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",n?"":"i"))};var xn=bn;function bn(t,e,n,r){r=r||{},this.path=e,this.method=t,this.callbacks=n,this.regexp=gn.pathRegexp(e,this.keys=[],r.sensitive,r.strict)}bn.prototype.match=function(t){var e=this.keys,n=this.params=[],r=this.regexp.exec(t);if(!r)return!1;for(var i=1,o=r.length;i<o;++i){var s=e[i-1],a="string"==typeof r[i]?decodeURIComponent(r[i]):r[i];s?n[s.name]=a:n.push(a)}return!0};var _n=Object.prototype.hasOwnProperty,En=Array.isArray,Cn=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),Sn={assign:function(t,e){return Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],r=0;r<e.length;++r)for(var i=e[r],o=i.obj[i.prop],s=Object.keys(o),a=0;a<s.length;++a){var p=s[a],u=o[p];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(e.push({obj:o,prop:p}),n.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(En(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,n){var r=t.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode:function(t,e,n){if(0===t.length)return t;var r=t;if("symbol"==typeof t?r=Symbol.prototype.toString.call(t):"string"!=typeof t&&(r=String(t)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var i="",o=0;o<r.length;++o){var s=r.charCodeAt(o);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?i+=r.charAt(o):s<128?i+=Cn[s]:s<2048?i+=Cn[192|s>>6]+Cn[128|63&s]:s<55296||s>=57344?i+=Cn[224|s>>12]+Cn[128|s>>6&63]+Cn[128|63&s]:(o+=1,s=65536+((1023&s)<<10|1023&r.charCodeAt(o)),i+=Cn[240|s>>18]+Cn[128|s>>12&63]+Cn[128|s>>6&63]+Cn[128|63&s])}return i},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},merge:function t(e,n,r){if(!n)return e;if("object"!=typeof n){if(En(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(r&&(r.plainObjects||r.allowPrototypes)||!_n.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var i=e;return En(e)&&!En(n)&&(i=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(n[r]=t[r]);return n}(e,r)),En(e)&&En(n)?(n.forEach(function(n,i){if(_n.call(e,i)){var o=e[i];o&&"object"==typeof o&&n&&"object"==typeof n?e[i]=t(o,n,r):e.push(n)}else e[i]=n}),e):Object.keys(n).reduce(function(e,i){var o=n[i];return _n.call(e,i)?e[i]=t(e[i],o,r):e[i]=o,e},i)}},An=String.prototype.replace,kn=/%20/g,In={RFC1738:"RFC1738",RFC3986:"RFC3986"},Tn=Sn.assign({default:In.RFC3986,formatters:{RFC1738:function(t){return An.call(t,kn,"+")},RFC3986:function(t){return String(t)}}},In),Ln=(Object.prototype.hasOwnProperty,Array.isArray,Array.prototype.push,Date.prototype.toISOString),On=Tn.default,Pn=(Tn.formatters[On],Object.prototype.hasOwnProperty),jn=Array.isArray,Nn={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:Sn.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Mn=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},Dn=function(t,e,n){if(t){var r=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,o=n.depth>0&&/(\[[^[\]]*])/.exec(r),s=o?r.slice(0,o.index):r,a=[];if(s){if(!n.plainObjects&&Pn.call(Object.prototype,s)&&!n.allowPrototypes)return;a.push(s)}for(var p=0;n.depth>0&&null!==(o=i.exec(r))&&p<n.depth;){if(p+=1,!n.plainObjects&&Pn.call(Object.prototype,o[1].slice(1,-1))&&!n.allowPrototypes)return;a.push(o[1])}return o&&a.push("["+r.slice(o.index)+"]"),function(t,e,n){for(var r=e,i=t.length-1;i>=0;--i){var o,s=t[i];if("[]"===s&&n.parseArrays)o=[].concat(r);else{o=n.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,p=parseInt(a,10);n.parseArrays||""!==a?!isNaN(p)&&s!==a&&String(p)===a&&p>=0&&n.parseArrays&&p<=n.arrayLimit?(o=[])[p]=r:o[a]=r:o={0:r}}r=o}return r}(a,e,n)}},Rn={parse:function(t,e){var n=function(t){if(!t)return Nn;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?Nn.charset:t.charset;return{allowDots:void 0===t.allowDots?Nn.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:Nn.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:Nn.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:Nn.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:Nn.comma,decoder:"function"==typeof t.decoder?t.decoder:Nn.decoder,delimiter:"string"==typeof t.delimiter||Sn.isRegExp(t.delimiter)?t.delimiter:Nn.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:Nn.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:Nn.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:Nn.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:Nn.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:Nn.strictNullHandling}}(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof t?function(t,e){var n,r={},i=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=e.parameterLimit===1/0?void 0:e.parameterLimit,s=i.split(e.delimiter,o),a=-1,p=e.charset;if(e.charsetSentinel)for(n=0;n<s.length;++n)0===s[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===s[n]?p="utf-8":"utf8=%26%2310003%3B"===s[n]&&(p="iso-8859-1"),a=n,n=s.length);for(n=0;n<s.length;++n)if(n!==a){var u,c,h=s[n],l=h.indexOf("]="),f=-1===l?h.indexOf("="):l+1;-1===f?(u=e.decoder(h,Nn.decoder,p,"key"),c=e.strictNullHandling?null:""):(u=e.decoder(h.slice(0,f),Nn.decoder,p,"key"),c=e.decoder(h.slice(f+1),Nn.decoder,p,"value")),c&&e.interpretNumericEntities&&"iso-8859-1"===p&&(c=Mn(c)),c&&"string"==typeof c&&e.comma&&c.indexOf(",")>-1&&(c=c.split(",")),h.indexOf("[]=")>-1&&(c=jn(c)?[c]:c),Pn.call(r,u)?r[u]=Sn.combine(r[u],c):r[u]=c}return r}(t,n):t,i=n.plainObjects?Object.create(null):{},o=Object.keys(r),s=0;s<o.length;++s){var a=o[s],p=Dn(a,r[a],n);i=Sn.merge(i,p,n)}return Sn.compact(i)}},Bn={exports:{}};(function(t){!function(e){var n="object"==typeof Bn.exports&&Bn.exports&&!Bn.exports.nodeType&&Bn.exports,r=Bn&&!Bn.nodeType&&Bn,i="object"==typeof t&&t;i.global!==i&&i.window!==i&&i.self!==i||(e=i);var o,s,a=2147483647,p=36,u=1,c=26,h=38,l=700,f=72,m=128,d="-",y=/^xn--/,v=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=p-u,b=Math.floor,_=String.fromCharCode;function E(t){throw new RangeError(w[t])}function C(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function S(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+C((t=t.replace(g,".")).split("."),e).join(".")}function A(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function k(t){return C(t,function(t){var e="";return t>65535&&(e+=_((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=_(t)}).join("")}function I(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function T(t,e,n){var r=0;for(t=n?b(t/l):t>>1,t+=b(t/e);t>x*c>>1;r+=p)t=b(t/x);return b(r+(x+1)*t/(t+h))}function L(t){var e,n,r,i,o,s,h,l,y,v,g,w=[],x=t.length,_=0,C=m,S=f;for((n=t.lastIndexOf(d))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&E("not-basic"),w.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<x;){for(o=_,s=1,h=p;i>=x&&E("invalid-input"),((l=(g=t.charCodeAt(i++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:p)>=p||l>b((a-_)/s))&&E("overflow"),_+=l*s,!(l<(y=h<=S?u:h>=S+c?c:h-S));h+=p)s>b(a/(v=p-y))&&E("overflow"),s*=v;S=T(_-o,e=w.length+1,0==o),b(_/e)>a-C&&E("overflow"),C+=b(_/e),_%=e,w.splice(_++,0,C)}return k(w)}function O(t){var e,n,r,i,o,s,h,l,y,v,g,w,x,C,S,k=[];for(w=(t=A(t)).length,e=m,n=0,o=f,s=0;s<w;++s)(g=t[s])<128&&k.push(_(g));for(r=i=k.length,i&&k.push(d);r<w;){for(h=a,s=0;s<w;++s)(g=t[s])>=e&&g<h&&(h=g);for(h-e>b((a-n)/(x=r+1))&&E("overflow"),n+=(h-e)*x,e=h,s=0;s<w;++s)if((g=t[s])<e&&++n>a&&E("overflow"),g==e){for(l=n,y=p;!(l<(v=y<=o?u:y>=o+c?c:y-o));y+=p)S=l-v,C=p-v,k.push(_(I(v+S%C,0))),l=b(S/C);k.push(_(I(l,0))),o=T(n,x,r==i),n=0,++r}++n,++e}return k.join("")}if(o={version:"1.4.1",ucs2:{decode:A,encode:k},decode:L,encode:O,toASCII:function(t){return S(t,function(t){return v.test(t)?"xn--"+O(t):t})},toUnicode:function(t){return S(t,function(t){return y.test(t)?L(t.slice(4).toLowerCase()):t})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return o});else if(n&&r)if(Bn.exports==n)r.exports=o;else for(s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);else e.punycode=o}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),Bn=Bn.exports;var Fn={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function Un(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var $n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},qn=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},Vn=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function zn(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var Hn=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},Gn={parse:function(t,e,n,r){e=e||"&",n=n||"=";var i={};if("string"!=typeof t||0===t.length)return i;var o=/\+/g;t=t.split(e);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var p=0;p<a;++p){var u,c,h,l,f=t[p].replace(o,"%20"),m=f.indexOf(n);m>=0?(u=f.substr(0,m),c=f.substr(m+1)):(u=f,c=""),h=decodeURIComponent(u),l=decodeURIComponent(c),Un(i,h)?$n(i[h])?i[h].push(l):i[h]=[i[h],l]:i[h]=l}return i},stringify:function(t,e,n,r){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?zn(Hn(t),function(r){var i=encodeURIComponent(qn(r))+n;return Vn(t[r])?zn(t[r],function(t){return i+encodeURIComponent(qn(t))}).join(e):i+encodeURIComponent(qn(t[r]))}).join(e):r?encodeURIComponent(qn(r))+n+encodeURIComponent(qn(t)):""}},Kn={};function Qn(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}Kn.parse=ar,Kn.resolve=function(t,e){return ar(t,!1,!0).resolve(e)};var Jn=/^([a-z0-9.+-]+:)/i,Wn=/:[0-9]*$/,Yn=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Xn=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Zn=["'"].concat(Xn),tr=["%","/","?",";","#"].concat(Zn),er=["/","?","#"],nr=/^[+a-z0-9A-Z_-]{0,63}$/,rr=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,ir={javascript:!0,"javascript:":!0},or={javascript:!0,"javascript:":!0},sr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function ar(t,e,n){if(t&&Fn.isObject(t)&&t instanceof Qn)return t;var r=new Qn;return r.parse(t,e,n),r}Qn.prototype.parse=function(t,e,n){if(!Fn.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),i=-1!==r&&r<t.indexOf("#")?"?":"#",o=t.split(i);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(i);if(s=s.trim(),!n&&1===t.split("#").length){var a=Yn.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?Gn.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var p=Jn.exec(s);if(p){var u=(p=p[0]).toLowerCase();this.protocol=u,s=s.substr(p.length)}if(n||p||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var c="//"===s.substr(0,2);!c||p&&or[p]||(s=s.substr(2),this.slashes=!0)}if(!or[p]&&(c||p&&!sr[p])){for(var h,l,f=-1,m=0;m<er.length;m++){-1!==(d=s.indexOf(er[m]))&&(-1===f||d<f)&&(f=d)}-1!==(l=-1===f?s.lastIndexOf("@"):s.lastIndexOf("@",f))&&(h=s.slice(0,l),s=s.slice(l+1),this.auth=decodeURIComponent(h)),f=-1;for(m=0;m<tr.length;m++){var d;-1!==(d=s.indexOf(tr[m]))&&(-1===f||d<f)&&(f=d)}-1===f&&(f=s.length),this.host=s.slice(0,f),s=s.slice(f),this.parseHost(),this.hostname=this.hostname||"";var y="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!y)for(var v=this.hostname.split(/\./),g=(m=0,v.length);m<g;m++){var w=v[m];if(w&&!w.match(nr)){for(var x="",b=0,_=w.length;b<_;b++)w.charCodeAt(b)>127?x+="x":x+=w[b];if(!x.match(nr)){var E=v.slice(0,m),C=v.slice(m+1),S=w.match(rr);S&&(E.push(S[1]),C.unshift(S[2])),C.length&&(s="/"+C.join(".")+s),this.hostname=E.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=Bn.toASCII(this.hostname));var A=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+A,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!ir[u])for(m=0,g=Zn.length;m<g;m++){var I=Zn[m];if(-1!==s.indexOf(I)){var T=encodeURIComponent(I);T===I&&(T=escape(I)),s=s.split(I).join(T)}}var L=s.indexOf("#");-1!==L&&(this.hash=s.substr(L),s=s.slice(0,L));var O=s.indexOf("?");if(-1!==O?(this.search=s.substr(O),this.query=s.substr(O+1),e&&(this.query=Gn.parse(this.query)),s=s.slice(0,O)):e&&(this.search="",this.query={}),s&&(this.pathname=s),sr[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){A=this.pathname||"";var P=this.search||"";this.path=A+P}return this.href=this.format(),this},Qn.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&Fn.isObject(this.query)&&Object.keys(this.query).length&&(o=Gn.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||sr[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+i+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+r},Qn.prototype.resolve=function(t){return this.resolveObject(ar(t,!1,!0)).format()},Qn.prototype.resolveObject=function(t){if(Fn.isString(t)){var e=new Qn;e.parse(t,!1,!0),t=e}for(var n=new Qn,r=Object.keys(this),i=0;i<r.length;i++){var o=r[i];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var p=s[a];"protocol"!==p&&(n[p]=t[p])}return sr[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!sr[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var h=u[c];n[h]=t[h]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||or[t.protocol])n.pathname=t.pathname;else{for(var l=(t.pathname||"").split("/");l.length&&!(t.host=l.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==l[0]&&l.unshift(""),l.length<2&&l.unshift(""),n.pathname=l.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var f=n.pathname||"",m=n.search||"";n.path=f+m}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var d=n.pathname&&"/"===n.pathname.charAt(0),y=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=y||d||n.host&&t.pathname,g=v,w=n.pathname&&n.pathname.split("/")||[],x=(l=t.pathname&&t.pathname.split("/")||[],n.protocol&&!sr[n.protocol]);if(x&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===l[0]?l[0]=t.host:l.unshift(t.host)),t.host=null),v=v&&(""===l[0]||""===w[0])),y)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,w=l;else if(l.length)w||(w=[]),w.pop(),w=w.concat(l),n.search=t.search,n.query=t.query;else if(!Fn.isNullOrUndefined(t.search)){if(x)n.hostname=n.host=w.shift(),(S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=S.shift(),n.host=n.hostname=S.shift());return n.search=t.search,n.query=t.query,Fn.isNull(n.pathname)&&Fn.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!w.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var b=w.slice(-1)[0],_=(n.host||t.host||w.length>1)&&("."===b||".."===b)||""===b,E=0,C=w.length;C>=0;C--)"."===(b=w[C])?w.splice(C,1):".."===b?(w.splice(C,1),E++):E&&(w.splice(C,1),E--);if(!v&&!g)for(;E--;E)w.unshift("..");!v||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),_&&"/"!==w.join("/").substr(-1)&&w.push("");var S,A=""===w[0]||w[0]&&"/"===w[0].charAt(0);x&&(n.hostname=n.host=A?"":w.length?w.shift():"",(S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=S.shift(),n.host=n.hostname=S.shift()));return(v=v||n.host&&w.length)&&!A&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),Fn.isNull(n.pathname)&&Fn.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},Qn.prototype.parseHost=function(){var t=this.host,e=Wn.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var pr={render:function(t,e,n){var r=new ur(t.app.page,t.routes,e,n);r.routeTransitional(0,function(){r.page=t.page(),r.routeQueue(0,function(){r.cancel()})})},isTransitional:function(t){return t.hasOwnProperty("from")&&t.hasOwnProperty("to")},mapRoute:function(t,e){var n=~(r=e.url.indexOf("?"))?e.url.slice(r):"",r=0;return t.replace(/\/(?:(?:\:([^?\/:*(]+)(?:\([^)]+\))?)|\*)(\?)?/g,function(t,n,i){var o=n?e[n]:e[r++];return i&&null==o?"":"/"+encodeURIComponent(o)})+n}};function ur(t,e,n,r){this.page=t,this.options=n,this.e=r,this.setUrl(n.url.replace(/#.*/,""));var i=Kn.parse(this.url).query;this.query=i?Rn.parse(i):{},this.method=n.method,this.body=n.body||{},this.setPrevious(n.previous),this.transitional=e.transitional[this.method],this.queue=e.queue[this.method],this.app=e.app}ur.prototype.cancel=function(){var t=this.options;this.e||t.noNavigate||(t.form?(t.form.setAttribute("data-router-ignore",""),t.form.submit()):window.location.assign(t.url))},ur.prototype.setUrl=function(t){this.url=t,this.path=t.replace(/\?.*/,"")},ur.prototype.setPrevious=function(t){this.previous=t,this.previousPath=t&&t.replace(/\?.*/,"")},ur.prototype.routeTransitional=function(t,e){var n;for(t||(t=0);n=this.transitional[t++];){if(n.to.match(this.path)&&n.from.match(this.previousPath)){var r=this,i=this.routeParams(n.to);return void this.onMatch(n.to,i,function(n){if(n)return r.cancel();r.routeTransitional(t,e)},o)}function o(){}}e()},ur.prototype.routeQueue=function(t,e){var n;for(t||(t=0);n=this.queue[t++];)if(n.match(this.path)){var r=this,i=this.routeParams(n);return void this.onMatch(n,i,function(n){if(n)return r.cancel();r.routeQueue(t,e)})}e()},ur.prototype.onMatch=function(t,e,n,r){if(!this.page)return n();this.e&&(this.e.preventDefault(),this.e=null),this.page.params=e,t.isTransitional?this.app.onRoute(t.callbacks,this.page,n,r):this.app.onRoute(t.callbacks,this.page,n)},ur.prototype.routeParams=function(t){var e=t.params,n=e.slice();for(var r in e)n[r]=e[r];return n.previous=this.previous,n.url=this.url,n.body=this.body,n.query=this.query,n.method=this.method,n};var cr=Kn.parse,hr=Kn.resolve,lr=window.location.pathname+window.location.search;window.history.replaceState&&window.history.replaceState({$render:!0,$method:"get"},null,window.location.href);var fr=mr;function mr(t,e){this.app=t,this.routes=e,window.history.pushState?function(t){document.addEventListener("click",function(e){var n=e.target;if(e.metaKey||1!==e.which)return;if(e.defaultPrevented)return;for(;n;){var r=n.href;if(r){if(n.hasAttribute&&n.hasAttribute("data-router-ignore"))return;if(n.target&&"_self"!==n.target)return;var i=r.indexOf("#");if(~i&&r.slice(0,i)===window.location.href.replace(/#.*/,""))return;return e._tracksLink=n,void t.push(r,!0,null,e)}n=n.parentNode}},!0),document.addEventListener("submit",function(e){var n=e.target;if(e.defaultPrevented)return;if("form"!==n.tagName.toLowerCase())return;if("multipart/form-data"===n.enctype)return;if(n.hasAttribute&&n.hasAttribute("data-router-ignore"))return;var r=n.action||window.location.href;t.push(r,!0,null,e)},!1),window.addEventListener("popstate",function(e){if(!t.app.page)return;var n=lr,r=e.state;lr=window.location.pathname+window.location.search;var i={previous:n,url:lr};if(r){if(!r.$render)return;return i.method=r.$method,pr.render(t,i)}var o,s,a=window.location.href,p=a.indexOf("#");~p&&lr!==n&&(i.method="get",pr.render(t,i),s=a.slice(p+1),(o=document.getElementById(s)||document.getElementsByName(s)[0])&&o.scrollIntoView())},!0)}(this):(this.push=function(t){window.location.assign(t)},this.replace=function(t){window.location.replace(t)})}function dr(t){var e=cr(t);return e&&e.protocol===window.location.protocol&&e.host===window.location.host&&e.pathname+(e.search||"")}mr.prototype.push=function(t,e,n,r){this._update("pushState",t,e,n,r)},mr.prototype.replace=function(t,e,n,r){this._update("replaceState",t,e,n,r)},mr.prototype.refresh=function(){var t=dr(window.location.href);pr.render(this,{url:t,method:"get"})},mr.prototype.back=function(){window.history.back()},mr.prototype.forward=function(){window.history.forward()},mr.prototype.go=function(t){window.history.go(t)},mr.prototype._update=function(t,e,n,r,i){var o=dr(hr(window.location.href,e));if(o){null==n&&(n=!0),null==r&&(r={});var s=function(t,e){if(t&&"submit"===t.type){for(var n,r=t.target,i=r.elements,o=[],s=0,a=i.length;s<a;s++){var p=(n=i[s]).name;if(p){var u=n.value;if(o.push(encodeURIComponent(p)+"="+encodeURIComponent(u)),"_method"===p){var c=u.toLowerCase();"delete"===c&&(c="del")}}}if(o=o.join("&"),"post"===r.method.toLowerCase())var h=c||"post",l=Rn.parse(o);else h="get",e+="?"+o}else h="get";return{method:h,url:e,previous:window.location.pathname+window.location.search,body:l,form:r,link:t&&t._tracksLink}}(i,o);r.$render=!0,r.$method=s.method,window.history[t](r,null,s.url),lr=window.location.pathname+window.location.search,n&&pr.render(this,s,i)}},mr.prototype.page=function(){var t=this.app.createPage(),e=this;return t.redirect=function(t){if("back"===t)return e.back();"home"===t&&(t="\\"),e.replace(t,!0)},t};var yr={},vr=yr=pr;vr.setup=function(t){var e={queue:{},transitional:{},app:t};t.history=new fr(t,e),["get","post","put","del","enter","exit"].forEach(function(n){var r=e.queue[n]=[],i=e.transitional[n]=[];t[n]=function(e,o){if(Array.isArray(e))return e.forEach(function(e){t[n](e,o)}),t;if(vr.isTransitional(e)){var s=e.from,a=e.to,p=e.forward||o&&o.forward||o,u=e.back||o&&o.back,c=new xn(n,s,u),h=new xn(n,a,p);return c.isTransitional=!0,h.isTransitional=!0,i.push({from:c,to:h}),u&&i.push({from:h,to:c}),t}return r.push(new xn(n,e,o)),t}})};var gr=Array.isArray,wr=Object.keys,xr=Object.prototype.hasOwnProperty,br=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var r,i,o,s=gr(e),a=gr(n);if(s&&a){if((i=e.length)!=n.length)return!1;for(r=i;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(s!=a)return!1;var p=e instanceof Date,u=n instanceof Date;if(p!=u)return!1;if(p&&u)return e.getTime()==n.getTime();var c=e instanceof RegExp,h=n instanceof RegExp;if(c!=h)return!1;if(c&&h)return e.toString()==n.toString();var l=wr(e);if((i=l.length)!==wr(n).length)return!1;for(r=i;0!=r--;)if(!xr.call(n,l[r]))return!1;for(r=i;0!=r--;)if(!t(e[o=l[r]],n[o]))return!1;return!0}return e!=e&&n!=n},_r={};(function(t){var e="browser"!==t.title;function n(t){this.cb=t,this.isDone=!1,this.count=0}function r(t){var e=new t.constructor;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function i(t){return t!=t}function o(t){return/^[0-9]+$/.test(t)}function s(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}_r.isServer=e,_r.asyncGroup=function(t){var e=new n(t);return function(){return e.add()}},_r.castSegments=function(t){for(var e=t.length;e--;){var n=t[e];"string"==typeof n&&o(n)&&(t[e]=+n)}return t},_r.contains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},_r.copy=function(t){if(t instanceof Date)return new Date(t);if("object"==typeof t)return null===t?null:Array.isArray(t)?t.slice():r(t);return t},_r.copyObject=r,_r.deepCopy=function t(e){if(e instanceof Date)return new Date(e);if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){for(var n=[],r=e.length;r--;)n[r]=t(e[r]);return n}var i=new e.constructor;for(var o in e)e.hasOwnProperty(o)&&(i[o]=t(e[o]));return i}return e},_r.deepEqual=br,_r.equal=function(t,e){return t===e||i(t)&&i(e)},_r.equalsNaN=i,_r.isArrayIndex=o,_r.lookup=function(t,e){if(!t)return e;for(var n=0,r=t.length;n<r;n++){if(null==e)return e;e=e[t[n]]}return e},_r.mergeInto=function(t,e){for(var n in e)t[n]=e[n];return t},_r.mayImpact=s,_r.mayImpactAny=function(t,e){for(var n=0,r=t.length;n<r;n++)if(s(t[n],e))return!0;return!1},_r.serverRequire=function(t,n){if(!e)return;return t.require(n)},_r.serverUse=function(t,n,r){if(!e)return this;var i=t.require(n);return this.use(i,r)},_r.use=function(t,e){var n=this._plugins||(this._plugins=[]);-1===n.indexOf(t)&&(n.push(t),t(this,e));return this},n.prototype.add=function(){this.count++;var t=this;return function(e){if(t.count--,!t.isDone)return e?(t.isDone=!0,void t.cb(e)):void(t.count>0||(t.isDone=!0,t.cb()))}}}).call(this,en);var Er=Cr;function Cr(t){this.controller=t,this._listeners=null}function Sr(t,e,n,r){this.type=t,this.target=e,this.listener=n,this.useCapture=!!r}function Ar(t,e){Sr.call(this,"destroy",t,e)}Cr.prototype._initListeners=function(){var t=this;return this.controller.on("destroy",function(){var e=t._listeners;if(e){for(var n=e.length;n--;)e[n].remove();t._listeners=null}}),this._listeners=[]},Cr.prototype._listenerIndex=function(t){var e=this._listeners;if(!e)return-1;for(var n=e.length;n--;)if(e[n].equals(t))return n;return-1},Cr.prototype.addListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i="destroy"===t?new Ar(e,n):new Sr(t,e,n,r);-1===this._listenerIndex(i)&&(this._listeners||this._initListeners()).push(i);i.add()},Cr.prototype.on=Cr.prototype.addListener,Cr.prototype.once=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document),this.addListener(t,e,function o(){i.removeListener(t,e,o,r);return n.apply(this,arguments)},r);var i=this},Cr.prototype.removeListener=function(t,e,n,r){"function"==typeof e&&(r=n,n=e,e=document);var i=new Sr(t,e,n,r);i.remove();var o=this._listenerIndex(i);o>-1&&this._listeners.splice(o,1)},Sr.prototype.equals=function(t){return this.listener===t.listener&&this.target===t.target&&this.type===t.type&&this.useCapture===t.useCapture},Sr.prototype.add=function(){this.target.addEventListener(this.type,this.listener,this.useCapture)},Sr.prototype.remove=function(){this.target.removeEventListener(this.type,this.listener,this.useCapture)},Ar.prototype=new Sr,Ar.prototype.add=function(){var t=this.target.$destroyListeners||(this.target.$destroyListeners=[]);-1===t.indexOf(this.listener)&&t.push(this.listener)},Ar.prototype.remove=function(){var t=this.target.$destroyListeners;if(t){var e=t.indexOf(this.listener);-1!==e&&t.splice(e,1)}};var kr=Jt.EventEmitter,Ir=Tr;function Tr(t,e,n){kr.call(this),this.dom=new Er(this),this.app=t,this.page=e,this.model=n,n.data.$controller=this}_r.mergeInto(Tr.prototype,kr.prototype),Tr.prototype.emitCancellable=function(){var t=!1;var e=Array.prototype.slice.call(arguments);return e.push(function(){t=!0}),this.emit.apply(this,e),t},Tr.prototype.emitDelayable=function(){var t=Array.prototype.slice.call(arguments),e=t.pop(),n=!1;return t.push(function(){return n=!0,e}),this.emit.apply(this,t),n||e(),n};var Lr={},Or=Tt.templates,Pr=Tt.expressions,jr=[].slice;function Nr(t,e){var n=t.controller,r=t.id(),i=["$components",r],o=n.model.root.eventContext(r);o._at=i.join("."),e.id=r,o._set(i,e),o.data=e,Ir.call(this,n.app,n.page,o),this.parent=n,this.context=t.componentChild(this),this.id=r,this._scope=i,this.page._components[r]=this,this.isDestroyed=!1}function Mr(t,e,n){this.expression=t,this.model=e,this.key=n}function Dr(t,e,n,r){this.template=new Mr(t,e,n),this.context=r,this.condition=t.get(r)}function Rr(t,e,n,r){if(r instanceof Pr.Expression){var i=r.pathSegments(t);if(i)e.root.ref(e._at+"."+n,i.join("."),{updateIndices:!0});else{var o=new Dr(r,e,n,t);t.addBinding(o),e.set(n,o.condition)}}else if(r instanceof Or.Template){var s=new Or.ContextClosure(r,t);e.set(n,s)}else e.set(n,r)}function Br(){this.id=null,this.$controller=null}function Fr(t){this.constructor=t}function Ur(){}function $r(t){this.constructor=t,this.component=null,t.prototype.destroy=Ur}function qr(t){return t===Object.prototype||t===Function.prototype||null===t}Lr.Component=Nr,Lr.ComponentAttributeBinding=Dr,Lr.createFactory=function(t){return t.singleton||t.prototype.singleton?new $r(t):new Fr(t)},Lr.extendComponent=function(t){if(t.prototype instanceof Nr)return;Vr(t)},_r.mergeInto(Nr.prototype,Ir.prototype),Nr.prototype.destroy=function(){this.emit("destroy"),this.model.removeContextListeners(),this.model.destroy(),delete this.page._components[this.id];var t=this.page._eventModel.object.$components;t&&delete t.object[this.id],this.isDestroyed=!0},Nr.prototype.bind=function(t){var e=this;return this.on("destroy",function(){e=null,t=null}),function(){if(t)return t.apply(e,arguments)}},Nr.prototype.throttle=function(t,e){var n=this;if(this.on("destroy",function(){n=null,t=null}),null==e||"number"==typeof e){var r,i=e||0,o=function(){var e=s;s=null,r=+new Date,t&&e&&t.apply(n,e)};return function(){var t=!s;if(s=jr.call(arguments),t){var e=+new Date,n=Math.max(r+i-e,0);setTimeout(o,n)}}}if("function"==typeof e){var s;o=function(){var e=s;s=null,t&&e&&t.apply(n,e)};return function(){var t=!s;s=jr.call(arguments),t&&e(o)}}throw new Error("Second argument must be a delay function or number")},Nr.prototype.debounce=function(t,e){if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var n,r,i=this;this.on("destroy",function(){i=null,t=null});var o=function(){var e=n;n=null,r=null,t&&e&&t.apply(i,e)};return function(){n=jr.call(arguments),r&&clearTimeout(r),r=setTimeout(o,e)}},Nr.prototype.debounceAsync=function(t,e){var n=1!==t.length;if("number"!=typeof(e=e||0))throw new Error("Second argument must be a number");var r=this;this.on("destroy",function(){r=null,t=null});var i,o,s=!1;function a(){var e=i;i=null,o=null,t&&e?(s=!0,e.push(a),t.apply(r,e)):s=!1}return function(){i=n?jr.call(arguments):[],o&&clearTimeout(o),s||(o=setTimeout(a,e))}},Nr.prototype.get=function(t,e){return this.getView(t).get(this.context,e)},Nr.prototype.getFragment=function(t){return this.getView(t).getFragment(this.context)},Nr.prototype.getView=function(t){var e=this.context.getView();return t?this.app.views.find(t,e.namespace):e},Nr.prototype.getAttribute=function(t){var e=this.context.forAttribute(t);if(e){var n=e.attributes[t];return n instanceof Pr.Expression&&(n=n.get(e)),Pr.renderValue(n,this.context)}},Nr.prototype.setAttribute=function(t,e){this.context.parent.attributes[t]=e},Nr.prototype.setNullAttribute=function(t,e){var n=this.context.parent.attributes;null==n[t]&&(n[t]=e)},Mr.prototype.update=function(t,e){var n=this.expression.get(t);e.condition=n,this.model.setDiff(this.key,n)},Dr.prototype=Object.create(Or.Binding.prototype),Dr.prototype.constructor=Dr,Fr.prototype.init=function(t){var e=new(this.constructor.DataConstructor||Br),n=new this.constructor(t,e);return n.context||Nr.call(n,t,e),function(t,e){var n=t.parent.attributes;if(n)for(var r in n)Rr(t,e,r,n[r])}(n.context,n.model),function(t,e){if(t.initHooks)for(var n=0,r=t.initHooks.length;n<r;n++)t.initHooks[n].emit(t,e)}(t,n),n.emit("init",n),n.init&&n.init(n.model),n.context},Fr.prototype.create=function(t){var e=t.controller;e.emit("create",e),e.create&&e.create(e.model,e.dom)},$r.prototype.isSingleton=!0,$r.prototype.init=function(t){return this.component||(this.component=new this.constructor),t.componentChild(this.component)},$r.prototype.create=Ur;var Vr=Object.setPrototypeOf&&Object.getPrototypeOf?function(t){var e=function(t){for(;;){var e=Object.getPrototypeOf(t);if(qr(e))return t;t=e}}(t.prototype);e!==Nr.prototype&&Object.setPrototypeOf(e,Nr.prototype)}:function(t){var e=t.prototype;t.prototype=Object.create(Nr.prototype),t.prototype.constructor=t,_r.mergeInto(t.prototype,e)};var zr=Tt.expressions,Hr=Zr,Gr=1;function Kr(t,e,n,r){this.id=Gr++,this.model=t,this.segments=n,this.item=e,this.outside=r,this.result=r.child(e).refChild(this)}function Qr(){}function Jr(){}function Wr(){}function Yr(){}function Xr(){}function Zr(){this.id=Gr++,this.object=null,this.array=null,this.arrayByReference=null,this.refOut=null,this.refChildren=null,this.bindings=null,this.itemContexts=null}function ti(t){for(var e in t)return!0;return!1}function ei(t){t._set()}Kr.prototype.update=function(){var t=zr.pathSegments(this.segments),e=zr.lookup(t,this.model.data);if(this.item!==e){delete this.outside.child(this.item).refChildren[this.id],this.item=e;var n=this.outside.child(this.item);n.refChildren||(n.refChildren=new Jr),n.refChildren[this.id]=this.result,this.result.update()}},Zr.prototype.refChild=function(t){this.refChildren||(this.refChildren=new Jr);var e=t.id;return this.refChildren[e]||(this.refChildren[e]=new Zr),this.refChildren[e]},Zr.prototype.arrayLookup=function(t,e,n){var r=zr.pathSegments(n),i=zr.lookup(r,t.data),o=this.at(n),s=this.at(e);o.refOut||(o.refOut=new Qr);var a=o.refOut[s.id];return null==a&&(a=new Kr(t,i,n,s),o.refOut[s.id]=a),a},Zr.prototype.child=function(t){var e;if("string"==typeof t)this.object||(this.object={}),e=this.object;else if("number"==typeof t)this.array||(this.array=[]),e=this.array;else{if(t instanceof Kr)return t.result;this.arrayByReference||(this.arrayByReference=[]),e=this.arrayByReference,t=t.item}return e[t]||(e[t]=new Zr)},Zr.prototype.at=function(t){if(null==t)return this;for(var e=this,n=0;n<t.length;n++)e=e.child(t[n]);return e},Zr.prototype.isEmpty=function(){if(ti(this.dependancies))return!1;if(ti(this.itemContexts))return!1;if(this.object){if(ti(this.object))return!1;this.object=null}if(this.arrayByReference){for(var t=0;t<this.arrayByReference.length;t++)if(null!=this.arrayByReference[t])return!1;this.arrayByReference=null}if(this.array){for(t=0;t<this.array.length;t++)if(null!=this.array[t])return!1;this.array=null}return!0},Zr.prototype._addItemContext=function(t){t._id||(t._id=Gr++),this.itemContexts||(this.itemContexts=new Yr),this.itemContexts[t._id]=t},Zr.prototype._removeItemContext=function(t){this.itemContexts&&delete this.itemContexts[t._id]},Zr.prototype._addBinding=function(t){var e=this.bindings||(this.bindings=new Wr);t.eventModels||(t.eventModels=new Xr),e[t.id]=t,t.eventModels[this.id]=this},Zr.prototype.addBinding=function(t,e){this.at(t)._addBinding(e)},Zr.prototype.addItemContext=function(t,e){this.at(t)._addItemContext(e)},Zr.prototype.removeBinding=function(t){if(t.eventModels){for(var e in t.eventModels){var n=t.eventModels[e];n.bindings&&delete n.bindings[t.id]}t.eventModels=null}},Zr.prototype._each=function(t,e,n){if(this.refChildren)for(var r in this.refChildren){var i=this.refChildren[r];i&&i._each(t,e,n)}if(t.length!==e){var o,s=t[e];"string"==typeof s?(o=this.object&&this.object[s])&&o._each(t,e+1,n):((o=this.array&&this.array[s])&&o._each(t,e+1,n),(o=this.arrayByReference&&this.arrayByReference[s])&&o._each(t,e+1,n))}else n(this)},Zr.prototype.localUpdate=function(t,e){if(this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.update(t,e)}if(this.refOut)for(var n in this.refOut){var i=this.refOut[n];i&&i.update()}},Zr.prototype.update=function(t,e){if(this.localUpdate(t,e),this.object)for(var n in this.object){(i=this.object[n])&&i.update()}if(this.array)for(var r=0;r<this.array.length;r++){(i=this.array[r])&&i.update()}if(this.arrayByReference)for(r=0;r<this.arrayByReference.length;r++){var i;(i=this.arrayByReference[r])&&i.update()}},Zr.prototype._updateChildItemContexts=function(t,e){if(this.arrayByReference){null==t&&(t=0),null==e&&(e=this.arrayByReference.length);for(var n=t;n<e;n++){var r=this.arrayByReference[n]&&this.arrayByReference[n].itemContexts;if(r)for(var i in r)r[i].item=n}}},Zr.prototype._updateArray=function(t,e){if(this.array){null==t&&(t=0),null==e&&(e=this.array.length);for(var n=t;n<e;n++){var r=this.array[n];r&&r.update()}}},Zr.prototype._updateObject=function(){if(this.object)for(var t in this.object){var e=this.object[t];e&&e.update()}},Zr.prototype._set=function(t,e){this.update(t,e)},Zr.prototype._insert=function(t,e){if(this._updateArray(t),this.arrayByReference&&this.arrayByReference.length>t){for(var n=0;n<e;n++)this.arrayByReference.splice(t,0,null);this._updateChildItemContexts(t+e)}if(this.bindings)for(var r in this.bindings){var i=this.bindings[r];i&&i.insert(t,e)}this._updateObject()},Zr.prototype._remove=function(t,e){if(this._updateArray(t),this.arrayByReference&&(this.arrayByReference.splice(t,e),this._updateChildItemContexts(t)),this.bindings)for(var n in this.bindings){var r=this.bindings[n];r&&r.remove(t,e)}this._updateObject()},Zr.prototype._move=function(t,e,n){var r,i;t<e?(r=t,i=e+n):(r=e,i=t+n),this._updateArray(r,i);var o=this.arrayByReference;if(o&&o.length>r){var s=o.splice(t,n);o.splice.apply(o,[e,0].concat(s)),this._updateChildItemContexts(r,i)}if(this.bindings)for(var a in this.bindings){var p=this.bindings[a];p&&p.move(t,e,n)}this._updateObject()},Zr.prototype.mutate=function(t,e){this._each(t,0,e);for(var n=0,r=t.length;n++<r;){var i=t.slice(0,n);i.push("*"),this._each(i,0,ei)}},Zr.prototype.set=function(t,e,n){this.mutate(t,function(t){t._set(e,n)})},Zr.prototype.insert=function(t,e,n){this.mutate(t,function(t){t._insert(e,n)})},Zr.prototype.remove=function(t,e,n){this.mutate(t,function(t){t._remove(e,n)})},Zr.prototype.move=function(t,e,n,r){this.mutate(t,function(t){t._move(e,n,r)})};var ni={};function ri(t,e,n){var r=n(t.selectionStart),i=n(t.selectionEnd),o=t.scrollTop;t.value=e,t.scrollTop!==o&&(t.scrollTop=o),document.activeElement===t&&(t.selectionStart=r,t.selectionEnd=i)}ni.onStringInsert=function(t,e,n,r){e||(e="");var i=e.slice(0,n)+r+e.slice(n);ri(t,i,function(t){return n<t?t+r.length:t})},ni.onStringRemove=function(t,e,n,r){e||(e="");var i=e.slice(0,n)+e.slice(n+r);ri(t,i,function(t){return n<t?t-Math.min(r,t-n):t})},ni.onTextInput=function(t,e,n){var r=t._get(e)||"";if(r===n)return;var i=0;for(;r.charAt(i)===n.charAt(i);)i++;var o=0;for(;r.charAt(r.length-1-o)===n.charAt(n.length-1-o)&&o+i<r.length&&o+i<n.length;)o++;if(r.length!==i+o){var s=r.length-i-o;t._stringRemove(e,i,s)}if(n.length!==i+o){var a=n.slice(i,n.length-o);t._stringInsert(e,i,a)}};var ii={};function oi(t){var e=t.type;return"text"===e||"textarea"===e||"search"===e||"url"===e||"tel"===e||"password"===e}function si(t){var e=t.type;return"number"===e||"range"===e&&!t.multiple}ii.add=function(t){t.addEventListener("input",pi,!0),t.addEventListener("change",ui,!0),parseFloat(window.navigator.appVersion.split("MSIE ")[1])<=9&&t.addEventListener("selectionchange",function(t){document.activeElement&&pi({target:document.activeElement})},!0);var e=document.createElement("input");if(e.type="number",e.value="7",e.valueAsNumber!=e.valueAsNumber){var n=ai;ai=function(t){return"number"===t.type?si(t)?parseFloat(t.value):t.value:n.apply(this,arguments)}}},ii.inputSupportsSelection=oi;var ai=function(t){return si(t)?t.valueAsNumber:t.value};function pi(t){var e=t.target;"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName||hi(t,e)}function ui(t){var e=t.target;"INPUT"===e.tagName?(ci(e,"checked"),hi(t,e)):"SELECT"===e.tagName?function t(e){for(var n=e.firstChild;n;n=n.nextSibling)"OPTION"===n.tagName?ci(n,"selected"):n.hasChildNodes()&&t(n)}(e):"TEXTAREA"===e.tagName&&hi(t,e)}function ci(t,e){var n=t.$bindAttributes&&t.$bindAttributes[e];if(n&&!n.isUnbound()){var r=t[e];n.template.expression.set(n.context,r)}}function hi(t,e){var n=e.$bindAttributes&&e.$bindAttributes.value;if(n&&!n.isUnbound())if(oi(e)){var r={$event:t};!function(t,e,n){var r=t.template.expression,i=r.pathSegments(t.context);if(i){var o=t.context.controller.model.pass(n);ni.onTextInput(o,i,e)}else r.set&&r.set(t.context,e)}(n,e.value,r)}else{var i=ai(e);n.template.expression.set(n.context,i)}}var li=Tt.contexts,fi=Tt.expressions,mi=Tt.templates,di=Tt.options.DependencyOptions,yi=vi;function vi(t,e){Ir.call(this,t,this,e),this.params=null,this.init&&this.init(e),this.context=this._createContext(),this._eventModel=null,this._removeModelListeners=null,this._components={},this._addListeners()}function gi(t,e,n){new xi(t,e,n).updateDependencies()}_r.mergeInto(vi.prototype,Ir.prototype),vi.prototype.$bodyClass=function(t){if(t){for(var e=[],n=t.split(":"),r=0,i=n.length;r<i;r++){var o=n.slice(0,r+1).join("-");e.push(o)}return e.join(" ")}},vi.prototype.$preventDefault=function(t){t.preventDefault()},vi.prototype.$stopPropagation=function(t){t.stopPropagation()},vi.prototype._setRenderParams=function(t){this.model.set("$render.ns",t),this.model.set("$render.params",this.params),this.model.set("$render.url",this.params&&this.params.url),this.model.set("$render.query",this.params&&this.params.query)},vi.prototype._setRenderPrefix=function(t){var e=t?t+":":"";this.model.set("$render.prefix",e)},vi.prototype.get=function(t,e,n){return this._setRenderPrefix(e),this.getView(t,e).get(this.context,n)},vi.prototype.getFragment=function(t,e){return this._setRenderPrefix(e),this.getView(t,e).getFragment(this.context)},vi.prototype.getView=function(t,e){return this.app.views.find(t,e)},vi.prototype.render=function(t){this.app.emit("render",this),this.context.pause(),this._setRenderParams(t);var e=this.getFragment("TitleElement",t),n=this.getFragment("BodyElement",t),r=document.getElementsByTagName("title")[0];r.parentNode.replaceChild(e,r),document.body.parentNode.replaceChild(n,document.body),this.context.unpause(),this.create&&this.create(this.model,this.dom),this.app.emit("routeDone",this,"render")},vi.prototype.attach=function(){this.context.pause();var t=this.model.get("$render.ns"),e=this.getView("TitleElement",t),n=this.getView("BodyElement",t),r=document.getElementsByTagName("title")[0];e.attachTo(r.parentNode,r,this.context),n.attachTo(document.body.parentNode,document.body,this.context),this.context.unpause(),this.create&&this.create(this.model,this.dom)},vi.prototype._createContext=function(){var t=new li.ContextMeta;t.views=this.app&&this.app.views;var e=new li.Context(t,this);return e.expression=new fi.PathExpression([]),e.alias="#root",e},vi.prototype._addListeners=function(){var t=this._eventModel=new Hr;this._addModelListeners(t),this._addContextListeners(t)},vi.prototype.destroy=function(){for(var t in this.emit("destroy"),this._removeModelListeners(),this._components){this._components[t].destroy()}var e=this.model.silent();e.destroy("_page"),e.destroy("$components"),e.unloadAll&&e.unloadAll()},vi.prototype._addModelListeners=function(t){var e=this.model;if(e){if(function(t){var e=!0,n=t.on("changeImmediate",function(r,i){t.removeListener("changeImmediate",n),e=Array.isArray(i)});return t.set("$derby.testEvent",!0),e}(e))return this._addModelListenersLegacy(t);var n=e.on("changeImmediate",function(e,n){e=_r.castSegments(e.slice()),t.set(e,n.previous,n.pass)}),r=e.on("loadImmediate",function(e){e=_r.castSegments(e.slice()),t.set(e)}),i=e.on("unloadImmediate",function(e,n){e=_r.castSegments(e.slice()),t.set(e,n.previous)}),o=e.on("insertImmediate",function(e,n){e=_r.castSegments(e.slice()),t.insert(e,n.index,n.values.length)}),s=e.on("removeImmediate",function(e,n){e=_r.castSegments(e.slice()),t.remove(e,n.index,n.values.length)}),a=e.on("moveImmediate",function(e,n){e=_r.castSegments(e.slice()),t.move(e,n.from,n.to,n.howMany)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",r),e.removeListener("unloadImmediate",i),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},vi.prototype._addModelListenersLegacy=function(t){var e=this.model;if(e){var n=e.on("changeImmediate",function(e,n){var r=n[1],i=n[2];e=_r.castSegments(e.slice()),t.set(e,r,i)}),r=e.on("loadImmediate",function(e){e=_r.castSegments(e.slice()),t.set(e)}),i=e.on("unloadImmediate",function(e){e=_r.castSegments(e.slice()),t.set(e)}),o=e.on("insertImmediate",function(e,n){var r=n[0],i=n[1];e=_r.castSegments(e.slice()),t.insert(e,r,i.length)}),s=e.on("removeImmediate",function(e,n){var r=n[0],i=n[1];e=_r.castSegments(e.slice()),t.remove(e,r,i.length)}),a=e.on("moveImmediate",function(e,n){var r=n[0],i=n[1],o=n[2];e=_r.castSegments(e.slice()),t.move(e,r,i,o)});this._removeModelListeners=function(){e.removeListener("changeImmediate",n),e.removeListener("loadImmediate",r),e.removeListener("unloadImmediate",i),e.removeListener("insertImmediate",o),e.removeListener("removeImmediate",s),e.removeListener("moveImmediate",a)}}},vi.prototype._addContextListeners=function(t){this.context.meta.addBinding=function(e){!function(t){t instanceof mi.AttributeBinding&&"value"===t.name&&("INPUT"===t.element.tagName||"TEXTAREA"===t.element.tagName)&&ii.inputSupportsSelection(t.element)&&t.template.expression.resolve(t.context)&&(t.update=bi)}(e);var n=e.template.expressions;if(n)for(var r=0,i=n.length;r<i;r++)gi(t,n[r],e);else{var o=e.template.expression;gi(t,o,e)}},this.context.meta.removeBinding=function(e){var n=e.meta;if(!n)return;for(var r=n.length;r--;)t.removeBinding(n[r])},this.context.meta.removeNode=function(t){var e=t.$component;e&&e.destroy();var n=t.$destroyListeners;if(n)for(var r=0;r<n.length;r++)n[r]()},this.context.meta.addItemContext=function(e){var n=e.expression.resolve(e);t.addItemContext(n,e)},this.context.meta.removeItemContext=function(t){}};var wi=1;function xi(t,e,n){this.eventModel=t,this.expression=e,this.binding=n,this.id=wi++,this.eventModels=null,this.dependencies=null,this.ignoreTemplateDependency=n instanceof Lr.ComponentAttributeBinding||n.template instanceof mi.DynamicText&&n instanceof mi.RangeBinding,n.meta?n.meta.push(this):n.meta=[this]}function bi(t,e){!function(t,e,n,r){if(r){if(r.$event&&r.$event.target===e)return;if(r.$stringInsert)return ni.onStringInsert(e,n,r.$stringInsert.index,r.$stringInsert.text);if(r.$stringRemove)return ni.onStringRemove(e,n,r.$stringRemove.index,r.$stringRemove.howMany)}t.template.update(t.context,t)}(this,this.element,t,e)}xi.prototype.updateDependencies=function(){var t;this.ignoreTemplateDependency&&this.binding.condition instanceof mi.Template&&(t=new di).setIgnoreTemplate(this.binding.condition);var e=this.expression.dependencies(this.binding.context,t);if(this.dependencies){if(function(t,e){var n=t?t.length:-1,r=e?e.length:-1;if(n!==r)return!1;for(var i=0;i<n;i++){var o=t[i],s=e[i],a=o?o.length:-1,p=s?s.length:-1;if(a!==p)return!1;for(var u=0;u<p;u++)if(o[u]!==s[u])return!1}return!0}(this.dependencies,e))return;this.eventModel.removeBinding(this)}if(e){this.dependencies=e;for(var n=0,r=e.length;n<r;n++){var i=e[n];i&&this.eventModel.addBinding(i,this)}}},xi.prototype.update=function(t,e){this.binding.update(t,e),this.updateDependencies()},xi.prototype.insert=function(t,e){this.binding.insert(t,e),this.updateDependencies()},xi.prototype.remove=function(t,e){this.binding.remove(t,e),this.updateDependencies()},xi.prototype.move=function(t,e,n){this.binding.move(t,e,n),this.updateDependencies()};var _i={},Ei=Jt.EventEmitter,Ci=Tt.templates,Si=Ai;function Ai(t,e,n,r){Ei.call(this),this.derby=t,this.name=e,this.filename=n,this.scriptHash="{{DERBY_SCRIPT_HASH}}",this.bundledAt="{{DERBY_BUNDLED_AT}}",this.Page=function(t){var e=t&&t.Page||yi;function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n}(t),this.proto=this.Page.prototype,this.views=new Ci.Views,this.tracksRoutes=yr.setup(this),this.model=null,this.page=null,this._pendingComponentMap={},this._init(r)}_r.mergeInto(Ai.prototype,Ei.prototype),Ai.prototype._init=function(){this._waitForAttach=!0,this._cancelAttach=!1,this.model=new this.derby.Model,_i(Tt,this.views),this._contentReady()},Ai.prototype._finishInit=function(){var t=this._getScript(),e=JSON.parse(t.nextSibling.innerHTML);this.model.createConnection(e),this.emit("model",this.model),_r.isProduction="production"===e.nodeEnv,_r.isProduction||this._autoRefresh(),this.model.unbundle(e);var n=this.createPage();if(n.params=this.model.get("$render.params"),this.emit("ready",n),this._waitForAttach=!1,this._cancelAttach)this.history.refresh();else{if(_r.isProduction)try{n.attach()}catch(t){this.history.refresh(),console.warn("attachment error",t.stack)}else n.attach();this.emit("load",n)}},Ai.prototype._contentReady=function(){var t=!1,e=this;function n(){document.addEventListener?document.removeEventListener("DOMContentLoaded",n,!1):document.detachEvent("onreadystatechange",n),r()}function r(){if(!t){if(!document.body)return setTimeout(r,0);t=!0,setTimeout(function(){e._finishInit()},0)}}if("loading"!==document.readyState)return r();if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(document.attachEvent){var i;document.attachEvent("onreadystatechange",n),window.attachEvent("onload",n);try{i=null==window.frameElement}catch(t){}document.documentElement.doScroll&&i&&function e(){if(!t){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(e,0)}r()}}()}},Ai.prototype._getScript=function(){return document.querySelector("script[data-derby-app]")},Ai.prototype.use=_r.use,Ai.prototype.serverUse=_r.serverUse,Ai.prototype.loadViews=function(){},Ai.prototype.loadStyles=function(){},Ai.prototype.addViews=function(){throw new Error("Parsing not available. Registering a view from source should not be used in application code. Instead, specify a filename with view.file.")},Ai.prototype.component=function(t,e,n){if("function"==typeof t&&(e=t,t=null),"function"!=typeof e)throw new Error("Missing component constructor argument");var r,i,o,s,a=e.view;a&&"object"==typeof a?(r=a.is,i=a.file,o=a.source,s=a.dependencies):(r=e.is||e.prototype.name,i=e.view||e.prototype.view);var p=t||r||i&&vn.basename(i,".html");if(!p)throw new Error("No view specified for component");if(i&&o)throw new Error("Component may not specify both a view file and source");var u=p.replace(/:index$/,""),c=this.views.nameMap[u];if((c&&c.componentFactory?c.componentFactory.constructor:this._pendingComponentMap[u])!==e){if(n&&c&&!c.fromSerialized)throw new Error('Dependencies cannot override existing views. Already registered "'+p+'"');if(this._pendingComponentMap[u]=e,s)for(var h=0;h<s.length;h++){var l=s[h];Array.isArray(l)?this.component(l[0],l[1],!0):this.component(null,l,!0)}var f;if(i?(this.loadViews(i,p),f=this.views.find(p)):o?(this.addViews(o,p),f=this.views.find(p)):f=t?this.views.find(p):this.views.register(p,""),!f){var m=this.views.findErrorMessage(p);throw new Error(m)}return Lr.extendComponent(e),f.componentFactory=Lr.createFactory(e),delete this._pendingComponentMap[u],this}},Ai.prototype.createPage=function(){this.page&&(this.emit("destroyPage",this.page),this.page.destroy());var t=new this.Page(this,this.model);return this.page=t,t},Ai.prototype.onRoute=function(t,e,n,r){if(this._waitForAttach)this._cancelAttach=!0;else if(this.emit("route",e),e.model.set("$render.params",e.params),e.model.set("$render.url",e.params.url),e.model.set("$render.query",e.params.query),r){var i=this;t.call(e,e,e.model,e.params,n,function(){i.emit("routeDone",e,"transition"),r()})}else t.call(e,e,e.model,e.params,n)},Ai.prototype._autoRefresh=function(){var t=this,e=this.model.connection;e.on("connected",function(){e.send({derby:"app",name:t.name,hash:t.scriptHash})}),e.on("receive",function(e){if(e.data.derby){var n=e.data;e.data=null,t._handleMessage(n.derby,n)}})},Ai.prototype._handleMessage=function(t,e){if("refreshViews"===t){new Function("return "+e.views)()(Tt,this.views);var n=this.model.get("$render.ns");this.page.render(n)}else if("refreshStyles"===t){var r=document.querySelector('style[data-filename="'+e.filename+'"]');r&&(r.innerHTML=e.css)}else"reload"===t&&this.model.whenNothingPending(function(){window.location=window.location})};var ki={};ki=ki=me,Si.prototype.addViews=function(t,e){var n=ki.parseViews(t,e);ki.registerParsedViews(this,n)},ki.getImportNamespace=function(t,e,n){var r=vn.extname(n),i=null==e.ns?vn.basename(e.src,r):e.ns;return t&&i?t+":"+i:t||i||""},ki.parseViews=function(t,e,n,r){var i,o,s=[],a=e?e+":":"";return w.parse(t+"\n",{rawTags:/^(?:[^\s=\/!>]+:|style|script)$/i,matchEnd:function(t){if(":"===t.slice(-1))return/<\/?[^\s=\/!>]+:[\s>]/i;return new RegExp("</"+t,"i")},start:function(t,e,n){if(":"!==e.charAt(e.length-1))throw new Error("Expected tag ending in colon (:) instead of "+t);if(i=e.slice(0,-1),o=n,"import"===i){if("function"!=typeof r)throw new Error("Template import implementation not provided");r(o)}},text:function(t,e){if(!i||"import"===i)return;s.push({name:a+i,source:t,options:o,filename:n})}}),s},ki.registerParsedViews=function(t,e){for(var n=0,r=e.length;n<r;n++){var i=e[n];t.views.register(i.name,i.source,i.options)}};var Ii=ki,Ti={};(function(t){var e,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var r=new Uint8Array(16);e=function(){return n.getRandomValues(r),r}}if(!e){var i=new Array(16);e=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}Ti=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});for(var Li=[],Oi={},Pi=0;Pi<256;Pi++)Li[Pi]=(Pi+256).toString(16).substr(1),Oi[Li[Pi]]=Pi;function ji(t,e){var n=e||0,r=Li;return r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]}var Ni=Ti(),Mi=[1|Ni[0],Ni[1],Ni[2],Ni[3],Ni[4],Ni[5]],Di=16383&(Ni[6]<<8|Ni[7]),Ri=0,Bi=0;function Fi(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var i=(t=t||{}).random||(t.rng||Ti)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e)for(var o=0;o<16;o++)e[r+o]=i[o];return e||ji(i)}var Ui=Fi;Ui.v1=function(t,e,n){var r=e&&n||0,i=e||[],o=void 0!==(t=t||{}).clockseq?t.clockseq:Di,s=void 0!==t.msecs?t.msecs:(new Date).getTime(),a=void 0!==t.nsecs?t.nsecs:Bi+1,p=s-Ri+(a-Bi)/1e4;if(p<0&&void 0===t.clockseq&&(o=o+1&16383),(p<0||s>Ri)&&void 0===t.nsecs&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ri=s,Bi=a,Di=o;var u=(1e4*(268435455&(s+=122192928e5))+a)%4294967296;i[r++]=u>>>24&255,i[r++]=u>>>16&255,i[r++]=u>>>8&255,i[r++]=255&u;var c=s/4294967296*1e4&268435455;i[r++]=c>>>8&255,i[r++]=255&c,i[r++]=c>>>24&15|16,i[r++]=c>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var h=t.node||Mi,l=0;l<6;l++)i[r+l]=h[l];return e||ji(i)},Ui.v4=Fi,Ui.parse=function(t,e,n){var r=e&&n||0,i=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){i<16&&(e[r+i++]=Oi[t])});i<16;)e[r+i++]=0;return e},Ui.unparse=ji;var $i=Ui;Vi.INITS=[];var qi=Vi;function Vi(t){this.root=this;var e=Vi.INITS;t||(t={}),this.debug=t.debug||{};for(var n=0;n<e.length;n++)e[n](this,t)}function zi(t){this.root=t.root,this._events=t._events,this._maxListeners=t._maxListeners,this._context=t._context,this._at=t._at,this._pass=t._pass,this._silent=t._silent,this._eventContext=t._eventContext,this._preventCompose=t._preventCompose}Vi.prototype.id=function(){return $i.v4()},Vi.prototype._child=function(){return new zi(this)},Vi.ChildModel=zi,zi.prototype=new Vi;var Hi=Jt.EventEmitter;function Gi(t,e,n){var r=n.patternSegments;if(!r)return!1;if(t===n.pattern||"**"===t)return!0;var i=e.length;if(i>r.length)return!1;for(var o=0;o<i;o++)if(e[o]!==r[o])return!1;return!0}function Ki(t,e){for(var n in t)this[n]=t[n];for(var n in e)this[n]=e[n]}function Qi(t,e,n,r,i){var o,s,a;if(i?(o=n,s=r,a=i):r?(a=r,t.isPath(n)?o=n:s=n):a=n,s&&s.useEventObjects)var p=!0;if(o){var u=t.path(o);return p?Wi(e,u,a,t._eventContext):Ji(u,a,t._eventContext)}var c=t.path();return c?p?Wi(e,c,a,t._eventContext):Ji(c,a,t._eventContext):a}function Ji(t,e,n){var r=_r.castSegments(t.split(".")),i=ro(t,r);function o(t,n){var r=i(t);if(r){var o=r.length?r.concat(n):n;return e.apply(null,o),!0}}return o.pattern=t,o.patternSegments=r,o.eventContext=n,o}function Wi(t,e,n,r){var i=_r.castSegments(e.split(".")),o=ro(e,i),s=function t(e){switch(e){case"change":return function(t){return new Yi(t)};case"insert":return function(t){return new Xi(t)};case"remove":return function(t){return new Zi(t)};case"move":return function(t){return new to(t)};case"load":return function(t){return new eo(t)};case"unload":return function(t){return new no(t)};case"all":return function(e){var n=e[0],r=t(n);return r(e.slice(1))};default:throw new Error("Unknown event: "+e)}}(t);function a(t,e){var r=o(t);if(r){var i=s(e);return n(i,r),!0}}return a.pattern=e,a.patternSegments=i,a.eventContext=r,a}function Yi(t){this.value=t[0],this.previous=t[1],this.passed=t[2]}function Xi(t){this.index=t[0],this.values=t[1],this.passed=t[2]}function Zi(t){this.index=t[0],this.removed=t[1],this.passed=t[2]}function to(t){this.from=t[0],this.to=t[1],this.howMany=t[2],this.passed=t[3]}function eo(t){this.document=t[0],this.passed=t[1]}function no(t){this.previousDocument=t[0],this.passed=t[1]}function ro(t,e){if("**"===t)return function(t){return[t.join(".")]};var n=function(t){var e=t.length-1,n=t[e];if("**"===n)return t.pop(),!0;if("string"!=typeof n)return!1;var r=/^([^\*]+)\*\*$/.exec(n);return!!r&&(t[e]=r[1],!0)}(e);return function(t){var r=e.length;if(!(r>t.length)&&(r===t.length||n)){for(var i=[],o=0;o<r;o++){var s=e[o],a=t[o];if("*"!==s&&"**"!==s){if(s!==a)return}else i.push(a)}if(n){var p=t.slice(o).join(".");i.push(p)}return i}}}qi.MUTATOR_EVENTS={change:!0,insert:!0,remove:!0,move:!0,load:!0,unload:!0},qi.INITS.push(function(t){Hi.call(this),t.setMaxListeners(0),t.root._defaultCallback=function(e){e&&t._emitError(e)},t.root._mutatorEventQueue=null,t.root._pass=new Ki({},{}),t.root._silent=null,t.root._eventContext=null}),_r.mergeInto(qi.prototype,Hi.prototype),qi.prototype.wrapCallback=function(t){if(!t)return this.root._defaultCallback;var e=this;return function(){try{return t.apply(this,arguments)}catch(t){e._emitError(t)}}},qi.prototype._emitError=function(t,e){var n=t.message?t.message:"string"==typeof t?t:"Unknown model error";if(e&&(n+=" "+e),t.data)try{n+=" "+JSON.stringify(t.data)}catch(t){}t instanceof Error?t.message=n:t=new Error(n),this.emit("error",t)},qi.prototype._emit=Hi.prototype.emit,qi.prototype.emit=function(t){if("error"===t)return this._emit.apply(this,arguments);if(qi.MUTATOR_EVENTS[t]){if(this._silent)return this;var e=arguments[1],n=arguments[2];if(this._emit(t+"Immediate",e,n),this.root._mutatorEventQueue)return this.root._mutatorEventQueue.push([t,e,n]),this;for(this.root._mutatorEventQueue=[],this._emit(t,e,n),this._emit("all",e,[t].concat(n));this.root._mutatorEventQueue.length;){var r=this.root._mutatorEventQueue.shift();t=r[0],e=r[1],n=r[2],this._emit(t,e,n),this._emit("all",e,[t].concat(n))}return this.root._mutatorEventQueue=null,this}return this._emit.apply(this,arguments)},qi.prototype._on=Hi.prototype.on,qi.prototype.addListener=qi.prototype.on=function(t,e,n,r){var i=Qi(this,t,e,n,r);return this._on(t,i),i},qi.prototype.once=function(t,e,n,r){var i=Qi(this,t,e,n,r);function o(){i.apply(null,arguments)&&this.removeListener(t,o)}return this._on(t,o),o},qi.prototype._removeAllListeners=Hi.prototype.removeAllListeners,qi.prototype.removeAllListeners=function(t,e){if(!t){for(var n in this._events)this.removeAllListeners(n,e);return this}var r=this.path(e);if(!r)return 0===arguments.length?this._removeAllListeners():this._removeAllListeners(t);for(var i=this.listeners(t),o=r.split("."),s=i.length;s--;){var a=i[s];Gi(r,o,a)&&this.removeListener(t,a)}return this},qi.prototype.pass=function(t,e){var n=this._child();return n._pass=e?new Ki(t,this._pass):new Ki(this._pass,t),n},qi.prototype.silent=function(t){var e=this._child();return e._silent=null==t||t,e},qi.prototype.eventContext=function(t){var e=this._child();return e._eventContext=t,e},qi.prototype.removeContextListeners=function(t){for(var e in 0===arguments.length&&(t=this._eventContext),this._events)for(var n=this.listeners(e),r=n.length;r--;){var i=n[r];i.eventContext===t&&this.removeListener(e,i)}return this},Yi.prototype.type="change",Xi.prototype.type="insert",Zi.prototype.type="remove",to.prototype.type="move",eo.prototype.type="load",no.prototype.type="unload";var io={};function oo(t,e){var n=t._child();return n._at=e,n}io.mixin={},qi.prototype._splitPath=function(t){var e=this.path(t);return e&&e.split(".")||[]},qi.prototype.path=function(t){return null==t||""===t?this._at?this._at:"":"string"==typeof t||"number"==typeof t?this._at?this._at+"."+t:""+t:"function"==typeof t.path?t.path():void 0},qi.prototype.isPath=function(t){return null!=this.path(t)},qi.prototype.scope=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return oo(this,t)},qi.prototype.at=function(t){if(arguments.length>1)for(var e=1;e<arguments.length;e++)t=t+"."+arguments[e];return oo(this,this.path(t))},qi.prototype.parent=function(t){null==t&&(t=1);var e=this._splitPath(),n=Math.max(0,e.length-t),r=e.slice(0,n).join(".");return this.scope(r)},qi.prototype.leaf=function(t){t||(t=this.path());var e=t.lastIndexOf(".");return t.slice(e+1)};var so=ao;function ao(t,e,n){this.collectionName=e,this.id=n,this.collectionData=t&&t.data[e]}ao.prototype.path=function(t){var e=this.collectionName+"."+this.id;return t&&t.length&&(e+="."+t.join(".")),e},ao.prototype._errorMessage=function(t,e,n){return t+" at "+this.path(e)+": "+JSON.stringify(n,null,2)};var po=uo;function uo(t,e,n,r){so.call(this,t,e,n),this.data=r,this._updateCollectionData()}function co(t,e){return t=t[e]||(t[e]=[])}uo.prototype=new so,uo.prototype._updateCollectionData=function(){this.collectionData[this.id]=this.data},uo.prototype.create=function(t,e){if(void 0!==this.data){var n=this._errorMessage("create on local document with data",null,this.data);return e(new Error(n))}this.data=t,this._updateCollectionData(),e()},uo.prototype.set=function(t,e,n){return this._apply(t,function(t,n){var r=t[n];return t[n]=e,r},n)},uo.prototype.del=function(t,e){var n=this.get(t);if(void 0!==n)return this._apply(t,function(t,e){return delete t[e],n},e);e()},uo.prototype.increment=function(t,e,n){var r=this;return this._validatedApply(t,function(e){if("number"!=typeof e&&null!=e)return new TypeError(r._errorMessage("increment on non-number",t,e))},function(t,n){var r=(t[n]||0)+e;return t[n]=r,r},n)},uo.prototype.push=function(t,e,n){return this._arrayApply(t,function(t){return t.push(e)},n)},uo.prototype.unshift=function(t,e,n){return this._arrayApply(t,function(t){return t.unshift(e)},n)},uo.prototype.insert=function(t,e,n,r){return this._arrayApply(t,function(t){return t.splice.apply(t,[e,0].concat(n)),t.length},r)},uo.prototype.pop=function(t,e){return this._arrayApply(t,function(t){return t.pop()},e)},uo.prototype.shift=function(t,e){return this._arrayApply(t,function(t){return t.shift()},e)},uo.prototype.remove=function(t,e,n,r){return this._arrayApply(t,function(t){return t.splice(e,n)},r)},uo.prototype.move=function(t,e,n,r,i){return this._arrayApply(t,function(t){var i=t.splice(e,r);return t.splice.apply(t,[n,0].concat(i)),i},i)},uo.prototype.stringInsert=function(t,e,n,r){var i=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(i._errorMessage("stringInsert on non-string",t,e))},function(t,r){var i=t[r];return null==i?(t[r]=n,i):(t[r]=i.slice(0,e)+n+i.slice(e),i)},r)},uo.prototype.stringRemove=function(t,e,n,r){var i=this;return this._validatedApply(t,function(e){if("string"!=typeof e&&null!=e)return new TypeError(i._errorMessage("stringRemove on non-string",t,e))},function(t,r){var i=t[r];return null==i?i:(e<0&&(e+=i.length),t[r]=i.slice(0,e)+i.slice(e+n),i)},r)},uo.prototype.get=function(t){return _r.lookup(t,this.data)},uo.prototype._createImplied=function(t,e){for(var n=this,r="data",i=0,o=t[i++];null!=o;)n=n[r]||(n[r]=/^\d+$/.test(o)?[]:{}),r=o,o=t[i++];return e(n,r)},uo.prototype._apply=function(t,e,n){var r=this._createImplied(t,e);return this._updateCollectionData(),n(),r},uo.prototype._validatedApply=function(t,e,n,r){var i=this._createImplied(t,function(t,i){var o=e(t[i]);return o?r(o):n(t,i)});return this._updateCollectionData(),r(),i},uo.prototype._arrayApply=function(t,e,n){var r=this._createImplied(t,co);if(!Array.isArray(r)){var i=this._errorMessage(e.name+" on non-array",t,r);return n(new TypeError(i))}var o=e(r);return this._updateCollectionData(),n(),o};function ho(){}function lo(){}function fo(){}function mo(){}function yo(t,e,n){this.model=t,this.name=e,this.Doc=n,this.docs=new fo,this.data=t.data[e]=new mo}qi.INITS.push(function(t){t.root.collections=new ho,t.root.data=new lo}),qi.prototype.getCollection=function(t){return this.root.collections[t]},qi.prototype.getDoc=function(t,e){var n=this.root.collections[t];return n&&n.docs[e]},qi.prototype.get=function(t){var e=this._splitPath(t);return this._get(e)},qi.prototype._get=function(t){return _r.lookup(t,this.root.data)},qi.prototype.getCopy=function(t){var e=this._splitPath(t);return this._getCopy(e)},qi.prototype._getCopy=function(t){var e=this._get(t);return _r.copy(e)},qi.prototype.getDeepCopy=function(t){var e=this._splitPath(t);return this._getDeepCopy(e)},qi.prototype._getDeepCopy=function(t){var e=this._get(t);return _r.deepCopy(e)},qi.prototype.getOrCreateCollection=function(t){var e=this.root.collections[t];if(e)return e;var n=this._getDocConstructor(t);return e=new yo(this.root,t,n),this.root.collections[t]=e,e},qi.prototype._getDocConstructor=function(){return po},qi.prototype.getOrCreateDoc=function(t,e,n){var r=this.getOrCreateCollection(t);return r.docs[e]||r.add(e,n)},qi.prototype.destroy=function(t){var e=this._splitPath(t),n=this.silent();if(n.removeAllListeners(null,t),n._removeAllRefs(e),n._stopAll(e),n._removeAllFilters(e),0===e.length){this.root.collections=new ho;var r=this.root.data;for(var i in r)delete r[i]}else if(1===e.length){var o=this.getCollection(e[0]);o&&o.destroy()}else n._del(e)},yo.prototype.add=function(t,e){var n=new this.Doc(this.model,this.name,t,e,this);return this.docs[t]=n,n},yo.prototype.destroy=function(){delete this.model.collections[this.name],delete this.model.data[this.name]},yo.prototype.remove=function(t){delete this.docs[t],delete this.data[t],function(t){for(var e in t)return!1;return!0}(this.docs)&&this.destroy()},yo.prototype.get=function(){return this.data};qi.prototype._mutate=function(t,e,n){n=this.wrapCallback(n);var r=t[0],i=t[1];if(!r||!i){var o=e.name+" must be performed under a collection and document id. Invalid path: "+t.join(".");return n(new Error(o))}var s=this.getOrCreateDoc(r,i),a=t.slice(2);if(this._preventCompose&&s.shareDoc){var p=s.shareDoc.preventCompose;s.shareDoc.preventCompose=!0;var u=e(s,a,n);return s.shareDoc.preventCompose=p,u}return e(s,a,n)},qi.prototype.set=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._set(r,e,n)},qi.prototype._set=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.set(i,e,o);return 0===i.length&&(e=n.get(i)),r.emit("change",t,[e,s,r._pass]),s},n)},qi.prototype.setNull=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setNull(r,e,n)},qi.prototype._setNull=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.get(i);return null!=s?(o(),s):(n.set(i,e,o),r.emit("change",t,[e,s,r._pass]),e)},n)},qi.prototype.setEach=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setEach(r,e,n)},qi.prototype._setEach=function(t,e,n){t=this._dereference(t);var r=_r.asyncGroup(this.wrapCallback(n));for(var i in e){var o=e[i];this._set(t.concat(i),o,r())}},qi.prototype.create=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._create(r,e,n)},qi.prototype._create=function(t,e,n){if(2!==(t=this._dereference(t)).length){var r="create may only be used on a document path. Invalid path: "+t.join(".");return(n=this.wrapCallback(n))(new Error(r))}var i=this;this._mutate(t,function(n,r,o){n.create(e,o),e=n.get(),i.emit("change",t,[e,void 0,i._pass])},n)},qi.prototype.createNull=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._createNull(r,e,n)},qi.prototype._createNull=function(t,e,n){t=this._dereference(t);var r=this.getDoc(t[0],t[1]);r&&null!=r.get()||this._create(t,e,n)},qi.prototype.add=function(){var t,e,n;0===arguments.length?e={}:1===arguments.length?"function"==typeof arguments[0]?(e={},n=arguments[0]):e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._add(r,e,n)},qi.prototype._add=function(t,e,n){if("object"!=typeof e){var r="add requires an object value. Invalid value: "+e;return(n=this.wrapCallback(n))(new Error(r))}var i=e.id||this.id();e.id=i,t=this._dereference(t.concat(i));var o=this;return this._mutate(t,function(n,r,i){var s;r.length?s=n.set(r,e,i):(n.create(e,i),e=n.get()),o.emit("change",t,[e,s,o._pass])},n),i},qi.prototype.del=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._del(n,e)},qi.prototype._del=function(t,e){t=this._dereference(t);var n=this;return this._mutate(t,function(e,r,i){var o=e.del(r,i);if(2===t.length){var s=t[0],a=t[1];n.root.collections[s].remove(a)}return n.emit("change",t,[void 0,o,n._pass]),o},e)},qi.prototype.increment=function(){var t,e,n;1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(n=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._increment(r,e,n)},qi.prototype._increment=function(t,e,n){t=this._dereference(t),null==e&&(e=1);var r=this;return this._mutate(t,function(n,i,o){var s=n.increment(i,e,o),a=s-e;return r.emit("change",t,[s,a,r._pass]),s},n)},qi.prototype.push=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._push(r,e,n)},qi.prototype._push=function(t,e,n){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(n,i,o){var s=n.push(i,e,o);return r.emit("insert",t,[s-1,[e],r._pass]),s},n)},qi.prototype.unshift=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._unshift(r,e,n)},qi.prototype._unshift=function(t,e,n){t=this._dereference(t,!0);var r=this;return this._mutate(t,function(n,i,o){var s=n.unshift(i,e,o);return r.emit("insert",t,[0,[e],r._pass]),s},n)},qi.prototype.insert=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for insert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._insert(i,+e,n,r)},qi.prototype._insert=function(t,e,n,r){t=this._dereference(t,!0);var i=this;return this._mutate(t,function(r,o,s){var a=Array.isArray(n)?n:[n],p=r.insert(o,e,a,s);return i.emit("insert",t,[e,a,i._pass]),p},r)},qi.prototype.pop=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._pop(n,e)},qi.prototype._pop=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,r,i){var o=e.get(r),s=o&&o.length;if(s){var a=e.pop(r,i);return n.emit("remove",t,[s-1,[a],n._pass]),a}i()},e)},qi.prototype.shift=function(){var t,e;1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:t=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._splitPath(t);return this._shift(n,e)},qi.prototype._shift=function(t,e){t=this._dereference(t,!0);var n=this;return this._mutate(t,function(e,r,i){var o=e.get(r);if(o&&o.length){var s=e.shift(r,i);return n.emit("remove",t,[0,[s],n._pass]),s}i()},e)},qi.prototype.remove=function(){var t,e,n,r;arguments.length<2?e=arguments[0]:2===arguments.length?"function"==typeof arguments[1]?(r=arguments[1],"number"==typeof arguments[0]?e=arguments[0]:t=arguments[0]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(r=arguments[2],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1])):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return null==e&&(e=i.pop()),this._remove(i,+e,n,r)},qi.prototype._remove=function(t,e,n,r){t=this._dereference(t,!0),null==n&&(n=1);var i=this;return this._mutate(t,function(r,o,s){var a=r.remove(o,e,n,s);return i.emit("remove",t,[e,a,i._pass]),a},r)},qi.prototype.move=function(){var t,e,n,r,i;if(arguments.length<2)throw new Error("Not enough arguments for move");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],i=arguments[2]):"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):4===arguments.length?"function"==typeof arguments[3]?(i=arguments[3],"number"==typeof arguments[0]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2])):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3],i=arguments[4]);var o=this._splitPath(t);return this._move(o,e,n,r,i)},qi.prototype._move=function(t,e,n,r,i){t=this._dereference(t,!0),null==r&&(r=1);var o=this;return this._mutate(t,function(i,s,a){if(n=+n,(e=+e)<0||n<0){var p=i.get(s).length;e<0&&(e+=p),n<0&&(n+=p)}var u=i.move(s,e,n,r,a);return o.emit("move",t,[e,n,u.length,o._pass]),u},i)},qi.prototype.stringInsert=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for stringInsert");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._stringInsert(i,e,n,r)},qi.prototype._stringInsert=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.stringInsert(o,e,n,s),p=r.get(o),u=i.pass({$stringInsert:{index:e,text:n}})._pass;i.emit("change",t,[p,a,u])},r)},qi.prototype.stringRemove=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for stringRemove");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._stringRemove(i,e,n,r)},qi.prototype._stringRemove=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.stringRemove(o,e,n,s),p=r.get(o),u=i.pass({$stringRemove:{index:e,howMany:n}})._pass;i.emit("change",t,[p,a,u])},r)},qi.prototype.subtypeSubmit=function(){var t,e,n,r;if(arguments.length<2)throw new Error("Not enough arguments for subtypeSubmit");2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?"function"==typeof arguments[2]?(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i=this._splitPath(t);return this._subtypeSubmit(i,e,n,r)},qi.prototype._subtypeSubmit=function(t,e,n,r){t=this._dereference(t);var i=this;return this._mutate(t,function(r,o,s){var a=r.subtypeSubmit(o,e,n,s),p=r.get(o),u=i.pass({$subtype:{type:e,op:n}})._pass;return i.emit("change",t,[p,void 0,u]),a},r)};var vo=_o;function go(t,e){this.index=t,this.values=e}function wo(t,e){this.index=t,this.howMany=e}function xo(t,e,n){this.from=t,this.to=e,this.howMany=n}function bo(t,e){return t===e}function _o(t,e,n){n||(n=bo);for(var r=t.length,i=e.length,o=[],s={},a={},p=0;p<r;p++)for(var u=t[p],c=0;c<i;c++)if(!a[c]&&n(u,e[c])){var h=p,l=c,f=0;do{s[p++]=a[c++]=!0,f++}while(p<r&&c<i&&n(t[p],e[c])&&!a[c]);o.push(new xo(h,l,f)),p--;break}var m=[];for(p=0;p<r;)if(s[p])p++;else{var d=p;for(f=0;p<r&&!s[p++];)f++;m.push(new wo(d,f))}var y=[];for(c=0;c<i;)if(a[c])c++;else{for(d=c,f=0;c<i&&!a[c++];)f++;var v=e.slice(d,d+f);y.push(new go(d,v))}var g,w,x=y.length,b=m.length,_=o.length,E=0;for(g=0;g<b;g++){var C=m[g];for(C.index-=E,E+=C.howMany,w=0;w<_;w++){(I=o[w]).from>=C.index&&(I.from-=C.howMany)}}for(g=x;g--;){var S=y[g];f=S.values.length;for(w=_;w--;){(I=o[w]).to>=S.index&&(I.to-=f)}}for(g=_;g-- >1;){if((I=o[g]).to!==I.from)for(w=g;w--;){var A=o[w];A.to>=I.to&&(A.to-=I.howMany),A.to>=I.from&&(A.to+=I.howMany)}}var k=[];for(g=0;g<_;g++){var I;if((I=o[g]).to!==I.from)for(k.push(I),w=g+1;w<_;w++){var T=o[w];T.from>=I.from&&(T.from-=I.howMany),T.from>=I.to&&(T.from+=I.howMany)}}return m.concat(k,y)}_o.InsertDiff=go,_o.RemoveDiff=wo,_o.MoveDiff=xo,go.prototype.type="insert",go.prototype.toJSON=function(){return{type:this.type,index:this.index,values:this.values}},wo.prototype.type="remove",wo.prototype.toJSON=function(){return{type:this.type,index:this.index,howMany:this.howMany}},xo.prototype.type="move",xo.prototype.toJSON=function(){return{type:this.type,from:this.from,to:this.to,howMany:this.howMany}};qi.prototype.setDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setDiff(r,e,n)},qi.prototype._setDiff=function(t,e,n){t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){var s=n.get(i);return _r.equal(s,e)?(o(),s):(n.set(i,e,o),r.emit("change",t,[e,s,r._pass]),s)},n)},qi.prototype.setDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setDiffDeep(r,e,n)},qi.prototype._setDiffDeep=function(t,e,n){var r=this._get(t);n=this.wrapCallback(n);var i=_r.asyncGroup(n),o=i();!function t(e,n,r,i,o){if("object"!=typeof r||!r||"object"!=typeof i||!i)return void e._setDiff(n,i,o());if(Array.isArray(r)&&Array.isArray(i)){var s=vo(r,i,_r.deepEqual);if(!s.length)return;if(2===s.length&&s[0].index===s[1].index&&s[0]instanceof vo.RemoveDiff&&1===s[0].howMany&&s[1]instanceof vo.InsertDiff&&1===s[1].values.length){var a=s[0].index,p=n.concat(a);return void t(e,p,r[a],i[a],o)}return void e._applyArrayDiff(n,s,o())}for(var u in r)if(!(u in i)){var p=n.concat(u);e._del(p,o())}for(var u in i)if(!_r.deepEqual(r[u],i[u])){var p=n.concat(u);t(e,p,r[u],i[u],o)}}(this,t,r,e,i),o()},qi.prototype.setArrayDiff=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setArrayDiff(r,e,n)},qi.prototype.setArrayDiffDeep=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this._splitPath(t);return this._setArrayDiffDeep(r,e,n)},qi.prototype._setArrayDiffDeep=function(t,e,n){return this._setArrayDiff(t,e,n,_r.deepEqual)},qi.prototype._setArrayDiff=function(t,e,n,r){var i=this._get(t);if(i===e)return this.wrapCallback(n)();if(Array.isArray(i)&&Array.isArray(e)){var o=vo(i,e,r);this._applyArrayDiff(t,o,n)}else this._set(t,e,n)},qi.prototype._applyArrayDiff=function(t,e,n){if(!e.length)return this.wrapCallback(n)();t=this._dereference(t);var r=this;return this._mutate(t,function(n,i,o){for(var s=_r.asyncGroup(o),a=0,p=e.length;a<p;a++){var u=e[a];if(u instanceof vo.InsertDiff)n.insert(i,u.index,u.values,s()),r.emit("insert",t,[u.index,u.values,r._pass]);else if(u instanceof vo.RemoveDiff){var c=n.remove(i,u.index,u.howMany,s());r.emit("remove",t,[u.index,c,r._pass])}else if(u instanceof vo.MoveDiff){var h=n.move(i,u.from,u.to,u.howMany,s());r.emit("move",t,[u.from,u.to,h.length,r._pass])}}},n)};var Eo,Co=Eo=new function(){};function So(t){return t&&t.slice().reverse()}Co.reverse=new function(t,e){this.get=t,this.set=e}(So,function(t){return{0:So(t)}}),Co.asc=function(t,e){return t<e?-1:t>e?1:0},Co.desc=function(t,e){return t>e?-1:t<e?1:0};(function(t){function e(){}function n(t,e,n){var r,i,o,s,a,p=e.pop();"string"==typeof p?i=p:r=p,n&&(o=t.path(e.shift())),p=e[e.length-1],Array.isArray(p)||t.isPath(p)||(s=e.pop());for(var u=(a=1===e.length&&Array.isArray(e[0])?e[0]:e).length;u--;)a[u]=t.path(a[u]);return{name:i,path:o,inputPaths:a,fns:r,options:s}}function r(){}function i(t){this.model=t,this.nameMap=t.root._namedFns,this.fromMap=new r}function o(t,e,n,r,i,o){if(this.model=t.pass({$fn:this}),this.name=e,this.from=n,this.inputPaths=r,this.options=o,!i)throw new TypeError("Model function not found: "+e);this.getFn=i.get||i,this.setFn=i.set,this.fromSegments=n&&n.split("."),this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}var p=o&&o.copy||"output";this.copyInput="input"===p||"both"===p,this.copyOutput="output"===p||"both"===p,this.mode=o&&o.mode||"diffDeep",this.async=!(!o||!o.async),this.eventPending=!1}qi.INITS.push(function(t){t.root._namedFns=new e,t.root._fns=new i(t),t.on("all",function(e,n){var r=n[n.length-1],i=t.root._fns.fromMap;for(var o in i){var s=i[o];r.$fn!==s&&(_r.mayImpactAny(s.inputsSegments,e)?s.onInput(r):_r.mayImpact(s.fromSegments,e)&&s.onOutput(r))}})}),qi.prototype.fn=function(t,e){this.root._namedFns[t]=e},qi.prototype.evaluate=function(){var t=n(this,Array.prototype.slice.call(arguments),!1);return this.root._fns.get(t.name,t.inputPaths,t.fns,t.options)},qi.prototype.start=function(){var t=n(this,Array.prototype.slice.call(arguments),!0);return this.root._fns.start(t.name,t.path,t.inputPaths,t.fns,t.options)},qi.prototype.stop=function(t){var e=this.path(t);this._stop(e)},qi.prototype._stop=function(t){this.root._fns.stop(t)},qi.prototype.stopAll=function(t){var e=this._splitPath(t);this._stopAll(e)},qi.prototype._stopAll=function(t){var e=this.root._fns.fromMap;for(var n in e){var r=e[n].fromSegments;_r.contains(t,r)&&this._stop(n)}},i.prototype.get=function(t,e,n,r){return n||(n=this.nameMap[t]||Eo[t]),new o(this.model,t,null,e,n,r).get()},i.prototype.start=function(t,e,n,r,i){r||(r=this.nameMap[t]||Eo[t]);var s=new o(this.model,t,e,n,r,i);return this.fromMap[e]=s,s._onInput()},i.prototype.stop=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},i.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.name){var r=[n.from].concat(n.inputPaths);n.options&&r.push(n.options),r.push(n.name),t.push(r)}}return t},o.prototype.apply=function(t,e){for(var n=0,r=this.inputsSegments.length;n<r;n++){var i=this.model._get(this.inputsSegments[n]);e.push(this.copyInput?_r.deepCopy(i):i)}return t.apply(this.model,e)},o.prototype.get=function(){return this.apply(this.getFn,[])},o.prototype.set=function(t,e){if(this.setFn){var n=this.apply(this.setFn,[t]);if(n){var r=this.inputsSegments,i=this.model.pass(e,!0);for(var o in n){t=this.copyOutput?_r.deepCopy(n[o]):n[o];this._setValue(i,r[o],t)}}}},o.prototype.onInput=function(e){if(!this.async)return this._onInput(e);if(!this.eventPending){this.eventPending=!0;var n=this;t.nextTick(function(){n._onInput(e),n.eventPending=!1})}},o.prototype._onInput=function(t){var e=this.copyOutput?_r.deepCopy(this.get()):this.get();return this._setValue(this.model.pass(t,!0),this.fromSegments,e),e},o.prototype.onOutput=function(t){var e=this.model._get(this.fromSegments);return this.set(e,t)},o.prototype._setValue=function(t,e,n){"diffDeep"===this.mode?t._setDiffDeep(e,n):"arrayDeep"===this.mode?t._setArrayDiffDeep(e,n):"array"===this.mode?t._setArrayDiff(e,n):t._setDiff(e,n)}}).call(this,en);function Ao(t,e){var n,r=e.pop();t.isPath(e[e.length-1])||(n=e.pop());for(var i=t.path(e.shift()),o=e.length;o--;)e[o]=t.path(e[o]);return{path:i,inputPaths:e.length?e:null,options:n,fn:r}}function ko(){}function Io(t){this.model=t,this.fromMap=new ko}function To(t,e,n,r,i,o){if(this.filters=t,this.model=t.model.pass({$filter:this}),this.path=e,this.segments=e.split("."),this.filterName=null,this.sortName=null,this.bundle=!0,this.filterFn=null,this.sortFn=null,this.inputPaths=i,this.inputsSegments=null,i){this.inputsSegments=[];for(var s=0;s<this.inputPaths.length;s++){var a=this.inputPaths[s].split(".");this.inputsSegments.push(a)}}this.options=o,this.skip=o&&o.skip,this.limit=o&&o.limit,n&&this.filter(n),r&&this.sort(r),this.idsSegments=null,this.from=null,this.fromSegments=null}qi.INITS.push(function(t){t.root._filters=new Io(t),t.on("all",function(e,n){var r=n[n.length-1],i=t.root._filters.fromMap;for(var o in i){var s=i[o];r.$filter!==s&&((_r.mayImpact(s.segments,e)||s.inputsSegments&&_r.mayImpactAny(s.inputsSegments,e))&&s.update(r))}})}),qi.prototype.filter=function(){var t=Ao(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,t.fn,null,t.inputPaths,t.options)},qi.prototype.sort=function(){var t=Ao(this,Array.prototype.slice.call(arguments));return this.root._filters.add(t.path,null,t.fn||"asc",t.inputPaths,t.options)},qi.prototype.removeAllFilters=function(t){var e=this._splitPath(t);this._removeAllFilters(e)},qi.prototype._removeAllFilters=function(t){var e=this.root._filters.fromMap;for(var n in e)_r.contains(t,e[n].fromSegments)&&e[n].destroy()},Io.prototype.add=function(t,e,n,r,i){return new To(this,t,e,n,r,i)},Io.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];if(n.bundle){var r=[e,n.path,n.filterName,n.sortName,n.inputPaths];n.options&&r.push(n.options),t.push(r)}}return t},To.prototype.filter=function(t){if("function"==typeof t)return this.filterFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.filterName=t,this.filterFn=this.model.root._namedFns[t]||Eo[t],!this.filterFn))throw new TypeError("Filter function not found: "+t);return this},To.prototype.sort=function(t){if(t||(t="asc"),"function"==typeof t)return this.sortFn=t,this.bundle=!1,this;if("string"==typeof t&&(this.sortName=t,this.sortFn=this.model.root._namedFns[t]||Eo[t],!this.sortFn))throw new TypeError("Sort function not found: "+t);return this},To.prototype._slice=function(t){if(null==this.skip&&null==this.limit)return t;var e,n=this.skip||0;return this.limit&&(e=n+this.limit),t.slice(n,e)},To.prototype.getInputs=function(){if(this.inputsSegments){for(var t=[],e=0,n=this.inputsSegments.length;e<n;e++){var r=this.model._get(this.inputsSegments[e]);t.push(r)}return t}},To.prototype.callFilter=function(t,e,n){var r=t[e];return n?this.filterFn.apply(this.model,[r,e,t].concat(n)):this.filterFn.call(this.model,r,e,t)},To.prototype.ids=function(){var t=this.model._get(this.segments),e=[];if(!t)return e;if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var r in t)t.hasOwnProperty(r)&&this.callFilter(t,r,n)&&e.push(r)}else e=Object.keys(t);var i=this.sortFn;return i&&e.sort(function(e,n){return i(t[e],t[n])}),this._slice(e)},To.prototype.get=function(){var t=this.model._get(this.segments),e=[];if(Array.isArray(t))throw new Error("model.filter is not currently supported on arrays");if(this.filterFn){var n=this.getInputs();for(var r in t)t.hasOwnProperty(r)&&this.callFilter(t,r,n)&&e.push(t[r])}else for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return this.sortFn&&e.sort(this.sortFn),this._slice(e)},To.prototype.update=function(t){var e=this.ids();this.model.pass(t,!0)._setArrayDiff(this.idsSegments,e)},To.prototype.ref=function(t){return t=this.model.path(t),this.from=t,this.fromSegments=t.split("."),this.filters.fromMap[t]=this,this.idsSegments=["$filters",t.replace(/\./g,"|")],this.update(),this.model.refList(t,this.path,this.idsSegments.join("."))},To.prototype.destroy=function(){delete this.filters.fromMap[this.from],this.model._removeRef(this.idsSegments),this.model._del(this.idsSegments)};function Lo(t,e){t.on(e+"Immediate",function(n,r){var i=r[r.length-1],o=t._refLists.fromMap;for(var s in o){var a=o[s];i.$refList!==a&&a.onMutation(e,n,r)}})}function Oo(t,e,n){for(var r=[],i=0;i<n.length;i++){var o=n[i],s=e.idByItem(o);void 0===s&&"object"==typeof o&&(s=o.id=t.id());var a=e.toSegmentsByItem(o);if(void 0===s||void 0===a)throw new Error("Unable to add item to refList: "+o);t._get(a)!==o&&t._set(a,o),r.push(s)}return r}function Po(t,e,n,r,i){this.model=t&&t.pass({$refList:this}),this.from=e,this.to=n,this.ids=r,this.fromSegments=e&&e.split("."),this.toSegments=n&&n.split("."),this.idsSegments=r&&r.split("."),this.options=i,this.deleteRemoved=i&&i.deleteRemoved}function jo(){}function No(){this.fromMap=new jo}qi.INITS.push(function(t){var e=t.root;for(var n in e._refLists=new No,qi.MUTATOR_EVENTS)Lo(e,n)}),qi.prototype.refList=function(){var t,e,n,r;2===arguments.length?(e=arguments[0],n=arguments[1]):3===arguments.length?this.isPath(arguments[2])?(t=arguments[0],e=arguments[1],n=arguments[2]):(e=arguments[0],n=arguments[1],r=arguments[2]):(t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3]);var i,o=this.path(t);if(Array.isArray(e)){i=[];for(var s=0;s<e.length;s++)i.push(this.path(e[s]))}else i=this.path(e);var a=this.path(n),p=new Po(this.root,o,i,a,r);return this.root._refLists.remove(o),p.model._setArrayDiff(p.fromSegments,p.get()),this.root._refLists.add(p),this.scope(o)},Po.prototype.get=function(){var t=this.model._get(this.idsSegments);if(!t)return[];for(var e=this.model._get(this.toSegments),n=[],r=0;r<t.length;r++){var i=t[r];n.push(e&&e[i])}return n},Po.prototype.dereference=function(t,e){var n=t.slice(e+1),r=this.idByIndex(n[0]);return null==r?[]:(n[0]=r,this.toSegments.concat(n))},Po.prototype.toSegmentsByItem=function(t){var e=this.idByItem(t);if(void 0!==e)return this.toSegments.concat(e)},Po.prototype.idByItem=function(t){if(t&&t.id)return t.id;var e=this.model._get(this.toSegments);for(var n in e)if(t===e[n])return n},Po.prototype.indicesByItem=function(t){var e=this.idByItem(t),n=this.model._get(this.idsSegments);if(n){for(var r,i=-1;-1!==(i=n.indexOf(e,i+1));)r?r.push(i):r=[i];return r}},Po.prototype.itemById=function(t){return this.model._get(this.toSegments.concat(t))},Po.prototype.idByIndex=function(t){return this.model._get(this.idsSegments.concat(t))},Po.prototype.onMutation=function(t,e,n){_r.mayImpact(this.toSegments,e)?function(t,e,n,r){var i=r.toSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o===i){if("insert"===t){for(var p=n[1],u=0;u<p.length;u++){var c=p[u];if(w=r.indicesByItem(c))for(var h=0;h<w.length;h++){var l=r.fromSegments.concat(w[h]);a._set(l,c)}}return}if("remove"===t){for(var f=n[0],m=(u=f,f+(p=n[1]).length);u<m;u++)if(w=r.indicesByItem(p[u])){h=0;for(var d=w.length;h<d;h++)l=r.fromSegments.concat(w[h]),a._set(l,void 0)}return}if("move"===t)return}if(o<=i)a._setArrayDiff(r.fromSegments,r.get());else if(o>i+1){if(c=a._get(e.slice(0,i+1)),!(w=r.indicesByItem(c)))return;var y=e.slice(i+1);for(u=0;u<w.length;u++){var v=w[u],g=r.fromSegments.concat(v,y);g=a._dereference(g,null,r),(n=n.slice())[n.length-1]=a._pass,a.emit(t,g,n)}}else if("change"!==t&&"load"!==t&&"unload"!==t){var w;if(c=a._get(e.slice(0,i+1)),(w=r.indicesByItem(c))&&("insert"===t||"remove"===t||"move"===t))for(u=0;u<w.length;u++)g=r.fromSegments.concat(w[u]),g=a._dereference(g,null,r),(n=n.slice())[n.length-1]=a._pass,a.emit(t,g,n)}else{var x;"change"===t?(c=n[0],x=n[1]):"load"===t?(c=n[0],x=void 0):"unload"===t&&(c=void 0,x=n[0]);var b=r.indicesByItem(c),_=r.indicesByItem(x);if(!b&&!_)return;if(_&&!function(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(_,b))for(var u=0;u<_.length;u++)l=r.fromSegments.concat(_[u]),a._set(l,void 0);if(b)for(u=0;u<b.length;u++)l=r.fromSegments.concat(b[u]),a._set(l,c)}}(t,e,n,this):_r.mayImpact(this.idsSegments,e)?function(t,e,n,r){var i=r.idsSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o===i){if("insert"===t){for(var p=n[0],u=n[1],c=[],h=0;h<u.length;h++){var l=r.itemById(u[h]);c.push(l)}return void a._insert(r.fromSegments,p,c)}if("remove"===t){p=n[0];var f=n[1].length;return void a._remove(r.fromSegments,p,f)}if("move"===t){var m=n[0],d=n[1];return f=n[2],void a._move(r.fromSegments,m,d,f)}}if(o<=i)a._setArrayDiff(r.fromSegments,r.get());else{p=e[i];var y=r.idByIndex(p),v=r.itemById(y),g=r.fromSegments.concat(p);a._get(g)!==v&&a._set(g,v)}}(t,e,n,this):_r.mayImpact(this.fromSegments,e)&&function(t,e,n,r){var i=r.fromSegments.length,o=e.length,s=n[n.length-1],a=r.model.pass(s,!0);if(o!==i)if(o<i)a._setArrayDiff(r.fromSegments,r.get());else{c=e[i];var p=a._get(r.fromSegments.concat(c)),u=r.toSegmentsByItem(p);if(o>i+1)throw new Error("Mutation on descendant of refList `from` should have been dereferenced: "+e.join("."));if("change"===t)return a._set(u,p),void function(t,e,n,r){var i=e.idByItem(r),o=e.idsSegments.concat(n);t._set(o,i)}(a,r,c,p);if("insert"===t||"remove"===t||"move"===t)throw new Error("Array mutation on child of refList `from`should have been dereferenced: "+e.join("."))}else{if("insert"===t){var c=n[0],h=Oo(a,r,v=n[1]);return void a._insert(r.idsSegments,c,h)}if("remove"===t){var c=n[0],l=n[1].length;if(h=a._remove(r.idsSegments,c,l),r.deleteRemoved)for(var f=0;f<h.length;f++){var m=r.itemById(h[f]);a._del(r.toSegmentsByItem(m))}return}if("move"===t){var d=n[0],y=n[1];return l=n[2],void a._move(r.idsSegments,d,y,l)}var v;if(!(v="change"===t?n[0]:a._get(r.fromSegments)))return void a._set(r.idsSegments,[]);h=Oo(a,r,v),a._set(r.idsSegments,h)}}(t,e,n,this)},No.prototype.add=function(t){this.fromMap[t.from]=t},No.prototype.remove=function(t){var e=this.fromMap[t];return delete this.fromMap[t],e},No.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to,n.ids,n.options])}return t};function Mo(t,e,n,r){var i=n[0];if(void 0===i){var o=r.slice(),s=o.pop(),a=t._get(o);if(!(a&&s in a))return void t._del(e)}t._set(e,i)}function Do(t,e,n){var r=n[0];t._set(e,r)}function Ro(t,e){t._del(e)}function Bo(t,e,n){var r=n[0],i=n[1];t._insert(e,r,i)}function Fo(t,e,n){var r=n[0],i=n[1].length;t._remove(e,r,i)}function Uo(t,e,n){var r=n[0],i=n[1],o=n[2];t._move(e,r,i,o)}function $o(t,e,n){t.on(e+"Immediate",function(r,i){for(var o,s=i[i.length-1],a=t._refs.toMap,p=0,u=r.length;p<u;p++){o=o?o+"."+r[p]:r[p];var c=a[o];if(c){c=c.slice();for(var h=r.slice(p+1),l=0,f=c.length;l<f;l++){var m=c[l],d=m.fromSegments.concat(h);if(t._get(d)===t._get(r))t.emit(e,d,i);else{var y=m.model.pass(s,!0);y._dereference=qo,n(y,d,i,r)}}}}var v=t._refs.parentToMap;if(!(c=v[o]))return;for(var l=0,f=c.length;l<f;l++){var m=c[l],g=t._get(m.toSegments),w=t._get(m.fromSegments);if(w!==g){var y=m.model.pass(s,!0);y._dereference=qo,y._set(m.fromSegments,g)}}})}function qo(t){return t}function Vo(t,e,n,r){this.model=t&&t.pass({$ref:this}),this.from=e,this.to=n,this.fromSegments=e.split("."),this.toSegments=n.split("."),this.parentTos=[];for(var i=1,o=this.toSegments.length;i<o;i++){var s=this.toSegments.slice(0,i).join(".");this.parentTos.push(s)}this.updateIndices=r&&r.updateIndices}function zo(){}function Ho(){}function Go(){this.fromMap=new zo,this.toMap=new Ho,this.parentToMap=new Ho}function Ko(t,e,n){t[e]||(t[e]=[]),t[e].push(n)}function Qo(t,e,n){var r=t[e];if(r){var i=r.indexOf(n);-1!==i&&(r.splice(i,1),r.length||delete t[e])}}qi.INITS.push(function(t){var e=t.root;e._refs=new Go,function(t){function e(e,n){var r=t._refs.fromMap;for(var i in r){var o=r[i];if(o.updateIndices&&_r.contains(e,o.toSegments)&&o.toSegments.length>e.length){var s=+o.toSegments[e.length],a=n(s);s!==a&&(t._refs.remove(i),o.toSegments[e.length]=""+a,o.to=o.toSegments.join("."),t._refs.add(o))}}}t.on("insertImmediate",function(t,n){var r=n[0],i=n[1].length;e(t,function(t){return r<=t?t+i:t})}),t.on("removeImmediate",function(t,n){var r=n[0],i=n[1].length;e(t,function(t){return r<=t?t-i:t})}),t.on("moveImmediate",function(t,n){var r=n[0],i=n[1],o=n[2];e(t,function(t){if(r<=t&&t<r+o)return t+i-r;r<=t&&(t-=o);i<=t&&(t+=o);return t})})}(e),$o(e,"change",Mo),$o(e,"load",Do),$o(e,"unload",Ro),$o(e,"insert",Bo),$o(e,"remove",Fo),$o(e,"move",Uo)}),qi.prototype._canRefTo=function(t){return this.isPath(t)||t&&"function"==typeof t.ref},qi.prototype.ref=function(){var t,e,n;1===arguments.length?e=arguments[0]:2===arguments.length?this._canRefTo(arguments[1])?(t=arguments[0],e=arguments[1]):(e=arguments[0],n=arguments[1]):(t=arguments[0],e=arguments[1],n=arguments[2]);var r=this.path(t),i=this.path(e);if(!i)return e.ref(r);var o=new Vo(this.root,r,i,n);if(o.fromSegments.length<2)throw new Error("ref must be performed under a collection and document id. Invalid path: "+r);this.root._refs.remove(r),this.root._refLists.remove(r);var s=this.get(e);return o.model._set(o.fromSegments,s),this.root._refs.add(o),this.scope(r)},qi.prototype.removeRef=function(t){var e=this._splitPath(t),n=e.join(".");this._removeRef(e,n)},qi.prototype._removeRef=function(t,e){this.root._refs.remove(e),this.root._refLists.remove(e),this._del(t)},qi.prototype.removeAllRefs=function(t){var e=this._splitPath(t);this._removeAllRefs(e)},qi.prototype._removeAllRefs=function(t){this._removeMapRefs(t,this.root._refs.fromMap),this._removeMapRefs(t,this.root._refLists.fromMap)},qi.prototype._removeMapRefs=function(t,e){for(var n in e){var r=e[n].fromSegments;_r.contains(t,r)&&this._removeRef(r,n)}},qi.prototype.dereference=function(t){var e=this._splitPath(t);return this._dereference(e).join(".")},qi.prototype._dereference=function(t,e,n){if(0===t.length)return t;var r,i=this.root._refs.fromMap,o=this.root._refLists.fromMap;do{var s="";r=!1;for(var a=0,p=t.length;a<p;a++){var u=i[s=s?s+"."+t[a]:t[a]];if(u){var c=t.slice(a+1);t=u.toSegments.concat(c),r=!0;break}var h=o[s];if(h&&h!==n){if(!(a+2<p||e&&a+1<p))continue;t=h.dereference(t,a),r=!0;break}}}while(r);return 0===t.length?["$null"]:t},Go.prototype.add=function(t){this.fromMap[t.from]=t,Ko(this.toMap,t.to,t);for(var e=0,n=t.parentTos.length;e<n;e++)Ko(this.parentToMap,t.parentTos[e],t)},Go.prototype.remove=function(t){var e=this.fromMap[t];if(e){delete this.fromMap[t],Qo(this.toMap,e.to,e);for(var n=0,r=e.parentTos.length;n<r;n++)Qo(this.parentToMap,e.parentTos[n],e);return e}},Go.prototype.toJSON=function(){var t=[];for(var e in this.fromMap){var n=this.fromMap[e];t.push([n.from,n.to])}return t};var Jo=qi,Wo=Jt.EventEmitter,Yo=Xo;function Xo(){Wo.call(this)}function Zo(t){Si.call(this,t)}ii.add(document),_r.mergeInto(Xo.prototype,Wo.prototype),Xo.prototype.Model=Jo,Xo.prototype.util=_r,Xo.prototype.App=Zo,Xo.prototype.Page=yi,Xo.prototype.Component=Lr.Component,Xo.prototype.createApp=function(){return new this.App(this)},Zo.prototype=Object.create(Si.prototype),Zo.prototype.constructor=Zo,Zo.prototype._init=function(){this.model=new this.derby.Model,this.createPage()};(function(t){var e=new Yo,n=e.App;t.derby=e,n.prototype.getTemplate=function(t){return document.getElementById(t)},n.prototype.loadViews=function(t,e){var n=this._resolveTemplate(t);if(!n)throw new Error('Cannot find template "'+t+'"');this._registerTemplate(n.template,e,n.filename)},n.prototype._registerTemplate=function(t,e,n){var r=t.innerHTML,i=this;var o=Ii.parseViews(r,e,n,function(t){var r=vn.dirname(n),o=vn.resolve(r,t.src),s=i._resolveTemplate(o);if(!s)throw new Error('Cannot find template "'+t.src+'" from "'+n+'"');importNamespace=Ii.getImportNamespace(e,t,s.filename),i._registerTemplate(s.template,importNamespace,s.filename)});Ii.registerParsedViews(this,o)},n.prototype._resolveTemplate=function(t){var e;return(e=this._attemptResolveTemplate(t))?e:(e=this._attemptResolveTemplate(t+".html"))?e:(e=this._attemptResolveTemplate(t+"/index"))?e:e=this._attemptResolveTemplate(t+"/index.html")},n.prototype._attemptResolveTemplate=function(t){var e=this.getTemplate(t);if(e)return{template:e,filename:t}},n.prototype.registerViews=function(t){t||(t='script[type="text/template"]');for(var e=document.querySelectorAll(t),n=0;n<e.length;n++){var r=e[n];this.views.register(r.id,r.innerHTML,r.dataset)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}();
//# sourceMappingURL=derby-standalone.min.map.json